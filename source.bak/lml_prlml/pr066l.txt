000010 IDENTIFICATION    DIVISION.
000020 PROGRAM-ID.       PR066L.
000030 AUTHOR.           MAYUMI.I.
000040*****************************************************
000050*    PROGRAM       :  経費マスタリスト　　　　　　  *
000060*    PRINTER TYPE  :  JIPS                          *
000070*    DATA WRITTEN  :  99/07/02                      *
000080*    COMPILE TYPE  :  COBOL                         *
000090*****************************************************
000100 ENVIRONMENT       DIVISION.
000110 CONFIGURATION     SECTION.
000120 SOURCE-COMPUTER.     SYSTEM3100.
000130 OBJECT-COMPUTER.     SYSTEM3100.
000140 INPUT-OUTPUT      SECTION.
000150 FILE-CONTROL.
000160     SELECT   HH-F    ASSIGN  TO   F1-MSD
000170              ORGANIZATION    INDEXED
000180              ACCESS          DYNAMIC
000190              RECORD  KEY     HH-KEY.
000200     SELECT   BNM     ASSIGN  TO   F2-MSD
000210              ORGANIZATION    INDEXED
000220              ACCESS          RANDOM
000230              RECORD  KEY     BNM-KEY.
000240     SELECT   KNG     ASSIGN  TO   F3-MSD
000250              ORGANIZATION    INDEXED
000260              ACCESS          RANDOM
000270              RECORD  KEY     KNG-KEY.
000280     SELECT   FCTL-F  ASSIGN  TO   F4-MSD
000290              ORGANIZATION    INDEXED
000300              ACCESS          RANDOM
000310              RECORD  KEY     FCTL-KEY.
000320     SELECT   SP-F    ASSIGN  TO   P-PRN999.
000330 I-O-CONTROL.
000340     APPLY     SHARED-MODE   ON   HH-F
000350     APPLY     SHARED-MODE   ON   BNM
000360     APPLY     SHARED-MODE   ON   KNG
000370     APPLY     SHARED-MODE   ON   FCTL-F
000380     APPLY     SHIFT-CODE    ON   SP-F.
000390 DATA              DIVISION.
000400 FILE              SECTION.
000410     COPY  KEIHI.
000420     COPY  BUMONF.
000430     COPY  KANGEL.
000440     COPY  FCTL.
000450 FD  SP-F
000460     LABEL       RECORD  OMITTED
000470     LINAGE          IS       66.
000480 01  SP-R               PIC  X(250).
000490 WORKING-STORAGE     SECTION.
000500 77  ERR-STAT           PIC  X(002).
000510 01  HEAD1.
000520     02  F              PIC  X(005) VALUE ""3FE04FE080"".
000530     02  F              PIC  X(039) VALUE SPACE.
000540     02  F              PIC  N(019) VALUE
000550         NC"＊＊＊　　経費マスタ　リスト　　＊＊＊".
000560     02  F              PIC  X(034) VALUE SPACE.
000570     02  H-NEN          PIC  9(002).
000580     02  F              PIC  N(001) VALUE NC"年".
000590     02  H-GET          PIC Z9.
000600     02  F              PIC  N(001) VALUE NC"月".
000610     02  H-PEY          PIC  Z9.
000620     02  F              PIC  N(003) VALUE NC"日作成".
000630     02  F              PIC  X(004) VALUE SPACE.
000640     02  H-PAGE         PIC ZZ9.
000650     02  F              PIC  N(001) VALUE NC"頁".
000660 01  HEAD2.
000670     02  F              PIC  X(005) VALUE ""3FE04F40A0"".
000680     02  F              PIC  N(002) VALUE NC"部門".
000690     02  F              PIC  X(002) VALUE "C ".
000700     02  F              PIC  N(004) VALUE NC"部門名称".
000710     02  F              PIC  X(010) VALUE SPACE.
000720     02  F              PIC  N(002) VALUE NC"科目".
000730     02  F              PIC  X(002) VALUE "C-".
000740     02  F              PIC  N(002) VALUE NC"補助".
000750     02  F              PIC  X(002) VALUE "C ".
000760     02  F              PIC  N(004) VALUE NC"科目名称".
000770     02  F              PIC  X(010) VALUE SPACE.
000780     02  F              PIC  N(004) VALUE NC"補助名称".
000790     02  F              PIC  X(010) VALUE SPACE.
000800     02  F              PIC  N(002) VALUE NC"合計".
000810     02  F              PIC  X(002) VALUE "C ".
000820     02  F              PIC  N(004) VALUE NC"改行数　".
000830     02  F              PIC  X(062) VALUE SPACE.
000840 01  HEAD3.
000850     02  F              PIC  X(052) VALUE SPACE.
000860     02  H-TMD1  OCCURS  6.
000870       03  F            PIC  X(008) VALUE SPACE.
000880       03  H-TM1        PIC  N(004).
000890 01  HEAD4.
000900     02  F              PIC  X(052) VALUE SPACE.
000910     02  H-TMD2  OCCURS  6.
000920       03  F            PIC  X(008) VALUE SPACE.
000930       03  H-TM2        PIC  N(004).
000940 01  HEAD5.
000950     02  F              PIC  X(052) VALUE SPACE.
000960     02  H-TMD3  OCCURS  3.
000970       03  F            PIC  X(008) VALUE SPACE.
000980       03  H-TM3        PIC  N(004).
000990     02  F              PIC  X(042) VALUE SPACE.
001000 01  W-P1.
001010     02  P-BMC          PIC  9(004).
001020     02  F              PIC  X(001).
001030     02  P-BMN          PIC  N(010).
001040     02  F              PIC  X(001).
001050     02  P-KMC          PIC  9(004).
001060     02  P-V            PIC  X(001).
001070     02  P-HJC          PIC  9(004).
001080     02  F              PIC  X(001).
001090     02  P-KMN          PIC  N(010).
001100     02  F              PIC  X(001).
001110     02  P-HJN          PIC  N(010).
001120     02  F              PIC  X(002).
001130     02  P-GKC          PIC  9(003).
001140     02  F              PIC  X(004).
001150     02  P-KGS          PIC  9(001).
001160     02  F              PIC  X(064).
001170 01  W-P2.
001180     02  F              PIC  X(052).
001190     02  P-KIND  OCCURS  6.
001200       03  P-KIN        PIC  ------,---,--9.
001210 01  W-PD.
001220     02  W-TM           PIC  N(004).
001230     02  W-TMD.
001240       03  F            PIC  N(001) VALUE SPACE.
001250       03  W-TUKI       PIC  N(002).
001260       03  F            PIC  N(001) VALUE NC"月".
001270 01  W-DATA.
001280     02  W-DATE         PIC  9(006).                              ｼｽﾃﾑﾋｽﾞｹ
001290     02  W-NGPD  REDEFINES  W-DATE.
001300       03  W-NEND       PIC  9(002).
001310       03  W-GETD       PIC  9(002).
001320       03  W-PEYD       PIC  9(002).
001330     02  W-DMM          PIC  9(001).
001340     02  W-PAGE         PIC  9(003).
001350     02  CNT            PIC  9(002).
001360     02  W-C            PIC  9(002).
001370     02  W-HC           PIC  9(001).
001380     02  W-KGET         PIC  9(002).
001390     02  W-GET          PIC  9(002).
001400     02  W-TD           PIC Z9.
001410     02  W-AREA.
001420       03  W-SD.
001430         04  W-SBMC     PIC  9(004).
001440         04  W-SKMC     PIC  9(004).
001450         04  W-SHJC     PIC  9(004).
001460       03  W-ED.
001470         04  W-EBMC     PIC  9(004).
001480         04  W-EKMC     PIC  9(004).
001490         04  W-EHJC     PIC  9(004).
001500     02  W-KN.
001510       03  W-KIND  OCCURS  15.
001520         04  W-KIN      PIC S9(011).
001530 SCREEN             SECTION.
001540 SD  C-CRT    END  STATUS  ESTAT.
001550 01  C-CLEAR.
001560     02  LINE   1  CLEAR  SCREEN.
001570 01  C-MID.
001580     02  LINE  01  COLUMN  32  VALUE
001590         " 経費マスタ　リスト "  REVERSE.
001600     02  LINE  04  COLUMN  31  VALUE  "ＦＲＯＭ".
001610     02  LINE  04  COLUMN  51  VALUE  "ＴＯ".
001620     02  LINE  06  COLUMN  11  VALUE  "部門コード".
001630     02  LINE  08  COLUMN  11  VALUE  "科目コード".
001640     02  LINE  10  COLUMN  11  VALUE  "補助科目コード".
001650     02  LINE  06  COLUMN  43  VALUE  "〜".
001660     02  LINE  08  COLUMN  43  VALUE  "〜".
001670     02  LINE  10  COLUMN  43  VALUE  "〜".
001680     02  LINE  23  COLUMN  61  VALUE  "確認 OK=1,NO=9 ( )".
001690 01  C-ACP.
001700     02  LINE   6.
001710       03  A-SBMC  COLUMN  33  PIC  9(004)
001720            USING W-SBMC  NO IFC CHECK OVERFLOW.
001730       03  A-EBMC  COLUMN  51  PIC  9(004)
001740            USING W-EBMC  NO IFC CHECK OVERFLOW.
001750     02  LINE   8.
001760       03  A-SKMC  COLUMN  33  PIC  9(004)
001770            USING W-SKMC  NO IFC CHECK OVERFLOW.
001780       03  A-EKMC  COLUMN  51  PIC  9(004)
001790            USING W-EKMC  NO IFC CHECK OVERFLOW.
001800     02  LINE  10.
001810       03  A-SHJC  COLUMN  33  PIC  9(004)
001820            USING W-SHJC  NO IFC CHECK OVERFLOW.
001830       03  A-EHJC  COLUMN  51  PIC  9(004)
001840            USING W-EHJC  NO IFC CHECK OVERFLOW.
001850     02  A-DMM   LINE  23  COLUMN  77  PIC  9(001)
001860          USING W-DMM   NO IFC CHECK OVERFLOW.
001870 01  C-ERR.
001880     02  LINE  24.
001890       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001900            "***  DATA ﾅｼ  ***".
001910       03  E-ME2   COLUMN  15  PIC  X(032) VALUE
001920            "***  ｺﾝﾄﾛｰﾙﾌｧｲﾙ(FCONTRL) ﾅｼ  ***".
001930       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001940       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001950 PROCEDURE          DIVISION.
001960 M-05.
001970     DISPLAY C-CLEAR.
001980     DISPLAY C-MID.
001990     INITIALIZE W-DATA.
002000 M-10.
002010     ACCEPT A-SBMC.
002020     IF ESTAT = "P9"
002030         GO TO M-95.
002040     IF ESTAT NOT = "01" AND "06"
002050         GO TO M-10.
002060 M-15.
002070     ACCEPT A-EBMC.
002080     IF ESTAT = "09"
002090         GO TO M-10.
002100     IF ESTAT NOT = "01" AND "06"
002110         GO TO M-15.
002120     IF W-SBMC > W-EBMC
002130         GO TO M-15.
002140 M-20.
002150     ACCEPT A-SKMC.
002160     IF ESTAT = "09"
002170         GO TO M-15.
002180     IF ESTAT NOT = "01" AND "06"
002190         GO TO M-20.
002200 M-25.
002210     ACCEPT A-EKMC.
002220     IF ESTAT = "09"
002230         GO TO M-20.
002240     IF ESTAT NOT = "01" AND "06"
002250         GO TO M-20.
002260 M-30.
002270     ACCEPT A-SHJC.
002280     IF ESTAT = "09"
002290         GO TO M-25.
002300     IF ESTAT NOT = "01" AND "06"
002310         GO TO M-30.
002320 M-35.
002330     ACCEPT A-EHJC.
002340     IF ESTAT = "09"
002350         GO TO M-30.
002360     IF ESTAT NOT = "01" AND "06"
002370         GO TO M-35.
002380     IF W-SD > W-ED
002390         GO TO M-20.
002400 M-40.
002410     ACCEPT A-DMM.
002420     IF ESTAT = "09"
002430         GO TO M-35.
002440     IF ESTAT NOT = "01" AND "06"
002450         GO TO M-40.
002460     IF W-DMM = 9
002470         GO TO M-10.
002480     IF W-DMM NOT = 1
002490         GO TO M-40.
002500*
002510     OPEN INPUT HH-F
002520     MOVE W-SD TO HH-KEY.
002530     START HH-F KEY NOT < HH-KEY INVALID
002540         CLOSE HH-F
002550         DISPLAY E-ME1 E-ME99
002560         GO TO M-95.
002570     READ HH-F NEXT WITH UNLOCK AT END
002580         CLOSE HH-F
002590         DISPLAY E-ME1 E-ME99
002600         GO TO M-95.
002610     IF HH-KEY > W-ED
002620         CLOSE HH-F
002630         DISPLAY E-ME1 E-ME99
002640         GO TO M-95.
002650*
002660     OPEN INPUT FCTL-F.
002670     MOVE "DATE  " TO FCTL-KEY.
002680     READ FCTL-F WITH UNLOCK INVALID
002690         CLOSE HH-F FCTL-F
002700         DISPLAY E-ME2 E-ME99
002710         GO TO M-95.
002720     MOVE FCTL-KSMM TO W-GET W-KGET.
002730     CLOSE FCTL-F.
002740*
002750     MOVE 0 TO W-HC.
002760 M-45.
002770     ADD 1 TO W-HC.
002780     IF W-HC = 4
002790         GO TO M-55.
002800     MOVE ZERO TO CNT.
002810 M-50.
002820     ADD 1 TO CNT.
002830     IF W-HC = 1 OR 2
002840         IF CNT = 7
002850             GO TO M-45.
002860     IF W-HC = 3
002870         IF CNT = 4
002880             GO TO M-45.
002890     ADD 1 TO W-GET.
002900     IF W-GET = 13
002910         MOVE 1 TO W-GET.
002920     MOVE W-GET TO W-TD.
002930     MOVE W-TD TO W-TUKI.
002940     MOVE W-TMD TO W-TM.
002950     IF W-HC = 1
002960         MOVE W-TM TO H-TM1(CNT).
002970     IF W-HC = 2
002980         MOVE W-TM TO H-TM2(CNT).
002990     IF W-HC = 3
003000         MOVE W-TM TO H-TM3(CNT).
003010     GO TO M-50.
003020 M-55.
003030     ACCEPT W-DATE FROM DATE.
003040     MOVE W-NEND TO H-NEN.
003050     MOVE W-GETD TO H-GET.
003060     MOVE W-PEYD TO H-PEY.
003070*
003080     OPEN INPUT BNM KNG.
003090     OPEN OUTPUT SP-F.
003100     PERFORM S-10 THRU S-15.
003110 M-60.
003120     MOVE ZERO TO W-KN W-C.
003130     MOVE W-KGET TO CNT.
003140 M-65.
003150     ADD 1 TO W-C CNT.
003160     IF W-C = 16
003170         GO TO M-70.
003180     IF W-C = 13
003190         MOVE 13 TO CNT.
003200     IF (CNT = 13) AND (W-C < 13)
003210         MOVE 1 TO CNT.
003220     MOVE HH-GEL(CNT) TO W-KIN(W-C).
003230     GO TO M-65.
003240 M-70.
003250     MOVE HH-BUCD TO BNM-KEY.
003260     READ BNM UNLOCK INVALID
003270         MOVE SPACE TO BNMNMN.
003280*
003290     MOVE HH-KACD TO K-ACCD.
003300     MOVE ZERO TO K-HOCD.
003310     READ KNG UNLOCK INVALID
003320         MOVE SPACE TO KNGNMN.
003330*
003340     MOVE SPACE TO W-P1.
003350     MOVE SPACE TO P-BMN P-KMN P-HJN.
003360     MOVE HH-BUCD TO P-BMC.
003370     MOVE BNMNMN TO P-BMN.
003380     MOVE HH-KACD TO P-KMC.
003390     MOVE "-" TO P-V.
003400     MOVE HH-HOCD TO P-HJC.
003410     MOVE KNGNMN TO P-KMN.
003420     IF HH-HOCD = ZERO
003430         GO TO M-75.
003440     MOVE HH-KACD TO K-ACCD.
003450     MOVE HH-HOCD TO K-HOCD.
003460     READ KNG UNLOCK INVALID
003470         MOVE SPACE TO KNGNMN.
003480     MOVE KNGNMN TO P-HJN.
003490 M-75.
003500     MOVE HH-GOCD TO P-GKC.
003510     MOVE HH-GYO TO P-KGS.
003520     IF LINAGE-COUNTER > 57
003530         PERFORM S-05 THRU S-15.
003540     MOVE SPACE TO SP-R.
003550     MOVE W-P1 TO SP-R.
003560     WRITE SP-R.
003570     MOVE SPACE TO SP-R.
003580*
003590     MOVE SPACE TO W-P2.
003600     MOVE W-KIN(01) TO P-KIN(01).
003610     MOVE W-KIN(02) TO P-KIN(02).
003620     MOVE W-KIN(03) TO P-KIN(03).
003630     MOVE W-KIN(04) TO P-KIN(04).
003640     MOVE W-KIN(05) TO P-KIN(05).
003650     MOVE W-KIN(06) TO P-KIN(06).
003660     MOVE SPACE TO SP-R.
003670     MOVE W-P2 TO SP-R.
003680     WRITE SP-R.
003690     MOVE SPACE TO SP-R.
003700*
003710     MOVE SPACE TO W-P2.
003720     MOVE W-KIN(07) TO P-KIN(01).
003730     MOVE W-KIN(08) TO P-KIN(02).
003740     MOVE W-KIN(09) TO P-KIN(03).
003750     MOVE W-KIN(10) TO P-KIN(04).
003760     MOVE W-KIN(11) TO P-KIN(05).
003770     MOVE W-KIN(12) TO P-KIN(06).
003780     MOVE SPACE TO SP-R.
003790     MOVE W-P2 TO SP-R.
003800     WRITE SP-R.
003810     MOVE SPACE TO SP-R.
003820*
003830     MOVE SPACE TO W-P2.
003840     MOVE W-KIN(13) TO P-KIN(01).
003850     MOVE W-KIN(14) TO P-KIN(02).
003860     MOVE W-KIN(15) TO P-KIN(03).
003870     MOVE SPACE TO SP-R.
003880     MOVE W-P2 TO SP-R.
003890     WRITE SP-R.
003900     MOVE SPACE TO SP-R.
003910*
003920     READ HH-F NEXT WITH UNLOCK AT END
003930         GO TO M-90.
003940     IF HH-KEY > W-ED
003950         GO TO M-90.
003960     GO TO M-60.
003970 M-90.
003980     CLOSE HH-F.
003990     CLOSE BNM KNG.
004000     CLOSE SP-F.
004010 M-95.
004020     DISPLAY C-CLEAR.
004030     STOP RUN.
004040 S-05.
004050     MOVE SPACE TO SP-R.
004060     WRITE SP-R AFTER PAGE.
004070 S-10.
004080     ADD 1 TO W-PAGE.
004090     MOVE W-PAGE TO H-PAGE.
004100     MOVE SPACE TO SP-R.
004110     MOVE HEAD1 TO SP-R.
004120     WRITE SP-R.
004130     MOVE SPACE TO SP-R.
004140     MOVE HEAD2 TO SP-R.
004150     WRITE SP-R AFTER 2.
004160     MOVE SPACE TO SP-R.
004170     MOVE HEAD3 TO SP-R.
004180     WRITE SP-R.
004190     MOVE SPACE TO SP-R.
004200     MOVE HEAD4 TO SP-R.
004210     WRITE SP-R.
004220     MOVE SPACE TO SP-R.
004230     MOVE HEAD5 TO SP-R.
004240     WRITE SP-R.
004250     MOVE SPACE TO SP-R.
004260 S-15.
004270     EXIT.
