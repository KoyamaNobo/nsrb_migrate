000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         PR560U.
000030*
000040 ENVIRONMENT         DIVISION.
000050 CONFIGURATION       SECTION.
000060 SOURCE-COMPUTER.    SYSTEM100.
000070 OBJECT-COMPUTER.    SYSTEM100.
000080 INPUT-OUTPUT        SECTION.
000090 FILE-CONTROL.
000100     SELECT  BZM-F   ASSIGN    TO  BZU-MSD
000110                     ORGANIZATION  INDEXED
000120                     RECORD   KEY  BZM-KEY
000130                     FILE      STATUS  IS  ERR-STAT.
000140*
000150     SELECT  AM      ASSIGN    TO  AM-MSD
000160                     ORGANIZATION  INDEXED
000170                     ACCESS  MODE  RANDOM
000180                     RECORD   KEY  AM-KEY
000190                     FILE      STATUS  IS  ERR-STAT.
000200*
000210     SELECT  GEN     ASSIGN    TO  PL-MSD
000220                     ORGANIZATION  INDEXED
000230                     ACCESS  MODE  RANDOM
000240                     RECORD   KEY  PL-KEY
000250                     FILE      STATUS  IS  ERR-STAT.
000260*
000270     SELECT  BUGEN-F    ASSIGN  TO  BU-MSD
000280                     ORGANIZATION  INDEXED
000290                     ACCESS  MODE  DYNAMIC
000300                     RECORD   KEY  BU-KEY
000310                     FILE      STATUS  IS  ERR-STAT.
000320*
000330     SELECT  FCTL-F  ASSIGN    TO  FCTL-MSD
000340                     ORGANIZATION  INDEXED
000350                     ACCESS  MODE  RANDOM
000360                     RECORD   KEY  FCTL-KEY
000370                     FILE      STATUS  IS  ERR-STAT.
000380 I-O-CONTROL.
000390     APPLY   SHARED-MODE      ON   AM  BUGEN-F
000400     APPLY   SHARED-MODE      ON   GEN BZM-F
000410     APPLY   SHARED-MODE      ON   FCTL-F.
000420 DATA                DIVISION.
000430 FILE                SECTION.
000440     COPY    LBUZAN.
000450     COPY    ACCUNT.
000460     COPY    LGENKF.
000470     COPY    BUGEN.
000480     COPY    FCTL.
000490 WORKING-STORAGE     SECTION.
000500 77  ERR-STAT        PIC  X(02).
000510 77  FIL             PIC  X(30)  VALUE  SPACE.
000520 77  I               PIC  9(02)  VALUE  0.
000530 77  FLG1            PIC  X(03).
000540 77  FLG2            PIC  X(03).
000550 01  WK-AREA.
000560     02  READ-FLG    PIC  9(01).
000570     02  SITEI.
000580       03  STARTBMN  PIC  9(04).
000590       03  ENDBMN    PIC  9(04).
000600     02  CHK         PIC  X(01).
000610     02  TY-SW       PIC  9(01).
000620 01  KEISAN.
000630     02  W-TOKI      PIC  S9(11).
000640     02  W-ZNKI      PIC  S9(11).
000650 01  SOEJI.
000660     02  FI              PIC 9(02).
000670     02  TI              PIC 9(02).
000680     02  SOE             PIC 9(02).
000690 01  WORK-AREA.
000700     02  CTDR            PIC S9(11).
000710     02  CTCR            PIC S9(11).
000720     02  ZCTDR           PIC S9(11).
000730     02  ZCTCR           PIC S9(11).
000740*****
000750 COPY  LWMSG.
000760**********
000770 SCREEN          SECTION.
000780 SD  SCR-D
000790     END STATUS  IS    ESTAT.
000800 01  DISP-BUZZER    LINE  24.
000810     02  DISP-BUZ-J-03    COLUMN  80  PIC X(05) VALUE ""27"J"03"".
000820 01  DSP-CLR-AREA.
000830     03  DSP-CLR        LINE    1.
000840         05  CLEAR  SCREEN.
000850     03  DSP-CLR-01     LINE   23  COLUMN   1  PIC X(1)
000860                        VALUE  " ".
000870     03  DSP-CLR-02     LINE   24  COLUMN   1  PIC X(30)
000880                        VALUE  "                              ".
000890 01  DSP-AREA.
000900     03  LINE  1.
000910         05      COLUMN  04  PIC  N(01)  VALUE  NC"年".
000920         05      COLUMN  08  PIC  N(02)  VALUE  NC"月度".
000930*****    05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY.           D.971114
000940         05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY2.          I.971114
000950         05      COLUMN  06  PIC  9(02)  FROM  Z-GEMMM.
000960         05      COLUMN  28  PIC  X(30)
000970              VALUE    " 部門別製造原価管理表（期末） "  REVERSE.
000980     03  LINE  24.
000990         05  COLUMN 61  PIC  N(2)
001000                        VALUE  NC"確認".
001010         05  COLUMN 66  PIC  X(13)
001020                        VALUE  "OK=1,NO=9 ( )".
001030 01  DSP-AREA2.
001040     03  DSP-050    LINE  24.
001050         05  DSP-051    COLUMN  1  PIC  X(14)
001060                        VALUE  "ｺﾝﾄﾛｰﾙ DATE ﾅｼ".
001070         05  DSP-052    COLUMN  1  PIC  X(13)
001080                        VALUE  "ｺﾝﾄﾛｰﾙ SEL ﾅｼ".
001090         05  DSP-053    COLUMN  1  PIC  X(15)
001100                        VALUE  "ｺﾝﾄﾛｰﾙ ﾘﾗｲﾄ ﾌﾉｳ".
001110         05  DSP-054    COLUMN  1  PIC  X(20)
001120                        VALUE  "ﾌﾞﾝﾍﾞﾂ ｿﾝｴｷ ﾘﾗｲﾄ ﾌﾉｳ".
001130         05  DSP-055    COLUMN  1  PIC  X(16)
001140                        VALUE  "ｶﾓｸ ﾏｽﾀ ﾅｼ KEY= ".
001150         05  DSP-056    COLUMN 17  PIC  9(04) FROM  BZM-BMON.
001160         05  DSP-057    COLUMN 22  PIC  9(04) FROM  BZM-KMCD.
001170         05  DSP-058    COLUMN  1  PIC  X(18)
001180                        VALUE  "ﾌﾞﾝﾍﾞﾂｿﾝｴｷ ﾂｲｶ ﾌﾉｳ".
001190         05  DSP-059.
001200             07  D59-1  COLUMN  1  PIC  X(17)
001210                        VALUE  "ｿﾝｴｷﾌｧｲﾙ ﾅｼ KEY= ".
001220             07  D59-2  COLUMN 18  PIC  X(3)  FROM  GNKEY(I).
001230 01  DSP-SP.
001240     03  LINE  24.
001250         05             COLUMN 77  PIC  X(01) VALUE " ".
001260 01  ACP-AREA.
001270     03  ACP-010        LINE    6.
001280         05  ACP-011               COLUMN  29  PIC 9(4)
001290                        USING   STARTBMN  CHECK OVERFLOW NO IFC.
001300         05  ACP-012               COLUMN  49  PIC 9(4)
001310                        USING   ENDBMN    CHECK OVERFLOW NO IFC.
001320     03  ACP-020        LINE   24    COLUMN    77  PIC X(1)
001330                        INTO   CHK      CHECK OVERFLOW NO IFC.
001340     03  ACP-030        LINE   23    COLUMN     1  PIC X(1)
001350                        INTO   CHK      CHECK OVERFLOW NO IFC.
001360 COPY  LSMSG.
001370 PROCEDURE           DIVISION.
001380 ST.
001390     OPEN  I-O    FCTL-F.
001400*
001410     MOVE  "DATE "        TO  FCTL-KEY1.
001420     READ   FCTL-F   WITH  UNLOCK  INVALID
001430            DISPLAY  DSP-051  DISP-BUZ-J-03
001440            PERFORM  CHK-RTN  THRU  CHK-RTNEX
001450            CLOSE  FCTL-F
001460            STOP RUN.
001470     MOVE FCTL-REC1     TO Z-R.
001480     MOVE  Z-KONYMD     TO  ZYMD.                                 今回日付
001490     PERFORM  Z-RTN     THRU  Z-EXT.
001500     IF ZI > 15
001510        MOVE 255     TO COMPLETION-CODE
001520        DISPLAY INV-CON DISP-BUZ-B
001530        CLOSE  FCTL-F
001540        STOP  RUN.
001550     MOVE 1     TO TY-SW.                                         前期欄
001560     MOVE ZI     TO TI.
001570     IF TI > 12
001580        MOVE 0      TO TY-SW                                      当期欄
001590        COMPUTE TI = Z-KSMM + ( TI - 12 )
001600        IF TI > 12
001610           COMPUTE TI = TI - 12.
001620     IF Z-KSMM = 12
001630        MOVE 1     TO FI
001640     ELSE
001650        COMPUTE FI = Z-KSMM + 1.
001660*
001670     DISPLAY  DSP-CLR  DSP-AREA.
001680*
001690 ST-10.
001700     ACCEPT   ACP-020.
001710     IF  ESTAT         =  "P9"
001720         MOVE 255     TO COMPLETION-CODE
001730         CLOSE FCTL-F
001740         STOP RUN.
001750     IF  ESTAT     NOT =  "01" AND "06"
001760         GO  TO  ST-10.
001770     IF  CHK           =    "1"        GO  TO  ST-40.
001780     IF  CHK           =    "9"
001790         DISPLAY       DSP-SP
001800         GO  TO        ST-10.
001810     GO  TO   ST-10.
001820 ST-40.
001830     MOVE ZERO     TO STARTBMN.
001840     MOVE 9999     TO ENDBMN.
001850     MOVE  "SEL  "        TO  FCTL-KEY3.
001860     READ   FCTL-F        INVALID
001870            DISPLAY  DSP-052  DISP-BUZ-J-03
001880            PERFORM  CHK-RTN  THRU  CHK-RTNEX
001890            CLOSE  FCTL-F
001900            STOP RUN.
001910     MOVE   STARTBMN      TO  FCTL-FROM1.
001920     MOVE   ENDBMN        TO  FCTL-TO1.
001930     REWRITE  FCTL-REC3  INVALID
001940            DISPLAY  DSP-053  DISP-BUZ-J-03
001950            PERFORM  CHK-RTN  THRU  CHK-RTNEX
001960            CLOSE  FCTL-F
001970            STOP RUN.
001980     OPEN  INPUT  BZM-F  AM  GEN.
001990     OPEN  I-O    BUGEN-F.
002000*
002010***
002020**
002030 ST-50.
002040     READ  BUGEN-F  NEXT  AT  END
002050           CLOSE       BUGEN-F
002060           OPEN   I-O  BUGEN-F
002070           GO  TO  ST-60.
002080     INITIALIZE                 BU-ZEN.
002090     REWRITE  BU-REC  INVALID
002100              DISPLAY  DSP-054  DISP-BUZ-J-03
002110              PERFORM  CHK-RTN  THRU  CHK-RTNEX
002120              GO  TO   END-RTN.
002130     GO  TO  ST-50.
002140 ST-60.
002150     READ   BZM-F           AT  END          GO  TO   END-RTN.
002160     IF     BZM-BMON    <       STARTBMN     GO  TO   ST-60.
002170     IF     BZM-BMON    >       ENDBMN       GO  TO   END-RTN.
002180     MOVE   BZM-KMCD   TO       AM-KEY.
002190     READ   AM     WITH UNLOCK  INVALID
002200            DISPLAY  DSP-055  DSP-056  DSP-057  DISP-BUZ-J-03
002210            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002220            GO  TO   ST-60.
002230     MOVE ZERO     TO WORK-AREA.
002240     PERFORM ZAN-SET-RTN THRU ZAN-SET-EX.
002250 ST-100.
002260     IF DR-CR = 1
002270        COMPUTE W-TOKI = CTDR - CTCR
002280        COMPUTE W-ZNKI = ZCTDR - ZCTCR
002290     ELSE
002300        COMPUTE W-TOKI = CTCR - CTDR
002310        COMPUTE W-ZNKI = ZCTCR - ZCTDR.
002320     MOVE   0       TO        I.
002330 ST-110.
002340     MOVE   0       TO        READ-FLG.
002350     ADD    1       TO        I.
002360     IF     I        >       12        GO  TO  ST-60.
002370     IF     GNKEY (I)   =     0        GO  TO  ST-110.
002380     MOVE   BZM-BMON   TO    BU-BUMN.
002390     MOVE   GNKEY (I)  TO    BU-LINNO.
002400     READ   BUGEN-F       INVALID
002410            PERFORM    BU-EDIT-RTN THRU BU-EDIT-EXT.
002420     IF     READ-FLG   =      2
002430            GO  TO     ST-110.
002440     IF GNCOM(I) = 1
002450        COMPUTE BU-TOUKI = BU-TOUKI + W-TOKI
002460        COMPUTE BU-ZENKI = BU-ZENKI + W-ZNKI
002470     ELSE
002480        COMPUTE BU-TOUKI = BU-TOUKI - W-TOKI
002490        COMPUTE BU-ZENKI = BU-ZENKI - W-ZNKI.
002500     IF     READ-FLG    NOT = 1
002510         REWRITE    BU-REC   INVALID
002520                DISPLAY  DSP-053  DISP-BUZ-J-03
002530                PERFORM  CHK-RTN  THRU  CHK-RTNEX
002540                GO  TO   END-RTN
002550         ELSE
002560         WRITE  BU-REC          INVALID
002570            DISPLAY  DSP-058  DISP-BUZ-J-03
002580            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002590            GO  TO   END-RTN.
002600     GO  TO     ST-110.
002610 END-RTN.
002620     PERFORM  CLSE-ENT   THRU  CLSE-EXT.
002630*
002640     STOP    RUN.
002650**********
002660**********
002670 ZAN-SET-RTN.
002680     IF ZI > 12     GO TO ZAN-SET-500.
002690     MOVE FI          TO SOE.
002700 ZAN-SET-000.
002710     ADD BZM-TJKR(SOE)     TO CTDR.
002720     ADD BZM-TJKS(SOE)     TO CTCR.
002730     IF SOE = ZI
002740        GO TO ZAN-SET-900.
002750     IF SOE = 12
002760        MOVE 1     TO SOE
002770        GO TO ZAN-SET-000.
002780     ADD 1     TO SOE.
002790     GO TO ZAN-SET-000.
002800 ZAN-SET-500.
002810     MOVE 13     TO SOE.
002820 ZAN-SET-600.
002830     ADD BZM-TJKR(SOE)     TO CTDR.
002840     ADD BZM-TJKS(SOE)     TO CTCR.
002850     IF SOE = ZI
002860        GO TO ZAN-SET-900.
002870     IF SOE = 15
002880        GO TO ZAN-SET-900.
002890     ADD 1     TO SOE.
002900     GO TO ZAN-SET-600.
002910 ZAN-SET-900.
002920     MOVE FI          TO SOE.
002930 ZAN-SET-910.
002940     IF TY-SW = 0
002950        ADD BZM-TJKR(SOE)     TO ZCTDR
002960        ADD BZM-TJKS(SOE)     TO ZCTCR
002970     ELSE
002980        ADD BZM-ZJKR(SOE)     TO ZCTDR
002990        ADD BZM-ZJKS(SOE)     TO ZCTCR.
003000     IF SOE = TI
003010        GO TO ZAN-SET-EX.
003020     IF SOE = 12
003030        MOVE 1     TO SOE
003040        GO TO ZAN-SET-910.
003050     ADD 1     TO SOE.
003060     GO TO ZAN-SET-910.
003070 ZAN-SET-EX.
003080     EXIT.
003090*****
003100 BU-EDIT-RTN.
003110     MOVE       1           TO   READ-FLG.
003120     MOVE       GNKEY (I)   TO   PL-KEY.
003130     READ      GEN  WITH  UNLOCK    INVALID
003140                DISPLAY  DSP-059  DISP-BUZ-J-03
003150                PERFORM  CHK-RTN  THRU  CHK-RTNEX
003160                MOVE ZERO     TO COMPLETION-CODE
003170                MOVE     2        TO    READ-FLG
003180                GO TO BU-EDIT-EXT.
003190     MOVE   SPACE           TO    BU-REC.
003200     MOVE   BZM-BMON        TO    BU-BUMN.
003210     MOVE   GNKEY (I)       TO    BU-LINNO.
003220     MOVE   PL-LIN          TO    BU-KAIP.
003230     MOVE   PL-GKB          TO    BU-GOKBN.
003240     MOVE   PL-NAMN         TO    BU-KMKNM.
003250     MOVE   0               TO    BU-ZENKI.
003260     MOVE   0               TO    BU-TOUKI.
003270     MOVE   0               TO    BU-DOGET.
003280     MOVE   0               TO    BU-TOGET.
003290     MOVE   PL-URIKB        TO    BU-URKBN.
003300     MOVE   PL-PKB          TO    BU-PRKBN.
003310     MOVE   PL-TANA         TO    BU-TBKBN.
003320 BU-EDIT-EXT.
003330     EXIT.
003340*****
003350 CHK-RTN.
003360     ACCEPT   ACP-030.
003370     IF  ESTAT        NOT  = "01" GO  TO  CHK-RTN.
003380     DISPLAY  DSP-CLR-01  DSP-CLR-02.
003390     MOVE "255"     TO COMPLETION-CODE.
003400 CHK-RTNEX.
003410     EXIT.
003420*****
003430 CLSE-ENT.
003440     CLOSE  BUGEN-F  GEN AM  BZM-F  FCTL-F.
003450 CLSE-EXT.
003460     EXIT.
003470*****
003480 COPY  LPMSG.
003490*****
