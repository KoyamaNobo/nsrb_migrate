000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         PR530U.
000030*
000040 ENVIRONMENT         DIVISION.
000050 CONFIGURATION       SECTION.
000060 SOURCE-COMPUTER.    SYSTEM100.
000070 OBJECT-COMPUTER.    SYSTEM100.
000080 INPUT-OUTPUT        SECTION.
000090 FILE-CONTROL.
000100     SELECT  BZM-F   ASSIGN    TO  BZU-MSD
000110                     ORGANIZATION  INDEXED
000120                     RECORD   KEY  BZM-KEY
000130                     FILE  STATUS  IS  ERR-STAT.
000140*
000150     SELECT  AM      ASSIGN    TO  AM-MSD
000160                     ORGANIZATION  INDEXED
000170                     ACCESS  MODE  RANDOM
000180                     RECORD   KEY  AM-KEY
000190                     FILE  STATUS  IS  ERR-STAT.
000200*
000210     SELECT  GEN     ASSIGN    TO  PL-MSD
000220                     ORGANIZATION  INDEXED
000230                     ACCESS  MODE  RANDOM
000240                     RECORD   KEY  PL-KEY
000250                     FILE  STATUS  IS  ERR-STAT.
000260*
000270     SELECT  BUGEN-F ASSIGN  TO  BU-MSD
000280                     ORGANIZATION  INDEXED
000290                     ACCESS  MODE  DYNAMIC
000300                     RECORD   KEY  BU-KEY
000310                     FILE  STATUS  IS  ERR-STAT.
000320*
000330     SELECT  FCTL-F  ASSIGN    TO  FCTL-MSD
000340                     ORGANIZATION  INDEXED
000350                     ACCESS  MODE  RANDOM
000360                     RECORD   KEY  FCTL-KEY
000370                     FILE  STATUS  IS  ERR-STAT.
000380 I-O-CONTROL.
000390     APPLY   SHARED-MODE      ON   AM  BUGEN-F
000400     APPLY   SHARED-MODE      ON   GEN BZM-F
000410     APPLY   SHARED-MODE      ON   FCTL-F.
000420 DATA                DIVISION.
000430 FILE                SECTION.
000440     COPY    LBUZAN.
000450     COPY    ACCUNT.
000460     COPY    LGENKF.
000470     COPY    BUGEN.
000480     COPY    FCTL.
000490 WORKING-STORAGE     SECTION.
000500 77  FIL             PIC  X(30)  VALUE  SPACE.
000510 77  I               PIC  9(02)  VALUE  0.
000520 77  ERR-STAT        PIC  X(02).
000530 01  WK-AREA.
000540     02  READ-FLG    PIC 9(01).
000550     02  SITEI.
000560       03  STARTBMN  PIC  9(04).
000570       03  ENDBMN    PIC  9(04).
000580     02  CHK         PIC  X(01).
000590     02  TY-SW       PIC  9(01).
000600 01  KEISAN.
000610     02  W-TOGET     PIC  S9(11).
000620     02  W-ZENEN     PIC  S9(11).
000630 01  SOEJI.
000640     02  FI              PIC 9(02).
000650     02  TI              PIC 9(02).
000660*****
000670 COPY  LWMSG.
000680**********
000690 SCREEN          SECTION.
000700 SD  SCR-D
000710     END STATUS  IS    ESTAT.
000720 01  DISP-BUZZER        LINE   24.
000730     03  DISP-BUZ-J-03  COLUMN 80  PIC X(05)  VALUE ""27"J"03"".
000740 01  DSP-CLR-AREA.
000750     03  DSP-CLR        LINE    1.
000760         05  CLEAR  SCREEN.
000770     03  DSP-CLR-01     LINE   23  COLUMN   1  PIC X(1)
000780                        VALUE  " ".
000790     03  DSP-CLR-02     LINE   24  COLUMN   1  PIC X(30)
000800                        VALUE  "                              ".
000810 01  DSP-AREA.
000820     03  DSP-010    LINE  1.
000830         05      COLUMN  04  PIC  N(01)  VALUE  NC"”N".
000840         05      COLUMN  08  PIC  N(02)  VALUE  NC"ŒŽ“x".
000850*****    05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY.           D.971113
000860         05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY2.          I.971113
000870         05      COLUMN  06  PIC  9(02)  FROM  Z-GEMMM.
000880         05  DSP-011    COLUMN 28  PIC  X(30)
000890              VALUE  " •”–å•Ê»‘¢Œ´‰¿•ñ‘iŒŽŽŸj "  REVERSE.
000900     03  DSP-020.
000910         05  LINE  04   COLUMN 27  PIC  N(04)
000920                       VALUE   NC"‚e‚q‚n‚l".
000930         05  LINE  04   COLUMN 50  PIC  N(02)
000940                       VALUE   NC"‚s‚n".
000950         05  LINE  06   COLUMN 11  PIC  N(05)
000960                        VALUE  NC"•”–åƒR[ƒh".
000970         05  LINE  06   COLUMN 40  PIC  N(01)
000980                        VALUE  NC"`".
000990     03  DSP-030    LINE  24.
001000         05  DSP-031    COLUMN 61  PIC  N(2)
001010                        VALUE  NC"Šm”F".
001020         05  DSP-032    COLUMN 66  PIC  X(13)
001030                        VALUE  "OK=1,NO=9 ( )".
001040 01  DSP-AREA2.
001050     03  DSP-050    LINE  24.
001060         05  DSP-051    COLUMN  1  PIC  X(13)
001070                        VALUE  "ºÝÄÛ°Ù SEL Å¼".
001080         05  DSP-052    COLUMN  1  PIC  X(15)
001090                        VALUE  "ºÝÄÛ°Ù Ø×²Ä ÌÉ³".
001100         05  DSP-053    COLUMN  1  PIC  X(14)
001110                        VALUE  "ºÝÄÛ°Ù DATE Å¼".
001120         05  DSP-054    COLUMN  1  PIC  X(20)
001130                        VALUE  "ÌÞÝÍÞÂ ¿Ý´· Ø×²Ä ÌÉ³".
001140         05  DSP-055    COLUMN  1  PIC  X(16)
001150                        VALUE  "¶Ó¸ Ï½À Å¼ KEY= ".
001160         05  DSP-056    COLUMN 17  PIC  9(04) FROM  BZM-BMON.
001170         05  DSP-057    COLUMN 22  PIC  9(04) FROM  BZM-KMCD.
001180         05  DSP-058    COLUMN  1  PIC  X(18)
001190                        VALUE  "ÌÞÝÍÞÂ¿Ý´· Â²¶ ÌÉ³".
001200         05  DSP-059.
001210             07  D59-1  COLUMN  1  PIC  X(17)
001220                        VALUE  "¿Ý´·Ì§²Ù Å¼ KEY= ".
001230             07  D59-2  COLUMN 18  PIC  X(3)  FROM  GNKEY(I).
001240 01  DSP-SP.
001250     02  LINE  06.
001260         03  COLUMN  29 PIC  X(04) VALUE "    ".
001270         03  COLUMN  49 PIC  X(04) VALUE "    ".
001280     02  LINE  24.
001290         03  COLUMN  77 PIC  X(01) VALUE " ".
001300 01  ACP-AREA.
001310     03  ACP-010        LINE    6.
001320         05  ACP-011               COLUMN  29  PIC 9(4)
001330                        USING   STARTBMN  CHECK OVERFLOW NO IFC.
001340         05  ACP-012               COLUMN  49  PIC 9(4)
001350                        USING   ENDBMN    CHECK OVERFLOW NO IFC.
001360     03  ACP-020        LINE   24    COLUMN    77  PIC X(1)
001370                        INTO   CHK      CHECK OVERFLOW NO IFC.
001380     03  ACP-030        LINE   23    COLUMN     1  PIC X(1)
001390                        INTO   CHK      CHECK OVERFLOW NO IFC.
001400 COPY  LSMSG.
001410******************************************************************
001420 PROCEDURE           DIVISION.
001430 ST.
001440     OPEN  I-O    FCTL-F.
001450*
001460     MOVE  "DATE "        TO  FCTL-KEY1.
001470     READ   FCTL-F   WITH  UNLOCK  INVALID
001480            DISPLAY  DSP-053  DISP-BUZ-J-03
001490            PERFORM  CHK-RTN  THRU  CHK-RTNEX
001500            CLOSE FCTL-F
001510            STOP RUN.
001520     MOVE FCTL-REC1  TO       Z-R.
001530***
001540     MOVE  Z-KONYMD     TO  ZYMD.                                 ¡‰ñ“ú•t
001550     PERFORM  Z-RTN     THRU  Z-EXT.
001560     IF ZI > 15
001570        MOVE "255"     TO COMPLETION-CODE
001580        CLOSE FCTL-F
001590        STOP RUN.
001600     MOVE 1     TO TY-SW.                                         ‘OŠú—“
001610     MOVE ZI     TO TI.
001620     IF TI > 12
001630        MOVE 0      TO TY-SW                                      “–Šú—“
001640        COMPUTE TI = Z-KSMM + ( TI - 12 )
001650        IF TI > 12
001660           COMPUTE TI = TI - 12.
001670     IF Z-KSMM = 12
001680        MOVE 1     TO FI
001690     ELSE
001700        COMPUTE FI = Z-KSMM + 1.
001710*
001720     DISPLAY  DSP-CLR  DSP-010  DSP-020  DSP-030.
001730*
001740 ST-10.
001750*    ACEPCRT  (08,36)  STARTBMN  WITH  OV-CHK  NO-IFC.
001760     ACCEPT   ACP-011.
001770     IF  ESTAT    =  "P9"
001780         MOVE  255     TO        COMPLETION-CODE
001790         CLOSE FCTL-F
001800         STOP  RUN.
001810     IF  ESTAT  NOT =  "01"  AND  "06"
001820         GO  TO  ST-10.
001830 ST-20.
001840*    ACEPCRT  (08,42)  ENDBMN    WITH  OV-CHK  NO-IFC.
001850     ACCEPT   ACP-012.
001860     IF  ESTAT    =  "09"         GO  TO  ST-10.
001870     IF  STARTBMN      >  ENDBMN       GO  TO  ST-10.
001880 ST-30.
001890*    ACEPCRT  (22,69)  CHK       WITH  OV-CHK.
001900     ACCEPT   ACP-020.
001910     IF  ESTAT  =  "09"
001920         GO  TO  ST-10.
001930     IF  ESTAT  NOT =  "01" AND "06"
001940         GO  TO  ST-30.
001950     IF  CHK           =    "1"        GO  TO  ST-40.
001960     IF  CHK           =    "9"
001970         DISPLAY  DSP-SP
001980         GO  TO  ST-10.
001990     GO  TO   ST-30.
002000 ST-40.
002010     MOVE  "SEL  "        TO  FCTL-KEY3.
002020     READ   FCTL-F        INVALID
002030            DISPLAY  DSP-051  DISP-BUZ-J-03
002040            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002050            CLOSE FCTL-F
002060            STOP RUN.
002070     MOVE   STARTBMN      TO  FCTL-FROM1.
002080     MOVE   ENDBMN        TO  FCTL-TO1.
002090     REWRITE  FCTL-REC3  INVALID
002100            DISPLAY  DSP-052  DISP-BUZ-J-03
002110            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002120            CLOSE FCTL-F
002130            STOP RUN.
002140     OPEN  INPUT  BZM-F  AM  GEN.
002150     OPEN  I-O    BUGEN-F.
002160*
002170 ST-50.
002180     READ  BUGEN-F  NEXT  AT  END
002190           CLOSE    BUGEN-F
002200           OPEN I-O BUGEN-F
002210           GO TO ST-60.
002220     INITIALIZE       BU-DOG.
002230     REWRITE  BU-REC  INVALID
002240              DISPLAY  DSP-054  DISP-BUZ-J-03
002250              PERFORM  CHK-RTN  THRU  CHK-RTNEX
002260              GO  TO   END-RTN.
002270     GO  TO  ST-50.
002280 ST-60.
002290     READ   BZM-F   UNLOCK  AT  END          GO  TO   END-RTN.
002300     IF     BZM-BMON    <       STARTBMN     GO  TO   ST-60.
002310     IF     BZM-BMON    >       ENDBMN       GO  TO   END-RTN.
002320     MOVE   BZM-KMCD   TO       AM-KEY.
002330     READ   AM     WITH UNLOCK  INVALID
002340            DISPLAY  DSP-055  DSP-056  DSP-057  DISP-BUZ-J-03
002350            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002360            GO  TO   ST-60.
002370     IF DR-CR = 1
002380        COMPUTE W-TOGET = BZM-TJKR(ZI) - BZM-TJKS(ZI)
002390     ELSE
002400        COMPUTE W-TOGET = BZM-TJKS(ZI) - BZM-TJKR(ZI).
002410     IF TY-SW = 0
002420        IF DR-CR = 1
002430           COMPUTE W-ZENEN = BZM-TJKR(TI) - BZM-TJKS(TI)
002440        ELSE
002450           COMPUTE W-ZENEN = BZM-TJKS(TI) - BZM-TJKR(TI)
002460     ELSE
002470        IF DR-CR = 1
002480           COMPUTE W-ZENEN = BZM-ZJKR(TI) - BZM-ZJKS(TI)
002490        ELSE
002500           COMPUTE W-ZENEN = BZM-ZJKS(TI) - BZM-ZJKR(TI).
002510*****       PERFORM  SET-RTN   THRU   SET-RTNEX.                  ????????
002520*
002530     MOVE   0       TO        I.
002540 ST-70.
002550     ADD    1       TO        I.
002560     IF     I        >       12        GO  TO  ST-60.
002570     IF     GNKEY (I)   =     0        GO  TO  ST-70.
002580     MOVE   0          TO    READ-FLG.
002590     MOVE   BZM-BMON   TO    BU-BUMN.
002600     MOVE   GNKEY (I)  TO    BU-LINNO.
002610     READ   BUGEN-F       INVALID
002620         PERFORM       BU-EDIT-RTN.
002630     IF     READ-FLG   =     2
002640            GO  TO     ST-70.
002650     IF  GNCOM (I)     =    1
002660         COMPUTE  BU-TOGET  =  BU-TOGET  +  W-TOGET
002670         COMPUTE  BU-DOGET  =  BU-DOGET  +  W-ZENEN
002680     ELSE
002690         COMPUTE  BU-TOGET  =  BU-TOGET  -  W-TOGET
002700         COMPUTE  BU-DOGET  =  BU-DOGET  -  W-ZENEN.
002710     IF     READ-FLG    =     0
002720            REWRITE    BU-REC   INVALID
002730                DISPLAY  DSP-054  DISP-BUZ-J-03
002740                PERFORM  CHK-RTN  THRU  CHK-RTNEX
002750                GO  TO   END-RTN
002760       ELSE
002770         WRITE  BU-REC          INVALID
002780            DISPLAY  DSP-058  DISP-BUZ-J-03
002790            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002800            GO  TO   END-RTN.
002810     GO  TO     ST-70.
002820 END-RTN.
002830     PERFORM  CLSE-ENT  THRU  CLSE-EXT.
002840*
002850     STOP   RUN.
002860**********
002870**********
002880 BU-EDIT-RTN.
002890     MOVE       1           TO   READ-FLG.
002900     MOVE       GNKEY (I)   TO   PL-KEY.
002910     READ       GEN WITH  UNLOCK    INVALID
002920                DISPLAY  DSP-059  DISP-BUZ-J-03
002930                PERFORM  CHK-RTN  THRU  CHK-RTNEX
002940                MOVE ZERO     TO COMPLETION-CODE
002950                MOVE     2        TO    READ-FLG
002960                GO  TO   BU-EDIT-EXT.
002970     MOVE   SPACE           TO    BU-REC.
002980     MOVE   BZM-BMON        TO    BU-BUMN.
002990     MOVE   GNKEY (I)       TO    BU-LINNO.
003000     MOVE   PL-LIN          TO    BU-KAIP.
003010     MOVE   PL-GKB          TO    BU-GOKBN.
003020     MOVE   PL-NAMN         TO    BU-KMKNM.
003030     MOVE   0               TO    BU-ZENKI.
003040     MOVE   0               TO    BU-TOUKI.
003050     MOVE   0               TO    BU-DOGET.
003060     MOVE   0               TO    BU-TOGET.
003070     MOVE   PL-URIKB        TO    BU-URKBN.
003080     MOVE   PL-PKB          TO    BU-PRKBN.
003090     MOVE   PL-TANA         TO    BU-TBKBN.
003100 BU-EDIT-EXT.
003110     EXIT.
003120*****
003130 CHK-RTN.
003140     ACCEPT   ACP-030.
003150     IF  ESTAT   NOT  = "01" GO  TO  CHK-RTN.
003160     DISPLAY  DSP-CLR-01  DSP-CLR-02.
003170     MOVE "255"     TO COMPLETION-CODE.
003180 CHK-RTNEX.
003190     EXIT.
003200*****
003210 CLSE-ENT.
003220     CLOSE  BZM-F  AM  GEN BUGEN-F  FCTL-F.
003230 CLSE-EXT.
003240     EXIT.
003250***
003260 COPY  LPMSG.
003270***
