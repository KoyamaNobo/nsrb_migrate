000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         PR460U.
000030*
000040 ENVIRONMENT         DIVISION.
000050 CONFIGURATION       SECTION.
000060 SOURCE-COMPUTER.    SYSTEM100.
000070 OBJECT-COMPUTER.    SYSTEM100.
000080 INPUT-OUTPUT        SECTION.
000090 FILE-CONTROL.
000100     SELECT  BZM-F   ASSIGN    TO  BZU-MSD
000110                     ORGANIZATION  INDEXED
000120                     RECORD   KEY  BZM-KEY
000130                     FILE      STATUS  IS  ERR-STAT.
000140*
000150     SELECT  AM      ASSIGN    TO  AM-MSD
000160                     ORGANIZATION  INDEXED
000170                     ACCESS  MODE  RANDOM
000180                     RECORD   KEY  AM-KEY
000190                     FILE      STATUS  IS  ERR-STAT.
000200*
000210     SELECT  PL      ASSIGN    TO  PL-MSD
000220                     ORGANIZATION  INDEXED
000230                     ACCESS  MODE  RANDOM
000240                     RECORD   KEY  PL-KEY
000250                     FILE      STATUS  IS  ERR-STAT.
000260*
000270     SELECT  BU-F    ASSIGN  TO  BU-MSD
000280                     ORGANIZATION  INDEXED
000290                     ACCESS  MODE  DYNAMIC
000300                     RECORD   KEY  BU-KEY
000310                     FILE      STATUS  IS  ERR-STAT.
000320*
000330     SELECT  FCTL-F  ASSIGN    TO  FCTL-MSD
000340                     ORGANIZATION  INDEXED
000350                     ACCESS  MODE  RANDOM
000360                     RECORD   KEY  FCTL-KEY
000370                     FILE      STATUS  IS  ERR-STAT.
000380 I-O-CONTROL.
000390     APPLY   SHARED-MODE      ON   AM  BU-F
000400     APPLY   SHARED-MODE      ON   PL  BZM-F
000410     APPLY   SHARED-MODE      ON   FCTL-F.
000420 DATA                DIVISION.
000430 FILE                SECTION.
000440     COPY    LBUZAN.
000450     COPY    ACCUNT.
000460     COPY    PL-LIB.
000470     COPY    BUPL.
000480     COPY    FCTL.
000490 WORKING-STORAGE     SECTION.
000500 77  ERR-STAT        PIC  X(02).
000510 77  FIL             PIC  X(30)  VALUE  SPACE.
000520 77  I               PIC  9(02)  VALUE  0.
000530 77  FLG1            PIC  X(03).
000540 77  FLG2            PIC  X(03).
000550 01  WK-AREA.
000560     02  READ-FLG    PIC  9(01).
000570     02  SITEI.
000580       03  STARTBMN  PIC  9(04).
000590       03  ENDBMN    PIC  9(04).
000600     02  CHK         PIC  X(01).
000610     02  TY-SW       PIC  9(01).
000620 01  KEISAN.
000630     02  W-TOKI      PIC  S9(11).
000640     02  W-ZNKI      PIC  S9(11).
000650 01  SOEJI.
000660     02  FI              PIC 9(02).
000670     02  TI              PIC 9(02).
000680     02  SOE             PIC 9(02).
000690 01  WORK-AREA.
000700     02  CTDR            PIC S9(11).
000710     02  CTCR            PIC S9(11).
000720     02  ZCTDR           PIC S9(11).
000730     02  ZCTCR           PIC S9(11).
000740*****
000750 COPY  LWMSG.
000760**********
000770 SCREEN          SECTION.
000780 SD  SCR-D
000790     END STATUS  IS    ESTAT.
000800 01  DISP-BUZZER    LINE  24.
000810     02  DISP-BUZ-J-03    COLUMN  80  PIC X(05) VALUE ""27"J"03"".
000820 01  DSP-CLR-AREA.
000830     03  DSP-CLR        LINE    1.
000840         05  CLEAR  SCREEN.
000850     03  DSP-CLR-01     LINE   23  COLUMN   1  PIC X(1)
000860                        VALUE  " ".
000870     03  DSP-CLR-02     LINE   24  COLUMN   1  PIC X(30)
000880                        VALUE  "                              ".
000890 01  DSP-AREA.
000900     03  DSP-010    LINE  1.
000910         05      COLUMN  04  PIC  N(01)  VALUE  NC"”N".
000920         05      COLUMN  08  PIC  N(02)  VALUE  NC"ŒŽ“x".
000930*****    05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY.           D.971113
000940         05      COLUMN  02  PIC  9(02)  FROM  Z-GEMYY2.          I.971113
000950         05      COLUMN  06  PIC  9(02)  FROM  Z-GEMMM.
000960         05  DSP-011    COLUMN 28  PIC  X(26)
000970              VALUE    " •”–å•Ê‘¹‰vŒvŽZ‘iŠú––j "  REVERSE.
000980     03  DSP-020.
000990         05  LINE  04.
001000             07         COLUMN 27  PIC  N(04)
001010                        VALUE  NC"‚e‚q‚n‚l".
001020             07         COLUMN 49  PIC  N(02)
001030                        VALUE  NC"‚s‚n".
001040         05  LINE  06.
001050             07         COLUMN 11  PIC  N(5)
001060                        VALUE  NC"•”–åƒR[ƒh".
001070             07         COLUMN 40  PIC  N(1)
001080                        VALUE  NC"`".
001090     03  DSP-030    LINE  24.
001100         05  DSP-031    COLUMN 61  PIC  N(2)
001110                        VALUE  NC"Šm”F".
001120         05  DSP-032    COLUMN 66  PIC  X(13)
001130                        VALUE  "OK=1,NO=9 ( )".
001140 01  DSP-AREA2.
001150     03  DSP-050    LINE  24.
001160         05  DSP-051    COLUMN  1  PIC  X(14)
001170                        VALUE  "ºÝÄÛ°Ù DATE Å¼".
001180         05  DSP-052    COLUMN  1  PIC  X(13)
001190                        VALUE  "ºÝÄÛ°Ù SEL Å¼".
001200         05  DSP-053    COLUMN  1  PIC  X(15)
001210                        VALUE  "ºÝÄÛ°Ù Ø×²Ä ÌÉ³".
001220         05  DSP-054    COLUMN  1  PIC  X(20)
001230                        VALUE  "ÌÞÝÍÞÂ ¿Ý´· Ø×²Ä ÌÉ³".
001240         05  DSP-055    COLUMN  1  PIC  X(16)
001250                        VALUE  "¶Ó¸ Ï½À Å¼ KEY= ".
001260         05  DSP-056    COLUMN 17  PIC  9(04) FROM  BZM-BMON.
001270         05  DSP-057    COLUMN 22  PIC  9(04) FROM  BZM-KMCD.
001280         05  DSP-058    COLUMN  1  PIC  X(18)
001290                        VALUE  "ÌÞÝÍÞÂ¿Ý´· Â²¶ ÌÉ³".
001300         05  DSP-059.
001310             07  D59-1  COLUMN  1  PIC  X(17)
001320                        VALUE  "¿Ý´·Ì§²Ù Å¼ KEY= ".
001330             07  D59-2  COLUMN 18  PIC  X(3)  FROM  PLKEY(I).
001340 01  DSP-SP.
001350     03  LINE  06.
001360         05             COLUMN 29  PIC  X(04) VALUE "    ".
001370         05             COLUMN 49  PIC  X(04) VALUE "    ".
001380     03  LINE  24.
001390         05             COLUMN 77  PIC  X(01) VALUE " ".
001400 01  ACP-AREA.
001410     03  ACP-010        LINE    6.
001420         05  ACP-011               COLUMN  29  PIC 9(4)
001430                        USING   STARTBMN  CHECK OVERFLOW NO IFC.
001440         05  ACP-012               COLUMN  49  PIC 9(4)
001450                        USING   ENDBMN    CHECK OVERFLOW NO IFC.
001460     03  ACP-020        LINE   24    COLUMN    77  PIC X(1)
001470                        INTO   CHK      CHECK OVERFLOW NO IFC.
001480     03  ACP-030        LINE   23    COLUMN     1  PIC X(1)
001490                        INTO   CHK      CHECK OVERFLOW NO IFC.
001500 COPY  LSMSG.
001510 PROCEDURE           DIVISION.
001520 ST.
001530     OPEN  I-O    FCTL-F.
001540*
001550     MOVE  "DATE "        TO  FCTL-KEY1.
001560     READ   FCTL-F   WITH  UNLOCK  INVALID
001570            DISPLAY  DSP-051  DISP-BUZ-J-03
001580            PERFORM  CHK-RTN  THRU  CHK-RTNEX
001590            CLOSE  FCTL-F
001600            STOP RUN.
001610     MOVE FCTL-REC1     TO Z-R.
001620     MOVE  Z-KONYMD     TO  ZYMD.                                 ¡‰ñ“ú•t
001630     PERFORM  Z-RTN     THRU  Z-EXT.
001640     IF ZI > 15
001650        MOVE 255     TO COMPLETION-CODE
001660        DISPLAY INV-CON DISP-BUZ-B
001670        CLOSE  FCTL-F
001680        STOP  RUN.
001690     MOVE 1     TO TY-SW.                                         ‘OŠú—“
001700     MOVE ZI     TO TI.
001710     IF TI > 12
001720        MOVE 0      TO TY-SW                                      “–Šú—“
001730        COMPUTE TI = Z-KSMM + ( TI - 12 )
001740        IF TI > 12
001750           COMPUTE TI = TI - 12.
001760     IF Z-KSMM = 12
001770        MOVE 1     TO FI
001780     ELSE
001790        COMPUTE FI = Z-KSMM + 1.
001800*
001810     DISPLAY  DSP-CLR  DSP-010.
001820     DISPLAY  DSP-020  DSP-030.
001830*
001840 ST-10.
001850*    ACEPCRT  (08,36)  STARTBMN  WITH  OV-CHK  NO-IFC.
001860     ACCEPT   ACP-011.
001870     IF  ESTAT         =  "P9"
001880         MOVE  255     TO      COMPLETION-CODE
001890         CLOSE  FCTL-F
001900         STOP  RUN.
001910     IF  ESTAT     NOT =  "01" AND "06"
001920         GO  TO  ST-10.
001930 ST-20.
001940*    ACEPCRT  (08,42)  ENDBMN    WITH  OV-CHK  NO-IFC.
001950     ACCEPT   ACP-012.
001960     IF  ESTAT         =  "09"         GO  TO  ST-10.
001970     IF  ESTAT     NOT =  "01" AND "06"
001980         GO  TO  ST-20.
001990     IF  STARTBMN      >  ENDBMN       GO  TO  ST-10.
002000 ST-30.
002010*    ACEPCRT  (22,69)  CHK       WITH  OV-CHK.
002020     ACCEPT   ACP-020.
002030     IF  ESTAT         =  "09"         GO  TO  ST-10.
002040     IF  ESTAT     NOT =  "01" AND "06"
002050         GO  TO  ST-30.
002060     IF  CHK           =    "1"        GO  TO  ST-40.
002070     IF  CHK           =    "9"
002080         DISPLAY       DSP-SP
002090         GO  TO        ST-10.
002100     GO  TO   ST-30.
002110 ST-40.
002120     MOVE  "SEL  "        TO  FCTL-KEY3.
002130     READ   FCTL-F        INVALID
002140            DISPLAY  DSP-052  DISP-BUZ-J-03
002150            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002160            CLOSE  FCTL-F
002170            STOP RUN.
002180     MOVE   STARTBMN      TO  FCTL-FROM.
002190     MOVE   ENDBMN        TO  FCTL-TO.
002200     REWRITE  FCTL-REC3  INVALID
002210            DISPLAY  DSP-053  DISP-BUZ-J-03
002220            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002230            CLOSE  FCTL-F
002240            STOP RUN.
002250     OPEN  INPUT  BZM-F  AM  PL.
002260     OPEN  I-O    BU-F.
002270*
002280***
002290**
002300 ST-50.
002310     READ  BU-F  NEXT  AT  END
002320           CLOSE       BU-F
002330           OPEN   I-O  BU-F
002340           GO  TO  ST-60.
002350     INITIALIZE                 BU-ZEN.
002360     REWRITE  BU-REC  INVALID
002370              DISPLAY  DSP-054  DISP-BUZ-J-03
002380              PERFORM  CHK-RTN  THRU  CHK-RTNEX
002390              GO  TO   END-RTN.
002400     GO  TO  ST-50.
002410 ST-60.
002420     READ   BZM-F           AT  END          GO  TO   END-RTN.
002430     IF     BZM-BMON    <       STARTBMN     GO  TO   ST-60.
002440     IF     BZM-BMON    >       ENDBMN       GO  TO   END-RTN.
002450     MOVE   BZM-KMCD   TO       AM-KEY.
002460     READ   AM     WITH UNLOCK  INVALID
002470            DISPLAY  DSP-055  DSP-056  DSP-057  DISP-BUZ-J-03
002480            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002490            GO  TO   ST-60.
002500     MOVE ZERO     TO WORK-AREA.
002510     PERFORM ZAN-SET-RTN THRU ZAN-SET-EX.
002520 ST-100.
002530     IF DR-CR = 1
002540        COMPUTE W-TOKI = CTDR - CTCR
002550        COMPUTE W-ZNKI = ZCTDR - ZCTCR
002560     ELSE
002570        COMPUTE W-TOKI = CTCR - CTDR
002580        COMPUTE W-ZNKI = ZCTCR - ZCTDR.
002590     MOVE   0       TO        I.
002600 ST-110.
002610     MOVE   0       TO        READ-FLG.
002620     ADD    1       TO        I.
002630     IF     I        >       12        GO  TO  ST-60.
002640     IF     PLKEY (I)   =     0        GO  TO  ST-110.
002650     MOVE   BZM-BMON   TO    BU-BUMN.
002660     MOVE   PLKEY (I)  TO    BU-LINNO.
002670     READ   BU-F       INVALID
002680            PERFORM    BU-EDIT-RTN THRU BU-EDIT-EXT.
002690     IF     READ-FLG   =      2
002700            GO  TO     ST-110.
002710     IF PLCOM(I) = 1
002720        COMPUTE BU-TOUKI = BU-TOUKI + W-TOKI
002730        COMPUTE BU-ZENKI = BU-ZENKI + W-ZNKI
002740     ELSE
002750        COMPUTE BU-TOUKI = BU-TOUKI - W-TOKI
002760        COMPUTE BU-ZENKI = BU-ZENKI - W-ZNKI.
002770     IF     READ-FLG    NOT = 1
002780         REWRITE    BU-REC   INVALID
002790                DISPLAY  DSP-053  DISP-BUZ-J-03
002800                PERFORM  CHK-RTN  THRU  CHK-RTNEX
002810                GO  TO   END-RTN
002820         ELSE
002830         WRITE  BU-REC          INVALID
002840            DISPLAY  DSP-058  DISP-BUZ-J-03
002850            PERFORM  CHK-RTN  THRU  CHK-RTNEX
002860            GO  TO   END-RTN.
002870     GO  TO     ST-110.
002880 END-RTN.
002890     PERFORM  CLSE-ENT   THRU  CLSE-EXT.
002900*
002910     STOP    RUN.
002920**********
002930**********
002940 ZAN-SET-RTN.
002950     IF ZI > 12     GO TO ZAN-SET-500.
002960     MOVE FI          TO SOE.
002970 ZAN-SET-000.
002980     ADD BZM-TJKR(SOE)     TO CTDR.
002990     ADD BZM-TJKS(SOE)     TO CTCR.
003000     IF SOE = ZI
003010        GO TO ZAN-SET-900.
003020     IF SOE = 12
003030        MOVE 1     TO SOE
003040        GO TO ZAN-SET-000.
003050     ADD 1     TO SOE.
003060     GO TO ZAN-SET-000.
003070 ZAN-SET-500.
003080     MOVE 13     TO SOE.
003090 ZAN-SET-600.
003100     ADD BZM-TJKR(SOE)     TO CTDR.
003110     ADD BZM-TJKS(SOE)     TO CTCR.
003120     IF SOE = ZI
003130        GO TO ZAN-SET-900.
003140     IF SOE = 15
003150        GO TO ZAN-SET-900.
003160     ADD 1     TO SOE.
003170     GO TO ZAN-SET-600.
003180 ZAN-SET-900.
003190     MOVE FI          TO SOE.
003200 ZAN-SET-910.
003210     IF TY-SW = 0
003220        ADD BZM-TJKR(SOE)     TO ZCTDR
003230        ADD BZM-TJKS(SOE)     TO ZCTCR
003240     ELSE
003250        ADD BZM-ZJKR(SOE)     TO ZCTDR
003260        ADD BZM-ZJKS(SOE)     TO ZCTCR.
003270     IF SOE = TI
003280        GO TO ZAN-SET-EX.
003290     IF SOE = 12
003300        MOVE 1     TO SOE
003310        GO TO ZAN-SET-910.
003320     ADD 1     TO SOE.
003330     GO TO ZAN-SET-910.
003340 ZAN-SET-EX.
003350     EXIT.
003360*****
003370 BU-EDIT-RTN.
003380     MOVE       1           TO   READ-FLG.
003390     MOVE       PLKEY (I)   TO   PL-KEY.
003400     READ       PL  WITH  UNLOCK    INVALID
003410                DISPLAY  DSP-059  DISP-BUZ-J-03
003420                PERFORM  CHK-RTN  THRU  CHK-RTNEX
003430                MOVE ZERO     TO COMPLETION-CODE
003440                MOVE     2        TO    READ-FLG
003450                GO TO BU-EDIT-EXT.
003460     MOVE   SPACE           TO    BU-REC.
003470     MOVE   BZM-BMON        TO    BU-BUMN.
003480     MOVE   PLKEY (I)       TO    BU-LINNO.
003490     MOVE   PL-LIN          TO    BU-KAIP.
003500     MOVE   PL-GKB          TO    BU-GOKBN.
003510     MOVE   PL-NAMN         TO    BU-KMKNM.
003520     MOVE   0               TO    BU-ZENKI.
003530     MOVE   0               TO    BU-TOUKI.
003540     MOVE   0               TO    BU-DOGET.
003550     MOVE   0               TO    BU-TOGET.
003560     MOVE   PL-URIKB        TO    BU-URKBN.
003570     MOVE   PL-PKB          TO    BU-PRKBN.
003580     MOVE   PL-TANA         TO    BU-TBKBN.
003590 BU-EDIT-EXT.
003600     EXIT.
003610*****
003620 CHK-RTN.
003630     ACCEPT   ACP-030.
003640     IF  ESTAT        NOT  = "01" GO  TO  CHK-RTN.
003650     DISPLAY  DSP-CLR-01  DSP-CLR-02.
003660     MOVE "255"     TO COMPLETION-CODE.
003670 CHK-RTNEX.
003680     EXIT.
003690*****
003700 CLSE-ENT.
003710     CLOSE  BU-F  PL  AM  BZM-F  FCTL-F.
003720 CLSE-EXT.
003730     EXIT.
003740*****
003750 COPY  LPMSG.
003760*****
