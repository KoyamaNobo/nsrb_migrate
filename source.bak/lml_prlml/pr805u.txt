000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         PR805U.
000030*
000040 ENVIRONMENT         DIVISION.
000050 CONFIGURATION       SECTION.
000060 SOURCE-COMPUTER.    SYSTEM100.
000070 OBJECT-COMPUTER.    SYSTEM100.
000080 INPUT-OUTPUT        SECTION.
000090 FILE-CONTROL.
000100*
000110     SELECT  HZM-F   ASSIGN    TO  F1-MSD
000120                     ORGANIZATION  INDEXED
000130                     ACCESS  MODE  DYNAMIC
000140                     RECORD   KEY  HZM-KEY
000150                     FILE  STATUS  IS  ERR-STAT.
000160*
000170     SELECT  AM      ASSIGN    TO  F2-MSD
000180                     ORGANIZATION  INDEXED
000190                     ACCESS  MODE  RANDOM
000200                     RECORD   KEY  AM-KEY.
000210*
000220     SELECT  FCTL-F  ASSIGN    TO  FCTL-MSD
000230                     ORGANIZATION  INDEXED
000240                     ACCESS  MODE  RANDOM
000250                     RECORD   KEY  FCTL-KEY
000260                     FILE  STATUS  IS  ERR-STAT.
000270 I-O-CONTROL.
000280     APPLY   EXCLUSIVE-MODE   ON   HZM-F
000290     APPLY   SHARED-MODE      ON   FCTL-F  AM.
000300 DATA                DIVISION.
000310 FILE                SECTION.
000320*
000330     COPY    LHOZAN.
000340     COPY    ACCUNT.
000350     COPY    FCTL.
000360**********************************
000370 WORKING-STORAGE     SECTION.
000380**********************************
000390 77  ERR-STAT        PIC  X(02).
000400 77  OHZM-KMCD       PIC  9(04).
000410 01  SOEJI.
000420     02  I           PIC  9(02).
000430     02  SOE         PIC  9(02).
000440 01  SUM-AREA.
000450     02  W-KR        PIC S9(11).
000460     02  W-KS        PIC S9(11).
000470*****
000480 COPY  LWMSG.
000490**********************************
000500 SCREEN          SECTION.
000510**********************************
000520 SD  SCR-D
000530     END STATUS  IS    ESTAT.
000540 COPY  LSMSG.
000550**********************************
000560 PROCEDURE           DIVISION.
000570**********************************
000580 ST.
000590*
000600     PERFORM  INI-RTN     THRU     INI-EX.
000610*
000620     OPEN  I-O    HZM-F.
000630     OPEN  INPUT  AM.
000640*
000650     PERFORM  UPD-RTN     THRU     UPD-EX.
000660*
000670     PERFORM  CLSE-ENT    THRU     CLSE-EXT.
000680 ED.
000690     STOP     RUN.
000700**********************************
000710*    初期　処理                  *
000720**********************************
000730 INI-RTN.
000740     OPEN  INPUT  FCTL-F.
000750     MOVE   "DATE  "      TO  FCTL-KEY1.
000760     READ   FCTL-F   UNLOCK   INVALID
000770            MOVE     255      TO    COMPLETION-CODE
000780            DISPLAY  INV-CON  DISP-BUZ-B
000790            CLOSE FCTL-F
000800            STOP     RUN.
000810     MOVE FCTL-REC1     TO Z-R.
000820     CLOSE FCTL-F.
000830 INI-EX.
000840     EXIT.
000850**********************************
000860*    更新　処理                  *
000870**********************************
000880 UPD-RTN.
000890     READ   HZM-F    NEXT AT  END
000900            GO  TO   UPD-EX.
000910     MOVE HZM-KMCD     TO OHZM-KMCD.
000920     GO TO UPD-100.
000930 UPD-000.
000940     READ   HZM-F    NEXT AT  END
000950            GO  TO   UPD-EX.
000960     IF HZM-KMCD = OHZM-KMCD
000970        GO TO UPD-200.
000980 UPD-100.
000990     MOVE HZM-KMCD     TO AM-KEY.
001000     READ AM UNLOCK INVALID KEY
001010          GO TO UPD-900.
001020 UPD-200.
001030     MOVE ZERO     TO SUM-AREA.
001040     PERFORM ZERO-RTN THRU ZERO-EX
001050             VARYING I FROM 1 BY 1
001060             UNTIL   I >  12.
001070     IF BS-PL = 1
001080        MOVE ZERO     TO HZM-ZAN
001090     ELSE
001100        IF DR-CR = 1
001110           COMPUTE HZM-ZAN = HZM-ZAN + W-KR - W-KS
001120        ELSE
001130           COMPUTE HZM-ZAN = HZM-ZAN + W-KS - W-KR.
001140*
001150     MOVE 13     TO I.
001160 UPD-300.
001170     COMPUTE SOE = Z-KSMM + ( I - 12 ).
001180     IF SOE > 12
001190        COMPUTE SOE = SOE - 12.
001200     MOVE HZM-TJIS(I)     TO HZM-TJIS(SOE).
001210     IF I NOT = 15
001220        ADD  1     TO I
001230        GO TO UPD-300.
001240*
001250     INITIALIZE  HZM-TJIS(13).
001260     INITIALIZE  HZM-TJIS(14).
001270     INITIALIZE  HZM-TJIS(15).
001280*
001290     MOVE HZM-KMCD     TO OHZM-KMCD ERR-K.
001300     REWRITE   HZM-R      INVALID
001310               MOVE  "HZM-F"   TO   ERR-F
001320               MOVE  "R"       TO   ERR-M
001330               PERFORM  ERR-ENT     THRU     ERR-EXT.
001340     GO TO UPD-000.
001350 UPD-900.
001360     MOVE HZM-KMCD     TO OHZM-KMCD ERR-K.
001370     DELETE HZM-F         INVALID
001380               MOVE  "HZM-F"   TO   ERR-F
001390               MOVE  "D"       TO   ERR-M
001400               PERFORM  ERR-ENT     THRU     ERR-EXT.
001410     CALL "CBLTCLS" USING HZM-F.
001420*
001430     READ   HZM-F    NEXT AT  END
001440            GO  TO   UPD-EX.
001450     IF HZM-KMCD NOT = OHZM-KMCD
001460        GO TO UPD-100.
001470*
001480     GO TO UPD-900.
001490 UPD-EX.
001500     EXIT.
001510**********************************
001520*    終了　処理                  *
001530**********************************
001540 CLSE-ENT.
001550     CLOSE  HZM-F  AM.
001560 CLSE-EXT.
001570     EXIT.
001580**
001590**********************************
001600*    当期実績　クリア            *
001610**********************************
001620 ZERO-RTN.
001630     ADD  HZM-TJKR(I)     TO W-KR.
001640     ADD  HZM-TJKS(I)     TO W-KS.
001650*
001660     INITIALIZE  HZM-TJIS(I).
001670 ZERO-EX.
001680     EXIT.
001690*****
001700 COPY  LPMSG.
001710*****
