000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. PRD300.
000030**********************************************
000040*    振替伝票財務換(SIWAKE-IW→SIWAKE-I)     *
000050**********************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT SDW ASSIGN TO SIWAKEIW-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE DYNAMIC
000150         RECORD KEY SDW-KEY
000160         FILE STATUS ERR-STAT.
000170     SELECT SDI ASSIGN TO SIWAKEI-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS MODE RANDOM
000200         RECORD KEY SDI-KEY
000210         FILE STATUS ERR-STAT.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON SDI.
000240 DATA DIVISION.
000250 FILE SECTION.
000260     COPY SIWAID.
000270     COPY SIWAIW.
000280 WORKING-STORAGE SECTION.
000290 01  ERR-STAT           PIC  X(002).
000300 01  W-FILE             PIC  X(013).
000310 01  W-DATA.
000320     02  W-DMM          PIC  9(001).
000330     02  W-SNGP.
000340       03  W-SNEN       PIC  9(004).
000350       03  W-SGET       PIC  9(002).
000360       03  W-SPEY       PIC  9(002).
000370     02  W-ENGP.
000380       03  W-ENEN       PIC  9(004).
000390       03  W-EGET       PIC  9(002).
000400       03  W-EPEY       PIC  9(002).
000410     02  W-SU           PIC  9(003).
000420     02  W-DNO          PIC  9(006).
000430     COPY LSTAT.
000440 SCREEN SECTION.
000450 SD  C-CRT
000460     END STATUS IS ESTAT.
000470 01  C-CLEAR.
000480     02  LINE   1  CLEAR SCREEN.
000490 01  C-MID.
000500     02  LINE   1  COLUMN  15  PIC  N(024) VALUE
000510          NC"振替伝票（手形・領収書要・売掛・買掛）　財務変換"
000520                                                        REVERSE.
000530     02  LINE  20  COLUMN  40  PIC  X(022) VALUE
000540          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000550 01  C-ACP.
000560     02  A-DMM   LINE  20  COLUMN  57  PIC  9(001)
000570          USING W-DMM   CHECK OVERFLOW NO IFC.
000580 01  C-DSP.
000590     02  D-NGP   LINE  12.
000600       03  COLUMN  23  PIC  9(004) FROM  W-SNEN.
000610       03  COLUMN  27  PIC  N(001) VALUE NC"年".
000620       03  COLUMN  29  PIC  Z(002) FROM  W-SGET.
000630       03  COLUMN  31  PIC  N(001) VALUE NC"月".
000640       03  COLUMN  33  PIC  Z(002) FROM  W-SPEY.
000650       03  COLUMN  35  PIC  N(001) VALUE NC"日".
000660       03  COLUMN  38  PIC  N(001) VALUE NC"〜".
000670       03  COLUMN  41  PIC  9(004) FROM  W-ENEN.
000680       03  COLUMN  45  PIC  N(001) VALUE NC"年".
000690       03  COLUMN  47  PIC  Z(002) FROM  W-EGET.
000700       03  COLUMN  49  PIC  N(001) VALUE NC"月".
000710       03  COLUMN  51  PIC  Z(002) FROM  W-EPEY.
000720       03  COLUMN  53  PIC  N(001) VALUE NC"日".
000730     02  D-SU    LINE  15.
000740       03  COLUMN  29  PIC  Z(003) FROM  W-SU.
000750       03  COLUMN  32  PIC  N(008) VALUE NC"枚　変換しました".
000760       03  COLUMN  54  PIC  X(006) VALUE "OK=ESC".
000770 01  C-ERR.
000780     02  LINE  24.
000790       03  E-ME1   COLUMN  15  PIC  X(028) VALUE
000800            "***  SIWAKE-I WRITE ｴﾗｰ  ***".
000810       03  E-ME2   COLUMN  15  PIC  X(031) VALUE
000820            "***  SIWAKE-IW REWRITE ｴﾗｰ  ***".
000830       03  E-ME3   COLUMN  15  PIC  X(017) VALUE
000840            "***  DATA ﾅｼ  ***".
000850       03  E-ME9   COLUMN  15  PIC  X(026) VALUE
000860            "***  未作表データ有り  ***".
000870     COPY LSSEM.
000880 PROCEDURE DIVISION.
000890 M-05.
000900     DISPLAY C-CLEAR.
000910     DISPLAY C-MID.
000920     MOVE ZERO TO W-DATA.
000930     OPEN INPUT SDW.
000940 M-10.
000950     READ SDW NEXT RECORD AT END
000960         GO TO M-15.
000970     IF SDWZHC NOT = 0
000980         GO TO M-10.
000990     IF ZERO = W-SNGP
001000         MOVE SDWYMD TO W-SNGP W-ENGP.
001010     IF SDWYMD < W-SNGP
001020         MOVE SDWYMD TO W-SNGP.
001030     IF SDWYMD > W-ENGP
001040         MOVE SDWYMD TO W-ENGP.
001050     GO TO M-10.
001060 M-15.
001070     CLOSE SDW.
001080     IF ZERO = W-SNGP
001090         DISPLAY E-ME3 E-ME99
001100         GO TO M-95.
001110     DISPLAY D-NGP.
001120 M-20.
001130     ACCEPT A-DMM.
001140     IF ESTAT = PF9
001150         GO TO M-95.
001160     IF ESTAT NOT = HTB AND SKP
001170         GO TO M-20.
001180     IF W-DMM = 9
001190         GO TO M-95.
001200     IF W-DMM NOT = 1
001210         GO TO M-20.
001220*
001230     OPEN I-O SDW.
001240     OPEN I-O SDI.
001250 M-25.
001260     READ SDW NEXT RECORD AT END
001270         GO TO M-90.
001280     IF SDWZHC NOT = 0
001290         GO TO M-25.
001300     IF SDWSIN NOT = 1
001310         DISPLAY E-ME9 E-ME99
001320         DISPLAY E-CL
001330         GO TO M-25.
001340 M-30.
001350     IF SDWJNO NOT = W-DNO
001360         ADD 1 TO W-SU
001370         MOVE SDWJNO TO W-DNO.
001380 M-35.
001390     INITIALIZE SDI-REC.
001400     MOVE SDWYMD TO SDIYMD.
001410     MOVE SDWJNO TO SDIJNO.
001420     MOVE SDWLNO TO SDILNO.
001430     MOVE SDWKARI TO SDIKARI.
001440     MOVE SDWKASI TO SDIKASI.
001450     MOVE SDWCUST TO SDICUST.
001460     MOVE SDWTEKICD TO SDITEKICD.
001470     MOVE SDWTEKI TO SDITEKI.
001480     MOVE SDWNAMEN TO SDINAMEN.
001490     MOVE SDWETAX TO SDIETAX.
001500     MOVE 1 TO SDISIN.
001510     WRITE SDI-REC INVALID KEY
001520         DISPLAY E-STAT E-ME1 E-ME99
001530         GO TO M-40.
001540*
001550     MOVE 1 TO SDWZHC.
001560     REWRITE SDW-REC INVALID KEY
001570         DISPLAY E-STAT E-ME3 E-ME99
001580         GO TO M-90.
001590     GO TO M-25.
001600 M-40.
001610     IF ERR-STAT NOT = "24"
001620         DISPLAY E-ME78 E-ME99
001630         GO TO M-90.
001640     DISPLAY E-CL.
001650     CLOSE SDI.
001660     MOVE "SIWAKE-I     " TO W-FILE.
001670     DISPLAY E-ME71 E-ME98 STOP " ".
001680     DISPLAY E-CL.
001690     OPEN I-O SDI.
001700     GO TO M-35.
001710 M-90.
001720     DISPLAY D-SU E-ME99.
001730     CLOSE SDI.
001740     CLOSE SDW.
001750 M-95.
001760     DISPLAY C-CLEAR.
001770     STOP RUN.
