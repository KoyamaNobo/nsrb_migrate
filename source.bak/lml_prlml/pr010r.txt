000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         PR010R.
000030**************************************
000040******    科目コード　問合せ    ******
000050**************************************
000060 ENVIRONMENT         DIVISION.
000070 CONFIGURATION       SECTION.
000080 SOURCE-COMPUTER.    SYSTEM3100.
000090 OBJECT-COMPUTER.    SYSTEM3100.
000100 INPUT-OUTPUT        SECTION.
000110 FILE-CONTROL.
000120     SELECT  KNG  ASSIGN  TO KNG-MSD
000130             ORGANIZATION   INDEXED
000140             ACCESS  MODE   DYNAMIC
000150             RECORD  KEY  KNG-KEY
000160             FILE   STATUS  IS  ERR-STAT.
000170 I-O-CONTROL.
000180     APPLY  SHARED-MODE  ON  KNG.
000190 DATA                DIVISION.
000200 FILE                SECTION.
000210     COPY KANGEL.
000220 WORKING-STORAGE      SECTION.
000230 01  ERR-STAT                PIC  X(002).
000240 01  W-DATA.
000250     02  W-ACT               PIC  9(001).
000260     02  W-KEY               PIC  9(004).
000270     02  W-L                 PIC  9(002).
000280     02  W-C1                PIC  9(002).
000290     02  W-C2                PIC  9(002).
000300     02  W-C3                PIC  9(002).
000310     02  CHK                 PIC  9(001).
000320     COPY LSTAT.
000330 SCREEN              SECTION.
000340 SD  C-CRT
000350     END  STATUS  IS  ESTAT.
000360 01  C-CLEAR.
000370     02  C-CL    LINE   1    CLEAR  SCREEN.
000380 01  C-MID.
000390     02  LINE   1    COLUMN  21    PIC  N(019)    VALUE
000400          NC"＊＊＊　　科目コード　問合せ　　＊＊＊" REVERSE.
000410     02  LINE   3.
000420       03  COLUMN   7  PIC  N(002) VALUE NC"科目" REVERSE.
000430       03  COLUMN  12  PIC  N(002) VALUE NC"補助" REVERSE.
000440       03  COLUMN  17  PIC  N(010) VALUE
000450            NC"科　目　名　　　　　" REVERSE.
000460       03  COLUMN  43  PIC  N(002) VALUE NC"科目" REVERSE.
000470       03  COLUMN  48  PIC  N(002) VALUE NC"補助" REVERSE.
000480       03  COLUMN  53  PIC  N(010) VALUE
000490            NC"科　目　名　　　　　" REVERSE.
000500     02  LINE  23    COLUMN  30    PIC  X(034)    VALUE
000510          "NEXT=ﾘﾀｰﾝ , 入力=ｆ･10 , 終了=ｆ･9".
000520 01  C-ACP.
000530     02  A-KEY   LINE   4  COLUMN   7  PIC  9(004)
000540          USING W-KEY   CHECK OVERFLOW NO IFC.
000550     02  A-ACT   LINE  23  COLUMN  67  PIC  9(001)
000560          USING W-ACT   CHECK OVERFLOW NO IFC.
000570 01  C-DSP.
000580     02  LINE  W-L.
000590         03  D-KEY.
000600           04  COLUMN  W-C1  PIC 9(004) FROM  K-ACCD.
000610           04  COLUMN  W-C2  PIC 9(004) FROM  K-HOCD.
000620         03  D-NAME   COLUMN  W-C3  PIC N(010) FROM  KNGNMN.
000630 01  C-ERR.
000640     02  LINE  24.
000650         03  E-STAT   COLUMN 10   PIC X(010)   FROM  ERR-STAT.
000660         03  E-ME98   COLUMN 75   PIC X(005)   VALUE ""27"J"05"".
000670         03  E-ME99   COLUMN 75   PIC X(005)   VALUE ""27"B"05"".
000680 PROCEDURE           DIVISION.
000690 M-05.
000700     DISPLAY  C-CLEAR.
000710     DISPLAY  C-MID.
000720     MOVE ZERO TO W-DATA.
000730     OPEN  INPUT KNG.
000740 M-10.
000750     ACCEPT  A-ACT.
000760     IF  ESTAT = PF9
000770         GO  TO  M-95.
000780     IF  ESTAT = HTB
000790         DISPLAY  C-CLEAR
000800         DISPLAY  C-MID
000810         GO  TO  M-20.
000820     IF  ESTAT NOT = ADV AND SKP
000830         GO  TO  M-10.
000840 M-15.
000850     ACCEPT  A-KEY.
000860     IF  ESTAT = BTB
000870         GO  TO  M-10.
000880     IF  ESTAT = PF9
000890         GO  TO  M-95.
000900     IF  ESTAT NOT = HTB AND SKP
000910         GO  TO  M-15.
000920     MOVE ZERO TO KNG-KEY.
000930     MOVE  W-KEY  TO K-ACCD.
000940 M-20.
000950     MOVE 0 TO CHK.
000960     MOVE  3      TO  W-L.
000970     MOVE 7 TO W-C1.
000980     MOVE 12 TO W-C2.
000990     MOVE 17 TO W-C3.
001000 M-25.
001010     START KNG   KEY NOT < KNG-KEY  INVALID  KEY
001020         GO  TO  M-15.
001030     READ KNG   NEXT  RECORD  WITH  UNLOCK  AT  END
001040         GO  TO  M-15.
001050 M-30.
001060     ADD  1  TO  W-L.
001070     IF  W-L = 23
001080         IF CHK = 1
001090             GO  TO  M-10
001100           ELSE
001110             MOVE 1 TO CHK
001120             MOVE  4 TO  W-L
001130             MOVE 43 TO W-C1
001140             MOVE 48 TO W-C2
001150             MOVE 53 TO W-C3.
001160     DISPLAY  D-KEY  D-NAME.
001170 M-35.
001180     READ KNG   NEXT  RECORD  WITH  UNLOCK  AT  END
001190         CLOSE  KNG
001200         OPEN  INPUT  KNG
001210         MOVE  ZERO  TO KNG-KEY
001220         GO  TO  M-25.
001230     GO  TO  M-30.
001240 M-95.
001250     CLOSE  KNG.
001260     DISPLAY  C-CLEAR.
001270     STOP  RUN.
