000010 IDENTIFICATION  DIVISION.
000020 PROGRAM-ID.     PR015M.
000030 AUTHOR.         A.KOMATSUBARA.
000040**********************************
000050*        科目マスタ(1) メンテ    *
000060**********************************
000070 ENVIRONMENT     DIVISION.
000080 CONFIGURATION   SECTION.
000090 SOURCE-COMPUTER.    SYSTEM100.
000100 OBJECT-COMPUTER.    SYSTEM100.
000110 INPUT-OUTPUT    SECTION.
000120 FILE-CONTROL.
000130     SELECT  AM              ASSIGN  TO  F1-MSD
000140             ORGANIZATION    INDEXED
000150             ACCESS          RANDOM
000160             RECORD  KEY IS  AM-KEY
000170             FILE    STATUS  ERR-STAT.
000180     SELECT  KNG             ASSIGN  TO  F2-MSD
000190             ORGANIZATION    INDEXED
000200             ACCESS          RANDOM
000210             RECORD  KEY IS  KNG-KEY
000220             FILE    STATUS  ERR-STAT.
000230 I-O-CONTROL.
000240     APPLY   SHARED-MODE  ON   AM  KNG.
000250 DATA    DIVISION.
000260 FILE    SECTION.
000270 COPY    ACCUNT.
000280 COPY    KANGEL.
000290 WORKING-STORAGE SECTION.
000300 77  ERR-STAT              PIC  X(02).
000310 01  W-GAMEN.
000320     02  W-ACT                     PIC  9(01).
000330     02  W-GAMEN-DATA.
000340         03  W-ACCTCD              PIC  9(04).
000350         03  W-KNGNMN              PIC  N(10).
000360         03  W-DR-CR               PIC  9(01).
000370         03  W-BFDZN               PIC S9(11).
000380         03  W-TEG-BAN             PIC  9(02).
000390         03  W-HOJYO               PIC  9(01).
000400         03  W-BS-PL               PIC  9(01).
000410         03  W-KEIHI               PIC  9(01).
000420         03  W-MOTKB               PIC  9(01).
000430         03  W-OKC                 PIC  X(01).
000440 01  W-AREA.
000450     02  INV-SW                    PIC  9(01).
000460 01  W-NSPACE                      PIC  N(10)  VALUE              I901218
000470            NC"　　　　　　　　　　".
000480 01  W-SPACE                       PIC  X(12)  VALUE              I901218
000490              "            ".
000500 COPY    LWMSG.
000510 SCREEN  SECTION.
000520 SD  SRT-X
000530     END STATUS  IS  ESTAT.
000540 01  DISP-C      LINE  1.
000550     02  DISP-CLE    CLEAR   SCREEN.
000560 01  DISP-AREA.
000570     02  DISP-KNGNMN LINE  6.
000580         03  COLUMN  18          PIC  N(10)   FROM   W-KNGNMN.
000590     02  DISP-BFDZN  LINE  8.
000600         03  COLUMN  27          PIC  ZZZZZZZZZZ9-
000610                                              FROM   W-BFDZN.
000620 01  ACEP-AREA.
000630     02  ACEP-ACT    LINE   3  COLUMN  67    PIC  9(01)
000640             USING   W-ACT     CHECK OVERFLOW NO IFC.
000650     02  ACEP-ACCTCD LINE   5  COLUMN  34    PIC  9(04)
000660             USING   W-ACCTCD  CHECK OVERFLOW NO IFC.
000670     02  ACEP-DR-CR  LINE   7  COLUMN  37    PIC  9(01)
000680             USING   W-DR-CR   CHECK OVERFLOW NO IFC.
000690     02  ACEP-BFDZN  LINE   8  COLUMN  27    PIC S9(11)
000700             INTO    W-BFDZN   CHECK OVERFLOW NO IFC.
000710     02  ACEP-TEG-BAN LINE  9  COLUMN  36    PIC  9(02)
000720             USING   W-TEG-BAN CHECK OVERFLOW NO IFC.
000730     02  ACEP-HOJYO  LINE   5  COLUMN  75    PIC  9(01)
000740             USING   W-HOJYO   CHECK OVERFLOW NO IFC.
000750     02  ACEP-BS-PL  LINE   6  COLUMN  75    PIC  9(01)
000760             USING   W-BS-PL   CHECK OVERFLOW NO IFC.
000770     02  ACEP-KEIHI  LINE   7  COLUMN  75    PIC  9(01)
000780             USING   W-KEIHI   CHECK OVERFLOW  NO IFC.
000790     02  ACEP-MOTKB  LINE   8  COLUMN  75    PIC  9(01)
000800             USING   W-MOTKB   CHECK OVERFLOW NO IFC.
000810     02  ACEP-OKC    LINE  24  COLUMN  77    PIC  X(01)
000820             USING   W-OKC     CHECK OVERFLOW  NO IFC.
000830 01  DISP-SP.
000840     02  LINE  3.
000850         03  COLUMN  67         VALUE " ".                        U901218
000860     02  DISP-SP-DATA.
000870         03  LINE  5.
000880             04  COLUMN  34     VALUE "    ".                     U901218
000890             04  COLUMN  75     VALUE " ".                        U901218
000900         03  LINE  6.
000910             04  COLUMN  18     PIC  N(10)  FROM  W-NSPACE.       U901218
000920             04  COLUMN  75     VALUE " ".                        U901218
000930         03  LINE  7.
000940             04  COLUMN  37     VALUE " ".                        U901218
000950             04  COLUMN  75     VALUE " ".                        U901218
000960         03  LINE  8.
000970             04  COLUMN  27     PIC  X(12)  FROM  W-SPACE.        U901218
000980             04  COLUMN  75     VALUE " ".                        U901218
000990         03  LINE  9.
001000             04  COLUMN  36     VALUE "  ".                       U901218
001010         03  LINE 24.
001020             04  COLUMN  77     VALUE " ".                        U901218
001030**
001040 COPY    LSMSG.
001050**
001060 PROCEDURE   DIVISION.
001070*************************
001080*    ＭＡＩＮ処理       *
001090*************************
001100 HAJIME.
001110     PERFORM     INI-RTN   THRU   INI-EX.
001120     PERFORM     ACP-RTN   THRU   ACP-EX.
001130     PERFORM     CLSE-ENT  THRU   CLSE-EXT.
001140 OWARI.
001150     STOP RUN.
001160*************************
001170*    初期処理           *
001180*************************
001190 INI-RTN.
001200     DISPLAY     DISP-C.
001210     CALL  "GR0150".
001220     OPEN        I-O       AM
001230                 INPUT     KNG.
001240     INITIALIZE  W-GAMEN.
001250 INI-EX.
001260     EXIT.
001270*************************
001280*    入力処理           *
001290*************************
001300 ACP-RTN.
001310     ACCEPT  ACEP-ACT.
001320     DISPLAY DISP-MSG-SPACE.
001330     IF  ESTAT  =  "P9"
001340         GO  TO  ACP-EX.
001350     IF  ESTAT  NOT =  "01" AND "06"
001360         GO  TO  ACP-RTN.
001370     IF  W-ACT  NOT =  1 AND 2 AND 3
001380         DISPLAY ERR-01  DISP-BUZ-J
001390         GO  TO  ACP-RTN.
001400 ACP-010.
001410     ACCEPT  ACEP-ACCTCD.
001420     DISPLAY DISP-MSG-SPACE.
001430     IF  ESTAT  =  "09"
001440         INITIALIZE W-GAMEN-DATA
001450         DISPLAY DISP-SP-DATA
001460         GO  TO  ACP-RTN.
001470     IF  ESTAT  NOT =  "01" AND "06"
001480         GO  TO  ACP-010.
001490*****DISPLAY ACEP-ACCTCD.                                         D901218
001500     MOVE  0     TO  INV-SW.
001510     PERFORM SCHK-RTN  THRU  SCHK-EX.
001520     IF  W-ACT  =  1
001530         IF  INV-SW  =  0
001540             DISPLAY NOR-D01  DISP-BUZ-J
001550             GO  TO  ACP-010.
001560     IF  W-ACT  =  2 OR 3
001570         IF  INV-SW  =  1
001580             DISPLAY INV-D01  DISP-BUZ-J
001590             GO  TO  ACP-010
001600         ELSE
001610             PERFORM DSP-RTN  THRU DSP-EX.
001620     MOVE  0     TO  INV-SW.
001630     PERFORM MCHK-RTN  THRU MCHK-EX.
001640     IF  INV-SW  =  1
001650         DISPLAY INV-M01  DISP-BUZ-J
001660         GO  TO  ACP-010.
001670     DISPLAY DISP-KNGNMN.
001680     IF  W-ACT  =  3
001690         GO  TO  ACP-090.
001700 ACP-020.
001710     ACCEPT  ACEP-DR-CR.
001720     IF  ESTAT  =  "09"
001730         GO  TO  ACP-010.
001740     IF  ESTAT  NOT =  "01" AND "06"
001750         GO  TO  ACP-020.
001760 ACP-030.
001770     ACCEPT  ACEP-BFDZN.
001780     IF  ESTAT  =  "09"
001790         GO  TO  ACP-020.
001800     IF  ESTAT  NOT =  "01" AND "06"
001810         GO  TO  ACP-030.
001820     DISPLAY DISP-BFDZN.
001830 ACP-040.
001840     ACCEPT  ACEP-TEG-BAN.
001850     IF  ESTAT  =  "09"
001860         GO  TO  ACP-030.
001870     IF  ESTAT  NOT =  "01" AND "06"
001880         GO  TO  ACP-040.
001890*****DISPLAY ACEP-TEG-BAN.                                        D901218
001900 ACP-050.
001910     ACCEPT  ACEP-HOJYO.
001920     IF  ESTAT  =  "09"
001930         GO  TO  ACP-040.
001940     IF  ESTAT  NOT =  "01" AND "06"
001950         GO  TO  ACP-050.
001960 ACP-060.
001970     ACCEPT  ACEP-BS-PL.
001980     IF  ESTAT  =  "09"
001990         GO  TO  ACP-050.
002000     IF  ESTAT  NOT =  "01" AND "06"
002010         GO  TO  ACP-060.
002020 ACP-070.
002030     ACCEPT  ACEP-KEIHI.
002040     IF  ESTAT  =  "09"
002050         GO  TO  ACP-060.
002060     IF  ESTAT  NOT =  "01" AND "06"
002070         GO  TO  ACP-070.
002080 ACP-080.
002090     ACCEPT  ACEP-MOTKB.
002100     IF  ESTAT  =  "09"
002110         GO  TO  ACP-070.
002120     IF  ESTAT  NOT =  "01" AND "06"
002130         GO  TO  ACP-080.
002140 ACP-090.
002150     ACCEPT  ACEP-OKC.
002160     DISPLAY DISP-MSG-SPACE.
002170     IF  ESTAT  =  "09"
002180         IF  W-ACT  =  3
002190             GO  TO  ACP-010
002200         ELSE
002210             GO  TO  ACP-080.
002220     IF  ESTAT  NOT =  "01" AND "06"
002230         GO  TO  ACP-090.
002240     IF  W-OKC  NOT =  "1" AND "9"
002250         DISPLAY ERR-01  DISP-BUZ-J
002260         GO  TO  ACP-090.
002270     IF  W-OKC  =  "1"
002280         PERFORM UPD-RTN  THRU UPD-EX
002290         INITIALIZE  W-GAMEN-DATA
002300         DISPLAY DISP-SP-DATA
002310         DISPLAY OK-01
002320         GO  TO  ACP-010.
002330     IF  W-OKC  =  "9"
002340         INITIALIZE  W-GAMEN
002350         DISPLAY DISP-SP
002360         DISPLAY CAN-01
002370         GO  TO  ACP-RTN.
002380 ACP-EX.
002390     EXIT.
002400*************************
002410*    終了処理           *
002420*************************
002430 CLSE-ENT.
002440     CLOSE       AM  KNG.
002450 CLSE-EXT.
002460     EXIT.
002470*************************
002480*    存在チェック       *
002490*************************
002500 SCHK-RTN.
002510     MOVE  W-ACCTCD   TO   AM-KEY.
002520     READ  AM         INVALID
002530                 MOVE 1    TO  INV-SW.
002540 SCHK-EX.
002550     EXIT.
002560*************************
002570*    表示処理　　       *
002580*************************
002590 DSP-RTN.
002600     MOVE  DR-CR      TO   W-DR-CR.
002610     MOVE  BFDZN      TO   W-BFDZN.
002620     MOVE  TEG-BAN    TO   W-TEG-BAN.
002630     MOVE  HOJYO      TO   W-HOJYO.
002640     MOVE  BS-PL      TO   W-BS-PL.
002650     MOVE  KEIHI      TO   W-KEIHI.
002660     MOVE  MOTKB      TO   W-MOTKB.
002670     DISPLAY ACEP-DR-CR  DISP-BFDZN  ACEP-TEG-BAN
002680             ACEP-HOJYO  ACEP-BS-PL  ACEP-KEIHI
002690             ACEP-MOTKB.
002700 DSP-EX.
002710     EXIT.
002720********************************
002730*    漢字科目Ｍ　存在チェック  *
002740********************************
002750 MCHK-RTN.
002760     MOVE  ZERO       TO   KNG-KEY.
002770     MOVE  W-ACCTCD   TO   K-ACCD.
002780     READ  KNG        UNLOCK INVALID
002790                 MOVE 1    TO  INV-SW
002800                 GO  TO    MCHK-EX.
002810     MOVE  KNGNMN     TO   W-KNGNMN.
002820 MCHK-EX.
002830     EXIT.
002840*************************
002850*    更新処理           *
002860*************************
002870 UPD-RTN.
002880     IF  W-ACT  =  1
002890         PERFORM   WRITE-RTN THRU   WRITE-EX.
002900     IF  W-ACT  =  2
002910         PERFORM REWRITE-RTN THRU REWRITE-EX.
002920     IF  W-ACT  =  3
002930         PERFORM  DELETE-RTN THRU  DELETE-EX.
002940 UPD-EX.
002950     EXIT.
002960*************************
002970*    登録処理           *
002980*************************
002990 WRITE-RTN.
003000     INITIALIZE  AM-REC.
003010     PERFORM SET-RTN THRU SET-EX.
003020     MOVE    AM-KEY               TO   ERR-K.                     I901218
003030     WRITE   AM-REC  INVALID
003040             MOVE    "AM"         TO   ERR-F
003050             MOVE    "W"          TO   ERR-M
003060*****        MOVE    AM-KEY       TO   ERR-K                      D901218
003070             PERFORM ERR-ENT    THRU   ERR-EXT.
003080     CALL "CBLTCLS" USING AM.
003090 WRITE-EX.
003100     EXIT.
003110*************************
003120*    修正処理           *
003130*************************
003140 REWRITE-RTN.
003150     PERFORM SET-RTN THRU SET-EX.
003160     MOVE    AM-KEY               TO   ERR-K.                     I901218
003170     REWRITE AM-REC  INVALID
003180             MOVE    "AM"         TO   ERR-F
003190             MOVE    "R"          TO   ERR-M
003200*****        MOVE    AM-KEY       TO   ERR-K                      D901218
003210             PERFORM ERR-ENT    THRU   ERR-EXT.
003220 REWRITE-EX.
003230     EXIT.
003240*************************
003250*    削除処理           *
003260*************************
003270 DELETE-RTN.
003280     MOVE    AM-KEY               TO   ERR-K.                     I901218
003290     DELETE  AM       INVALID
003300             MOVE    "AM"         TO   ERR-F
003310             MOVE    "D"          TO   ERR-M
003320*****        MOVE    AM-KEY       TO   ERR-K                      D901218
003330             PERFORM ERR-ENT    THRU   ERR-EXT.
003340     CALL "CBLTCLS" USING AM.
003350 DELETE-EX.
003360     EXIT.
003370*************************
003380*    項目セット処理     *
003390*************************
003400 SET-RTN.
003410     MOVE  W-ACCTCD   TO   AM-KEY.
003420     MOVE  W-DR-CR    TO   DR-CR.
003430     MOVE  W-BFDZN    TO   BFDZN.
003440     MOVE  W-TEG-BAN  TO   TEG-BAN.
003450     MOVE  W-HOJYO    TO   HOJYO.
003460     MOVE  W-BS-PL    TO   BS-PL.
003470     MOVE  W-KEIHI    TO   KEIHI.
003480     MOVE  W-MOTKB    TO   MOTKB.
003490 SET-EX.
003500     EXIT.
003510*******
003520     COPY    LPMSG.
