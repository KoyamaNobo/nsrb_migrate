000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMH110.
000030*********************************************************
000040*    PROGRAM         :  履物分類別在庫・廃棄明細表      *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT TSW-F ASSIGN TO TSW-MSD
000170         FILE STATUS IS ERR-STAT.
000180     SELECT HKBM ASSIGN TO HKB-MSD
000190         ORGANIZATION INDEXED
000200         RECORD KEY HKB-KEY
000210         ACCESS MODE RANDOM
000220         FILE STATUS IS ERR-STAT.
000230     SELECT SP-F ASSIGN TO P-PRN999.
000240 I-O-CONTROL.
000250     APPLY SHARED-MODE ON M-DATE
000260     APPLY SHARED-MODE ON HKBM
000270     APPLY SHIFT-CODE  ON SP-F.
000280 DATA DIVISION.
000290 FILE SECTION.
000300     COPY LIBFDD.
000310     COPY LIHKBM.
000320     COPY LSPF.
000330 FD  TSW-F
000340     BLOCK  2 RECORDS
000350     LABEL RECORD IS STANDARD
000360     VALUE OF IDENTIFICATION WK0128ID.
000370 01  TSW-R.
000380     02  TSW-HCD        PIC  9(006).
000390     02  TSW-KSU        PIC S9(006).
000400     02  TSW-HSU        PIC S9(006).
000410     02  TSW-FT         PIC  9(005).
000420     02  TSW-BC1        PIC  9(002).
000430     02  TSW-BC2        PIC  9(002).
000440     02  TSW-BC3        PIC  9(002).
000450     02  TSW-BMC        PIC  9(002).
000460     02  TSW-BMNO       PIC  9(001).
000470     02  F              PIC  X(096).
000480 WORKING-STORAGE SECTION.
000490 77  W-15K              PIC  X(005) VALUE ""3FE04F40A0"".
000500 77  WK0128ID           PIC  X(009) VALUE SPACE.
000510 01  STN-NO.
000520     02  STN-NO1        PIC  X(003).
000530     02  STN-NO2        PIC  X(003).
000540 01  W-FID.
000550     02  W-FID1         PIC  X(006) VALUE "WK0128".
000560     02  W-FID2         PIC  X(003).
000570 01  HEAD1.
000580     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000590     02  F              PIC  X(029) VALUE SPACE.
000600     02  F              PIC  N(024) VALUE
000610          NC"＊＊＊　　履物　分類　在庫・廃棄明細表　　＊＊＊".
000620     02  F              PIC  X(021) VALUE SPACE.
000630     02  F              PIC  X(005) VALUE "DATE ".
000640     02  H-DATE         PIC 99B99B99.
000650 01  HEAD2.
000660     02  F              PIC  X(038) VALUE SPACE.
000670     02  F              PIC  X(008) VALUE "I-----  ".
000680     02  F              PIC  N(003) VALUE NC"在　庫".
000690     02  F              PIC  X(019) VALUE "  ------I  I-----  ".
000700     02  F              PIC  N(003) VALUE NC"廃　棄".
000710     02  F              PIC  X(019) VALUE "  ------I  I-----  ".
000720     02  F              PIC  N(003) VALUE NC"残　高".
000730     02  F              PIC  X(009) VALUE "  ------I".
000740 01  HEAD3.
000750     02  F              PIC  X(041) VALUE SPACE.
000760     02  F              PIC  N(003) VALUE NC"数　量".
000770     02  F              PIC  X(008) VALUE SPACE.
000780     02  F              PIC  N(003) VALUE NC"金　額".
000790     02  F              PIC  X(005) VALUE SPACE.
000800     02  F              PIC  N(003) VALUE NC"数　量".
000810     02  F              PIC  X(008) VALUE SPACE.
000820     02  F              PIC  N(003) VALUE NC"金　額".
000830     02  F              PIC  X(005) VALUE SPACE.
000840     02  F              PIC  N(003) VALUE NC"数　量".
000850     02  F              PIC  X(008) VALUE SPACE.
000860     02  F              PIC  N(003) VALUE NC"金　額".
000870 01  W-P.
000880     02  P-M0           PIC  N(003).
000890     02  F              PIC  X(004).
000900     02  P-TM           PIC  N(013).
000910     02  P-MD    REDEFINES P-TM.
000920       03  P-M1         PIC  N(003).
000930       03  F            PIC  X(004).
000940       03  P-M2         PIC  N(008).
000950     02  P-KSU          PIC ---,---,--9.
000960     02  P-KKIN         PIC --,---,---,--9.
000970     02  P-HSU          PIC ---,---,--9.
000980     02  P-HKIN         PIC --,---,---,--9.
000990     02  P-ZSU          PIC ---,---,--9.
001000     02  P-ZKIN         PIC --,---,---,--9.
001010 01  W-DATA.
001020     02  W-DMM          PIC  9(001).
001030     02  W-BC3          PIC  9(002).
001040     02  W-BMC          PIC  9(002).
001050     02  W-BC1          PIC  9(002).
001060     02  W-BN3          PIC  N(003).
001070     02  W-BMN          PIC  N(003).
001080     02  CHK.
001090       03  CHK1         PIC  9(001).
001100       03  CHK2         PIC  9(001).
001110     02  CNT            PIC  9(001).
001120 01  W-TD.
001130     02  WT-KSU         PIC S9(007).
001140     02  WT-KKIN        PIC S9(010).
001150     02  WT-HSU         PIC S9(007).
001160     02  WT-HKIN        PIC S9(010).
001170     02  WT-ZSU         PIC S9(007).
001180     02  WT-ZKIN        PIC S9(009).
001190 01  W-GD.
001200     02  WG-KSU         PIC S9(007).
001210     02  WG-KKIN        PIC S9(010).
001220     02  WG-HSU         PIC S9(007).
001230     02  WG-HKIN        PIC S9(010).
001240     02  WG-ZSU         PIC S9(007).
001250     02  WG-ZKIN        PIC S9(009).
001260 01  W-SD.
001270     02  WS-KSU         PIC S9(007).
001280     02  WS-KKIN        PIC S9(010).
001290     02  WS-HSU         PIC S9(007).
001300     02  WS-HKIN        PIC S9(010).
001310     02  WS-ZSU         PIC S9(007).
001320     02  WS-ZKIN        PIC S9(009).
001330 01  W-AD.
001340     02  WA-KSU         PIC S9(007).
001350     02  WA-KKIN        PIC S9(010).
001360     02  WA-HSU         PIC S9(007).
001370     02  WA-HKIN        PIC S9(010).
001380     02  WA-ZSU         PIC S9(007).
001390     02  WA-ZKIN        PIC S9(009).
001400 01  ERR-STAT           PIC  X(002).
001410     COPY LSTAT.
001420 SCREEN SECTION.
001430 SD  C-CRT
001440     END STATUS IS ESTAT.
001450 01  C-CLEAR.
001460     02  LINE   1  CLEAR SCREEN.
001470 01  C-MID.
001480     02  LINE   3  COLUMN  10  PIC  N(023) VALUE
001490          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001500     02  LINE   4  COLUMN  10  PIC  N(023) VALUE
001510          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001520     02  LINE   5  COLUMN  10  PIC  N(023) VALUE
001530          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001540     02  LINE   6  COLUMN  10  PIC  N(023) VALUE
001550          NC"＊＊＊　　　履物　分類　在庫・廃棄　　　＊＊＊".
001560     02  LINE   7  COLUMN  10  PIC  N(023) VALUE
001570          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001580     02  LINE   8  COLUMN  10  PIC  N(023) VALUE
001590          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001600     02  LINE   9  COLUMN  10  PIC  N(023) VALUE
001610          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001620     02  LINE  22  COLUMN  22  PIC  X(022) VALUE
001630          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001640 01  C-ACP.
001650     02  A-DMM   LINE  22  COLUMN  39  PIC  9(001)
001660          USING W-DMM   CHECK OVERFLOW NO IFC.
001670 01  C-ERR.
001680     02  LINE  24.
001690       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001700            "***  DATA ﾅｼ  ***".
001710       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001720            "***  HKBM ﾅｼ  ***".
001730       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001740       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001750       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001760     COPY LIBSCR.
001770 PROCEDURE DIVISION.
001780 M-05.
001790     COPY LIBCPR.
001800     DISPLAY C-CLEAR.
001810     DISPLAY C-MID.
001820 M-10.
001830     ACCEPT A-DMM.
001840     IF ESTAT = PF9
001850         GO TO M-95.
001860     IF ESTAT NOT = HTB AND SKP
001870         GO TO M-10.
001880     IF W-DMM = 9
001890         GO TO M-95.
001900     IF W-DMM NOT = 1
001910         GO TO M-10.
001920*
001930     CALL "CBLSTNNO" USING STN-NO.
001940     MOVE STN-NO2 TO W-FID2.
001950     MOVE W-FID TO WK0128ID.
001960     OPEN INPUT TSW-F.
001970     OPEN INPUT HKBM.
001980     OPEN OUTPUT SP-F.
001990     MOVE DATE-02R TO H-DATE.
002000     MOVE ZERO TO W-AD.
002010 M-15.
002020     READ TSW-F AT END
002030         DISPLAY E-ME1 E-ME99
002040         GO TO M-90.
002050     IF ZERO = TSW-KSU AND TSW-HSU
002060         GO TO M-15.
002070     PERFORM MID-020 THRU MID-EX.
002080 M-20.
002090     MOVE TSW-BC3 TO W-BC3.
002100     MOVE ZERO TO W-SD CHK.
002110     MOVE SPACE TO HKB-KEY.
002120     MOVE "14" TO HKB-NO.
002130     MOVE W-BC3 TO HKB-BR3.
002140     READ HKBM WITH UNLOCK INVALID KEY
002150         DISPLAY E-ME2 E-ME99
002160         MOVE SPACE TO HKB-BRN3.
002170     MOVE HKB-BRN3 TO W-BN3.
002180 M-25.
002190     MOVE TSW-BMC TO W-BMC.
002200     MOVE ZERO TO W-GD CHK2 CNT.
002210     MOVE SPACE TO HKB-KEY.
002220     MOVE "16" TO HKB-NO.
002230     MOVE W-BMC TO HKB-BMC.
002240     READ HKBM WITH UNLOCK INVALID KEY
002250         DISPLAY E-ME2 E-ME99
002260         MOVE SPACE TO HKB-BMN.
002270     MOVE HKB-BMN TO W-BMN.
002280 M-30.
002290     MOVE TSW-BC1 TO W-BC1.
002300     MOVE ZERO TO W-TD.
002310     MOVE SPACE TO HKB-KEY.
002320     MOVE "11" TO HKB-NO.
002330     MOVE W-BC1 TO HKB-BR1.
002340     READ HKBM WITH UNLOCK INVALID KEY
002350         DISPLAY E-ME2 E-ME99
002360         MOVE SPACE TO HKB-BRN1.
002370 M-35.
002380     ADD TSW-KSU TO WT-KSU.
002390     COMPUTE WT-KKIN = WT-KKIN + (TSW-KSU * TSW-FT).
002400     ADD TSW-HSU TO WT-HSU.
002410     COMPUTE WT-HKIN = WT-HKIN + (TSW-HSU * TSW-FT).
002420     COMPUTE WT-ZSU = WT-KSU - WT-HSU.
002430     COMPUTE WT-ZKIN = WT-KKIN - WT-HKIN.
002440 M-40.
002450     READ TSW-F AT END
002460         GO TO M-85.
002470     IF ZERO = TSW-KSU AND TSW-HSU
002480         GO TO M-40.
002490     IF TSW-BC3 NOT = W-BC3
002500         GO TO M-50.
002510     IF TSW-BMC NOT = W-BMC
002520         GO TO M-45.
002530     IF TSW-BC1 = W-BC1
002540         GO TO M-35.
002550*
002560     PERFORM MEI-RTN THRU MEI-EX.
002570     GO TO M-30.
002580 M-45.
002590     PERFORM MEI-RTN THRU MEI-EX.
002600     PERFORM KEI1-RTN THRU KEI1-EX.
002610     GO TO M-25.
002620 M-50.
002630     PERFORM MEI-RTN THRU MEI-EX.
002640     PERFORM KEI1-RTN THRU KEI1-EX.
002650     PERFORM KEI2-RTN THRU KEI2-EX.
002660     GO TO M-20.
002670 M-85.
002680     PERFORM MEI-RTN THRU MEI-EX.
002690     PERFORM KEI1-RTN THRU KEI1-EX.
002700     PERFORM KEI2-RTN THRU KEI2-EX.
002710     PERFORM KEI3-RTN THRU KEI3-EX.
002720 M-90.
002730     CLOSE HKBM.
002740     CLOSE TSW-F.
002750     CLOSE SP-F.
002760 M-95.
002770     DISPLAY C-CLEAR.
002780     STOP RUN.
002790 MID-RTN.
002800     MOVE SPACE TO SP-R.
002810     WRITE SP-R AFTER PAGE.
002820 MID-020.
002830     MOVE SPACE TO SP-R.
002840     MOVE HEAD1 TO SP-R.
002850     WRITE SP-R.
002860     MOVE SPACE TO SP-R.
002870     MOVE HEAD2 TO SP-R.
002880     WRITE SP-R AFTER 2.
002890     MOVE SPACE TO SP-R.
002900     MOVE HEAD3 TO SP-R.
002910     WRITE SP-R.
002920     MOVE SPACE TO SP-R.
002930 MID-EX.
002940     EXIT.
002950 MEI-RTN.
002960     IF ZERO = WT-KSU AND WT-KKIN AND WT-HSU AND WT-HKIN AND
002970               WT-ZSU AND WT-ZKIN
002980         GO TO MEI-EX.
002990*
003000     MOVE SPACE TO W-P.
003010     MOVE ALL NX"2121" TO P-M0 P-TM.
003020     IF CHK1 = 0
003030         MOVE 1 TO CHK1
003040         MOVE W-BN3 TO P-M0
003050         MOVE W-BMN TO P-M1.
003060     IF CHK2 = 0
003070         MOVE 1 TO CHK2
003080         MOVE W-BMN TO P-M1.
003090     MOVE HKB-BRN1 TO P-M2.
003100     MOVE WT-KSU TO P-KSU.
003110     MOVE WT-KKIN TO P-KKIN.
003120     MOVE WT-HSU TO P-HSU.
003130     MOVE WT-HKIN TO P-HKIN.
003140     MOVE WT-ZSU TO P-ZSU.
003150     MOVE WT-ZKIN TO P-ZKIN.
003160     IF LINAGE-COUNTER > 59
003170         PERFORM MID-RTN THRU MID-EX.
003180     MOVE SPACE TO SP-R.
003190     MOVE W-P TO SP-R.
003200     WRITE SP-R.
003210     MOVE SPACE TO SP-R.
003220*
003230     ADD WT-KSU TO WG-KSU.
003240     ADD WT-KKIN TO WG-KKIN.
003250     ADD WT-HSU TO WG-HSU.
003260     ADD WT-HKIN TO WG-HKIN.
003270     ADD WT-ZSU TO WG-ZSU.
003280     ADD WT-ZKIN TO WG-ZKIN.
003290     IF CNT = 5
003300         MOVE 9 TO CNT.
003310     IF CNT = 0
003320         MOVE 5 TO CNT.
003330 MEI-EX.
003340     EXIT.
003350 KEI1-RTN.
003360     IF CNT NOT = 9
003370         MOVE SPACE TO SP-R
003380         GO TO KEI1-020.
003390     MOVE SPACE TO W-P.
003400     MOVE ALL NX"2121" TO P-M0 P-TM.
003410     MOVE NC"　　　　　　　　（　計　）" TO P-TM.
003420     MOVE WG-KSU TO P-KSU.
003430     MOVE WG-KKIN TO P-KKIN.
003440     MOVE WG-HSU TO P-HSU.
003450     MOVE WG-HKIN TO P-HKIN.
003460     MOVE WG-ZSU TO P-ZSU.
003470     MOVE WG-ZKIN TO P-ZKIN.
003480     IF LINAGE-COUNTER > 59
003490         PERFORM MID-RTN THRU MID-EX.
003500     MOVE SPACE TO SP-R.
003510     MOVE W-P TO SP-R.
003520     WRITE SP-R.
003530     MOVE SPACE TO SP-R.
003540 KEI1-020.
003550     WRITE SP-R.
003560     ADD WG-KSU TO WS-KSU.
003570     ADD WG-KKIN TO WS-KKIN.
003580     ADD WG-HSU TO WS-HSU.
003590     ADD WG-HKIN TO WS-HKIN.
003600     ADD WG-ZSU TO WS-ZSU.
003610     ADD WG-ZKIN TO WS-ZKIN.
003620 KEI1-EX.
003630     EXIT.
003640 KEI2-RTN.
003650     MOVE SPACE TO W-P.
003660     MOVE ALL NX"2121" TO P-M0 P-TM.
003670     MOVE NC"　　　［　小　計　］　　　" TO P-TM.
003680     MOVE WS-KSU TO P-KSU.
003690     MOVE WS-KKIN TO P-KKIN.
003700     MOVE WS-HSU TO P-HSU.
003710     MOVE WS-HKIN TO P-HKIN.
003720     MOVE WS-ZSU TO P-ZSU.
003730     MOVE WS-ZKIN TO P-ZKIN.
003740     IF LINAGE-COUNTER > 59
003750         PERFORM MID-RTN THRU MID-EX.
003760     MOVE SPACE TO SP-R.
003770     MOVE W-P TO SP-R.
003780     WRITE SP-R.
003790     MOVE SPACE TO SP-R.
003800     WRITE SP-R.
003810*
003820     ADD WS-KSU TO WA-KSU.
003830     ADD WS-KKIN TO WA-KKIN.
003840     ADD WS-HSU TO WA-HSU.
003850     ADD WS-HKIN TO WA-HKIN.
003860     ADD WS-ZSU TO WA-ZSU.
003870     ADD WS-ZKIN TO WA-ZKIN.
003880 KEI2-EX.
003890     EXIT.
003900 KEI3-RTN.
003910     MOVE SPACE TO W-P.
003920     MOVE ALL NX"2121" TO P-M0 P-TM.
003930     MOVE NC"【　　合　計　　】　　　　" TO P-TM.
003940     MOVE WA-KSU TO P-KSU.
003950     MOVE WA-KKIN TO P-KKIN.
003960     MOVE WA-HSU TO P-HSU.
003970     MOVE WA-HKIN TO P-HKIN.
003980     MOVE WA-ZSU TO P-ZSU.
003990     MOVE WA-ZKIN TO P-ZKIN.
004000     MOVE SPACE TO SP-R.
004010     MOVE W-P TO SP-R.
004020     WRITE SP-R.
004030 KEI3-EX.
004040     EXIT.
