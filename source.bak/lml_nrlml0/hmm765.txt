000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMG960.
000030*    PROGRAM         :  履物月次　マスター更新・クリア　　 *
000040 ENVIRONMENT DIVISION.
000050 CONFIGURATION SECTION.
000060 SOURCE-COMPUTER. SYSTEM3100.
000070 OBJECT-COMPUTER. SYSTEM3100.
000080 INPUT-OUTPUT SECTION.
000090 FILE-CONTROL.
000100     COPY LIBCSE.
000110     SELECT HIYF ASSIGN TO HIY-MSD.
000120     SELECT HUH-M ASSIGN TO HUH-MSD
000130         ORGANIZATION INDEXED
000140         RECORD KEY HUH-KEY
000150         ACCESS MODE DYNAMIC
000160         FILE STATUS IS ERR-STAT.
000170 I-O-CONTROL.
000180     APPLY SHARED-MODE ON M-DATE.
000190 DATA DIVISION.
000200 FILE SECTION.
000210     COPY LIBFDD.
000220 FD  HIYF
000230     BLOCK  5 RECORDS
000240     LABEL RECORD IS STANDARD
000250     VALUE OF IDENTIFICATION "HIYF".
000260 01  HIY-R.
000270     02  F              PIC  X(006).                              品名ｺｰﾄﾞ
000280     02  HIY-NGD.
000290       03  HIY-NEN      PIC  9(004).
000300       03  HIY-GET      PIC  9(002).
000310     02  HIY-NG    REDEFINES HIY-NGD  PIC 9(006).
000320     02  F              PIC  X(090).
000330 FD  HUH-M
000340     BLOCK  5 RECORDS
000350     LABEL RECORD IS STANDARD
000360     VALUE OF IDENTIFICATION "T-HUHM".
000370 01  HUH-R.
000380     02  HUH-KEY.
000390       03  HUH-HCD      PIC  9(006).                              品名ｺｰﾄﾞ
000400       03  HUH-HCDD  REDEFINES HUH-HCD.
000410         04  HUH-HCD1   PIC  9(004).
000420         04  HUH-HCD2   PIC  9(002).
000430     02  HUH-NGD.
000440       03  HUH-NEN      PIC  9(004).
000450       03  HUH-GET      PIC  9(002).
000460     02  HUH-NG    REDEFINES HUH-NGD  PIC 9(006).
000470     02  HUH-D.
000480       03  HUH-ZS       PIC S9(006).                              前繰数
000490       03  HUH-ZK       PIC S9(009).                              前繰額
000500       03  HUH-NS       PIC S9(007).                              入庫数
000510       03  HUH-NK       PIC S9(010).                              入庫額
000520       03  HUH-SS       PIC S9(008).                              出荷数
000530       03  HUH-SK       PIC S9(010).                              出荷額
000540       03  HUH-YS       PIC S9(006).                              翌繰数
000550       03  HUH-YK       PIC S9(009).                              翌繰額
000560       03  HUH-UG       PIC S9(010).                              売上原価
000570     02  HUH-BCD12.
000580       03  HUH-BCD1     PIC  9(003).
000590       03  HUH-BCW1  REDEFINES HUH-BCD1.
000600         04  HUH-BC1    PIC  9(002).
000610         04  HUH-BC21   PIC  9(001).
000620       03  HUH-BC22     PIC  9(001).
000630     02  HUH-BCW12 REDEFINES HUH-BCD12.
000640       03  F            PIC  9(002).
000650       03  HUH-BC2      PIC  9(002).
000660     02  HUH-BC3        PIC  9(002).                              分類CD3
000670     02  HUH-BCD3  REDEFINES HUH-BC3.
000680       03  HUH-BC31     PIC  9(001).
000690       03  HUH-BC32     PIC  9(001).
000700     02  HUH-BMC        PIC  9(002).
000710     02  HUH-BMNO       PIC  9(001).
000720     02  HUH-BC4        PIC  9(001).
000730     02  F              PIC  X(005).
000740 WORKING-STORAGE SECTION.
000750 77  W-FILE             PIC  X(013).
000760 01  W-DATA.
000770     02  W-NG.
000780       03  W-NEN        PIC  9(004).
000790       03  W-GET        PIC  9(002).
000800     02  W-DMM          PIC  9(001).
000810     02  W-DC           PIC  9(001).
000820     02  W-NGD.
000830       03  W-NEN1       PIC  9(002).
000840       03  W-NGS.
000850         04  W-NEN2     PIC  9(002).
000860         04  W-GETS     PIC  9(002).
000870 01  ERR-STAT           PIC  X(002).
000880     COPY LSTAT.
000890 SCREEN SECTION.
000900 SD  C-CRT
000910     END STATUS IS ESTAT.
000920 01  C-CLEAR.
000930     02  C-CL    LINE   1  CLEAR SCREEN.
000940 01  C-MID.
000950     02  LINE   3  COLUMN  10  PIC  N(025) VALUE
000960          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000970     02  LINE   4  COLUMN  10  PIC  N(025) VALUE
000980          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000990     02  LINE   5  COLUMN  10  PIC  N(025) VALUE
001000          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001010     02  LINE   6  COLUMN  10  PIC  N(025) VALUE
001020          NC"＊＊＊　　ＨＩＹＦ　Ｔ−ＨＵＨＭ　変換　　　＊＊＊".
001030     02  LINE   7  COLUMN  10  PIC  N(025) VALUE
001040          NC"＊＊＊　　　　　　（評価替え）　　　　　　　＊＊＊".
001050     02  LINE   8  COLUMN  10  PIC  N(025) VALUE
001060          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001070     02  LINE   9  COLUMN  10  PIC  N(025) VALUE
001080          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001090     02  LINE  12  COLUMN  18  PIC  X(014) VALUE
001100            "    年   月 分".
001110     02  LINE  22  COLUMN  18  PIC  X(022) VALUE
001120            "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001130 01  C-ACP.
001140     02  LINE  12.
001150       03  A-NEN   COLUMN  18  PIC 9(004)
001160            USING W-NEN   CHECK OVERFLOW NO IFC.
001170       03  A-GET   COLUMN  25  PIC 9(002)
001180            USING W-GET   CHECK OVERFLOW NO IFC.
001190     02  A-DMM   LINE  22  COLUMN  35  PIC 9(001)
001200          USING W-DMM   CHECK OVERFLOW NO IFC.
001210 01  C-ERR.
001220     02  LINE  24.
001230       03  E-ME1   COLUMN  15  PIC  X(022) VALUE
001240            "***  HIYF DATA ﾅｼ  ***".
001250       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
001260            "***  T-HUHM WRITE ｴﾗｰ  ***".
001270       03  E-HUHM  COLUMN  50  PIC  X(006) FROM  HUH-KEY.
001280     COPY LIBSCR.
001290     COPY LSSEM.
001300 PROCEDURE DIVISION.
001310 M-05.
001320     DISPLAY C-CLEAR.
001330     DISPLAY C-MID.
001340     MOVE ZERO TO W-DATA.
001350     COPY LIBCPR.
001360     MOVE D-NHNG TO W-NGS.
001370     MOVE 20 TO W-NEN1.
001380     SUBTRACT 1 FROM W-GETS.
001390     IF W-GETS = ZERO
001400         MOVE 12 TO W-GETS
001410         SUBTRACT 1 FROM W-NEN2.
001420     MOVE W-NGD TO W-NG.
001430     DISPLAY A-NEN A-GET.
001440 M-10.
001450     ACCEPT A-NEN.
001460     IF ESTAT = PF9
001470         MOVE 255 TO COMPLETION-CODE
001480         GO TO M-95.
001490     IF ESTAT NOT = HTB AND SKP
001500         GO TO M-10.
001510     IF W-NEN < 2010
001520         GO TO M-10.
001530 M-15.
001540     ACCEPT A-GET.
001550     IF ESTAT = BTB
001560         GO TO M-10.
001570     IF ESTAT NOT = HTB AND SKP
001580         GO TO M-15.
001590     IF W-GET < 1 OR > 12
001600         GO TO M-15.
001610 M-20.
001620     ACCEPT A-DMM.
001630     IF ESTAT = BTB
001640         GO TO M-15.
001650     IF ESTAT NOT = HTB AND SKP
001660         GO TO M-20.
001670     IF W-DMM = 9
001680         MOVE 255 TO COMPLETION-CODE
001690         GO TO M-95.
001700     IF W-DMM NOT = 1
001710         GO TO M-20.
001720*
001730     OPEN OUTPUT HUH-M.
001740     CLOSE HUH-M.
001750     OPEN INPUT HIYF.
001760     OPEN I-O HUH-M.
001770 M-25.
001780     READ HIYF AT END
001790         GO TO M-90.
001800     IF HIY-NG NOT = W-NG
001810         GO TO M-25.
001820     MOVE HIY-R TO HUH-R.
001830     WRITE HUH-R INVALID KEY
001840         MOVE 255 TO COMPLETION-CODE
001850         DISPLAY E-ME2 E-HUHM E-ME99
001860         GO TO M-90.
001870     IF W-DC = 0
001880         MOVE 1 TO W-DC.
001890     GO TO M-25.
001900 M-90.
001910     CLOSE HUH-M.
001920     CLOSE HIYF.
001930     IF W-DC = 0
001940         MOVE 255 TO COMPLETION-CODE
001950         DISPLAY E-ME1 E-ME99.
001960 M-95.
001970     DISPLAY C-CLEAR.
001980     STOP RUN.
