000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKT310.
000030*********************************************************
000040*    PROGRAM         :  請求明細　問合せ　　　　　      *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCHK31                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION IS INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY IS T-KEY
000200         ALTERNATE RECORD KEY IS T-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT SM-F ASSIGN TO SM-MSD.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON M-DATE
000250     APPLY SHARED-MODE ON T-M.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LIBFDD.
000290     COPY LITM.
000300 FD  SM-F
000310     BLOCK  2 RECORDS
000320     LABEL RECORD IS STANDARD
000330     VALUE OF IDENTIFICATION WK0128ID.
000340 01  SM-R.
000350     02  SM-TCD         PIC  9(004).
000360     02  SM-DATE        PIC  9(008).
000370     02  SM-NGP   REDEFINES SM-DATE.
000380       03  SM-NEN       PIC  9(004).
000390       03  SM-GP        PIC  9(004).
000400     02  SM-ZS          PIC S9(009).
000410     02  SM-ZSZ         PIC S9(007).
000420     02  SM-UR          PIC S9(009).
000430     02  SM-URZ         PIC S9(007).
000440     02  SM-TS          PIC S9(007).
000450     02  SM-TSZ         PIC S9(005).
000460     02  SM-NK          PIC S9(009).
000470     02  SM-NKZ         PIC S9(007).
000480     02  SM-NNGP.
000490       03  SM-NY        PIC  9(002).
000500       03  SM-NMD       PIC  9(004).
000510     02  SM-SIT         PIC  9(003).
000520     02  SM-SU          PIC  9(001).
000530     02  SM-DNO         PIC  9(006).
000540     02  F              PIC  X(004).
000550     02  SM-TNC         PIC  9(002).
000560     02  F              PIC  X(007).
000570     02  SM-PC          PIC  9(001).
000580     02  F              PIC  X(026).
000590 WORKING-STORAGE SECTION.
000600 77  W-MSG              PIC  X(030).
000610 77  WK0128ID           PIC  X(009) VALUE SPACE.
000620 01  STN-NO.
000630     02  STN-NO1        PIC  X(003).
000640     02  STN-NO2        PIC  X(003).
000650 01  W-FID.
000660     02  W-FID1         PIC  X(006) VALUE "WK0128".
000670     02  W-FID2         PIC  X(003).
000680 01  W-DATA.
000690     02  W-DMM          PIC  9(001).
000700     02  W-TCD          PIC  9(004).
000710     02  W-S            PIC  9(001).
000720     02  W-L            PIC  9(002).
000730     02  W-SK           PIC S9(009).
000740     02  W-SKZ          PIC S9(007).
000750     02  W-UR           PIC S9(009).
000760     02  W-URZ          PIC S9(007).
000770     02  W-NG.
000780       03  W-NEN        PIC  9(004).
000790       03  W-NENL  REDEFINES W-NEN.
000800         04  W-NEN1     PIC  9(002).
000810         04  W-NEN2     PIC  9(002).
000820       03  W-GET        PIC  9(002).
000830     02  W-NGL   REDEFINES W-NG.
000840       03  F            PIC  9(002).
000850       03  W-NGS        PIC  9(004).
000860     02  W-NGPD.
000870       03  W-NEND       PIC  9(004).
000880       03  W-GPD.
000890         04  W-GETD     PIC  9(002).
000900         04  W-PEYD     PIC  9(002).
000910     02  W-SHM          PIC  N(001).                              I.111026
000920     02  W-SGR          PIC  9(001)V9(01).                        I.111026
000930 01  ERR-STAT           PIC  X(002).
000940     COPY LSTAT.
000950 SCREEN SECTION.
000960 SD  C-CRT
000970     END STATUS IS ESTAT.
000980 01  C-CLEAR.
000990     02  LINE   1  CLEAR SCREEN.
001000 01  C-ACP.
001010     02  A-TCD   LINE   5  COLUMN   7  PIC  9(004)
001020          USING W-TCD   CHECK OVERFLOW NO IFC.
001030     02  A-GP    LINE   9  COLUMN   2  PIC  9(004)
001040          USING W-GPD   CHECK OVERFLOW NO IFC.
001050     02  A-DMM   LINE  22  COLUMN  79  PIC  9(001)
001060          USING W-DMM   CHECK OVERFLOW NO IFC.
001070 01  C-DSP.
001080     02  D-NAME  LINE   5  COLUMN  21  PIC  N(026) FROM  T-NAME.  I.020410
001090     02  D-SSM   LINE   6.                                        I.111026
001100       03  COLUMN  26  PIC  Z(003) FROM  T-NKY.                   I.111026
001110       03  COLUMN  30  PIC  X(001) VALUE ",".                     I.111026
001120       03  COLUMN  32  PIC  N(001) FROM  W-SHM.                   I.111026
001130       03  COLUMN  35  PIC  X(001) VALUE ",".                     I.111026
001140       03  COLUMN  37  PIC Z.Z     FROM  W-SGR.                   I.111026
001150       03  COLUMN  40  PIC  X(001) VALUE "%".                     I.111026
001160*****02  D-NAME  LINE   5  COLUMN  21  PIC  N(024) FROM  T-NAME.  D.020410
001170     02  LINE  W-L.
001180       03  D-MD.
001190         04  COLUMN   2  PIC  9(004)       FROM  SM-GP.
001200         04  COLUMN   7  PIC ----,---,--9  FROM  W-UR.
001210         04  COLUMN  20  PIC -----,--9     FROM  W-URZ.
001220         04  COLUMN  30  PIC ----,---,--9  FROM  SM-NK.
001230         04  COLUMN  43  PIC -----,--9     FROM  SM-NKZ.
001240         04  COLUMN  53  PIC ----,---,--9  FROM  W-SK.
001250         04  COLUMN  66  PIC -----,--9     FROM  W-SKZ.
001260       03  D-NMD   COLUMN  76  PIC  9(004) FROM  SM-NMD.
001270 01  C-ERR.
001280     02  LINE  24.
001290       03  E-ME    COLUMN  15  PIC  X(030) FROM  W-MSG.
001300       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001310       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001320       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001330            "                                                  ".
001340     COPY LIBSCR.
001350 PROCEDURE DIVISION.
001360 M-05.
001370     COPY LIBCPR.
001380     MOVE ZERO TO W-DATA.
001390     MOVE D-NHNG TO W-NGS.
001400     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001410         ADD DATE-NC1 TO W-NEN.
001420     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001430         ADD DATE-NC2 TO W-NEN.
001440     OPEN INPUT T-M.
001450     CALL "CBLSTNNO" USING STN-NO.
001460     MOVE STN-NO2 TO W-FID2.
001470     MOVE W-FID TO WK0128ID.
001480 M-10.
001490     DISPLAY C-CLEAR.
001500     CALL "SCHK31".
001510 M-15.
001520     ACCEPT A-TCD.
001530     DISPLAY E-CL.
001540     IF ESTAT = PF9
001550         GO TO M-90.
001560     IF ESTAT NOT = HTB AND SKP
001570         GO TO M-15.
001580     MOVE W-TCD TO T-KEY.
001590     READ T-M WITH UNLOCK INVALID KEY
001600         MOVE SPACE TO W-MSG
001610         MOVE "***  ﾄｸｲｻｷ ﾅｼ  ***" TO W-MSG
001620         DISPLAY E-ME
001630         GO TO M-15.
001640     IF T-SHC1 = 1                                                I.111026
001650         MOVE NC"現" TO W-SHM                                     I.111026
001660       ELSE                                                       I.111026
001670         IF T-SHC1 = 2                                            I.111026
001680             MOVE NC"小" TO W-SHM                                 I.111026
001690           ELSE                                                   I.111026
001700             IF T-SHC1 = 3                                        I.111026
001710                 MOVE NC"手" TO W-SHM                             I.111026
001720               ELSE                                               I.111026
001730                 MOVE NC"　" TO W-SHM.                            I.111026
001740     COMPUTE W-SGR = T-SGR + T-STR.                               I.111026
001750     DISPLAY D-NAME D-SSM.                                        I.111026
001760*****DISPLAY D-NAME.                                              D.111026
001770 M-20.
001780     ACCEPT A-GP.
001790     IF ESTAT = BTB
001800         GO TO M-15.
001810     IF ESTAT NOT = HTB AND SKP
001820         GO TO M-20.
001830     IF W-GETD < 1 OR > 12
001840         GO TO M-20.
001850     IF W-PEYD < 1 OR > 31
001860         GO TO M-20.
001870     IF W-GET < W-GETD
001880         COMPUTE W-NEND = W-NEN - 1
001890       ELSE
001900         MOVE W-NEN TO W-NEND.
001910*
001920     OPEN INPUT SM-F.
001930 M-25.
001940     READ SM-F AT END
001950         MOVE 9 TO W-S
001960         GO TO M-40.
001970     IF SM-PC NOT = 0
001980         GO TO M-25.
001990     IF SM-TCD < W-TCD
002000         GO TO M-25.
002010     IF SM-TCD > W-TCD
002020         MOVE 9 TO W-S
002030         GO TO M-40.
002040     IF SM-DATE < W-NGPD
002050         GO TO M-25.
002060*
002070     MOVE 8 TO W-L.
002080 M-30.
002090     ADD 1 TO W-L.
002100     IF W-L = 21
002110         MOVE 1 TO W-S
002120         GO TO M-40.
002130     COMPUTE W-UR = SM-UR + SM-TS.
002140     COMPUTE W-URZ = SM-URZ + SM-TSZ.
002150     COMPUTE W-SK = SM-ZS + W-UR - SM-NK.
002160     COMPUTE W-SKZ = SM-ZSZ + W-URZ - SM-NKZ.
002170     DISPLAY D-MD.
002180     IF SM-NMD NOT = ZERO
002190         DISPLAY D-NMD.
002200 M-35.
002210     READ SM-F AT END
002220         MOVE 9 TO W-S
002230         GO TO M-40.
002240     IF SM-PC NOT = 0
002250         GO TO M-35.
002260     IF SM-TCD > W-TCD
002270         MOVE 9 TO W-S
002280         GO TO M-40.
002290     GO TO M-30.
002300 M-40.
002310     ACCEPT A-DMM.
002320     IF ESTAT = PF9
002330         CLOSE SM-F
002340         GO TO M-90.
002350     IF W-S = 1
002360         DISPLAY C-CLEAR
002370         CALL "SCHK31"
002380         DISPLAY A-TCD D-NAME
002390         MOVE 8 TO W-L
002400         GO TO M-30.
002410     CLOSE SM-F.
002420     GO TO M-10.
002430 M-90.
002440     CLOSE T-M.
002450 M-95.
002460     DISPLAY C-CLEAR.
002470     STOP RUN.
