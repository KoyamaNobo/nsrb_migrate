000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKD210.
000030***************************************************************
000040*    PROGRAM         :  請求明細累積ファイル　入金日入力　　  *
000050*    PRINTER TYPE    :  JIPS                                  *
000060*    SCREEN          :  ------                                *
000070*    COMPILE TYPE    :  COBOL                                 *
000080***************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SM-F ASSIGN TO SM-MSD.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY T-KEY
000200         ALTERNATE RECORD KEY T-KEY2
000210         FILE STATUS IS ERR-STAT.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON T-M.
000240 DATA DIVISION.
000250 FILE SECTION.
000260     COPY LITM.
000270 FD  SM-F
000280     BLOCK  5 RECORDS
000290     LABEL RECORD IS STANDARD
000300     VALUE OF IDENTIFICATION "SMF".
000310 01  SM-R.
000320     02  S-TCD          PIC  9(004).
000330     02  S-NGP.
000340       03  S-NG         PIC  9(002).
000350       03  S-NGPS       PIC  9(006).
000360     02  S-ZS           PIC S9(009).
000370     02  S-ZSZ          PIC S9(007).
000380     02  S-UR           PIC S9(009).
000390     02  S-URZ          PIC S9(007).
000400     02  S-TS           PIC S9(007).
000410     02  S-TSZ          PIC S9(005).
000420     02  S-NK           PIC S9(009).
000430     02  S-NKZ          PIC S9(007).
000440     02  S-DATE         PIC  9(006).
000450     02  S-SI           PIC  9(003).
000460     02  S-SU           PIC  9(001).
000470     02  S-SNO          PIC  9(006).
000480     02  F              PIC  X(013).
000490     02  S-DC           PIC  9(001).
000500 WORKING-STORAGE SECTION.
000510 01  ERR-STAT           PIC  X(002).
000520 01  W-FILE             PIC  X(013).
000530 01  W-DATA.
000540     02  W-DATE         PIC  9(006).
000550     02  W-NGPD  REDEFINES W-DATE.
000560       03  W-NEN        PIC  9(002).
000570       03  W-GET        PIC  9(002).
000580       03  W-PEY        PIC  9(002).
000590     02  W-CNGP         PIC  9(006).
000600     02  W-SYSD         PIC  9(006).
000610     02  W-KIN          PIC S9(009).
000620     02  W-DMM          PIC  9(001).
000630     02  W-KEY.
000640       03  W-SNO        PIC  9(006).
000650     02  W-END          PIC  9(001) VALUE 0.
000660     COPY LSTAT.
000670 SCREEN SECTION.
000680 SD  C-CRT
000690     END STATUS IS ESTAT.
000700 01  C-CLEAR.
000710     02  LINE   1  CLEAR SCREEN.
000720 01  C-MID.
000730     02  LINE   1  COLUMN   7  PIC  N(024) VALUE
000740          NC"＊＊＊　　請求累積ファイル　入金日入力　　＊＊＊".
000750     02  LINE   4.
000760       03  COLUMN   8  PIC  X(008) VALUE "請 求 №".
000770       03  COLUMN  33  PIC  X(009) VALUE "終了=ｆ･9".
000780     02  LINE   5  COLUMN  34  PIC  X(017) VALUE
000790          "（*印は修正不可）".
000800     02  LINE   7  COLUMN   6  PIC  X(010) VALUE "* 請求日付".
000810     02  LINE   9  COLUMN   6  PIC  X(010) VALUE "* 得 意 先".
000820     02  LINE  11  COLUMN   6  PIC  X(010) VALUE "* 請求金額".
000830     02  LINE  13  COLUMN   8  PIC  X(008) VALUE "入 金 日".
000840     02  LINE  22  COLUMN  30  PIC  X(022) VALUE
000850          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000860 01  C-ACP.
000870     02  A-SNO   LINE   4  COLUMN  18  PIC  9(006)
000880          USING W-SNO     CHECK OVERFLOW NO IFC.
000890     02  A-DATE  LINE  13  COLUMN  20  PIC  9(006)
000900          USING W-DATE    CHECK OVERFLOW NO IFC.
000910     02  A-DMM   LINE  22  COLUMN  47  PIC  9(001)
000920          USING W-DMM     CHECK OVERFLOW NO IFC.
000930 01  C-DSP.
000940     02  D-MD.
000950       03  LINE   9.
000960         04  D-TCD   COLUMN  18  PIC  9(004) FROM  S-TCD.
000970         04  D-NAME  COLUMN  23  PIC  N(026) FROM  T-NAME.
000980       03  D-DATE  LINE   7  COLUMN  20  PIC  9(006) FROM  S-NGPS.
000990       03  D-KIN   LINE  11.
001000         04  COLUMN  17  PIC ----,---,--- FROM  W-KIN.
001010 01  C-ERR.
001020     02  LINE  24.
001030       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001040            "***  DATA ﾅｼ  ***".
001050       03  E-ME2   COLUMN  15  PIC  X(015) VALUE
001060            "***  TM ﾅｼ  ***".
001070       03  E-ME3   COLUMN  15  PIC  X(018) VALUE
001080            "***  ﾋｽﾞｹ ｴﾗｰ  ***".
001090       03  E-ME5   COLUMN  15  PIC  X(025) VALUE
001100            "***  SMF REWRITE ｴﾗｰ  ***".
001110     COPY LSSEM.
001120 PROCEDURE DIVISION.
001130 M-05.
001140     DISPLAY C-CLEAR.
001150     DISPLAY C-MID.
001160*
001170     ACCEPT W-SYSD FROM DATE.
001180     OPEN INPUT T-M.
001190 M-10.
001200     PERFORM ACP-RTN THRU ACP-EX.
001210     IF W-END = 8
001220         GO TO M-90.
001230     PERFORM REW-RTN THRU REW-EX.
001240     IF W-END = 8
001250         GO TO M-90.
001260     DISPLAY C-CLEAR.
001270     DISPLAY C-MID.
001280     GO TO M-10.
001290 M-90.
001300     CLOSE T-M.
001310 M-95.
001320     DISPLAY C-CLEAR.
001330     STOP RUN.
001340 ACP-RTN.
001350     ACCEPT A-SNO.
001360     DISPLAY E-CL.
001370     IF ESTAT = C2 OR PF9
001380         MOVE 8 TO W-END
001390         GO TO ACP-EX.
001400     IF ESTAT NOT = HTB AND SKP
001410         GO TO ACP-RTN.
001420     IF W-SNO = ZERO
001430         GO TO ACP-RTN.
001440*
001450     OPEN I-O SM-F.
001460 ACP-020.
001470     READ SM-F AT END
001480         CLOSE SM-F
001490         DISPLAY E-ME1 E-ME98
001500         GO TO ACP-RTN.
001510     IF S-SNO NOT = W-SNO
001520         GO TO ACP-020.
001530*
001540     MOVE S-TCD TO T-KEY.
001550     READ T-M WITH UNLOCK INVALID KEY
001560         MOVE SPACE TO T-NAME
001570         MOVE NC"　マスター　なし　" TO T-NAME.
001580*
001590     MOVE S-NGPS TO W-DATE.
001600     SUBTRACT 1 FROM W-GET.
001610     IF W-GET = ZERO
001620         MOVE 12 TO W-GET
001630         SUBTRACT 1 FROM W-NEN.
001640     MOVE W-DATE TO W-CNGP.
001650     COMPUTE W-KIN = S-ZS + S-ZSZ + S-UR + S-URZ + S-TS + S-TSZ
001660                   - S-NK + S-NKZ.
001670     MOVE S-DATE TO W-DATE.
001680     DISPLAY A-DATE D-MD.
001690 ACP-040.
001700     ACCEPT A-DATE.
001710     DISPLAY E-CL.
001720     IF ESTAT = BTB
001730         CLOSE SM-F
001740         GO TO ACP-RTN.
001750     IF ESTAT NOT = HTB AND SKP
001760         GO TO ACP-040.
001770     IF W-DATE = ZERO
001780         GO TO ACP-200.
001790     IF W-GET < 1 OR > 12
001800         GO TO ACP-040.
001810     IF W-PEY < 1 OR > 31
001820         GO TO ACP-040.
001830     IF W-CNGP NOT < W-DATE
001840         GO TO ACP-040.
001850     IF W-SYSD < W-DATE
001860         GO TO ACP-040.
001870 ACP-200.
001880     ACCEPT A-DMM.
001890     IF ESTAT = BTB
001900         GO TO ACP-040.
001910     IF ESTAT NOT = HTB AND SKP
001920         GO TO ACP-200.
001930     IF W-DMM = 9
001940         CLOSE SM-F
001950         GO TO ACP-RTN.
001960     IF W-DMM NOT = 1
001970         GO TO ACP-200.
001980 ACP-EX.
001990     EXIT.
002000 REW-RTN.
002010     REWRITE SM-R.
002020     IF ERR-STAT NOT = "00"
002030         DISPLAY E-STAT E-ME5 E-ME99
002040         MOVE 8 TO W-END.
002050     CLOSE SM-F.
002060 REW-EX.
002070     EXIT.
