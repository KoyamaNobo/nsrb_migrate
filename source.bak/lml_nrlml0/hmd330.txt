000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMD330.
000030*********************************************************
000040*    PROGRAM         :  倉庫間移動一括入力　　　　　　  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ______                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY IS HI-KEY
000200         ALTERNATE RECORD KEY IS HI-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT JCON ASSIGN TO JCON-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE IS RANDOM
000250         RECORD KEY IS JCON3-KEY
000260         FILE STATUS IS ERR-STAT.
000270     SELECT NJZAI ASSIGN TO NJZAI-MSD
000280         ORGANIZATION INDEXED
000290         ACCESS MODE IS DYNAMIC
000300         RECORD KEY IS NJZAI-KEY
000310         FILE STATUS IS ERR-STAT.
000320     SELECT HSKIF ASSIGN TO HSKIF-MSD.
000330     SELECT SP-F ASSIGN TO P-PRN999.
000340 I-O-CONTROL.
000350     APPLY SHARED-MODE ON M-DATE
000360     APPLY SHARED-MODE ON HI-M
000370     APPLY SHARED-MODE ON NJZAI
000380     APPLY SHARED-MODE ON JCON
000390     APPLY SHIFT-CODE  ON SP-F.
000400 DATA DIVISION.
000410 FILE SECTION.
000420     COPY LIBFDD.
000430     COPY LIHIM.
000440     COPY LNJZAI.
000450     COPY L-JCON.
000460     COPY LSPF.
000470 FD  HSKIF
000480     BLOCK  3 RECORDS
000490     LABEL RECORD IS STANDARD
000500     VALUE OF IDENTIFICATION "HSKIF".
000510 01  HSKI-R.
000520     02  HSKI-NO        PIC  9(007).                              受入№
000530     02  HSKI-NOD   REDEFINES HSKI-NO.
000540       03  HSKI-UNO     PIC  9(006).
000550       03  HSKI-GYO     PIC  9(001).
000560     02  HSKI-DATE      PIC  9(008).
000570     02  HSKI-NGPD  REDEFINES HSKI-DATE.
000580       03  HSKI-NG      PIC  9(006).
000590       03  F            PIC  9(002).
000600     02  HSKI-NGP   REDEFINES HSKI-DATE.
000610       03  F            PIC  9(002).
000620       03  HSKI-NGPS    PIC  9(006).
000630     02  HSKI-HCD       PIC  9(006).
000640     02  HSKI-SIZ       PIC  9(001).                              ｻｲｽﾞ区分
000650     02  HSKI-SUD.                                                数量
000660       03  HSKI-SU      PIC S9(005)  OCCURS  10.
000670     02  HSKI-SKC       PIC  9(001).                              倉庫C
000680     02  HSKI-IDC       PIC  9(001).
000690     02  F              PIC  X(008).
000700     02  HSKI-IKC       PIC  9(001).
000710     02  HSKI-PRN       PIC  9(001).
000720     02  HSKI-UPD       PIC  9(001).
000730 WORKING-STORAGE SECTION.
000740 77  W-FILE             PIC  X(013).
000750 77  ERR-STAT           PIC  X(002).
000760 77  W-POC              PIC  9(001) VALUE 0.
000770 77  W-IPC              PIC  9(001) VALUE 0.
000780 01  HEAD1.
000790     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000800     02  F              PIC  X(041) VALUE SPACE.
000810     02  F              PIC  N(023) VALUE
000820          NC"＊＊＊　　倉庫間移動　一括入力リスト　　＊＊＊".
000830     02  F              PIC  X(027) VALUE SPACE.
000840     02  F              PIC  X(005) VALUE "DATE ".
000850     02  H-DATE         PIC 99B99B99.
000860     02  F              PIC  X(007) VALUE "     P.".
000870     02  H-PAGE         PIC Z9.
000880 01  HEAD2.
000890     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000900     02  F              PIC  X(001) VALUE SPACE.
000910     02  F              PIC  N(004) VALUE NC"日　　付".
000920     02  F              PIC  X(003) VALUE SPACE.
000930     02  F              PIC  N(004) VALUE NC"倉　　庫".
000940     02  F              PIC  X(120) VALUE SPACE.
000950 01  HEAD3.
000960     02  F              PIC  X(004) VALUE SPACE.
000970     02  F              PIC  N(004) VALUE NC"　伝票№".
000980     02  F              PIC  X(001) VALUE "-".
000990     02  F              PIC  N(002) VALUE NC"行　".
001000     02  F              PIC  X(006) VALUE "ｺｰﾄﾞ  ".
001010     02  F              PIC  N(008) VALUE NC"品　　　　　名　".
001020     02  F              PIC  X(025) VALUE SPACE.
001030     02  F              PIC  X(001) VALUE "1".
001040     02  F              PIC  X(004) VALUE SPACE.
001050     02  F              PIC  N(002) VALUE NC"３号".
001060     02  F              PIC  X(004) VALUE SPACE.
001070     02  F              PIC  N(002) VALUE NC"２号".
001080     02  F              PIC  X(004) VALUE SPACE.
001090     02  F              PIC  N(002) VALUE NC"１号".
001100     02  F              PIC  X(004) VALUE SPACE.
001110     02  F              PIC  N(002) VALUE NC"０号".
001120     02  F              PIC  X(004) VALUE SPACE.
001130     02  F              PIC  N(002) VALUE NC"　中".
001140     02  F              PIC  X(004) VALUE SPACE.
001150     02  F              PIC  N(002) VALUE NC"　大".
001160     02  F              PIC  X(004) VALUE SPACE.
001170     02  F              PIC  N(002) VALUE NC"特大".
001180     02  F              PIC  X(021) VALUE
001190          "   28.0   29.0   30.0".
001200     02  F              PIC  X(008) VALUE SPACE.
001210 01  HEAD4.
001220     02  F              PIC  X(057) VALUE SPACE.
001230     02  F              PIC  X(039) VALUE
001240          "2   12.5   13.0   13.5   14.0   15.0   ".
001250     02  F              PIC  X(032) VALUE
001260          "16.0   17.0   18.0   19.0   20.0".
001270     02  F              PIC  X(008) VALUE SPACE.
001280 01  HEAD5.
001290     02  F              PIC  X(057) VALUE SPACE.
001300     02  F              PIC  X(039) VALUE
001310          "3   21.0   21.5   22.0   22.5   23.0   ".
001320     02  F              PIC  X(032) VALUE
001330          "23.5   24.0   24.5   25.0       ".
001340     02  F              PIC  X(008) VALUE SPACE.
001350 01  HEAD6.
001360     02  F              PIC  X(057) VALUE SPACE.
001370     02  F              PIC  X(039) VALUE
001380          "4   24.0   24.5   25.0   25.5   26.0   ".
001390     02  F              PIC  X(032) VALUE
001400          "26.5   27.0   27.5              ".
001410     02  F              PIC  X(005) VALUE SPACE.
001420     02  F              PIC  N(002) VALUE NC"合計".
001430 01  W-P1.
001440     02  P-DATE         PIC 99/99/99.
001450     02  F              PIC  X(002).
001460     02  P-SKC          PIC  9(001).
001470     02  F              PIC  X(001).
001480     02  P-SKN          PIC  N(006).
001490     02  F              PIC  X(115).
001500 01  W-P2.
001510     02  F              PIC  X(004).
001520     02  P-UNO          PIC  9(006).
001530     02  P-V            PIC  X(001).
001540     02  P-GYO          PIC  9(001).
001550     02  F              PIC  X(001).
001560     02  P-HCD          PIC  9(006).
001570     02  F              PIC  X(001).
001580     02  P-NAME         PIC  N(024).
001590     02  F              PIC  X(001).
001600     02  P-SIZ          PIC  9(001).
001610     02  P-SU           PIC ---,---       OCCURS  10.
001620     02  P-TSU          PIC ----,--9.
001630 01  W-DATA.
001640     02  W-SHCD         PIC  9(006).
001650     02  W-EHCD         PIC  9(006).
001660     02  W-IDM          PIC  9(001).
001670     02  W-IDS          PIC  9(001).
001680     02  W-DMM          PIC  9(001).
001690     02  W-UNO1         PIC  9(006).
001700     02  W-UNO2         PIC  9(006).
001710     02  W-GN           PIC  9(001).
001720     02  W-AMEI.
001730       03  W-MEID  OCCURS   6.
001740         04  W-HCD      PIC  9(006).
001750         04  W-SIZ      PIC  9(001).
001760         04  W-ASUD.
001770           05  W-SUD   OCCURS  10.
001780             06  W-SU   PIC S9(005).
001790     02  WC-ASUD.
001800       03  WC-SUD   OCCURS  10.
001810         04  WC-SU      PIC S9(005).
001820     02  W-NGP          PIC  9(008).
001830     02  W-NGPD  REDEFINES W-NGP.
001840       03  W-NG.
001850         04  W-NEN      PIC  9(004).
001860         04  W-NENL  REDEFINES W-NEN.
001870           05  W-NEN1   PIC  9(002).
001880           05  W-NEN2   PIC  9(002).
001890         04  W-GET      PIC  9(002).
001900       03  W-PEY        PIC  9(002).
001910     02  W-NGPSD REDEFINES W-NGP.
001920       03  F            PIC  9(002).
001930       03  W-NGPS       PIC  9(006).
001940     02  W-SIZD         PIC  9(001).
001950     02  CNT            PIC  9(002).
001960     02  W-ZC           PIC  9(001).
001970     02  CHK            PIC  9(001).
001980     02  W-TSU          PIC S9(006).
001990     02  W-SUT          PIC S9(006).
002000     02  W-PAGE         PIC  9(002).
002010     COPY LSTAT.
002020     COPY LWMSG.
002030 SCREEN SECTION.
002040 SD  C-CRT
002050     END STATUS IS ESTAT.
002060 01  C-CLEAR.
002070     02  LINE   1 CLEAR SCREEN.
002080 01  C-MID.
002090     03  LINE   1  COLUMN  19  PIC  N(020) VALUE
002100          NC"＊＊＊　　倉庫間移動　一括入力　　＊＊＊".
002110     03  LINE   9  COLUMN  27  PIC  X(043) VALUE
002120          "品名ｺｰﾄﾞ  000000 ～ 999999          終了=F9".
002130     03  LINE  12  COLUMN  27  PIC  X(024) VALUE
002140          "移動元                  ".
002150     03  LINE  13  COLUMN  27  PIC  X(024) VALUE
002160          "      ↓　↓　↓　↓    ".
002170     03  LINE  14  COLUMN  27  PIC  X(024) VALUE
002180          "移動先                  ".
002190     03  LINE  23  COLUMN  41  PIC  X(025) VALUE
002200          "確認(OK=1,NO=9)-->   ﾘﾀｰﾝ".
002210 01  C-ACP.
002220     02  LINE   9.
002230       03  A-SHCD   COLUMN  37  PIC  9(006)
002240            USING W-SHCD  CHECK OVERFLOW NO IFC.
002250       03  A-EHCD   COLUMN  47  PIC  9(006)
002260            USING W-EHCD  CHECK OVERFLOW NO IFC.
002270     02  A-IDM   LINE  12  COLUMN  37  PIC  9(001)
002280          USING W-IDM   CHECK OVERFLOW NO IFC.
002290     02  A-IDS   LINE  14  COLUMN  37  PIC  9(001)
002300          USING W-IDS   CHECK OVERFLOW NO IFC.
002310*
002320     02  A-DMM   LINE  23  COLUMN  60  PIC  9(001)
002330          USING W-DMM   CHECK OVERFLOW NO IFC.
002340 01  C-DSP.
002350     02  D-IDMN  LINE  12  COLUMN  39  PIC  N(006) FROM  JCON3-03.
002360     02  D-IDSN  LINE  14  COLUMN  39  PIC  N(006) FROM  JCON3-03.
002370     02  D-PRN.
002380       03  LINE   1  COLUMN  19  PIC  N(021) VALUE
002390            NC"＊＊＊　　倉庫間移動　入力リスト　　＊＊＊".
002400       03  LINE  23  COLUMN  41  PIC  X(025) VALUE
002410            "確認(OK=1,NO=9)-->   ﾘﾀｰﾝ".
002420 01  C-ERR.
002430     02  LINE  24.
002440       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002450            "***  DATA ﾅｼ  ***".
002460       03  E-ME6   COLUMN  15  PIC  N(011) VALUE
002470            NC"コントロールＦ　未登録".
002480       03  E-ME7   COLUMN  15  PIC  N(007) VALUE
002490            NC"倉庫名　未登録".
002500       03  E-ME11  COLUMN  15  PIC  X(019) VALUE
002510            "***  WRITE ｴﾗｰ  ***".
002520       03  E-ME12  COLUMN  15  PIC  X(027) VALUE
002530            "***  JCON ﾃﾞﾝﾋﾟｮｳNO ﾅｼ  ***".
002540       03  E-ME13  COLUMN  15  PIC  X(026) VALUE
002550            "***  JCON REWRITE ｴﾗｰ  ***".
002560     COPY LIBSCR.
002570     COPY LSSEM.
002580 PROCEDURE DIVISION.
002590 M-020.
002600     DISPLAY C-CLEAR.
002610     DISPLAY C-MID.
002620*
002630     MOVE ZERO TO W-DATA.
002640     MOVE 999999 TO W-EHCD.                                       I.151103
002650     OPEN I-O JCON.
002660     MOVE "18" TO JCON5-KEY.
002670     READ JCON UNLOCK INVALID
002680         CLOSE JCON
002690         MOVE 255 TO COMPLETION-CODE
002700         DISPLAY E-ME6 E-ME99
002710         STOP RUN.
002720*
002730     OPEN INPUT NJZAI.
002740     OPEN EXTEND HSKIF.
002750     COPY LIBCPR.
002760     ACCEPT W-NGPS FROM DATE.
002770     MOVE ZERO TO W-NEN1.
002780     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
002790         ADD DATE-NC1 TO W-NEN.
002800     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
002810         ADD DATE-NC2 TO W-NEN.
002820 M-120.
002830     ACCEPT A-SHCD.
002840     DISPLAY E-CL.
002850     IF ESTAT = PF9
002860         MOVE 255 TO COMPLETION-CODE
002870         CLOSE JCON
002880         CLOSE NJZAI
002890         CLOSE HSKIF
002900         GO TO M-980.
002910     IF ESTAT NOT = HTB AND SKP
002920         GO TO M-120.
002930 M-140.
002940     ACCEPT A-EHCD.
002950     DISPLAY E-CL.
002960     IF ESTAT = BTB
002970         GO TO M-120.
002980     IF ESTAT NOT = HTB AND SKP
002990         GO TO M-140.
003000     IF W-SHCD > W-EHCD
003010         GO TO M-140.
003020 M-160.
003030     ACCEPT A-IDM.
003040     DISPLAY E-CL.
003050     IF ESTAT = BTB
003060         GO TO M-140.
003070     IF ESTAT NOT = HTB AND SKP
003080         GO TO M-160.
003090     MOVE 3 TO JCON3-01.
003100     MOVE W-IDM TO JCON3-02.
003110     READ JCON UNLOCK INVALID
003120         DISPLAY E-ME7
003130         GO TO M-160.
003140     DISPLAY D-IDMN.
003150 M-180.
003160     ACCEPT A-IDS.
003170     DISPLAY E-CL.
003180     IF ESTAT = BTB
003190         GO TO M-160.
003200     IF ESTAT NOT = HTB AND SKP
003210         GO TO M-180.
003220     MOVE 3 TO JCON3-01.
003230     MOVE W-IDS TO JCON3-02.
003240     READ JCON UNLOCK INVALID
003250         DISPLAY E-ME7
003260         GO TO M-180.
003270     DISPLAY D-IDSN.
003280     IF W-IDM = W-IDS
003290         GO TO M-180.
003300 M-200.
003310     ACCEPT A-DMM.
003320     DISPLAY E-CL.
003330     IF ESTAT = BTB
003340         GO TO M-180.
003350     IF ESTAT NOT = HTB AND SKP
003360         GO TO M-200.
003370     IF W-DMM = 9
003380         GO TO M-120.
003390     IF W-DMM NOT = 1
003400         GO TO M-200.
003410*
003420     MOVE SPACE TO NJZAI-KEY.
003430     MOVE W-IDM TO NJZAI-01.
003440     MOVE W-SHCD TO NJZAI-02.
003450     START NJZAI KEY NOT < NJZAI-KEY INVALID KEY
003460         MOVE 255 TO COMPLETION-CODE
003470         DISPLAY E-ME1 E-ME99
003480         CLOSE JCON
003490         CLOSE NJZAI
003500         CLOSE HSKIF
003510         GO TO M-980.
003520 M-220.
003530     READ NJZAI NEXT RECORD AT END
003540         MOVE 255 TO COMPLETION-CODE
003550         DISPLAY E-ME1 E-ME99
003560         CLOSE JCON
003570         CLOSE NJZAI
003580         CLOSE HSKIF
003590         GO TO M-980.
003600     IF NJZAI-01 > W-IDM
003610         MOVE 255 TO COMPLETION-CODE
003620         DISPLAY E-ME1 E-ME99
003630         CLOSE JCON
003640         CLOSE NJZAI
003650         CLOSE HSKIF
003660         GO TO M-980.
003670     IF NJZAI-02 > W-EHCD
003680         MOVE 255 TO COMPLETION-CODE
003690         DISPLAY E-ME1 E-ME99
003700         CLOSE JCON
003710         CLOSE NJZAI
003720         CLOSE HSKIF
003730         GO TO M-980.
003740     PERFORM CHK-RTN THRU CHK-EX.
003750     IF W-ZC = 0
003760         GO TO M-220.
003770 M-240.
003780     MOVE ZERO TO W-AMEI.
003790     MOVE 0 TO W-GN.
003800 M-260.
003810     ADD 1 TO W-GN.
003820     IF W-GN = 7
003830         GO TO M-300.
003840     MOVE NJZAI-02 TO W-HCD(W-GN).
003850     MOVE NJZAI-03 TO W-SIZ(W-GN).
003860     MOVE WC-ASUD TO W-ASUD(W-GN).
003870 M-280.
003880     READ NJZAI NEXT RECORD AT END
003890         GO TO M-320.
003900     IF NJZAI-01 > W-IDM
003910         GO TO M-320.
003920     IF NJZAI-02 > W-EHCD
003930         GO TO M-320.
003940     PERFORM CHK-RTN THRU CHK-EX.
003950     IF W-ZC = 0
003960         GO TO M-280.
003970     GO TO M-260.
003980 M-300.
003990     PERFORM WRI-RTN THRU WRI-EX.
004000     IF COMPLETION-CODE = 255
004010         GO TO M-600.
004020     GO TO M-240.
004030 M-320.
004040     PERFORM WRI-RTN THRU WRI-EX.
004050 M-600.
004060     CLOSE NJZAI.
004070     CLOSE HSKIF.
004080*
004090     OPEN I-O HSKIF.
004100     OPEN INPUT HI-M.
004110     DISPLAY C-CLEAR.
004120     DISPLAY D-PRN.
004130 M-620.
004140     ACCEPT A-DMM.
004150     DISPLAY E-CL.
004160     IF ESTAT = PF9
004170         CLOSE HSKIF
004180         CLOSE HI-M
004190         GO TO M-980.
004200     IF ESTAT NOT = HTB AND SKP
004210         GO TO M-620.
004220     IF W-DMM = 9
004230         CLOSE HSKIF
004240         CLOSE HI-M
004250         GO TO M-980.
004260     IF W-DMM NOT = 1
004270         GO TO M-620.
004280 M-640.
004290     READ HSKIF AT END
004300         DISPLAY E-ME1 E-ME99
004310         GO TO M-980.
004320     IF HSKI-DATE NOT = W-NGP
004330         GO TO M-640.
004340     IF HSKI-HCD < W-SHCD OR > W-EHCD
004350         GO TO M-640.
004360     IF HSKI-UPD NOT = 0
004370         GO TO M-640.
004380     IF HSKI-PRN NOT = 0
004390         GO TO M-640.
004400     IF HSKI-IKC NOT = 1
004410         GO TO M-640.
004420 M-660.
004430     MOVE 0 TO CHK.
004440     MOVE ZERO TO W-SUT.
004450     MOVE HSKI-UNO TO W-UNO1.
004460 M-680.
004470     PERFORM MEI-RTN THRU MEI-EX.
004480 M-700.
004490     READ HSKIF AT END
004500         GO TO M-980.
004510     IF HSKI-DATE NOT = W-NGP
004520         GO TO M-700.
004530     IF HSKI-HCD < W-SHCD OR > W-EHCD
004540         GO TO M-700.
004550     IF HSKI-UPD NOT = 0
004560         GO TO M-700.
004570     IF HSKI-PRN NOT = 0
004580         GO TO M-700.
004590     IF HSKI-IKC NOT = 1
004600         GO TO M-700.
004610     IF HSKI-UNO = W-UNO1
004620         GO TO M-680.
004630     PERFORM KEI-RTN THRU KEI-EX.
004640     GO TO M-660.
004650 M-900.
004660     IF W-IPC = 0
004670         MOVE 255 TO COMPLETION-CODE.
004680     IF W-POC NOT = ZERO
004690         PERFORM KEI-RTN THRU KEI-EX
004700         CLOSE SP-F.
004710     CLOSE HI-M.
004720     CLOSE JCON.                                                  I.030613
004730     CLOSE HSKIF.                                                 I.970110
004740 M-980.
004750     DISPLAY C-CLEAR.
004760     STOP RUN.
004770 CHK-RTN.
004780     MOVE ZERO TO WC-ASUD CNT W-ZC.
004790 CHK-020.
004800     ADD 1 TO CNT.
004810     IF CNT = 11
004820         GO TO CHK-EX.
004830     COMPUTE WC-SU(CNT) = NJZAI-0411(CNT) - NJZAI-0511(CNT)
004840                        + NJZAI-0611(CNT) + NJZAI-0711(CNT)
004850                        - NJZAI-0811(CNT) - NJZAI-0911(CNT)
004860                        + NJZAI-1111(CNT).
004870     IF W-ZC = 0
004880         IF WC-SU(CNT) NOT = ZERO
004890             MOVE 1 TO W-ZC.
004900     GO TO CHK-020.
004910 CHK-EX.
004920     EXIT.
004930 WRI-RTN.
004940     MOVE ZERO TO W-UNO1 W-UNO2.
004950     MOVE "18" TO JCON5-KEY  ERR-K.
004960     READ JCON INVALID
004970         MOVE 255 TO COMPLETION-CODE
004980         DISPLAY E-ME12 E-ME99
004990         GO TO WRI-EX.
005000     ADD 1 TO JCON5-03.
005010     MOVE JCON5-03 TO W-UNO1.
005020     ADD 1 TO JCON5-03.
005030     MOVE JCON5-03 TO W-UNO2.
005040     REWRITE JCON5-R  INVALID
005050         MOVE 255 TO COMPLETION-CODE
005060         DISPLAY E-ME13 E-ME99
005070         GO TO WRI-EX.
005080     MOVE ZERO TO CHK.
005090 WRI-020.
005100     ADD 1 TO CHK.
005110     IF CHK = 3
005120         GO TO WRI-EX.
005130     MOVE ZERO TO W-GN.
005140 WRI-040.
005150     ADD 1 TO W-GN.
005160     IF W-GN = 7
005170         GO TO WRI-020.
005180     IF W-HCD(W-GN) = ZERO
005190         GO TO WRI-020.
005200 WRI-060.
005210     MOVE ZERO TO HSKI-R.
005220     MOVE W-GN TO HSKI-GYO.
005230     MOVE W-NGP TO HSKI-DATE.
005240     MOVE W-HCD(W-GN) TO HSKI-HCD.
005250     MOVE W-SIZ(W-GN) TO HSKI-SIZ.
005260     IF CHK = 1
005270         MOVE W-UNO1 TO HSKI-UNO
005280         MOVE W-SU(W-GN,01) TO HSKI-SU(01)
005290         MOVE W-SU(W-GN,02) TO HSKI-SU(02)
005300         MOVE W-SU(W-GN,03) TO HSKI-SU(03)
005310         MOVE W-SU(W-GN,04) TO HSKI-SU(04)
005320         MOVE W-SU(W-GN,05) TO HSKI-SU(05)
005330         MOVE W-SU(W-GN,06) TO HSKI-SU(06)
005340         MOVE W-SU(W-GN,07) TO HSKI-SU(07)
005350         MOVE W-SU(W-GN,08) TO HSKI-SU(08)
005360         MOVE W-SU(W-GN,09) TO HSKI-SU(09)
005370         MOVE W-SU(W-GN,10) TO HSKI-SU(10)
005380         MOVE W-IDS TO HSKI-SKC
005390         MOVE 1 TO HSKI-IDC
005400         MOVE 1 TO HSKI-IKC
005410       ELSE
005420         MOVE W-UNO2 TO HSKI-UNO
005430         COMPUTE HSKI-SU(01) = -1 * W-SU(W-GN,01)
005440         COMPUTE HSKI-SU(02) = -1 * W-SU(W-GN,02)
005450         COMPUTE HSKI-SU(03) = -1 * W-SU(W-GN,03)
005460         COMPUTE HSKI-SU(04) = -1 * W-SU(W-GN,04)
005470         COMPUTE HSKI-SU(05) = -1 * W-SU(W-GN,05)
005480         COMPUTE HSKI-SU(06) = -1 * W-SU(W-GN,06)
005490         COMPUTE HSKI-SU(07) = -1 * W-SU(W-GN,07)
005500         COMPUTE HSKI-SU(08) = -1 * W-SU(W-GN,08)
005510         COMPUTE HSKI-SU(09) = -1 * W-SU(W-GN,09)
005520         COMPUTE HSKI-SU(10) = -1 * W-SU(W-GN,10)
005530         MOVE W-IDM TO HSKI-SKC
005540         MOVE 1 TO HSKI-IKC.
005550     WRITE HSKI-R.
005560     IF ERR-STAT NOT = "00"
005570         DISPLAY E-STAT E-ME11 E-ME99
005580         GO TO WRI-100.
005590     IF W-IPC = 0
005600         MOVE 1 TO W-IPC.
005610     GO TO WRI-040.
005620 WRI-100.
005630     IF ERR-STAT NOT = "34"
005640         MOVE 255 TO COMPLETION-CODE
005650         DISPLAY E-ME78 E-ME99
005660         GO TO WRI-EX.
005670     DISPLAY E-CL.
005680     CLOSE HSKIF.
005690     MOVE "HSKIF        " TO W-FILE.
005700     DISPLAY E-ME71 E-ME98 STOP " ".
005710     DISPLAY E-CL.
005720     OPEN EXTEND HSKIF.
005730     GO TO WRI-060.
005740 WRI-EX.
005750     EXIT.
005760 MID-RTN.
005770     MOVE SPACE TO SP-R.
005780     WRITE SP-R AFTER PAGE.
005790 MID-010.
005800     ADD 1 TO W-PAGE.
005810     MOVE W-PAGE TO H-PAGE.
005820     MOVE SPACE TO SP-R.
005830     MOVE HEAD1 TO SP-R.
005840     WRITE SP-R.
005850     MOVE SPACE TO SP-R.
005860     MOVE HEAD2 TO SP-R.
005870     WRITE SP-R AFTER 2.
005880     MOVE SPACE TO SP-R.
005890     MOVE HEAD3 TO SP-R.
005900     WRITE SP-R.
005910     MOVE SPACE TO SP-R.
005920     MOVE HEAD4 TO SP-R.
005930     WRITE SP-R.
005940     MOVE SPACE TO SP-R.
005950     MOVE HEAD5 TO SP-R.
005960     WRITE SP-R.
005970     MOVE SPACE TO SP-R.
005980     MOVE HEAD6 TO SP-R.
005990     WRITE SP-R.
006000     MOVE SPACE TO SP-R.
006010 MID-EX.
006020     EXIT.
006030 MEI-RTN.
006040     IF W-POC = ZERO
006050         MOVE 5 TO W-POC
006060         OPEN OUTPUT SP-F
006070         ACCEPT H-DATE FROM DATE
006080         PERFORM MID-010 THRU MID-EX.
006090     IF CHK NOT = 0
006100         GO TO MEI-020.
006110     MOVE 1 TO CHK.
006120     MOVE 3 TO JCON3-01.
006130     MOVE HSKI-SKC TO JCON3-02.
006140     READ JCON UNLOCK INVALID
006150         MOVE SPACE TO JCON3-03.
006160*
006170     MOVE SPACE TO W-P1.
006180     MOVE SPACE TO P-SKN.
006190     MOVE HSKI-NGPS TO P-DATE.
006200     MOVE HSKI-SKC TO P-SKC.
006210     MOVE JCON3-03 TO P-SKN.
006220     IF LINAGE-COUNTER > 60
006230         PERFORM MID-RTN THRU MID-EX.
006240     MOVE SPACE TO SP-R.
006250     MOVE W-P1 TO SP-R.
006260     WRITE SP-R.
006270     MOVE SPACE TO SP-R.
006280 MEI-020.
006290     MOVE HSKI-HCD TO HI-KEY.
006300     READ HI-M WITH UNLOCK INVALID KEY
006310         MOVE SPACE TO HI-NAME.
006320     COMPUTE W-TSU = HSKI-SU(01) + HSKI-SU(02) + HSKI-SU(03)
006330                   + HSKI-SU(04) + HSKI-SU(05) + HSKI-SU(06)
006340                   + HSKI-SU(07) + HSKI-SU(08) + HSKI-SU(09)
006350                   + HSKI-SU(10).
006360     MOVE SPACE TO W-P2.
006370     MOVE SPACE TO P-NAME.
006380     IF CHK = 1
006390         MOVE 2 TO CHK
006400         MOVE HSKI-UNO TO P-UNO.
006410     MOVE "-" TO P-V.
006420     MOVE HSKI-GYO TO P-GYO.
006430     MOVE HSKI-HCD TO P-HCD.
006440     MOVE HI-NAME TO P-NAME.
006450     MOVE HSKI-SIZ TO P-SIZ.
006460     MOVE HSKI-SU(01) TO P-SU(01).
006470     MOVE HSKI-SU(02) TO P-SU(02).
006480     MOVE HSKI-SU(03) TO P-SU(03).
006490     MOVE HSKI-SU(04) TO P-SU(04).
006500     MOVE HSKI-SU(05) TO P-SU(05).
006510     MOVE HSKI-SU(06) TO P-SU(06).
006520     MOVE HSKI-SU(07) TO P-SU(07).
006530     MOVE HSKI-SU(08) TO P-SU(08).
006540     MOVE HSKI-SU(09) TO P-SU(09).
006550     MOVE HSKI-SU(10) TO P-SU(10).
006560     MOVE W-TSU TO P-TSU.
006570     IF LINAGE-COUNTER > 61
006580         MOVE HSKI-UNO TO P-UNO
006590         PERFORM MID-RTN THRU MID-EX
006600         MOVE SPACE TO SP-R
006610         MOVE W-P1 TO SP-R
006620         WRITE SP-R
006630         MOVE SPACE TO SP-R.
006640     MOVE W-P2 TO SP-R.
006650     WRITE SP-R.
006660     MOVE SPACE TO SP-R.
006670     ADD W-TSU TO W-SUT.
006680*
006690     MOVE 1 TO HSKI-PRN.
006700     REWRITE HSKI-R.
006710 MEI-EX.
006720     EXIT.
006730 KEI-RTN.
006740     IF CHK NOT = 2
006750         GO TO KEI-EX.
006760     MOVE SPACE TO W-P2.
006770     MOVE SPACE TO P-NAME.
006780     MOVE NC"　　　　　　　　　　　　　［　合　計　］" TO P-NAME.
006790     MOVE W-SUT TO P-TSU.
006800     IF LINAGE-COUNTER > 61
006810         PERFORM MID-RTN THRU MID-EX
006820         MOVE SPACE TO SP-R
006830         MOVE W-P1 TO SP-R
006840         WRITE SP-R
006850         MOVE SPACE TO SP-R.
006860     MOVE W-P2 TO SP-R.
006870     WRITE SP-R.
006880     MOVE SPACE TO SP-R.
006890 KEI-EX.
006900     EXIT.
