000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMN150.
000030*********************************************************
000040*    PROGRAM         :  棚卸Ｗチェックファイル１作成    *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT HTI-M ASSIGN TO HTI-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY HTI-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT HTIMW ASSIGN TO HTIW-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE DYNAMIC
000230         RECORD KEY HTIW-KEY
000240         FILE STATUS IS ERR-STAT.
000250     SELECT HTWCF ASSIGN TO HTWC-MSD.
000260 I-O-CONTROL.
000270     APPLY SHARED-MODE ON HTI-M
000280     APPLY SHARED-MODE ON HTIMW.
000290 DATA DIVISION.
000300 FILE SECTION.
000310     COPY LIHTIM.
000320 FD  HTIMW
000330     BLOCK  3 RECORDS
000340     LABEL RECORD IS STANDARD
000350     VALUE OF IDENTIFICATION "HTIMW".
000360 01  HTIW-R.
000370     02  HTIW-KEY.
000380       03  HTIW-DNO.                                              伝票№
000390         04  HTIW-DNO1  PIC  9(005).                              伝票№
000400         04  HTIW-DNO2  PIC  X(001).
000410       03  HTIW-GNO     PIC  9(001).                              行№
000420     02  HTIW-SNO       PIC  9(001).
000430     02  HTIW-HCD       PIC  9(006).                              品名ｺｰﾄﾞ
000440     02  HTIW-SIZ       PIC  9(001).
000450     02  HTIW-SUD.                                                棚卸数
000460       03  HTIW-SU      PIC S9(006)  OCCURS  10.
000470     02  HTIW-BC.
000480       03  HTIW-BC1     PIC  9(002).
000490       03  HTIW-BC2     PIC  9(002).
000500       03  HTIW-BC3     PIC  9(002).
000510     02  HTIW-ISU       PIC  9(003).
000520     02  F              PIC  X(001).
000530 FD  HTWCF
000540     BLOCK  2 RECORDS
000550     LABEL RECORD IS STANDARD
000560     VALUE OF IDENTIFICATION WK0128ID.
000570 01  HTWC-R.
000580     02  HTWC-HCD       PIC  9(006).                              品名ｺｰﾄﾞ
000590     02  HTWC-SIZ       PIC  9(001).
000600     02  HTWC-ASUD.                                               棚卸数
000610       03  HTWC-ASU     PIC S9(006)  OCCURS  10.
000620     02  HTWC-BSUD.                                               棚卸数
000630       03  HTWC-BSU     PIC S9(006)  OCCURS  10.
000640     02  F              PIC  X(001).
000650 WORKING-STORAGE SECTION.
000660 77  WK0128ID           PIC  X(009) VALUE SPACE.
000670 01  STN-NO.
000680     02  STN-NO1        PIC  X(003).
000690     02  STN-NO2        PIC  X(003).
000700 01  W-FID.
000710     02  W-FID1         PIC  X(006) VALUE "WK0128".
000720     02  W-FID2         PIC  X(003).
000730 01  W-DATA.
000740     02  CNT            PIC  9(002).
000750 01  ERR-STAT           PIC  X(002).
000760 SCREEN SECTION.
000770 SD  C-CRT
000780     END STATUS IS ESTAT.
000790 01  C-CLEAR.
000800     02  LINE   1  CLEAR SCREEN.
000810 01  C-MID.
000820     02  LINE   3  COLUMN  10  PIC  N(024) VALUE
000830          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000840     02  LINE   4  COLUMN  10  PIC  N(024) VALUE
000850          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000860     02  LINE   5  COLUMN  10  PIC  N(024) VALUE
000870          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
000880     02  LINE   6  COLUMN  10  PIC  N(024) VALUE
000890          NC"＊＊＊　　棚卸Ｗチェックファイル１作成　　＊＊＊".
000900     02  LINE   7  COLUMN  10  PIC  N(024) VALUE
000910          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
000920     02  LINE   8  COLUMN  10  PIC  N(024) VALUE
000930          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000940     02  LINE   9  COLUMN  10  PIC  N(024) VALUE
000950          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000960 01  C-ERR.
000970     02  LINE  24.
000980       03  E-ME1   COLUMN  15  PIC  X(019) VALUE
000990            "***  ｲﾘｽｳ ZERO  ***".
001000       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001010       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001020       03  E-HTI   COLUMN  45  PIC  9(006) FROM  HTI-HCD.
001030       03  E-HTIW  COLUMN  45  PIC  9(006) FROM  HTIW-HCD.
001040       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001050       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001060            "                                                  ".
001070 PROCEDURE DIVISION.
001080 M-05.
001090     DISPLAY C-CLEAR.
001100     DISPLAY C-MID.
001110*
001120     CALL "CBLSTNNO" USING STN-NO.
001130     MOVE STN-NO2 TO W-FID2.
001140     MOVE W-FID TO WK0128ID.
001150     OPEN OUTPUT HTWCF.
001160     OPEN INPUT HTI-M HTIMW.
001170 M-10.
001180     READ HTI-M NEXT RECORD WITH UNLOCK AT END
001190         GO TO M-30.
001200     IF HTI-SUD = ZERO
001210         GO TO M-10.
001220     IF HTI-SNO NOT = 6
001230         GO TO M-10.
001240     IF HTI-BC3 = 30
001250         GO TO M-10.
001260*
001270     MOVE ZERO TO HTWC-R.
001280     MOVE HTI-HCD TO HTWC-HCD.
001290     MOVE HTI-SIZ TO HTWC-SIZ.
001300     MOVE ZERO TO CNT.
001310 M-20.
001320     ADD 1 TO CNT.
001330     IF CNT = 11
001340         GO TO M-25.
001350     IF HTI-SU(CNT) NOT = ZERO
001360         IF HTI-GNO > 4
001370             MOVE HTI-SU(CNT) TO HTWC-ASU(CNT)
001380           ELSE
001390             COMPUTE HTWC-ASU(CNT) = HTI-SU(CNT) * HTI-ISU
001400             IF HTI-ISU = ZERO
001410                 DISPLAY E-ME1 E-HTI E-ME99
001420                 DISPLAY E-CL.
001430     GO TO M-20.
001440 M-25.
001450     WRITE HTWC-R.
001460     GO TO M-10.
001470 M-30.
001480     READ HTIMW NEXT RECORD WITH UNLOCK AT END
001490         GO TO M-90.
001500     IF HTIW-SUD = ZERO
001510         GO TO M-30.
001520*
001530     MOVE ZERO TO HTWC-R.
001540     MOVE HTIW-HCD TO HTWC-HCD.
001550     MOVE HTIW-SIZ TO HTWC-SIZ.
001560     MOVE ZERO TO CNT.
001570 M-40.
001580     ADD 1 TO CNT.
001590     IF CNT = 11
001600         GO TO M-45.
001610     IF HTIW-SU(CNT) NOT = ZERO
001620         IF HTIW-GNO > 4
001630             MOVE HTIW-SU(CNT) TO HTWC-BSU(CNT)
001640           ELSE
001650             COMPUTE HTWC-BSU(CNT) = HTIW-SU(CNT) * HTIW-ISU
001660             IF HTIW-ISU = ZERO
001670                 DISPLAY E-ME1 E-HTIW E-ME99
001680                 DISPLAY E-CL.
001690     GO TO M-40.
001700 M-45.
001710     WRITE HTWC-R.
001720     GO TO M-30.
001730 M-90.
001740     CLOSE HTI-M HTIMW.
001750     CLOSE HTWCF.
001760 M-95.
001770     DISPLAY C-CLEAR.
001780     STOP RUN.
