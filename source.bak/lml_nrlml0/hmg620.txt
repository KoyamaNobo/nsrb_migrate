000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMG620.
000030*************************************************************
000040*    PROGRAM         :  履物品種別受払表（ＥＸＣＥＬ変換用）*
000050*    PRINTER TYPE    :  JIPS                                *
000060*    SCREEN          :  ******                              *
000070*    COMPILE TYPE    :  COBOL                               *
000080*    W-JS1           :  月  =0  ,  年  =1                   *
000090*    W-JS2           :  4ｹﾀ =0  ,  6ｹﾀ =1                   *
000100*    W-JS3           :  ｺｰﾄﾞ=0  ,  分類=1                   *
000110*    W-JS4           :  全体=0  ,  ハイパー=1               *
000120*************************************************************
000130 ENVIRONMENT DIVISION.
000140 CONFIGURATION SECTION.
000150 SOURCE-COMPUTER. SYSTEM3100.
000160 OBJECT-COMPUTER. SYSTEM3100.
000170 INPUT-OUTPUT SECTION.
000180 FILE-CONTROL.
000190     COPY LIBCSE.
000200     SELECT HUH-F ASSIGN TO HUH-MSD
000210         FILE STATUS IS ERR-STAT.
000220     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000230         ORGANIZATION IS INDEXED
000240         ACCESS MODE IS DYNAMIC
000250         RECORD KEY IS HI-KEY
000260         ALTERNATE RECORD KEY IS HI-KEY2
000270         FILE STATUS IS ERR-STAT.
000280     SELECT HKBM ASSIGN TO HKB-MSD
000290         ORGANIZATION INDEXED
000300         ACCESS MODE RANDOM
000310         RECORD KEY HKB-KEY
000320         FILE STATUS ERR-STAT.
000330     SELECT EXL-F ASSIGN TO EXL-MSD.
000340 I-O-CONTROL.
000350     APPLY SHARED-MODE ON M-DATE
000360     APPLY SHARED-MODE ON HI-M
000370     APPLY SHARED-MODE ON HKBM.
000380 DATA DIVISION.
000390 FILE SECTION.
000400     COPY LIBFDD.
000410     COPY LIHIM.
000420     COPY LIHKBM.
000430 FD  HUH-F
000440     BLOCK  2 RECORDS
000450     LABEL RECORD IS STANDARD
000460     VALUE OF IDENTIFICATION WK0128ID.
000470 01  HUH-R.
000480     02  UH-HCD.
000490       03  UH-HCD1      PIC  9(004).
000500       03  UH-HCD2      PIC  9(002).
000510     02  UH-NG          PIC  9(006).
000520     02  UH-ZSU         PIC S9(006).                                前月数
000530     02  UH-ZKIN        PIC S9(009).                                前月額
000540     02  UH-NSU         PIC S9(007).                                入庫数
000550     02  UH-NKIN        PIC S9(010).                                入庫額
000560     02  UH-USU         PIC S9(008).                                売上数
000570     02  UH-UKIN        PIC S9(010).                                売上額
000580     02  UH-YSU         PIC S9(006).                                翌月数
000590     02  UH-YKIN        PIC S9(009).                                翌月額
000600     02  UH-URG         PIC S9(010).                                売上原
000610     02  UH-BCD1.
000620       03  UH-BC1       PIC  9(002).
000630       03  UH-BC21      PIC  9(001).
000640     02  UH-BC22        PIC  9(001).
000650     02  UH-BC3         PIC  9(002).                                 分類 
000660     02  UH-BMC         PIC  9(002).
000670     02  UH-BMNO        PIC  9(001).
000680     02  FILLER         PIC  X(032).
000690 FD  EXL-F
000700     BLOCK  1 RECORDS
000710     LABEL RECORD IS STANDARD
000720     VALUE OF IDENTIFICATION "WK0256000".
000730 01  EXL-R.
000740     02  EXL-HCD        PIC  X(006).
000750     02  EXL-HNA        PIC  N(024).
000760     02  EXL-FT         PIC  9(005).
000770     02  EXL-UT         PIC S9(005).
000780     02  EXL-ZS         PIC S9(007).
000790     02  EXL-ZK         PIC S9(010).
000800     02  EXL-NS         PIC S9(007).
000810     02  EXL-NK         PIC S9(010).
000820     02  EXL-US         PIC S9(007).
000830     02  EXL-UK         PIC S9(010).
000840     02  EXL-YS         PIC S9(007).
000850     02  EXL-YK         PIC S9(010).
000860     02  EXL-AR         PIC S9(010).
000870     02  EXL-RR         PIC S9(003)V9(01).
000880     02  FILLER         PIC  X(110).
000890 WORKING-STORAGE SECTION.
000900 77  W-JS1              PIC  9(001).
000910 77  W-JS2              PIC  9(001).
000920 77  W-JS3              PIC  9(001).
000930 77  W-JS4              PIC  9(001).
000940 77  WK0128ID           PIC  X(009) VALUE SPACE.
000950 01  STN-NO.
000960     02  STN-NO1        PIC  X(003).
000970     02  STN-NO2        PIC  X(003).
000980 01  W-FID1.
000990     02  W-FID11        PIC  X(006) VALUE "WK0128".
001000     02  W-FID12        PIC  X(003).
001010 01  W-DATA.
001020     02  W-BC3          PIC  9(002).
001030     02  W-BMC          PIC  9(002).
001040     02  W-BC1          PIC  9(002).
001050     02  W-BC21         PIC  9(001).
001060     02  W-HCD.
001070       03  W-HCD1       PIC  9(004).
001080       03  F            PIC  9(002).
001090     02  CNT            PIC  9(002).
001100     02  CHK            PIC  9(001).
001110     02  CHKD           PIC  9(001).
001120     02  W-ALL          PIC S9(006)V9(05).
001130     02  W-DMM          PIC  9(001).
001140     02  W-TC           PIC  9(002).
001150     02  W-MC           PIC  9(001).
001160     02  W-EC           PIC  9(002).
001170     02  W-SNG.
001180       03  W-SNEN       PIC  9(004).
001190       03  W-SND   REDEFINES W-SNEN.
001200         04  W-SN1      PIC  9(002).
001210         04  W-SN2      PIC  9(002).
001220       03  W-SGET       PIC  9(002).
001230     02  W-SNGL  REDEFINES W-SNG.
001240       03  F            PIC  9(002).
001250       03  W-SNGS       PIC  9(004).
001260     02  W-ENG.
001270       03  W-ENEN       PIC  9(004).
001280       03  W-END   REDEFINES W-ENEN.
001290         04  W-EN1      PIC  9(002).
001300         04  W-EN2      PIC  9(002).
001310       03  W-EGET       PIC  9(002).
001320     02  W-ENGL  REDEFINES W-ENG.
001330       03  F            PIC  9(002).
001340       03  W-ENGS       PIC  9(004).
001350     02  W-SHCD         PIC  9(004).
001360     02  W-EHCD         PIC  9(004).
001370     02  W-SBC3         PIC  9(002).
001380     02  W-EBC3         PIC  9(002).
001390     02  W-SBMNO        PIC  9(001).
001400     02  W-EBMNO        PIC  9(001).
001410     02  W-SBCD1        PIC  9(003).
001420     02  W-EBCD1        PIC  9(003).
001430*
001440     02  W-NAME         PIC  N(024).
001450     02  W-ANM   REDEFINES W-NAME.
001460       03  W-NM    OCCURS  24  PIC  N(001).
001470     02  W-ANMT  REDEFINES W-NAME.
001480       03  F            PIC  N(012).
001490       03  W-NMT        PIC  N(012).
001500     02  W-NAMED        PIC  N(024).
001510     02  W-ANMD  REDEFINES W-NAMED.
001520       03  W-NMD   OCCURS  24  PIC  N(001).
001530     02  W-HED.
001540       03  H-NNK.
001550         04  H-HN       PIC  N(002).
001560         04  F          PIC  N(001) VALUE NC"年".
001570         04  H-HG       PIC  N(002).
001580         04  F          PIC  N(002) VALUE NC"月～".
001590         04  H-ON       PIC  N(002).
001600         04  F          PIC  N(001) VALUE NC"年".
001610         04  H-OG       PIC  N(002).
001620         04  F          PIC  N(002) VALUE NC"月　".
001630       03  H-HIV        PIC  N(004) VALUE SPACE.
001640       03  H-MID        PIC  N(002) VALUE SPACE.
001650       03  F            PIC  N(004) VALUE NC"別受払表".
001660*
001670     02  W-TM           PIC  N(012).
001680     02  W-TMDD  REDEFINES W-TM.
001690       03  W-TMD   OCCURS  12  PIC  N(001).
001700     02  W-MN           PIC  N(008).
001710     02  W-MNDD  REDEFINES W-MN.
001720       03  W-MND   OCCURS   8  PIC  N(001).
001730 01  W-D.
001740     02  W-DD    OCCURS  6.
001750       03  W-ZS         PIC S9(007).
001760       03  W-ZK         PIC S9(010).
001770       03  W-NS         PIC S9(007).
001780       03  W-NK         PIC S9(010).
001790       03  W-US         PIC S9(007).
001800       03  W-UK         PIC S9(010).
001810       03  W-YS         PIC S9(007).
001820       03  W-YK         PIC S9(010).
001830       03  W-AR         PIC S9(009).
001840 01  W-WD.
001850     02  W-UT           PIC S9(005).
001860     02  W-FT           PIC  9(005).
001870     02  W-RR           PIC S9(003)V9(01).
001880 01  ERR-STAT           PIC  X(002).
001890     COPY LSTAT.
001900 SCREEN  SECTION.
001910 SD  C-CRT
001920     END STATUS IS ESTAT.
001930 01  C-CLEAR.
001940     02  C-CL    LINE   1  CLEAR SCREEN.
001950 01  C-MID.
001960     02  LINE   3  COLUMN  12  PIC  N(022) VALUE
001970          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001980     02  LINE   4  COLUMN  12  PIC  N(022) VALUE
001990          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002000     02  LINE   5  COLUMN  12  PIC  N(022) VALUE
002010          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
002020     02  LINE   6  COLUMN  12  PIC  N(022) VALUE
002030          NC"＊＊＊　　　履物　品種別　受払表　　　＊＊＊".
002040     02  LINE   7  COLUMN  12  PIC  N(022) VALUE
002050          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
002060     02  LINE   8  COLUMN  12  PIC  N(022) VALUE
002070          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002080     02  LINE   9  COLUMN  12  PIC  N(022) VALUE
002090          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002100     02  LINE  22  COLUMN  24  PIC  X(022) VALUE
002110          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
002120 01  C-ACP.
002130     02  LINE  15.
002140       03  A-SHCD  COLUMN  29  PIC  9(004)
002150            USING W-SHCD  CHECK OVERFLOW NO IFC.
002160       03  A-EHCD  COLUMN  37  PIC  9(004)
002170            USING W-EHCD  CHECK OVERFLOW NO IFC.
002180       03  A-SBC3  COLUMN  27  PIC  9(002)
002190            USING W-SBC3  CHECK OVERFLOW NO IFC.
002200       03  A-EBC3  COLUMN  33  PIC  9(002)
002210            USING W-EBC3  CHECK OVERFLOW NO IFC.
002220     02  LINE  17.
002230       03  A-SBMNO COLUMN  28  PIC  9(001)
002240            USING W-SBMNO CHECK OVERFLOW NO IFC.
002250       03  A-EBMNO COLUMN  33  PIC  9(001)
002260            USING W-EBMNO CHECK OVERFLOW NO IFC.
002270     02  LINE  19.
002280       03  A-SBC1  COLUMN  26  PIC  9(003)
002290            USING W-SBCD1 CHECK OVERFLOW NO IFC.
002300       03  A-EBC1  COLUMN  33  PIC  9(003)
002310            USING W-EBCD1 CHECK OVERFLOW NO IFC.
002320     02  A-DMM   LINE  22  COLUMN  41  PIC  9(001)
002330          USING W-DMM   CHECK OVERFLOW NO IFC.
002340 01  C-DSP.
002350     02  D-MID   LINE   7  COLUMN  28  PIC  N(005) VALUE
002360          NC"ハイパーＶ".
002370     02  D-HCDM.
002380       03  LINE  15  COLUMN  19  PIC  X(024) VALUE
002390            "品名ｺｰﾄﾞ  0000 ～ 9999".
002400     02  D-BCM.
002410       03  LINE  15  COLUMN  19  PIC  X(049) VALUE
002420            "分類③  00 ～ 99    一　般=10,ワーク=20,教　育=30".
002430       03  LINE  17.
002440         04  COLUMN  19  PIC  X(029) VALUE
002450              "部門№   0 ～ 9     国  内=1,".
002460         04  COLUMN  48  PIC  N(003) VALUE NC"上　海".
002470         04  COLUMN  54  PIC  X(011) VALUE "=2,仕  入=3".
002480       03  LINE  18.
002490         04  COLUMN  39  PIC  N(003) VALUE NC"ワーク".
002500         04  COLUMN  45  PIC  X(011) VALUE
002510              "=4,教　育=5".
002520       03  LINE  19  COLUMN  19  PIC  X(017) VALUE
002530            "分類① 000 ～ 999".
002540     02  D-NG.
002550       03  LINE   6  COLUMN  12  PIC  N(022) VALUE
002560            NC"＊＊＊　　履物　品種別　年間受払表　　＊＊＊".
002570       03  LINE  13.
002580         04  COLUMN  23  PIC  X(001) VALUE "'".
002590         04  COLUMN  24  PIC  9(002) FROM  W-SN2.
002600         04  COLUMN  26  PIC  N(001) VALUE NC"年".
002610         04  COLUMN  28  PIC  9(002) FROM  W-SGET.
002620         04  COLUMN  30  PIC  X(009) VALUE "月 より '".
002630         04  COLUMN  39  PIC  9(002) FROM  W-EN2.
002640         04  COLUMN  41  PIC  N(001) VALUE NC"年".
002650         04  COLUMN  43  PIC  9(002) FROM  W-EGET.
002660         04  COLUMN  45  PIC  N(001) VALUE NC"月".
002670 01  C-ERR.
002680     02  LINE  24.
002690       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002700            "***  DATA ﾅｼ  ***".
002710       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
002720       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
002730       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
002740     COPY LIBSCR.
002750 PROCEDURE DIVISION.
002760 M-020.
002770     ACCEPT W-JS1.
002780     ACCEPT W-JS2.
002790     ACCEPT W-JS3.
002800     ACCEPT W-JS4.
002810     IF 1 < W-JS1 OR W-JS2 OR W-JS3 OR W-JS4
002820         STOP RUN.
002830     COPY LIBCPR.
002840     DISPLAY C-CLEAR.
002850     DISPLAY C-MID.
002860     IF W-JS4 = 1
002870         DISPLAY D-MID.
002880     IF W-JS1 = 1
002890         PERFORM NGD-RTN THRU NGD-EX.
002900     IF W-JS3 = 1
002910         DISPLAY D-BCM
002920         GO TO M-100.
002930     DISPLAY D-HCDM.
002940 M-040.
002950     ACCEPT A-SHCD.
002960     IF ESTAT = PF9
002970         DISPLAY C-CLEAR
002980         STOP RUN.
002990     IF ESTAT NOT = HTB AND SKP
003000         GO TO M-040.
003010 M-060.
003020     ACCEPT A-EHCD.
003030     IF ESTAT = BTB
003040         GO TO M-040.
003050     IF ESTAT NOT = HTB AND SKP
003060         GO TO M-060.
003070     IF W-SHCD > W-EHCD
003080         GO TO M-060.
003090     GO TO M-220.
003100 M-100.
003110     ACCEPT A-SBC3.
003120     IF ESTAT = PF9
003130         DISPLAY C-CLEAR
003140         STOP RUN.
003150     IF ESTAT NOT = HTB AND SKP
003160         GO TO M-100.
003170 M-120.
003180     ACCEPT A-EBC3.
003190     IF ESTAT = BTB
003200         GO TO M-100.
003210     IF ESTAT NOT = HTB AND SKP
003220         GO TO M-120.
003230     IF W-SBC3 > W-EBC3
003240         GO TO M-120.
003250 M-140.
003260     ACCEPT A-SBMNO.
003270     IF ESTAT = BTB
003280         GO TO M-120.
003290     IF ESTAT NOT = HTB AND SKP
003300         GO TO M-140.
003310 M-160.
003320     ACCEPT A-EBMNO.
003330     IF ESTAT = BTB
003340         GO TO M-140.
003350     IF ESTAT NOT = HTB AND SKP
003360         GO TO M-160.
003370     IF W-SBMNO > W-EBMNO
003380         GO TO M-160.
003390 M-180.
003400     ACCEPT A-SBC1.
003410     IF ESTAT = BTB
003420         GO TO M-160.
003430     IF ESTAT NOT = HTB AND SKP
003440         GO TO M-180.
003450 M-200.
003460     ACCEPT A-EBC1.
003470     IF ESTAT = BTB
003480         GO TO M-180.
003490     IF ESTAT NOT = HTB AND SKP
003500         GO TO M-200.
003510     IF W-SBCD1 > W-EBCD1
003520         GO TO M-200.
003530 M-220.
003540     ACCEPT A-DMM.
003550     IF ESTAT = BTB
003560         IF W-JS3 = 0
003570             GO TO M-060
003580           ELSE
003590             GO TO M-200.
003600     IF ESTAT NOT = HTB AND SKP
003610         GO TO M-220.
003620     IF W-DMM = 9
003630         DISPLAY C-CLEAR
003640         STOP RUN.
003650     IF W-DMM NOT = 1
003660         GO TO M-220.
003670*
003680     CALL "CBLSTNNO" USING STN-NO.
003690     MOVE STN-NO2 TO W-FID12.
003700     MOVE W-FID1 TO WK0128ID.
003710     OPEN INPUT HUH-F.
003720     OPEN INPUT HI-M.
003730     OPEN INPUT HKBM.
003740     OPEN OUTPUT EXL-F.
003750 M-300.
003760     READ HUH-F AT END
003770         DISPLAY E-ME1 E-ME99
003780         GO TO M-980.
003790     IF W-JS3 = 0
003800         IF UH-HCD1 < W-SHCD OR > W-EHCD
003810             GO TO M-300.
003820     IF W-JS3 = 1
003830         IF UH-BC3 < W-SBC3 OR > W-EBC3
003840             GO TO M-300.
003850     IF W-JS3 = 1
003860         IF UH-BMNO < W-SBMNO OR > W-EBMNO
003870             GO TO M-300.
003880     IF W-JS3 = 1
003890         IF UH-BCD1 < W-SBCD1 OR > W-EBCD1
003900             GO TO M-300.
003910     IF W-JS1 = 1
003920         IF UH-NG < W-SNG OR > W-ENG
003930             GO TO M-300.
003940     IF ZERO = UH-ZSU AND UH-ZKIN AND UH-NSU AND UH-NKIN AND
003950               UH-USU AND UH-UKIN AND UH-YSU AND UH-YKIN
003960         GO TO M-300.
003970     IF W-JS4 = 0
003980         GO TO M-310.
003990     MOVE UH-HCD TO HI-KEY.
004000     READ HI-M WITH UNLOCK INVALID KEY
004010         MOVE 0 TO HI-HPV.
004020     IF HI-HPV NOT = 1
004030         GO TO M-300.
004040 M-310.
004050     IF W-JS4 = 1
004060         MOVE NC"ハイパー" TO H-HIV.
004070     IF W-JS2 = 0
004080         MOVE NC"品種" TO H-MID.
004090     IF W-JS2 = 1
004100         MOVE NC"品名" TO H-MID.
004110     IF W-JS1 = 0
004120         MOVE ALL NC"　" TO H-NNK
004130       ELSE
004140         MOVE W-SN2 TO H-HN
004150         MOVE W-SGET TO H-HG
004160         MOVE W-EN2 TO H-ON
004170         MOVE W-EGET TO H-OG.
004180     MOVE SPACE TO W-NAME.
004190     MOVE W-HED TO W-NAME.
004200     INITIALIZE EXL-R.
004210     MOVE W-NAME TO EXL-HNA.
004220     WRITE EXL-R.
004230     MOVE ZERO TO W-D.
004240 M-320.
004250     MOVE ZERO TO W-DD(5).
004260     MOVE UH-BC3 TO W-BC3.
004270 M-340.
004280     MOVE ZERO TO W-DD(4).
004290     MOVE UH-BMC TO W-BMC.
004300 M-360.
004310     MOVE ZERO TO W-DD(3).
004320     MOVE UH-BC1 TO W-BC1.
004330 M-380.
004340     MOVE ZERO TO W-DD(2).
004350     MOVE UH-BC21 TO W-BC21.
004360 M-400.
004370     IF W-JS2 = 0
004380         MOVE UH-HCD1 TO W-HCD1
004390       ELSE
004400         MOVE UH-HCD TO W-HCD.
004410     MOVE ZERO TO W-DD(1).
004420     PERFORM HMS-RTN THRU HMS-EX.
004430 M-420.
004440     PERFORM SET-RTN THRU SET-EX.
004450     IF (W-JS1 = 1) OR (W-JS2 = 0)
004460         GO TO M-440.
004470     MOVE 1 TO CHK.
004480     PERFORM PRI-RTN THRU PRI-EX.
004490     PERFORM TOT-RTN THRU TOT-EX.
004500 M-440.
004510     READ HUH-F AT END
004520         GO TO M-920.
004530     IF W-JS3 = 0
004540         IF UH-HCD1 < W-SHCD OR > W-EHCD
004550             GO TO M-440.
004560     IF W-JS3 = 1
004570         IF UH-BC3 < W-SBC3 OR > W-EBC3
004580             GO TO M-440.
004590     IF W-JS3 = 1
004600         IF UH-BMNO < W-SBMNO OR > W-EBMNO
004610             GO TO M-440.
004620     IF W-JS3 = 1
004630         IF UH-BCD1 < W-SBCD1 OR > W-EBCD1
004640             GO TO M-440.
004650     IF W-JS1 = 1
004660         IF UH-NG < W-SNG OR > W-ENG
004670             GO TO M-440.
004680     IF ZERO = UH-ZSU AND UH-ZKIN AND UH-NSU AND UH-NKIN AND
004690               UH-USU AND UH-UKIN AND UH-YSU AND UH-YKIN
004700         GO TO M-440.
004710     IF W-JS4 = 0
004720         GO TO M-450.
004730     MOVE UH-HCD TO HI-KEY.
004740     READ HI-M WITH UNLOCK INVALID KEY
004750         MOVE 0 TO HI-HPV.
004760     IF HI-HPV NOT = 1
004770         GO TO M-440.
004780 M-450.
004790     IF UH-BC3 NOT = W-BC3
004800         GO TO M-580.
004810     IF UH-BMC NOT = W-BMC
004820         GO TO M-540.
004830     IF UH-BC1 NOT = W-BC1
004840         GO TO M-500.
004850     IF UH-BC21 NOT = W-BC21
004860         GO TO M-460.
004870     IF (W-JS1 = 0) AND (W-JS2 = 1)
004880         GO TO M-400.
004890     IF W-JS2 = 0
004900         IF UH-HCD1 = W-HCD1
004910             GO TO M-420.
004920     IF (W-JS1 = 1) AND (W-JS2 = 1)
004930         IF UH-HCD = W-HCD
004940             GO TO M-420.
004950     MOVE 1 TO CHK.
004960     PERFORM PRI-RTN THRU PRI-EX.
004970     PERFORM TOT-RTN THRU TOT-EX.
004980     GO TO M-400.
004990 M-460.
005000     IF (W-JS1 = 0) AND (W-JS2 = 1)
005010         GO TO M-480.
005020     MOVE 1 TO CHK.
005030     PERFORM PRI-RTN THRU PRI-EX.
005040     PERFORM TOT-RTN THRU TOT-EX.
005050 M-480.
005060     MOVE 2 TO CHK.
005070     IF W-BC21 NOT = 0
005080         PERFORM PRI-RTN THRU PRI-EX.
005090     PERFORM TOT-RTN THRU TOT-EX.
005100     GO TO M-380.
005110 M-500.
005120     IF (W-JS1 = 0) AND (W-JS2 = 1)
005130         GO TO M-520.
005140     MOVE 1 TO CHK.
005150     PERFORM PRI-RTN THRU PRI-EX.
005160     PERFORM TOT-RTN THRU TOT-EX.
005170 M-520.
005180     MOVE 2 TO CHK.
005190     IF W-BC21 NOT = 0
005200         PERFORM PRI-RTN THRU PRI-EX.
005210     PERFORM TOT-RTN THRU TOT-EX.
005220     MOVE 3 TO CHK.
005230     PERFORM PRI-RTN THRU PRI-EX.
005240     PERFORM TOT-RTN THRU TOT-EX.
005250     GO TO M-360.
005260 M-540.
005270     IF (W-JS1 = 0) AND (W-JS2 = 1)
005280         GO TO M-560.
005290     MOVE 1 TO CHK.
005300     PERFORM PRI-RTN THRU PRI-EX.
005310     PERFORM TOT-RTN THRU TOT-EX.
005320 M-560.
005330     MOVE 2 TO CHK.
005340     IF W-BC21 NOT = 0
005350         PERFORM PRI-RTN THRU PRI-EX.
005360     PERFORM TOT-RTN THRU TOT-EX.
005370     MOVE 3 TO CHK.
005380     PERFORM PRI-RTN THRU PRI-EX.
005390     PERFORM TOT-RTN THRU TOT-EX.
005400*
005410     MOVE 4 TO CHK.
005420     PERFORM PRI-RTN THRU PRI-EX.
005430     PERFORM TOT-RTN THRU TOT-EX.
005440     GO TO M-340.
005450 M-580.
005460     IF (W-JS1 = 0) AND (W-JS2 = 1)
005470         GO TO M-600.
005480     MOVE 1 TO CHK.
005490     PERFORM PRI-RTN THRU PRI-EX.
005500     PERFORM TOT-RTN THRU TOT-EX.
005510 M-600.
005520     MOVE 2 TO CHK.
005530     IF W-BC21 NOT = 0
005540         PERFORM PRI-RTN THRU PRI-EX.
005550     PERFORM TOT-RTN THRU TOT-EX.
005560     MOVE 3 TO CHK.
005570     PERFORM PRI-RTN THRU PRI-EX.
005580     PERFORM TOT-RTN THRU TOT-EX.
005590*
005600     MOVE 4 TO CHK.
005610     PERFORM PRI-RTN THRU PRI-EX.
005620     PERFORM TOT-RTN THRU TOT-EX.
005630*
005640     MOVE 5 TO CHK.
005650     PERFORM PRI-RTN THRU PRI-EX.
005660     PERFORM TOT-RTN THRU TOT-EX.
005670     GO TO M-320.
005680 M-920.
005690     IF (W-JS1 = 0) AND (W-JS2 = 1)
005700         GO TO M-940.
005710     MOVE 1 TO CHK.
005720     PERFORM PRI-RTN THRU PRI-EX.
005730     PERFORM TOT-RTN THRU TOT-EX.
005740 M-940.
005750     MOVE 2 TO CHK.
005760     IF W-BC21 NOT = 0
005770         PERFORM PRI-RTN THRU PRI-EX.
005780     PERFORM TOT-RTN THRU TOT-EX.
005790     MOVE 3 TO CHK.
005800     PERFORM PRI-RTN THRU PRI-EX.
005810     PERFORM TOT-RTN THRU TOT-EX.
005820*
005830     MOVE 4 TO CHK.
005840     PERFORM PRI-RTN THRU PRI-EX.
005850     PERFORM TOT-RTN THRU TOT-EX.
005860*
005870     MOVE 5 TO CHK.
005880     PERFORM PRI-RTN THRU PRI-EX.
005890     PERFORM TOT-RTN THRU TOT-EX.
005900*
005910     MOVE 6 TO CHK.
005920     PERFORM PRI-RTN THRU PRI-EX.
005930 M-980.
005940     CLOSE HUH-F.
005950     CLOSE HI-M.
005960     CLOSE HKBM.
005970     CLOSE EXL-F.
005980     DISPLAY C-CLEAR.
005990     STOP RUN.
006000 NGD-RTN.
006010     MOVE ZERO TO W-SNG W-ENG.
006020     MOVE D-SPNG TO W-SNGS.
006030     MOVE D-EPNG TO W-ENGS.
006040     IF W-SN2 >= DATE-NF1 AND <= DATE-NT1
006050         ADD DATE-NC1 TO W-SNEN.
006060     IF W-SN2 >= DATE-NF2 AND <= DATE-NT2
006070         ADD DATE-NC2 TO W-SNEN.
006080     IF W-EN2 >= DATE-NF1 AND <= DATE-NT1
006090         ADD DATE-NC1 TO W-ENEN.
006100     IF W-EN2 >= DATE-NF2 AND <= DATE-NT2
006110         ADD DATE-NC2 TO W-ENEN.
006120     DISPLAY D-NG.
006130 NGD-EX.
006140     EXIT.
006150 HMS-RTN.
006160     IF W-JS2 = 0
006170         GO TO HMS-010.
006180     MOVE UH-HCD TO HI-KEY.
006190     READ HI-M WITH UNLOCK INVALID KEY
006200         MOVE NC"　＊＊　マスター　なし　＊＊　　　　" TO HI-NAME
006210         MOVE ZERO TO HI-FT.
006220     GO TO HMS-EX.
006230 HMS-010.
006240     MOVE SPACE TO W-NAME W-NAMED.
006250     MOVE ZERO TO HI-KEY.
006260     MOVE W-HCD1 TO HI-HCD1.
006270     START HI-M KEY NOT < HI-KEY INVALID KEY
006280         MOVE NC"　＊＊　マスター　なし　＊＊　　　　" TO W-NAME
006290         GO TO HMS-EX.
006300     READ HI-M NEXT RECORD WITH UNLOCK AT END
006310         MOVE NC"　＊＊　マスター　なし　＊＊　　　　" TO W-NAME
006320         GO TO HMS-EX.
006330     IF W-HCD1 NOT = HI-HCD1
006340         MOVE NC"　＊＊　マスター　なし　＊＊　　　　" TO W-NAME
006350         GO TO HMS-EX.
006360*
006370     MOVE HI-NAME TO W-NAMED.
006380     MOVE SPACE TO W-NAME.
006390     MOVE ZERO TO CNT.
006400 HMS-020.
006410     ADD 1 TO CNT.
006420     IF CNT = 24
006430         GO TO HMS-EX.
006440     MOVE W-NMD(CNT) TO W-NM(CNT).
006450     IF W-NMD(CNT) NOT = SPACE
006460         GO TO HMS-020.
006470     ADD 1 TO CNT.
006480     IF CNT = 24
006490         GO TO HMS-EX.
006500     MOVE W-NMD(CNT) TO W-NM(CNT).
006510     IF W-NMD(CNT) NOT = SPACE
006520         GO TO HMS-020.
006530 HMS-EX.
006540     EXIT.
006550 SET-RTN.
006560     IF W-JS1 = 1
006570         IF W-SNG = UH-NG
006580             ADD UH-ZSU TO W-ZS(1)
006590             ADD UH-ZKIN TO W-ZK(1).
006600     IF W-JS1 = 1
006610         IF W-ENG = UH-NG
006620             ADD UH-YSU TO W-YS(1)
006630             ADD UH-YKIN TO W-YK(1).
006640     IF W-JS1 = 0
006650         ADD UH-ZSU TO W-ZS(1)
006660         ADD UH-ZKIN TO W-ZK(1)
006670         ADD UH-YSU TO W-YS(1)
006680         ADD UH-YKIN TO W-YK(1).
006690     ADD UH-NSU TO W-NS(1).
006700     ADD UH-NKIN TO W-NK(1).
006710     ADD UH-USU TO W-US(1).
006720     ADD UH-UKIN TO W-UK(1).
006730     COMPUTE W-AR(1) = W-YK(1) + W-UK(1) - W-NK(1) - W-ZK(1).
006740 SET-EX.
006750     EXIT.
006760 PRI-RTN.
006770     MOVE ZERO TO W-WD.
006780     IF W-JS2 = 0
006790         IF W-YS(CHK) NOT = ZERO
006800             COMPUTE W-FT ROUNDED = W-YK(CHK) / W-YS(CHK).
006810     IF W-UK(CHK) = ZERO
006820         GO TO PRI-020.
006830     IF W-US(CHK) NOT = ZERO
006840         COMPUTE W-UT ROUNDED = W-UK(CHK) / W-US(CHK).
006850     IF W-AR(CHK) NOT = ZERO
006860         IF W-UK(CHK) > ZERO
006870             COMPUTE W-RR ROUNDED = (W-AR(CHK) * 100) / W-UK(CHK)
006880           ELSE
006890             COMPUTE W-RR ROUNDED =
006900                                   (W-AR(CHK) * -100) / W-UK(CHK).
006910 PRI-020.
006920     IF ZERO = W-ZK(CHK) AND W-NK(CHK) AND W-UK(CHK) AND W-YK(CHK)
006930           AND W-ZS(CHK) AND W-NS(CHK) AND W-US(CHK) AND W-YS(CHK)I.100802
006940         GO TO PRI-EX.
006950     INITIALIZE EXL-R.
006960     MOVE SPACE TO EXL-HNA.
006970     IF CHK = 1
006980         IF W-JS2 = 1
006990             MOVE W-HCD TO EXL-HCD
007000           ELSE
007010             MOVE W-HCD1 TO EXL-HCD.
007020     MOVE W-ZS(CHK) TO EXL-ZS.
007030     MOVE W-ZK(CHK) TO EXL-ZK.
007040     MOVE W-NS(CHK) TO EXL-NS.
007050     MOVE W-NK(CHK) TO EXL-NK.
007060     MOVE W-US(CHK) TO EXL-US.
007070     MOVE W-UK(CHK) TO EXL-UK.
007080     MOVE W-YS(CHK) TO EXL-YS.
007090     MOVE W-YK(CHK) TO EXL-YK.
007100     MOVE W-AR(CHK) TO EXL-AR.
007110     IF W-UT NOT = ZERO
007120         MOVE W-UT TO EXL-UT.
007130     IF W-RR NOT = ZERO
007140         MOVE W-RR TO EXL-RR.
007150     IF CHK = 1
007160         IF W-JS2 = 1
007170             MOVE HI-NAME TO EXL-HNA
007180             MOVE HI-FT TO EXL-FT
007190             GO TO PRI-240
007200           ELSE
007210             MOVE W-NAME TO EXL-HNA
007220             MOVE W-FT TO EXL-FT
007230             GO TO PRI-240.
007240     IF CHK = 2
007250         MOVE SPACE TO W-NAME
007260         MOVE NC"　　　　　　｛　小計　｝" TO W-NMT
007270         MOVE W-NAME TO EXL-HNA
007280         GO TO PRI-240.
007290     IF CHK = 6
007300         MOVE SPACE TO W-NAME
007310         MOVE NC"【　総　合　計　】　　　" TO W-NMT
007320         MOVE W-NAME TO EXL-HNA
007330         GO TO PRI-240.
007340*
007350     IF CHK NOT = 3
007360         GO TO PRI-080.
007370     MOVE SPACE TO HKB-KEY.
007380     MOVE "11" TO HKB-NO.
007390     MOVE W-BC1 TO HKB-BR1.
007400     READ HKBM WITH UNLOCK INVALID KEY
007410         MOVE SPACE TO HKB-BRN1.
007420     MOVE SPACE TO W-TM W-MN.
007430     MOVE HKB-BRN1 TO W-MN.
007440     MOVE 9 TO W-EC.
007450 PRI-040.
007460     SUBTRACT 1 FROM W-EC.
007470     IF W-EC NOT = 0
007480         IF W-MND(W-EC) = SPACE
007490             GO TO PRI-040.
007500*
007510     ADD 1 TO W-EC.
007520     MOVE NC"（" TO W-TMD(4).
007530     MOVE 4 TO W-TC.
007540     MOVE 0 TO W-MC.
007550 PRI-060.
007560     ADD 1 TO W-TC W-MC.
007570     IF W-MC NOT = W-EC
007580         MOVE W-MND(W-MC) TO W-TMD(W-TC)
007590         GO TO PRI-060.
007600     MOVE NC"）" TO W-TMD(W-TC).
007610     MOVE SPACE TO W-NAME.
007620     MOVE W-TM TO W-NMT.
007630     MOVE W-NAME TO EXL-HNA.
007640     GO TO PRI-240.
007650*
007660 PRI-080.
007670     IF CHK NOT = 4
007680         GO TO PRI-160.
007690     MOVE SPACE TO HKB-KEY.
007700     MOVE "16" TO HKB-NO.
007710     MOVE W-BMC TO HKB-BMC.
007720     READ HKBM WITH UNLOCK INVALID KEY
007730         MOVE SPACE TO HKB-BMN.
007740     MOVE SPACE TO W-TM W-MN.
007750     MOVE HKB-BMN TO W-TM.
007760     MOVE ZERO TO W-MC W-EC.
007770 PRI-100.
007780     ADD 1 TO W-MC.
007790     IF W-MC = 5
007800         GO TO PRI-120.
007810     IF W-TMD(W-MC) NOT = SPACE
007820         ADD 1 TO W-EC
007830         MOVE W-TMD(W-MC) TO W-MND(W-EC).
007840     GO TO PRI-100.
007850 PRI-120.
007860     ADD 1 TO W-EC.
007870     MOVE NC"計" TO W-MND(W-EC).
007880     ADD 2 TO W-EC.
007890     MOVE SPACE TO W-TM.
007900     MOVE NC"＜" TO W-TMD(3).
007910     MOVE 4 TO W-TC.
007920     MOVE 0 TO W-MC.
007930 PRI-140.
007940     ADD 1 TO W-TC W-MC.
007950     IF W-MC NOT = W-EC
007960         MOVE W-MND(W-MC) TO W-TMD(W-TC)
007970         GO TO PRI-140.
007980     MOVE NC"＞" TO W-TMD(W-TC).
007990     MOVE SPACE TO W-NAME.
008000     MOVE W-TM TO W-NMT.
008010     MOVE W-NAME TO EXL-HNA.
008020     GO TO PRI-240.
008030*
008040 PRI-160.
008050     IF CHK NOT = 5
008060         GO TO PRI-240.
008070     MOVE SPACE TO HKB-KEY.
008080     MOVE "14" TO HKB-NO.
008090     MOVE W-BC3 TO HKB-BR3.
008100     READ HKBM WITH UNLOCK INVALID KEY
008110         MOVE SPACE TO HKB-BRN3.
008120     MOVE SPACE TO W-TM W-MN.
008130     MOVE HKB-BRN3 TO W-TM.
008140     MOVE ZERO TO W-MC W-EC.
008150 PRI-180.
008160     ADD 1 TO W-MC.
008170     IF W-MC = 5
008180         GO TO PRI-200.
008190     IF W-TMD(W-MC) NOT = SPACE
008200         ADD 1 TO W-EC
008210         MOVE W-TMD(W-MC) TO W-MND(W-EC).
008220     GO TO PRI-180.
008230 PRI-200.
008240     ADD 1 TO W-EC.
008250     MOVE NC"合" TO W-MND(W-EC).
008260     ADD 1 TO W-EC.
008270     MOVE NC"計" TO W-MND(W-EC).
008280     ADD 2 TO W-EC.
008290     MOVE SPACE TO W-TM.
008300     MOVE NC"［" TO W-TMD(2).
008310     MOVE 3 TO W-TC.
008320     MOVE 0 TO W-MC.
008330 PRI-220.
008340     ADD 1 TO W-TC W-MC.
008350     IF W-MC NOT = W-EC
008360         MOVE W-MND(W-MC) TO W-TMD(W-TC)
008370         GO TO PRI-220.
008380     MOVE NC"］" TO W-TMD(W-TC).
008390     MOVE SPACE TO W-NAME.
008400     MOVE W-TM TO W-NMT.
008410     MOVE W-NAME TO EXL-HNA.
008420*
008430 PRI-240.
008440     WRITE EXL-R.
008450 PRI-EX.
008460     EXIT.
008470 TOT-RTN.
008480     COMPUTE CHKD = CHK + 1.
008490     ADD W-ZS(CHK) TO W-ZS(CHKD).
008500     ADD W-ZK(CHK) TO W-ZK(CHKD).
008510     ADD W-NS(CHK) TO W-NS(CHKD).
008520     ADD W-NK(CHK) TO W-NK(CHKD).
008530     ADD W-US(CHK) TO W-US(CHKD).
008540     ADD W-UK(CHK) TO W-UK(CHKD).
008550     ADD W-YS(CHK) TO W-YS(CHKD).
008560     ADD W-YK(CHK) TO W-YK(CHKD).
008570     ADD W-AR(CHK) TO W-AR(CHKD).
008580 TOT-EX.
008590     EXIT.
