000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKD050.
000030*********************************************************
000040*    PROGRAM         :  請求明細ファイル　入金日　セット*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SM-F ASSIGN TO SM-MSD.
000160     SELECT NYU-F ASSIGN TO NYU-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY NYU-KEY.
000200 I-O-CONTROL.
000210     APPLY SHARED-MODE ON NYU-F.
000220 DATA DIVISION.
000230 FILE SECTION.
000240 FD  SM-F
000250     BLOCK  5 RECORDS
000260     LABEL RECORD IS STANDARD
000270     VALUE OF IDENTIFICATION "SMF".
000280 01  S-R.
000290     02  S-TCD          PIC  9(004).
000300     02  S-NGP.
000310       03  S-NG         PIC  9(006).
000320       03  S-PEY        PIC  9(002).
000330     02  S-ZS           PIC S9(009).
000340     02  S-ZSZ          PIC S9(007).
000350     02  S-UR           PIC S9(009).
000360     02  S-URZ          PIC S9(007).
000370     02  S-TS           PIC S9(007).
000380     02  S-TSZ          PIC S9(005).
000390     02  S-NK           PIC S9(009).
000400     02  S-NKZ          PIC S9(007).
000410     02  S-DATE         PIC  9(006).
000420     02  S-SI           PIC  9(003).
000430     02  S-SU           PIC  9(001).
000440     02  F              PIC  X(019).
000450     02  S-DC           PIC  9(001).
000460 FD  NYU-F
000470     BLOCK  5 RECORDS
000480     LABEL RECORD IS STANDARD
000490     VALUE OF IDENTIFICATION "NYUF".
000500 01  NYU-R.
000510     02  NYU-DATE       PIC  9(008).
000520     02  NYU-NGP   REDEFINES NYU-DATE.
000530       03  NYU-NG.
000540         04  NYU-NEN    PIC  9(004).
000550         04  NYU-GET    PIC  9(002).
000560       03  NYU-PEY      PIC  9(002).
000570     02  NYU-NGPL  REDEFINES NYU-DATE.
000580       03  F            PIC  9(002).
000590       03  NYU-NGPS     PIC  9(006).
000600     02  NYU-TCD        PIC  9(004).
000610     02  NYU-KIN        PIC S9(008).
000620     02  NYU-NC.
000630       03  NYU-NC1      PIC  9(001).
000640       03  NYU-NC2      PIC  9(001).
000650     02  F              PIC  9(001).
000660     02  NYU-TGK        PIC  9(008).
000670     02  NYU-TGKD  REDEFINES NYU-TGK.
000680       03  F            PIC  9(002).
000690       03  NYU-TGKS     PIC  9(006).
000700     02  NYU-SS.
000710       03  NYU-SSN      PIC  9(004).
000720       03  NYU-SSG      PIC  9(002).
000730     02  NYU-SSL   REDEFINES NYU-SS.
000740       03  F            PIC  9(002).
000750       03  NYU-SSS      PIC  9(004).
000760     02  NYU-BC         PIC  9(001).
000770     02  NYU-TC         PIC  9(002).
000780     02  F              PIC  X(003).
000790     02  NYU-KEY        PIC  X(007).
000800     02  F              PIC  X(052).
000810 WORKING-STORAGE SECTION.
000820 01  W-DATA.
000830     02  W-TBL          PIC  X(024) VALUE
000840          "312831303130313130313031".
000850     02  W-GN    REDEFINES W-TBL.
000860       03  W-GN1   OCCURS  12  PIC  9(002).
000870     02  W-NGP1.
000880       03  W-NEN1       PIC  9(004).
000890       03  W-GET1       PIC  9(002).
000900       03  W-PEY1       PIC  9(002).
000910     02  W-NGP2.
000920       03  W-NEN2       PIC  9(004).
000930       03  W-GET2       PIC  9(002).
000940       03  W-PEY2       PIC  9(002).
000950     02  W-SIT.
000960       03  W-SI1   OCCURS  12  PIC  9(003).
000970     02  CNT            PIC  9(002).
000980     02  W-SI           PIC  9(003).
000990     02  W-C            PIC  9(001).
001000     02  CHK            PIC  9(001).
001010 01  ERR-STAT           PIC  X(002).
001020 SCREEN SECTION.
001030 SD  C-CRT
001040     END STATUS IS ESTAT.
001050 01  C-CLEAR.
001060     02  LINE   1  CLEAR SCREEN.
001070 01  C-MID.
001080     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
001090          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001100     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
001110          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001120     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
001130          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001140     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
001150          NC"＊＊＊　　請求明細Ｆ　入金日　変換　　＊＊＊".
001160     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
001170          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001180     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
001190          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001200     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
001210          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001220 01  C-ERR.
001230     02  LINE  24.
001240       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001250       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001260 PROCEDURE DIVISION.
001270 M-05.
001280     DISPLAY C-CLEAR.
001290     DISPLAY C-MID.
001300     OPEN INPUT NYU-F.
001310     OPEN I-O SM-F.
001320 M-10.
001330     READ NYU-F NEXT RECORD AT END
001340         GO TO M-65.
001350     IF NYU-SS = ZERO
001360         GO TO M-10.
001370     IF NYU-NC2 = 8
001380         GO TO M-10.
001390 M-15.
001400     READ SM-F AT END
001410         GO TO M-55.
001420     IF S-DC NOT = 0
001430         GO TO M-15.
001440     IF NYU-TCD NOT = S-TCD
001450         GO TO M-15.
001460     IF NYU-SS NOT = S-NG
001470         GO TO M-15.
001480     MOVE NYU-NGPS TO S-DATE.
001490     MOVE ZERO TO W-C W-SIT.
001500     IF NYU-TGK = ZERO
001510         GO TO M-25.
001520     IF NYU-NC1 NOT = 3 AND 4
001530         GO TO M-25.
001540 M-20.
001550     PERFORM S-05 THRU S-15.
001560     ADD 1 TO W-C.
001570     MOVE W-SI TO W-SI1(W-C).
001580 M-25.
001590     READ NYU-F NEXT RECORD AT END
001600         GO TO M-60.
001610     IF NYU-SS = ZERO
001620         GO TO M-25.
001630     IF NYU-NC2 = 8
001640         GO TO M-25.
001650 M-30.
001660     IF NYU-TCD NOT = S-TCD
001670         GO TO M-35.
001680     IF NYU-SS NOT = S-NG
001690         GO TO M-35.
001700     IF NYU-NC1 = 3 OR 4
001710         GO TO M-20.
001720     GO TO M-25.
001730 M-35.
001740     PERFORM S-20 THRU S-35.
001750 M-50.
001760     CLOSE SM-F.
001770     OPEN I-O SM-F.
001780     GO TO M-15.
001790 M-55.
001800     CLOSE SM-F.
001810     OPEN I-O SM-F.
001820     GO TO M-10.
001830 M-60.
001840     PERFORM S-20 THRU S-35.
001850 M-65.
001860     CLOSE NYU-F.
001870     CLOSE SM-F.
001880     DISPLAY C-CLEAR.
001890     STOP RUN.
001900 S-05.
001910     MOVE S-NGP TO W-NGP1.
001920     COMPUTE W-SI = W-GN1(W-GET1) - W-PEY1.
001930     MOVE NYU-TGK TO W-NGP2.
001940     ADD W-PEY2 TO W-SI.
001950     IF W-GET1 = 12
001960         MOVE ZERO TO W-GET1.
001970     ADD 1 TO W-GET1.
001980     IF W-GET1 = W-GET2
001990         GO TO S-15.
002000     IF W-GET2 = 1
002010         MOVE 13 TO W-GET2.
002020     SUBTRACT 1 FROM W-GET2.
002030     MOVE W-GET1 TO CNT.
002040 S-10.
002050     ADD W-GN1(CNT) TO W-SI.
002060     IF CNT = W-GET2
002070         GO TO S-15.
002080     IF CNT = 12
002090         MOVE ZERO TO CNT.
002100     ADD 1 TO CNT.
002110     GO TO S-10.
002120 S-15.
002130     EXIT.
002140 S-20.
002150     MOVE ZERO TO CNT W-SI.
002160     IF W-C = ZERO
002170         GO TO S-30.
002180 S-25.
002190     IF CNT NOT = W-C
002200         ADD 1 TO CNT
002210         ADD W-SI1(CNT) TO W-SI
002220         GO TO S-25.
002230     COMPUTE W-SI ROUNDED = W-SI / W-C.
002240 S-30.
002250     MOVE W-SI TO S-SI.
002260     MOVE W-C TO S-SU.
002270     REWRITE S-R.
002280 S-35.
002290     EXIT.
