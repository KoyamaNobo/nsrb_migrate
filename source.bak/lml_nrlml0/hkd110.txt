000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKD110.
000030*********************************************************
000040*    PROGRAM         :  入金累積ファイル　修正入力　　  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ------                          *
000070*        変更　　　  :  95/07/18                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170*****SELECT KKB-M ASSIGN TO KKB-MSD                               D.991223
000180*****    ORGANIZATION INDEXED                                     D.991223
000190*****    RECORD KEY KKB-KEY                                       D.991223
000200*****    ACCESS MODE RANDOM                                       D.991223
000210*****    FILE STATUS IS ERR-STAT.                                 D.991223
000220     SELECT HKBM ASSIGN TO HKB-MSD                                I.960917
000230         ORGANIZATION INDEXED                                     I.960917
000240         ACCESS MODE RANDOM                                       I.960917
000250         RECORD KEY HKB-KEY                                       I.960917
000260         FILE STATUS IS ERR-STAT.                                 I.960917
000270*****SELECT T-M ASSIGN TO T-MSD                                   D.000222
000280     SELECT T-M ASSIGN TO T1-MSD T2-MSD                           I.000222
000290         ORGANIZATION INDEXED
000300         ACCESS MODE RANDOM
000310         RECORD KEY T-KEY
000320         ALTERNATE RECORD KEY T-KEY2                              I.000222
000330         FILE STATUS IS ERR-STAT.
000340*****SELECT NYUR-F ASSIGN TO NYUR-MSD.                            D.960917
000350*****SELECT NYUR-YR ASSIGN TO NYURY-MSD.                          D.960917
000360     SELECT NYUR-F ASSIGN TO NYUR-MSD                             I.960917
000370         FILE STATUS IS ERR-STAT.                                 I.960917
000380*****SELECT NYUR-YR ASSIGN TO NYURY-MSD                           D.991223
000390*****    FILE STATUS IS ERR-STAT.                                 D.991223
000400 I-O-CONTROL.
000410     APPLY SHARED-MODE ON M-DATE
000420*****APPLY SHARED-MODE ON KKB-M                                   D.991223
000430     APPLY SHARED-MODE ON HKBM                                    I.960917
000440     APPLY SHARED-MODE ON T-M.
000450 DATA DIVISION.
000460 FILE SECTION.
000470     COPY LIBFDD.
000480*****COPY LIKKBM.                                                 D.991223
000490     COPY LIHKBM.                                                 I.960917
000500     COPY LITM.
000510     COPY LSNYUR.                                                 I.970714
000520*FD  NYUR-F                                                       D.970714
000530*****BLOCK  6 RECORDS                                             D.970714
000540*****LABEL RECORD IS STANDARD                                     D.970714
000550*****VALUE OF IDENTIFICATION "NYURF".                             D.970714
000560*01  NYUR-R.                                                      D.970714
000570*****02  NUR-DATE       PIC  9(006).                              D.970714
000580*****02  NUR-NGP   REDEFINES NUR-DATE.                            D.970714
000590*****  03  NUR-NG.                                                D.970714
000600*****    04  NUR-NEN    PIC  9(002).                              D.970714
000610*****    04  NUR-GET    PIC  9(002).                              D.970714
000620*****  03  NUR-PEY      PIC  9(002).                              D.970714
000630*****02  NUR-TCD        PIC  9(004).                              D.970714
000640*****02  NUR-KIN        PIC S9(008).                              D.970714
000650*****02  NUR-NC         PIC  9(002).                              D.970714
000660*****02  NUR-NCD   REDEFINES NUR-NC.                              D.970714
000670*****  03  NUR-NC1      PIC  9(001).                              D.970714
000680*****  03  NUR-NC2      PIC  9(001).                              D.970714
000690*****02  NUR-TGK        PIC  9(006).                              D.970714
000700*****02  NUR-TGKD  REDEFINES NUR-TGK.                             D.970714
000710*****  03  NUR-TNG.                                               D.970714
000720*****    04  NUR-TGN    PIC  9(002).                              D.970714
000730*****    04  NUR-TGG    PIC  9(002).                              D.970714
000740*****  03  NUR-TGP      PIC  9(002).                              D.970714
000750*****02  NUR-SS         PIC  9(004).                              D.970714
000760*****02  NUR-SSD   REDEFINES NUR-SS.                              D.970714
000770*****  03  NUR-SSN      PIC  9(002).                              D.970714
000780*****  03  NUR-SSG      PIC  9(002).                              D.970714
000790*****02  NUR-BC         PIC  9(001).                              D.970714
000800*****02  NUR-TC         PIC  9(002).                              D.970714
000810*****02  F              PIC  X(003).                              D.970714
000820*****02  NUR-NO         PIC  9(006).                              D.970714
000830*FD  NYUR-YR                                                      D.991223
000840*****BLOCK  6 RECORDS                                             D.970714
000850*****BLOCK  5 RECORDS                                             D.991223
000860*****LABEL RECORD IS STANDARD                                     D.991223
000870*****VALUE OF IDENTIFICATION "NYURYR".                            D.991223
000880*01  NYUY-R.                                                      D.991223
000890*****02  NYUY-DATE      PIC  9(006).                              D.970714
000900*****02  NYUY-DATE      PIC  9(008).                              D.991223
000910*****02  NYUY-NGP   REDEFINES NYUY-DATE.                          D.991223
000920*****  03  NYUY-NG.                                               D.991223
000930*****    04  NYUY-NEN   PIC  9(002).                              D.970714
000940*****    04  NYUY-NEN   PIC  9(004).                              D.991223
000950*****    04  NYUY-GET   PIC  9(002).                              D.991223
000960*****  03  NYUY-PEY     PIC  9(002).                              D.991223
000970*****02  NYUY-TCD       PIC  9(004).                              D.991223
000980*****02  NYUY-KIN       PIC S9(008).                              D.991223
000990*****02  NYUY-NC        PIC  9(002).                              D.991223
001000*****02  NYUY-NCD   REDEFINES NYUY-NC.                            D.991223
001010*****  03  NYUY-NC1     PIC  9(001).                              D.991223
001020*****  03  NYUY-NC2     PIC  9(001).                              D.991223
001030*****02  NYUY-TD        PIC  9(006).                              D.970714
001040*****02  NYUY-TD        PIC  9(008).                              D.991223
001050*****02  NYUY-TDD   REDEFINES NYUY-TD.                            D.991223
001060*****  03  NYUY-TNG.                                              D.991223
001070*****    04  NYUY-TNEN  PIC  9(002).                              D.970714
001080*****    04  NYUY-TNEN  PIC  9(004).                              D.991223
001090*****    04  NYUY-TGET  PIC  9(002).                              D.991223
001100*****  03  NYUY-TPEY    PIC  9(002).                              D.991223
001110*****02  NYUY-SS        PIC  9(004).                              D.970714
001120*****02  NYUY-SS        PIC  9(006).                              D.991223
001130*****02  NYUY-SSD   REDEFINES NYUY-SS.                            D.991223
001140*****  03  NYUY-SNEN    PIC  9(002).                              D.970714
001150*****  03  NYUY-SNEN    PIC  9(004).                              D.991223
001160*****  03  NYUY-SGET    PIC  9(002).                              D.991223
001170*****02  NYUY-BC        PIC  9(001).                              D.991223
001180*****02  NYUY-TC        PIC  9(002).                              D.991223
001190*****02  F              PIC  X(003).                              D.991223
001200*****02  NYUY-NO        PIC  9(006).                              D.991223
001210*****02  F              PIC  X(003).                              D.991223
001220 WORKING-STORAGE SECTION.
001230 01  ERR-STAT           PIC  X(002).
001240 01  W-FILE             PIC  X(013).
001250 01  W-DATA.
001260*****02  W-HNG          PIC  9(004).                              D.970714
001270*****02  W-KNG          PIC  9(004).                              D.970714
001280     02  W-HNG          PIC  9(006).                              I.970714
001290     02  W-HNGD  REDEFINES W-HNG.                                 I.970714
001300       03  W-HNEN       PIC  9(004).                              I.970714
001310       03  W-HNEND REDEFINES W-HNEN.                              I.970714
001320         04  W-HNEN1    PIC  9(002).                              I.970714
001330         04  W-HNEN2    PIC  9(002).                              I.970714
001340       03  W-HGET       PIC  9(002).                              I.970714
001350     02  W-HNGL  REDEFINES W-HNG.                                 I.970714
001360       03  F            PIC  9(002).                              I.970714
001370       03  W-HNGS       PIC  9(004).                              I.970714
001380     02  W-KNG          PIC  9(006).                              I.970714
001390     02  W-KNGD  REDEFINES W-KNG.                                 I.970714
001400       03  W-KNEN       PIC  9(004).                              I.970714
001410       03  W-KNEND REDEFINES W-KNEN.                              I.970714
001420         04  W-KNEN1    PIC  9(002).                              I.970714
001430         04  W-KNEN2    PIC  9(002).                              I.970714
001440       03  W-KGET       PIC  9(002).                              I.970714
001450     02  W-KNGL  REDEFINES W-KNG.                                 I.970714
001460       03  F            PIC  9(002).                              I.970714
001470       03  W-KNGS       PIC  9(004).                              I.970714
001480     02  W-DMM          PIC  9(001).
001490*****02  W-DNO          PIC  9(006).                              D.991223
001500     02  W-KEY.                                                   I.991223
001510       03  W-DNO        PIC  9(006).                              I.991223
001520       03  W-GNO        PIC  9(001).                              I.991223
001530     02  W-END          PIC  9(001) VALUE 0.                      I.960917
001540     02  W-NKNA         PIC  N(006).                              I.991223
001550     02  W-NSNA         PIC  N(006).                              I.991223
001560*****02  CNT            PIC  9(010).                              D.960917
001570*****02  W-ANN.                                                   D.960917
001580*****  03  W-NN    OCCURS  10  PIC  N(004).                       D.960917
001590*****02  W-NND.                                                   D.960917
001600*****  03  F            PIC  N(020) VALUE                         D.960917
001610*****       NC"現　金　振　込　小切手　約　手　為　手　".         D.960917
001620*****  03  F            PIC  N(020) VALUE                         D.960917
001630*****       NC"買掛相殺他相殺　取消し　　　　　相　殺　".         D.960917
001640     COPY LSTAT.
001650 SCREEN SECTION.
001660 SD  C-CRT
001670     END STATUS IS ESTAT.
001680 01  C-CLEAR.
001690     02  LINE   1  CLEAR SCREEN.
001700 01  C-MID.
001710     02  LINE   1  COLUMN   8  PIC  N(023) VALUE
001720          NC"＊＊＊　　入金累積ファイル　修正入力　　＊＊＊".
001730*****02  LINE   4  COLUMN   8  PIC  X(008) VALUE "入 金 №".      D.991223
001740     02  LINE   4.                                                I.991223
001750       03  COLUMN   8  PIC  X(008) VALUE "入 金 №".              I.991223
001760       03  COLUMN  24  PIC  X(001) VALUE "-".                     I.991223
001770       03  COLUMN  33  PIC  X(009) VALUE "終了=ｆ･9".             I.991223
001780     02  LINE   5  COLUMN  34  PIC  X(017) VALUE
001790          "（*印は修正不可）".
001800     02  LINE   7  COLUMN   8  PIC  N(004) VALUE NC"日　　付".
001810     02  LINE   9  COLUMN   6  PIC  X(010) VALUE "* 得 意 先".
001820*****02  LINE  11  COLUMN   8  PIC  N(004) VALUE NC"入金区分".    D.991223
001830     02  LINE  11.                                                I.991223
001840       03  COLUMN   8  PIC  N(004) VALUE NC"入金区分".            I.991223
001850       03  COLUMN  38  PIC  N(004) VALUE NC"相殺区分".            I.991223
001860     02  LINE  13  COLUMN   8  PIC  N(004) VALUE NC"手形期日".
001870     02  LINE  15  COLUMN   6  PIC  X(010) VALUE "* 金　　額".
001880     02  LINE  17  COLUMN   8  PIC  N(004) VALUE NC"請求年月".
001890     02  LINE  22  COLUMN  30  PIC  X(022) VALUE
001900          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001910 01  C-ACP.
001920*****02  A-DNO   LINE   4  COLUMN  18  PIC  9(006)                D.991223
001930     02  LINE   4.                                                I.991223
001940       03  A-DNO   COLUMN  18  PIC  9(006)                        I.991223
001950            USING W-DNO     CHECK OVERFLOW NO IFC.
001960       03  A-GNO   COLUMN  25  PIC  9(001)                        I.991223
001970            USING W-GNO     CHECK OVERFLOW NO IFC.                I.991223
001980     02  A-DATE  LINE   7  COLUMN  18  PIC  9(006)
001990          USING NUR-NGPS  CHECK OVERFLOW NO IFC.                  I.970714
002000*****     USING NUR-DATE  CHECK OVERFLOW NO IFC.                  D.970714
002010*****02  A-NC    LINE  11  COLUMN  18  PIC  9(002)                D.991223
002020     02  LINE  11.                                                I.991223
002030       03  A-NC    COLUMN  18  PIC  9(002)                        I.991223
002040            USING NUR-NC    CHECK OVERFLOW NO IFC.
002050       03  A-NSC   COLUMN  48  PIC  9(001)                        I.991223
002060            USING NUR-NSC   CHECK OVERFLOW NO IFC.                I.991223
002070     02  A-TD    LINE  13  COLUMN  18  PIC  9(006)
002080          USING NUR-TGKS  CHECK OVERFLOW NO IFC.                  I.970714
002090*****     USING NUR-TGK   CHECK OVERFLOW NO IFC.                  D.970714
002100     02  A-SS    LINE  17  COLUMN  18  PIC  9(004)
002110          USING NUR-SSS   CHECK OVERFLOW NO IFC.                  I.970714
002120*****     USING NUR-SS    CHECK OVERFLOW NO IFC.                  D.970714
002130     02  A-DMM   LINE  22  COLUMN  47  PIC  9(001)
002140          USING W-DMM     CHECK OVERFLOW NO IFC.
002150 01  C-DSP.
002160     02  D-MD.
002170       03  LINE   9.
002180         04  D-TCD   COLUMN  18  PIC  9(004) FROM  NUR-TCD.
002190         04  D-NAME  COLUMN  23  PIC  N(026) FROM  T-NAME.        I.020408
002200*****    04  D-NAME  COLUMN  23  PIC  N(024) FROM  T-NAME.        D.020408
002210*****  03  D-NN    LINE  11.                                      D.991223
002220       03  LINE  11.                                              I.991223
002230         04  D-NN    COLUMN  23  PIC  N(006) FROM  W-NKNA.        I.991223
002240         04  D-NSNA  COLUMN  50  PIC  N(006) FROM  W-NSNA.        I.991223
002250*****    04  COLUMN  23  PIC  N(004) FROM  W-NN(CNT).             D.960917
002260*****    04  COLUMN  23  PIC  N(004) FROM  HKB-NKNA.              D.960920
002270*****    04  COLUMN  23  PIC  N(006) FROM  HKB-NKNA.              D.991223
002280       03  D-KIN   LINE  15.
002290         04  COLUMN  18  PIC ZZZZZZZ9-  FROM  NUR-KIN.
002300     02  S-NSC   LINE  11  COLUMN  48  PIC  X(024) VALUE          I.991223
002310          "                        ".                             I.991223
002320     02  S-TD    LINE  13  COLUMN  18  PIC  X(006) VALUE "      ".
002330     02  S-SS    LINE  17  COLUMN  18  PIC  X(004) VALUE "    ".
002340     02  S-DMM   LINE  22  COLUMN  47  PIC  X(001) VALUE " ".
002350*****02  LINE  15.                                                D.991223
002360*****  03  D-SME04 COLUMN  18  PIC  N(017) VALUE                  D.991223
002370*****       NC"＊＊＊　　他で入金入力中　　＊＊＊" BLINK.         D.991223
002380*****  03  D-SME13 COLUMN  18  PIC  N(017) VALUE                  D.991223
002390*****       NC"＊＊＊　　他で日次更新中　　＊＊＊" BLINK.         D.991223
002400*****  03  D-SME15 COLUMN  18  PIC  N(017) VALUE                  D.991223
002410*****       NC"＊＊＊　　他で月次更新中　　＊＊＊" BLINK.         D.991223
002420 01  C-ERR.
002430     02  LINE  24.
002440       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002450            "***  DATA ﾅｼ  ***".
002460       03  E-ME2   COLUMN  15  PIC  X(015) VALUE
002470            "***  TM ﾅｼ  ***".
002480       03  E-ME3   COLUMN  15  PIC  X(018) VALUE
002490            "***  ﾋｽﾞｹ ｴﾗｰ  ***".
002500       03  E-ME4   COLUMN  15  PIC  X(017) VALUE                  I.960917
002510            "***  HKBM ﾅｼ  ***".                                  I.960917
002520       03  E-ME5   COLUMN  15  PIC  X(027) VALUE                  I.960917
002530            "***  NYURF REWRITE ｴﾗｰ  ***".                        I.960917
002540*****  03  E-ME7   COLUMN  15  PIC  X(017) VALUE                  D.991223
002550*****       "***  KKBM ﾅｼ  ***".                                  D.991223
002560*****  03  E-ME8   COLUMN  15  PIC  X(026) VALUE                  D.991223
002570*****       "***  KKBM REWRITE ｴﾗｰ  ***".                         D.991223
002580*****  03  E-ME10  COLUMN  15  PIC  X(026) VALUE                  D.991223
002590*****       "***  NYURYR WRITE ｴﾗｰ  ***".                         D.991223
002600*****  03  E-ME11  COLUMN  15  PIC  X(028) VALUE                  D.991223
002610*****       "***  NYURYR REWRITE ｴﾗｰ  ***".                       D.991223
002620*****  03  E-ME90  COLUMN  15  PIC  N(022) VALUE                  D.991223
002630*****       NC"【　　工品区分マスターを修正して下さい　　】".     D.991223
002640     COPY LSSEM.                                                  I.940623
002650     COPY LIBSCR.
002660 PROCEDURE DIVISION.
002670 M-05.
002680     COPY LIBCPR.
002690     MOVE ZERO TO W-HNG W-KNG.                                    I.970714
002700     MOVE D-NHNG TO W-HNGS.                                       I.970714
002710     IF W-HNEN2 >= DATE-NF1 AND <= DATE-NT1                       I.970714
002720         ADD DATE-NC1 TO W-HNEN.                                  I.970714
002730     IF W-HNEN2 >= DATE-NF2 AND <= DATE-NT2                       I.970714
002740         ADD DATE-NC2 TO W-HNEN.                                  I.970714
002750     MOVE D-NKNG TO W-KNGS.                                       I.970714
002760     IF W-KNEN2 >= DATE-NF1 AND <= DATE-NT1                       I.970714
002770         ADD DATE-NC1 TO W-KNEN.                                  I.970714
002780     IF W-KNEN2 >= DATE-NF2 AND <= DATE-NT2                       I.970714
002790         ADD DATE-NC2 TO W-KNEN.                                  I.970714
002800*****MOVE D-NHNG TO W-HNG.                                        D.970714
002810*****MOVE D-NKNG TO W-KNG.                                        D.970714
002820     DISPLAY C-CLEAR.
002830     DISPLAY C-MID.
002840*
002850*****PERFORM KKB1-RTN THRU KKB1-EX.                               D.991223
002860*****IF W-END = 9                                                 D.991223
002870*****    GO TO M-95.                                              D.991223
002880*****OPEN I-O KKB-M.                                              D.960917
002890*****MOVE SPACE TO KKB-KEY.                                       D.960917
002900*****MOVE 90 TO KKB-NO.                                           D.960917
002910*****READ KKB-M INVALID KEY                                       D.960917
002920*****    DISPLAY E-ME78 E-ME7 E-ME99                              D.960917
002930*****    CLOSE KKB-M                                              D.960917
002940*****    DISPLAY C-CLEAR                                          D.960917
002950*****    STOP RUN.                                                D.960917
002960*****IF KKB-SC15 = 1                                              D.960917
002970*****    DISPLAY D-SME15 E-ME99                                   D.960917
002980*****    CLOSE KKB-M                                              D.960917
002990*****    DISPLAY C-CLEAR                                          D.960917
003000*****    STOP RUN.                                                D.960917
003010*****IF KKB-SC13 = 1                                              D.960917
003020*****    DISPLAY D-SME13 E-ME99                                   D.960917
003030*****    CLOSE KKB-M                                              D.960917
003040*****    DISPLAY C-CLEAR                                          D.960917
003050*****    STOP RUN.                                                D.960917
003060*****IF KKB-SC04 = 1                                              D.960917
003070*****    DISPLAY D-SME04 E-ME99                                   D.960917
003080*****    CLOSE KKB-M                                              D.960917
003090*****    DISPLAY C-CLEAR                                          D.960917
003100*****    STOP RUN.                                                D.960917
003110*****MOVE 1 TO KKB-SC04.                                          D.960917
003120*****REWRITE KKB-R INVALID KEY                                    D.960917
003130*****    DISPLAY E-ME78 E-STAT E-ME8 E-ME99                       D.960917
003140*****    CLOSE KKB-M                                              D.960917
003150*****    DISPLAY C-CLEAR                                          D.960917
003160*****    STOP RUN.                                                D.960917
003170*****CLOSE KKB-M.                                                 D.960917
003180*
003190     OPEN INPUT T-M.
003200     OPEN INPUT HKBM.                                             I.960917
003210*****MOVE W-NND TO W-ANN.                                         D.960917
003220 M-10.
003230*****ACCEPT A-DNO.                                                D.960917
003240*****DISPLAY E-CL.                                                D.960917
003250*****IF ESTAT = C2 OR PF9                                         D.960917
003260     PERFORM ACP-RTN THRU ACP-EX.                                 I.960917
003270     IF W-END = 8                                                 I.960917
003280         GO TO M-90.
003290*****IF ESTAT NOT = HTB AND SKP                                   D.960917
003300*****    GO TO M-10.                                              D.960917
003310*****IF W-DNO = ZERO                                              D.960917
003320*****    GO TO M-10.                                              D.960917
003330*
003340*****OPEN I-O NYUR-F.                                             D.960917
003350*M-15.                                                            D.960917
003360*****READ NYUR-F AT END                                           D.960917
003370*****    CLOSE NYUR-F                                             D.960917
003380*****    DISPLAY E-ME1 E-ME98                                     D.960917
003390*****    GO TO M-10.                                              D.960917
003400*****IF NUR-NO NOT = W-DNO                                        D.960917
003410*****    GO TO M-15.                                              D.960917
003420*****MOVE NUR-TCD TO T-KEY.                                       D.960917
003430*****READ T-M WITH UNLOCK INVALID KEY                             D.960917
003440*****    MOVE SPACE TO T-NAME                                     D.960917
003450*****    MOVE NC"　マスター　なし　" TO T-NAME.                   D.960917
003460*****COMPUTE CNT = NUR-NC1 + 1.                                   D.960917
003470*****DISPLAY A-DATE A-NC D-MD.                                    D.960917
003480*****IF NUR-TGK = ZERO                                            D.960917
003490*****    DISPLAY S-TD                                             D.960917
003500*****  ELSE                                                       D.960917
003510*****    DISPLAY A-TD.                                            D.960917
003520*****IF NUR-SS = ZERO                                             D.960917
003530*****    DISPLAY S-SS                                             D.960917
003540*****  ELSE                                                       D.960917
003550*****    DISPLAY A-SS.                                            D.960917
003560*M-20.                                                            D.960917
003570*****ACCEPT A-DATE.                                               D.960917
003580*****DISPLAY E-CL.                                                D.960917
003590*****IF ESTAT = BTB                                               D.960917
003600*****    CLOSE NYUR-F                                             D.960917
003610*****    GO TO M-10.                                              D.960917
003620*****IF ESTAT NOT = HTB AND SKP                                   D.960917
003630*****    GO TO M-20.                                              D.960917
003640*****IF NUR-NGP = ZERO                                            D.960917
003650*****    GO TO M-20.                                              D.960917
003660*****IF NUR-GET < 1 OR > 12                                       D.960917
003670*****    GO TO M-20.                                              D.960917
003680*****IF NUR-PEY < 1 OR > 31                                       D.960917
003690*****    GO TO M-20.                                              D.960917
003700*****IF NUR-NG NOT = W-HNG AND W-KNG                              D.960917
003710*****    DISPLAY E-ME3 E-ME98                                     D.960917
003720*****    GO TO M-20.                                              D.960917
003730*M-25.                                                            D.960917
003740*****ACCEPT A-NC.                                                 D.960917
003750*****IF ESTAT = BTB                                               D.960917
003760*****    GO TO M-20.                                              D.960917
003770*****IF ESTAT NOT = HTB AND SKP                                   D.960917
003780*****    GO TO M-25.                                              D.960917
003790*****IF NUR-NC1 = 8                                               D.960917
003800*****    GO TO M-25.                                              D.960917
003810*****IF NUR-NC2 NOT = 0 AND 8 AND 9                               D.960917
003820*****    GO TO M-25.                                              D.960917
003830*****IF NUR-NC = "78" OR "98"                                     D.960917
003840*****    GO TO M-25.                                              D.960917
003850*****IF NUR-NC1 NOT = 7                                           D.960917
003860*****    IF NUR-NC2 = 9                                           D.960917
003870*****        GO TO M-25.                                          D.960917
003880*****COMPUTE CNT = NUR-NC1 + 1.                                   D.960917
003890*****DISPLAY D-NN.                                                D.960917
003900*****IF NUR-NC NOT = "30" AND "40"                                D.960917
003910*****    MOVE ZERO TO NUR-TGK                                     D.960917
003920*****    DISPLAY S-TD                                             D.960917
003930*****    GO TO M-35.                                              D.960917
003940*M-30.                                                            D.960917
003950*****ACCEPT A-TD.                                                 D.960917
003960*****IF ESTAT = BTB                                               D.960917
003970*****    GO TO M-25.                                              D.960917
003980*****IF ESTAT NOT = HTB AND SKP                                   D.960917
003990*****    GO TO M-30.                                              D.960917
004000*****IF NUR-TGG < 1 OR > 12                                       D.960917
004010*****    GO TO M-30.                                              D.960917
004020*****IF NUR-TGP < 1 OR > 31                                       D.960917
004030*****    GO TO M-30.                                              D.960917
004040*****IF NUR-TGK < NUR-DATE                                        D.960917
004050*****    GO TO M-30.                                              D.960917
004060*M-35.                                                            D.960917
004070*****IF NUR-NC2 > 7                                               D.960917
004080*****    DISPLAY S-SS                                             D.960917
004090*****    MOVE ZERO TO NUR-SS                                      D.960917
004100*****    GO TO M-45.                                              D.960917
004110*****ACCEPT A-SS.                                                 D.960917
004120*****IF ESTAT NOT = BTB                                           D.960917
004130*****    GO TO M-40.                                              D.960917
004140*****IF NUR-NC = "30" OR "40"                                     D.960917
004150*****    GO TO M-30.                                              D.960917
004160*****GO TO M-25.                                                  D.960917
004170*M-40.                                                            D.960917
004180*****IF ESTAT NOT = HTB AND SKP                                   D.960917
004190*****    GO TO M-35.                                              D.960917
004200*****IF NUR-SS = ZERO                                             D.960917
004210*****    DISPLAY S-SS                                             D.960917
004220*****    GO TO M-45.                                              D.960917
004230*****IF NUR-SSG < 1 OR > 12                                       D.960917
004240*****    GO TO M-35.                                              D.960917
004250*****IF NUR-SS > NUR-NG                                           D.960917
004260*****    GO TO M-35.                                              D.960917
004270*M-45.                                                            D.960917
004280*****ACCEPT A-DMM.                                                D.960917
004290*****IF ESTAT NOT = BTB                                           D.960917
004300*****    GO TO M-50.                                              D.960917
004310*****IF NUR-NC2 < 8                                               D.960917
004320*****    GO TO M-35.                                              D.960917
004330*****IF NUR-NC = "30" OR "40"                                     D.960917
004340*****    GO TO M-30.                                              D.960917
004350*****GO TO M-25.                                                  D.960917
004360*M-50.                                                            D.960917
004370*****IF ESTAT NOT = HTB AND SKP                                   D.960917
004380*****    GO TO M-45.                                              D.960917
004390*****IF W-DMM = 9                                                 D.960917
004400*****    CLOSE NYUR-F                                             D.960917
004410*****    GO TO M-10.                                              D.960917
004420*****IF W-DMM NOT = 1                                             D.960917
004430*****    GO TO M-45.                                              D.960917
004440*
004450*****REWRITE NYUR-R.                                              D.960917
004460*****CLOSE NYUR-F.                                                D.960917
004470     PERFORM REW-RTN THRU REW-EX.                                 I.960917
004480     IF W-END = 8                                                 I.960917
004490         GO TO M-90.                                              I.960917
004500*****PERFORM NEN-RTN THRU NEN-EX.                                 D.991223
004510*****IF W-END = 8                                                 D.991223
004520*****    GO TO M-90.                                              D.991223
004530*
004540*****OPEN I-O NYUR-YR.                                            D.960917
004550*M-55.                                                            D.960917
004560*****READ NYUR-YR AT END                                          D.960917
004570*****    GO TO M-60.                                              D.960917
004580*****IF W-DNO NOT = NYUY-NO                                       D.960917
004590*****    GO TO M-55.                                              D.960917
004600*****MOVE NYUR-R TO NYUY-R.                                       D.960917
004610*****REWRITE NYUY-R.                                              D.960917
004620*****GO TO M-65.                                                  D.960917
004630*M-60.                                                            D.960917
004640*****MOVE NYUR-R TO NYUY-R.                                       D.960917
004650*****WRITE NYUY-R.                                                D.960917
004660*M-65.                                                            D.960917
004670*****CLOSE NYUR-YR.                                               D.960917
004680     DISPLAY C-CLEAR.
004690     DISPLAY C-MID.
004700     GO TO M-10.
004710 M-90.
004720     CLOSE T-M.
004730     CLOSE HKBM.
004740*
004750*****PERFORM KKB2-RTN THRU KKB2-EX.                               D.991223
004760*****OPEN I-O KKB-M.                                              D.960917
004770*****MOVE SPACE TO KKB-KEY.                                       D.960917
004780*****MOVE 90 TO KKB-NO.                                           D.960917
004790*****READ KKB-M INVALID KEY                                       D.960917
004800*****    DISPLAY E-ME78 E-ME7 E-ME99                              D.960917
004810*****    GO TO M-95.                                              D.960917
004820*****MOVE 0 TO KKB-SC04.                                          D.960917
004830*****REWRITE KKB-R INVALID KEY                                    D.960917
004840*****    DISPLAY E-ME78 E-STAT E-ME8 E-ME99                       D.960917
004850*****    DISPLAY E-ME90 E-ME99.                                   D.960917
004860 M-95.
004870*****CLOSE KKB-M.                                                 D.960917
004880     DISPLAY C-CLEAR.
004890     STOP RUN.
004900*--------------  ＫＫＢＭ　チェック  -------------------------------------
004910*KKB1-RTN.                                                        D.991223
004920*****OPEN I-O KKB-M.                                              D.991223
004930*****MOVE SPACE TO KKB-KEY.                                       D.991223
004940*****MOVE 90 TO KKB-NO.                                           D.991223
004950*****READ KKB-M INVALID KEY                                       D.991223
004960*****    DISPLAY E-ME78 E-ME7 E-ME99                              D.991223
004970*****    MOVE 9 TO W-END                                          D.991223
004980*****    GO TO KKB1-020.                                          D.991223
004990*****IF KKB-SC15 = 1                                              D.991223
005000*****    DISPLAY D-SME15 E-ME99                                   D.991223
005010*****    MOVE 9 TO W-END                                          D.991223
005020*****    GO TO KKB1-020.                                          D.991223
005030*****IF KKB-SC13 = 1                                              D.991223
005040*****    DISPLAY D-SME13 E-ME99                                   D.991223
005050*****    MOVE 9 TO W-END                                          D.991223
005060*****    GO TO KKB1-020.                                          D.991223
005070*****IF KKB-SC04 = 1                                              D.991223
005080*****    DISPLAY D-SME04 E-ME99                                   D.991223
005090*****    MOVE 9 TO W-END                                          D.991223
005100*****    GO TO KKB1-020.                                          D.991223
005110*****MOVE 1 TO KKB-SC04.                                          D.991223
005120*****REWRITE KKB-R INVALID KEY                                    D.991223
005130*****    DISPLAY E-ME78 E-STAT E-ME8 E-ME99                       D.991223
005140*****    MOVE 9 TO W-END                                          D.991223
005150*****    GO TO KKB1-020.                                          D.991223
005160*KKB1-020.                                                        D.991223
005170*****CLOSE KKB-M.                                                 D.991223
005180*KKB1-EX.                                                         D.991223
005190*****EXIT.                                                        D.991223
005200*--------------  入　　力  -----------------------------------------------
005210 ACP-RTN.                                                         I.960917
005220     ACCEPT A-DNO.                                                I.960917
005230     DISPLAY E-CL.                                                I.960917
005240     IF ESTAT = C2 OR PF9                                         I.960917
005250         MOVE 8 TO W-END                                          I.960917
005260         GO TO ACP-EX.                                            I.960917
005270     IF ESTAT NOT = HTB AND SKP                                   I.960917
005280         GO TO ACP-RTN.                                           I.960917
005290     IF W-DNO = ZERO                                              I.960917
005300         GO TO ACP-RTN.                                           I.960917
005310 ACP-010.                                                         I.991223
005320     ACCEPT A-GNO.                                                I.991223
005330     DISPLAY E-CL.                                                I.991223
005340     IF ESTAT = BTB                                               I.991223
005350         GO TO ACP-RTN.                                           I.991223
005360     IF ESTAT NOT = HTB AND SKP                                   I.991223
005370         GO TO ACP-010.                                           I.991223
005380     IF W-GNO = 0                                                 I.991223
005390         GO TO ACP-010.                                           I.991223
005400*
005410     OPEN I-O NYUR-F.                                             I.960917
005420 ACP-020.                                                         I.960917
005430     READ NYUR-F AT END                                           I.960917
005440         CLOSE NYUR-F                                             I.960917
005450         DISPLAY E-ME1 E-ME98                                     I.960917
005460         GO TO ACP-RTN.                                           I.960917
005470*****IF NUR-NO NOT = W-DNO                                        D.991223
005480     IF NUR-KEY NOT = W-KEY                                       I.991223
005490         GO TO ACP-020.                                           I.960917
005500*
005510     MOVE NUR-TCD TO T-KEY.                                       I.960917
005520     READ T-M WITH UNLOCK INVALID KEY                             I.960917
005530         MOVE SPACE TO T-NAME                                     I.960917
005540         MOVE NC"　マスター　なし　" TO T-NAME.                   I.960917
005550*
005560     MOVE SPACE TO HKB-KEY.                                       I.960917
005570     MOVE "31" TO HKB-NO.                                         I.960917
005580     MOVE NUR-NC1 TO HKB-NKC1.                                    I.960917
005590     READ HKBM WITH UNLOCK INVALID KEY                            I.960917
005600         MOVE SPACE TO HKB-NKNA.                                  I.960917
005610     MOVE HKB-NKNA TO W-NKNA.                                     I.991223
005620*
005630     IF NUR-NSC = 0                                               I.991223
005640         GO TO ACP-030.                                           I.991223
005650     MOVE SPACE TO HKB-KEY.                                       I.991223
005660     MOVE "32" TO HKB-NO.                                         I.991223
005670     MOVE NUR-NSC TO HKB-NSC.                                     I.991223
005680     READ HKBM WITH UNLOCK INVALID KEY                            I.991223
005690         MOVE SPACE TO HKB-NSNA.                                  I.991223
005700     MOVE HKB-NSNA TO W-NSNA.                                     I.991223
005710 ACP-030.                                                         I.991223
005720     DISPLAY A-DATE A-NC D-MD.                                    I.960917
005730     IF NUR-NC = "60"                                             I.991223
005740         DISPLAY A-NSC                                            I.991223
005750       ELSE                                                       I.991223
005760         DISPLAY S-NSC.                                           I.991223
005770     IF NUR-TGK = ZERO                                            I.960917
005780         DISPLAY S-TD                                             I.960917
005790       ELSE                                                       I.960917
005800         DISPLAY A-TD.                                            I.960917
005810     IF NUR-SS = ZERO                                             I.960917
005820         DISPLAY S-SS                                             I.960917
005830       ELSE                                                       I.960917
005840         DISPLAY A-SS.                                            I.960917
005850 ACP-040.                                                         I.960917
005860     ACCEPT A-DATE.                                               I.960917
005870     DISPLAY E-CL.                                                I.960917
005880     IF ESTAT = BTB                                               I.960917
005890         CLOSE NYUR-F                                             I.960917
005900         GO TO ACP-RTN.                                           I.960917
005910     IF ESTAT NOT = HTB AND SKP                                   I.960917
005920         GO TO ACP-040.                                           I.960917
005930     MOVE ZERO TO NUR-NEN1.                                       I.970714
005940     IF NUR-NGP = ZERO                                            I.960917
005950         GO TO ACP-040.                                           I.960917
005960     IF NUR-GET < 1 OR > 12                                       I.960917
005970         GO TO ACP-040.                                           I.960917
005980     IF NUR-PEY < 1 OR > 31                                       I.960917
005990         GO TO ACP-040.                                           I.960917
006000*
006010     IF NUR-NEN2 >= DATE-NF1 AND <= DATE-NT1                      I.970714
006020         ADD DATE-NC1 TO NUR-NEN.                                 I.970714
006030     IF NUR-NEN2 >= DATE-NF2 AND <= DATE-NT2                      I.970714
006040         ADD DATE-NC2 TO NUR-NEN.                                 I.970714
006050     IF NUR-NG NOT = W-HNG AND W-KNG                              I.960917
006060         DISPLAY E-ME3 E-ME98                                     I.960917
006070         GO TO ACP-040.                                           I.960917
006080 ACP-060.                                                         I.960917
006090     ACCEPT A-NC.                                                 I.960917
006100     DISPLAY E-CL.                                                I.960917
006110     IF ESTAT = BTB                                               I.960917
006120         GO TO ACP-040.                                           I.960917
006130     IF ESTAT NOT = HTB AND SKP                                   I.960917
006140         GO TO ACP-060.                                           I.960917
006150*
006160     MOVE SPACE TO HKB-KEY.                                       I.960917
006170     MOVE "31" TO HKB-NO.                                         I.960917
006180     MOVE NUR-NC1 TO HKB-NKC1.                                    I.960917
006190     READ HKBM WITH UNLOCK INVALID KEY                            I.960917
006200         DISPLAY E-ME4 E-ME98                                     I.960917
006210         GO TO ACP-060.                                           I.960917
006220     IF NUR-NC2 NOT = 0 AND 8 AND 9                               I.960917
006230         GO TO ACP-060.                                           I.960917
006240     IF NUR-NC = "78" OR "98"                                     I.960917
006250         GO TO ACP-060.                                           I.960917
006260     IF NUR-NC1 NOT = 7                                           I.960917
006270         IF NUR-NC2 = 9                                           I.960917
006280             GO TO ACP-060.                                       I.960917
006290     MOVE HKB-NKNA TO W-NKNA.                                     I.991223
006300     DISPLAY D-NN.                                                I.960917
006310*
006320     IF NUR-NC = "60"                                             I.991223
006330         MOVE ZERO TO NUR-TGK                                     I.991223
006340         DISPLAY S-TD                                             I.991223
006350         GO TO ACP-070.                                           I.991223
006360     MOVE 0 TO NUR-NSC.                                           I.991223
006370     DISPLAY S-NSC.                                               I.991223
006380     IF NUR-NC NOT = "30" AND "40"                                I.960917
006390         MOVE ZERO TO NUR-TGK                                     I.960917
006400         DISPLAY S-TD                                             I.960917
006410         GO TO ACP-100                                            I.991223
006420       ELSE                                                       I.991223
006430         GO TO ACP-080.                                           I.991223
006440*****    GO TO ACP-100.                                           D.991223
006450 ACP-070.                                                         I.991223
006460     ACCEPT A-NSC.                                                I.991223
006470     DISPLAY E-CL.                                                I.991223
006480     IF ESTAT = BTB                                               I.991223
006490         GO TO ACP-060.                                           I.991223
006500     IF ESTAT NOT = HTB AND SKP                                   I.991223
006510         GO TO ACP-070.                                           I.991223
006520*
006530     MOVE SPACE TO HKB-KEY.                                       I.991223
006540     MOVE "32" TO HKB-NO.                                         I.991223
006550     MOVE NUR-NSC TO HKB-NSC.                                     I.991223
006560     READ HKBM WITH UNLOCK INVALID KEY                            I.991223
006570         DISPLAY E-ME4 E-ME98                                     I.991223
006580         GO TO ACP-070.                                           I.991223
006590     MOVE HKB-NSNA TO W-NSNA.                                     I.991223
006600     DISPLAY D-NSNA.                                              I.991223
006610     GO TO ACP-100.                                               I.991223
006620 ACP-080.                                                         I.960917
006630     ACCEPT A-TD.                                                 I.960917
006640     IF ESTAT = BTB                                               I.960917
006650         GO TO ACP-060.                                           I.960917
006660     IF ESTAT NOT = HTB AND SKP                                   I.960917
006670         GO TO ACP-080.                                           I.960917
006680     IF NUR-TGG < 1 OR > 12                                       I.960917
006690         GO TO ACP-080.                                           I.960917
006700     IF NUR-TGP < 1 OR > 31                                       I.960917
006710         GO TO ACP-080.                                           I.960917
006720*
006730     MOVE ZERO TO NUR-TGN1.                                       I.970714
006740     IF NUR-TGN2 >= DATE-NF1 AND <= DATE-NT1                      I.970714
006750         ADD DATE-NC1 TO NUR-TGN.                                 I.970714
006760     IF NUR-TGN2 >= DATE-NF2 AND <= DATE-NT2                      I.970714
006770         ADD DATE-NC2 TO NUR-TGN.                                 I.970714
006780     IF NUR-TGK < NUR-DATE                                        I.960917
006790         GO TO ACP-080.                                           I.960917
006800 ACP-100.                                                         I.960917
006810     IF NUR-NC2 > 7                                               I.960917
006820         DISPLAY S-SS                                             I.960917
006830         MOVE ZERO TO NUR-SS                                      I.960917
006840         GO TO ACP-200.                                           I.960917
006850*
006860     ACCEPT A-SS.                                                 I.960917
006870     IF ESTAT = BTB                                               I.960917
006880         IF NUR-NC = "30" OR "40"                                 I.960917
006890             GO TO ACP-080                                        I.960917
006900           ELSE                                                   I.960917
006910             IF NUR-NC = "60"                                     I.991223
006920                 GO TO ACP-070                                    I.991223
006930               ELSE                                               I.991223
006940                 GO TO ACP-060.                                   I.960917
006950     IF ESTAT NOT = HTB AND SKP                                   I.960917
006960         GO TO ACP-100.                                           I.960917
006970*
006980     MOVE ZERO TO NUR-SSN1.                                       I.970714
006990     IF NUR-SS = ZERO                                             I.960917
007000         DISPLAY S-SS                                             I.960917
007010         GO TO ACP-200.                                           I.960917
007020     IF NUR-SSG < 1 OR > 12                                       I.960917
007030         GO TO ACP-100.                                           I.960917
007040     IF NUR-SSN2 >= DATE-NF1 AND <= DATE-NT1                      I.970714
007050         ADD DATE-NC1 TO NUR-SSN.                                 I.970714
007060     IF NUR-SSN2 >= DATE-NF2 AND <= DATE-NT2                      I.970714
007070         ADD DATE-NC2 TO NUR-SSN.                                 I.970714
007080     IF NUR-SS > NUR-NG                                           I.960917
007090         GO TO ACP-100.                                           I.960917
007100 ACP-200.                                                         I.960917
007110     ACCEPT A-DMM.                                                I.960917
007120     IF ESTAT = BTB                                               I.960917
007130         IF NUR-NC2 < 8                                           I.960917
007140             GO TO ACP-100.                                       I.960917
007150     IF ESTAT = BTB                                               I.960917
007160*****    IF NUR-NC = "30" OR "40"                                 D.991223
007170         IF NUR-NC1 = 3 OR 4                                      I.991223
007180             GO TO ACP-080                                        I.960917
007190           ELSE                                                   I.960917
007200             GO TO ACP-060.                                       I.960917
007210     IF ESTAT NOT = HTB AND SKP                                   I.960917
007220         GO TO ACP-200.                                           I.960917
007230     IF W-DMM = 9                                                 I.960917
007240         CLOSE NYUR-F                                             I.960917
007250         GO TO ACP-RTN.                                           I.960917
007260     IF W-DMM NOT = 1                                             I.960917
007270         GO TO ACP-200.                                           I.960917
007280 ACP-EX.                                                          I.960917
007290     EXIT.                                                        I.960917
007300*--------------  ＮＹＵＲＦ　ＲＥＷＲＩＴＥ　-----------------------------
007310 REW-RTN.                                                         I.960917
007320     REWRITE NYUR-R.                                              I.960917
007330     IF ERR-STAT NOT = "00"                                       I.960917
007340         DISPLAY E-STAT E-ME5 E-ME99                              I.960917
007350         MOVE 8 TO W-END.                                         I.960917
007360     CLOSE NYUR-F.                                                I.960917
007370 REW-EX.                                                          I.960917
007380     EXIT.                                                        I.960917
007390*--------------  ＮＹＵＲＹＲ　ＲＥＷＲＩＴＥ・ＷＲＩＴＥ　---------------
007400*NEN-RTN.                                                         D.991223
007410*****OPEN I-O NYUR-YR.                                            D.991223
007420*NEN-020.                                                         D.991223
007430*****READ NYUR-YR AT END                                          D.991223
007440*****    GO TO NEN-100.                                           D.991223
007450*****IF W-DNO NOT = NYUY-NO                                       D.991223
007460*****    GO TO NEN-020.                                           D.991223
007470*****MOVE NYUR-R TO NYUY-R.                                       D.991223
007480*****REWRITE NYUY-R.                                              D.991223
007490*****IF ERR-STAT NOT = "00"                                       D.991223
007500*****    DISPLAY E-STAT E-ME11 E-ME99                             D.991223
007510*****    MOVE 8 TO W-END.                                         D.991223
007520*****GO TO NEN-500.                                               D.991223
007530*NEN-100.                                                         D.991223
007540*****CLOSE NYUR-YR.                                               D.991223
007550*****OPEN EXTEND NYUR-YR.                                         D.991223
007560*NEN-120.                                                         D.991223
007570*****MOVE NYUR-R TO NYUY-R.                                       D.991223
007580*****WRITE NYUY-R.                                                D.991223
007590*****IF ERR-STAT = "00"                                           D.991223
007600*****    GO TO NEN-500.                                           D.991223
007610*****DISPLAY E-STAT E-ME10 E-ME99.                                D.991223
007620*****IF ERR-STAT NOT = "34"                                       D.991223
007630*****    DISPLAY E-ME78 E-ME99                                    D.991223
007640*****    MOVE 8 TO W-END                                          D.991223
007650*****    GO TO NEN-500.                                           D.991223
007660*****DISPLAY E-CL.                                                D.991223
007670*****CLOSE NYUR-YR.                                               D.991223
007680*****MOVE "NYURYR       " TO W-FILE.                              D.991223
007690*****DISPLAY E-ME71 E-ME98 STOP " ".                              D.991223
007700*****DISPLAY E-CL.                                                D.991223
007710*****OPEN EXTEND NYUR-YR.                                         D.991223
007720*****GO TO NEN-120.                                               D.991223
007730*NEN-500.                                                         D.991223
007740*****CLOSE NYUR-YR.                                               D.991223
007750*NEN-EX.                                                          D.991223
007760*****EXIT.                                                        D.991223
007770*--------------  ＫＫＢＭ　開放　-----------------------------------------
007780*KKB2-RTN.                                                        D.991223
007790*****OPEN I-O KKB-M.                                              D.991223
007800*****MOVE SPACE TO KKB-KEY.                                       D.991223
007810*****MOVE 90 TO KKB-NO.                                           D.991223
007820*****READ KKB-M INVALID KEY                                       D.991223
007830*****    DISPLAY E-ME78 E-ME7 E-ME99                              D.991223
007840*****    GO TO KKB2-EX.                                           D.991223
007850*****MOVE 0 TO KKB-SC04.                                          D.991223
007860*****REWRITE KKB-R INVALID KEY                                    D.991223
007870*****    DISPLAY E-ME78 E-STAT E-ME8 E-ME99                       D.991223
007880*****    DISPLAY E-ME90 E-ME99.                                   D.991223
007890*KKB2-EX.                                                         D.991223
007900*****EXIT.                                                        D.991223
