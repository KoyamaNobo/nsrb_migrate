000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMH500.
000030************************************************************
000040*    PROGRAM         :  履物製品　廃棄更新            　　 *
000050************************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT HAIKI ASSIGN TO HAIKI-MSD.
000130     SELECT HHTF ASSIGN TO HHT1-MSD HHT2-MSD
000140         ORGANIZATION INDEXED
000150         ACCESS MODE DYNAMIC
000160         RECORD KEY HHT-KEY
000170         ALTERNATE RECORD KEY HHT-KEY2
000180         FILE STATUS IS ERR-STAT.
000190     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000200         ORGANIZATION INDEXED
000210         ACCESS MODE DYNAMIC
000220         RECORD KEY HI-KEY
000230         ALTERNATE RECORD KEY HI-KEY2
000240         FILE STATUS IS ERR-STAT.
000250     SELECT HUH-M ASSIGN TO HUH-MSD
000260         ORGANIZATION INDEXED
000270         RECORD KEY HUH-KEY
000280         ACCESS MODE DYNAMIC
000290         FILE STATUS IS ERR-STAT.
000300 I-O-CONTROL.
000310     APPLY SHARED-MODE ON HI-M.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIHHTF.
000350     COPY LIHIM.
000360     COPY LIHUHM.
000370 FD  HAIKI
000380     BLOCK  4 RECORDS
000390     LABEL RECORD IS STANDARD
000400     VALUE OF IDENTIFICATION WK0064ID.
000410 01  HAI-R.
000420     02  HAI-KEY.
000430       03  HAI-HCD      PIC  9(006).
000440       03  HAI-SIZ      PIC  9(001).
000450     02  HAI-ASU.
000460       03  HAI-SUD   OCCURS  10.
000470         04  HAI-SU     PIC S9(005).
000480     02  F              PIC  X(007).
000490 WORKING-STORAGE SECTION.
000500 77  W-FILE             PIC  X(013).
000510 77  I                  PIC  9(002).
000520 77  WK0064ID           PIC  X(009) VALUE SPACE.
000530 01  STN-NO.
000540     02  STN-NO1        PIC  X(003).
000550     02  STN-NO2        PIC  X(003).
000560 01  W-FID.
000570     02  W-FID1         PIC  X(006) VALUE "WK0064".
000580     02  W-FID2         PIC  X(003).
000590 01  W-DATA.
000600     02  W-D.
000610       03  W-HCD        PIC  9(006).
000620       03  W-SU         PIC S9(006).
000630       03  W-KIN        PIC S9(009).
000640     02  CNT            PIC  9(002).
000650 01  ERR-STAT           PIC  X(002).
000660     COPY LWMSG.
000670 SCREEN SECTION.
000680 SD  C-CRT
000690     END STATUS IS ESTAT.
000700 01  C-CLEAR.
000710     02  C-CL    LINE   1  CLEAR SCREEN.
000720 01  C-MID.
000730     02  LINE   3  COLUMN  10  PIC  N(025) VALUE
000740          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000750     02  LINE   4  COLUMN  10  PIC  N(025) VALUE
000760          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000770     02  LINE   5  COLUMN  10  PIC  N(025) VALUE
000780          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
000790     02  LINE   6  COLUMN  10  PIC  N(025) VALUE
000800          NC"＊＊＊　　　　　履物　廃棄　セット　　　　　＊＊＊".
000810     02  LINE   7  COLUMN  10  PIC  N(025) VALUE
000820          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
000830     02  LINE   8  COLUMN  10  PIC  N(025) VALUE
000840          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000850     02  LINE   9  COLUMN  10  PIC  N(025) VALUE
000860          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000870 01  C-ERR.
000880     02  LINE  24.
000890       03  E-ME5   COLUMN  15  PIC  X(026) VALUE
000900            "***  HUHM REWRITE ｴﾗｰ  ***".
000910       03  E-ME6   COLUMN  15  PIC  X(018) VALUE
000920            "***  ｻﾞｲｺ ｴﾗｰ  ***".
000930       03  E-ME7   COLUMN  15  PIC  X(017) VALUE
000940            "***  HUHM ﾅｼ  ***".
000950       03  E-ME8   COLUMN  15  PIC  X(016) VALUE
000960            "***  HIM ﾅｼ  ***".
000970       03  E-ME10  COLUMN  15  PIC  X(017) VALUE
000980            "***  HHTF ﾅｼ  ***".
000990       03  E-ME11  COLUMN  15  PIC  X(026) VALUE
001000            "***  HHTF REWRITE ｴﾗ-  ***".
001010       03  E-HHTF  COLUMN  50  PIC  X(007) FROM  HHT-KEY.
001020       03  E-HUHM  COLUMN  50  PIC  X(006) FROM  HUH-KEY.
001030     COPY LSSEM.
001040 PROCEDURE DIVISION.
001050 M-05.
001060     DISPLAY C-CLEAR.
001070     DISPLAY C-MID.
001080     CALL "CBLSTNNO" USING STN-NO.
001090     MOVE STN-NO2 TO W-FID2.
001100     MOVE W-FID TO WK0064ID.
001110     OPEN INPUT HAIKI.
001120     OPEN I-O HHTF HUH-M.
001130     OPEN INPUT HI-M.
001140 M-15.
001150     READ HAIKI AT END
001160         GO TO M-95.
001170     MOVE HAI-KEY TO HHT-KEY.
001180     READ HHTF INVALID KEY
001190         DISPLAY E-ME10 E-HHTF E-ME99
001200         GO TO M-30.
001210     MOVE ZERO TO CNT.
001220 M-20.
001230     ADD 1 TO CNT.
001240     IF CNT = 11
001250         GO TO M-25.
001260     IF HAI-SU(CNT) = ZERO
001270         GO TO M-20.
001280     COMPUTE HHT-ZSU(CNT) = HHT-ZSU(CNT) - HAI-SU(CNT).
001290     MOVE HHT-ZSU(CNT) TO HHT-TZS(CNT).
001300     GO TO M-20.
001310 M-25.
001320     REWRITE HHT-R INVALID KEY
001330         MOVE 255 TO COMPLETION-CODE
001340         DISPLAY E-ME78 E-STAT E-ME11 E-HHTF E-ME99
001350         GO TO M-95.
001360 M-30.
001370     MOVE HAI-HCD TO HI-KEY.
001380     READ HI-M WITH UNLOCK INVALID KEY
001390         DISPLAY E-ME8 E-HHTF E-ME99
001400         MOVE ZERO TO HI-FT
001410         DISPLAY E-CL.
001420     COMPUTE W-SU = HAI-SU(01) + HAI-SU(02) + HAI-SU(03)
001430                  + HAI-SU(04) + HAI-SU(05) + HAI-SU(06)
001440                  + HAI-SU(07) + HAI-SU(08) + HAI-SU(09)
001450                  + HAI-SU(10).
001460*
001470     MOVE HAI-HCD TO HUH-KEY.
001480     READ HUH-M INVALID KEY
001490         DISPLAY E-ME7 E-HUHM E-ME99
001500         GO TO M-15.
001510     COMPUTE HUH-YS = HUH-YS - W-SU.
001520     COMPUTE HUH-YK = HUH-YS * HI-FT.
001530     COMPUTE HUH-ZS = HUH-ZS - W-SU.                              I.170407
001540     COMPUTE HUH-ZK = HUH-ZS * HI-FT.                             I.170407
001550*****MOVE HUH-YS TO HUH-ZS.                                       D.170407
001560*****MOVE HUH-YK TO HUH-ZK.                                       D.170407
001570     REWRITE HUH-R INVALID KEY
001580         MOVE 255 TO COMPLETION-CODE
001590         DISPLAY E-ME78 E-STAT E-ME5 E-HUHM E-ME99
001600         GO TO M-95.
001610     GO TO M-15.
001620 M-95.
001630     CLOSE HHTF HUH-M.
001640     CLOSE HAIKI.
001650     CLOSE HI-M.
001660     DISPLAY C-CLEAR.
001670     STOP RUN.
