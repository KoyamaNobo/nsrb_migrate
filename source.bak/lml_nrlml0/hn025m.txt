000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HN025M.
000030*************************************************************
000040*    PROGRAM         :  履物得意先品名単価　問合せ（出荷用）*
000050*    SCREEN          :  SH015M                              *
000060*    COMPILE TYPE    :  COBOL                               *
000070*************************************************************
000080 ENVIRONMENT DIVISION.
000090 CONFIGURATION SECTION.
000100 SOURCE-COMPUTER. SYSTEM3100.
000110 OBJECT-COMPUTER. SYSTEM3100.
000120 INPUT-OUTPUT SECTION.
000130 FILE-CONTROL.
000140     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000150         ORGANIZATION INDEXED
000160         ACCESS MODE RANDOM
000170         RECORD KEY T-KEY
000180         ALTERNATE RECORD KEY T-KEY2.
000190     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000200         ORGANIZATION INDEXED
000210         ACCESS MODE RANDOM
000220         RECORD KEY HI-KEY
000230         ALTERNATE RECORD KEY HI-KEY2.
000240     SELECT THTM ASSIGN TO THT1-MSD THT2-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE DYNAMIC
000270         RECORD KEY THT-KEY
000280         ALTERNATE RECORD KEY THT-KEY2
000290         FILE STATUS IS ERR-STAT.
000300 I-O-CONTROL.
000310     APPLY SHARED-MODE ON T-M
000320     APPLY SHARED-MODE ON THTM
000330     APPLY SHARED-MODE ON HI-M.
000340 DATA DIVISION.
000350 FILE SECTION.
000360     COPY LITM.
000370     COPY LIHIM.
000380     COPY LIDTHT.
000390 WORKING-STORAGE SECTION.
000400 77  W-FILE             PIC  X(013).
000410 01  ERR-STAT           PIC  X(002).
000420 01  W-DATA.
000430     02  CHK            PIC  9(001).
000440     02  W-END          PIC  9(001).
000450     02  W-SEN          PIC  9(001).
000460     02  W-L            PIC  9(002).
000470     02  W-TCD          PIC  9(004).
000480     02  W-HCD          PIC  9(006).
000490     02  W-DMM          PIC  9(001).
000500     COPY LSTAT.
000510 SCREEN SECTION.
000520 SD  C-CRT
000530     END STATUS IS ESTAT.
000540 01  C-CLEAR.
000550     02  LINE   1  CLEAR SCREEN.
000560 01  C-ACP.
000570     02  A-SEN   LINE   3  COLUMN  54  PIC  9(001)
000580          USING W-SEN   CHECK OVERFLOW NO IFC.
000590*
000600     02  LINE   5.
000610       03  A-TCD1   COLUMN   8  PIC  9(004)
000620            USING W-TCD   CHECK OVERFLOW NO IFC.
000630       03  A-HCD1   COLUMN   8  PIC  9(006)
000640            USING W-HCD   CHECK OVERFLOW NO IFC.
000650     02  LINE   8.
000660       03  A-TCD2   COLUMN   4  PIC  9(004)
000670            USING W-TCD   CHECK OVERFLOW NO IFC.
000680       03  A-HCD2   COLUMN   3  PIC  9(006)
000690            USING W-HCD   CHECK OVERFLOW NO IFC.
000700     02  A-DMM   LINE  23  COLUMN  67  PIC  9(001)
000710          USING W-DMM   CHECK OVERFLOW NO IFC.
000720 01  C-DSP.
000730     02  D-MEC.
000740       03  LINE   5  COLUMN  15  PIC  X(006) VALUE "      ".
000750       03  LINE   7  COLUMN  10  PIC  X(014) VALUE
000760            "              ".
000770     02  D-ME1.
000780       03  LINE   5.
000790         04  COLUMN  12  PIC  X(002) VALUE "  ".
000800         04  COLUMN  15  PIC  N(003) VALUE NC"得意先".
000810       03  LINE   7  COLUMN  10  PIC  N(007) VALUE
000820            NC"品　　　　　名".
000830     02  D-ME2.
000840       03  LINE   5  COLUMN  15  PIC  N(003) VALUE NC"品　名".
000850       03  LINE   7  COLUMN  10  PIC  N(007) VALUE
000860            NC"得　意　先　名".
000870     02  LINE   5.
000880       03  D-TNA    COLUMN  22  PIC  N(026) FROM  T-NAME.
000890       03  D-HNA    COLUMN  22  PIC  N(024) FROM  HI-NAME.
000900     02  LINE W-L.
000910       03  D-MEIH.
000920         04  COLUMN   3  PIC  9(006) FROM  THT-HCD.
000930         04  COLUMN  10  PIC  N(024) FROM  HI-NAME.
000940         04  COLUMN  65  PIC  9(001) FROM  THT-SIZ.
000950         04  COLUMN  68  PIC  Z(005) FROM  THT-T.
000960         04  COLUMN  74  PIC  Z(005) FROM  THT-TT.
000970       03  D-MEIT.
000980         04  COLUMN   4  PIC  9(004) FROM  THT-TCD.
000990         04  COLUMN  10  PIC  N(026) FROM  T-NAME.
001000         04  COLUMN  65  PIC  9(001) FROM  THT-SIZ.
001010         04  COLUMN  68  PIC  Z(005) FROM  THT-T.
001020         04  COLUMN  74  PIC  Z(005) FROM  THT-TT.
001030       03  D-SPC.
001040         04  COLUMN   1  PIC  X(040) VALUE
001050              "                                        ".
001060         04  COLUMN  41  PIC  X(040) VALUE
001070              "                                        ".
001080 01  C-ERR.
001090     02  LINE  24.
001100       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001110            "***  ﾄｸｲｻｷ ﾅｼ  ***".
001120       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001130            "***  ﾋﾝﾒｲ ﾅｼ  ***".
001140       03  E-ME3   COLUMN  15  PIC  X(017) VALUE
001150            "***  DATA ﾅｼ  ***".
001160       03  E-ME9   COLUMN  15  PIC  N(008) VALUE
001170            NC"ＥＮＤ　ＤＡＴＡ".
001180     COPY LSSEM.
001190 PROCEDURE DIVISION.
001200 M-05.
001210     DISPLAY C-CLEAR.
001220     CALL "SH015M".
001230     DISPLAY D-MEC.
001240     OPEN INPUT THTM T-M HI-M.
001250 M-10.
001260     ACCEPT A-SEN.
001270     IF ESTAT = PF9
001280         GO TO M-90.
001290     IF ESTAT NOT = HTB AND SKP
001300         GO TO M-10.
001310     IF W-SEN = 9
001320         GO TO M-90.
001330     IF W-SEN NOT = 1 AND 2
001340         GO TO M-10.
001350 M-15.
001360     IF W-SEN = 1
001370         DISPLAY D-ME1.
001380     IF W-SEN = 2
001390         DISPLAY D-ME2
001400         GO TO M-50.
001410 M-20.
001420     ACCEPT A-TCD1.
001430     DISPLAY E-CL.
001440     IF ESTAT = PF9
001450         GO TO M-90.
001460     IF ESTAT = BTB
001470         GO TO M-10.
001480     IF ESTAT NOT = HTB AND SKP
001490         GO TO M-20.
001500*
001510     MOVE W-TCD TO T-KEY.
001520     READ T-M WITH UNLOCK INVALID KEY
001530         DISPLAY E-ME1
001540         GO TO M-20.
001550     DISPLAY D-TNA.
001560*
001570     MOVE SPACE TO THT-KEY.
001580     MOVE W-TCD TO THT-TCD.
001590 M-25.
001600     START THTM KEY NOT < THT-KEY INVALID KEY
001610         DISPLAY E-ME3
001620         GO TO M-20.
001630     READ THTM NEXT RECORD WITH UNLOCK AT END
001640         DISPLAY E-ME3
001650         GO TO M-20.
001660     IF W-TCD NOT = THT-TCD
001670         DISPLAY E-ME3
001680         GO TO M-20.
001690 M-30.
001700     MOVE 0 TO W-END.
001710     MOVE 7 TO W-L.
001720 M-35.
001730     ADD 1 TO W-L.
001740     IF W-L = 22
001750         GO TO M-40.
001760     MOVE THT-HCD TO HI-KEY.
001770     READ HI-M WITH UNLOCK INVALID KEY
001780         MOVE SPACE TO HI-NAME
001790         MOVE NC"＊　品名　なし　＊" TO HI-NAME.
001800     DISPLAY D-MEIH.
001810*
001820     READ THTM NEXT RECORD WITH UNLOCK AT END
001830         MOVE 1 TO W-END
001840         DISPLAY E-ME9
001850         GO TO M-40.
001860     IF W-TCD NOT = THT-TCD
001870         MOVE 1 TO W-END
001880         DISPLAY E-ME9
001890         GO TO M-40.
001900     GO TO M-35.
001910 M-40.
001920     ACCEPT A-DMM.
001930     IF ESTAT = PF9
001940         GO TO M-90.
001950     IF ESTAT = BTB
001960         PERFORM CLE-RTN THRU CLE-EX
001970         GO TO M-45.
001980     IF ESTAT NOT = HTB
001990         GO TO M-40.
002000     IF W-END = 1
002010         DISPLAY C-CLEAR
002020         CALL "SH015M"
002030         DISPLAY A-SEN
002040         GO TO M-15.
002050     PERFORM CLE-RTN THRU CLE-EX.
002060     GO TO M-30.
002070 M-45.
002080     ACCEPT A-HCD2.
002090     IF ESTAT = PF9
002100         GO TO M-90.
002110     IF ESTAT = BTB
002120         GO TO M-20.
002130     IF ESTAT NOT = HTB AND SKP
002140         GO TO M-45.
002150*
002160     MOVE SPACE TO THT-KEY.
002170     MOVE W-TCD TO THT-TCD.
002180     MOVE W-HCD TO THT-HCD.
002190     GO TO M-25.
002200 M-50.
002210     ACCEPT A-HCD1.
002220     DISPLAY E-CL.
002230     IF ESTAT = PF9
002240         GO TO M-90.
002250     IF ESTAT = BTB
002260         GO TO M-10.
002270     IF ESTAT NOT = HTB AND SKP
002280         GO TO M-50.
002290*
002300     MOVE W-HCD TO HI-KEY.
002310     READ HI-M WITH UNLOCK INVALID KEY
002320         DISPLAY E-ME2
002330         GO TO M-50.
002340     DISPLAY D-HNA.
002350*
002360     MOVE 0 TO CHK.
002370     MOVE SPACE TO THT-KEY2.
002380     MOVE W-HCD TO THT-HCD.
002390 M-55.
002400     START THTM KEY NOT < THT-KEY2 INVALID KEY
002410         DISPLAY E-ME3
002420         GO TO M-50.
002430 M-57.
002440     READ THTM NEXT RECORD WITH UNLOCK AT END
002450         DISPLAY E-ME3
002460         GO TO M-50.
002470     IF W-HCD NOT = THT-HCD
002480         DISPLAY E-ME3
002490         GO TO M-50.
002500     IF CHK = 1
002510         IF W-TCD > THT-TCD2
002520             GO TO M-57.
002530 M-60.
002540     MOVE 0 TO W-END.
002550     MOVE 7 TO W-L.
002560 M-65.
002570     ADD 1 TO W-L.
002580     IF W-L = 22
002590         GO TO M-70.
002600     MOVE THT-TCD TO T-KEY.
002610     READ T-M WITH UNLOCK INVALID KEY
002620         MOVE SPACE TO T-NAME
002630         MOVE NC"＊　得意先　なし　＊" TO T-NAME.
002640     DISPLAY D-MEIT.
002650*
002660     READ THTM NEXT RECORD WITH UNLOCK AT END
002670         MOVE 1 TO W-END
002680         DISPLAY E-ME9
002690         GO TO M-70.
002700     IF W-HCD NOT = THT-HCD
002710         MOVE 1 TO W-END
002720         DISPLAY E-ME9
002730         GO TO M-70.
002740     GO TO M-65.
002750 M-70.
002760     ACCEPT A-DMM.
002770     IF ESTAT = PF9
002780         GO TO M-90.
002790     IF ESTAT = BTB
002800         PERFORM CLE-RTN THRU CLE-EX
002810         GO TO M-75.
002820     IF ESTAT NOT = HTB
002830         GO TO M-70.
002840     IF W-END = 1
002850         DISPLAY C-CLEAR
002860         CALL "SH015M"
002870         DISPLAY A-SEN
002880         GO TO M-15.
002890     PERFORM CLE-RTN THRU CLE-EX.
002900     GO TO M-60.
002910 M-75.
002920     ACCEPT A-TCD2.
002930     IF ESTAT = PF9
002940         GO TO M-90.
002950     IF ESTAT = BTB
002960         GO TO M-50.
002970     IF ESTAT NOT = HTB AND SKP
002980         GO TO M-75.
002990*
003000     MOVE 1 TO CHK.
003010     MOVE SPACE TO THT-KEY2.
003020     MOVE W-HCD TO THT-HCD.
003030     GO TO M-55.
003040 M-90.
003050     CLOSE THTM T-M HI-M.
003060 M-95.
003070     DISPLAY C-CLEAR.
003080     STOP RUN.
003090 CLE-RTN.
003100     MOVE 7 TO W-L.
003110 CLE-020.
003120     ADD 1 TO W-L.
003130     IF W-L NOT = 22
003140         DISPLAY D-SPC
003150         GO TO CLE-020.
003160     DISPLAY E-CL.
003170 CLE-EX.
003180     EXIT.
