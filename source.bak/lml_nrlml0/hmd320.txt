000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMD320.
000030*********************************************************
000040*    PROGRAM         :  倉庫間移動入力　　　　　　　　  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCHD32                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY IS HI-KEY
000200         ALTERNATE RECORD KEY IS HI-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT JCON ASSIGN TO JCON-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE IS RANDOM
000250         RECORD KEY IS JCON3-KEY
000260         FILE STATUS IS ERR-STAT.
000270     SELECT HSKIF ASSIGN TO HSKIF-MSD.
000280     SELECT SP-F ASSIGN TO P-PRN999.
000290 I-O-CONTROL.
000300     APPLY SHARED-MODE ON M-DATE
000310     APPLY SHARED-MODE ON HI-M
000320     APPLY SHARED-MODE ON JCON
000330     APPLY SHIFT-CODE  ON SP-F.
000340 DATA DIVISION.
000350 FILE SECTION.
000360     COPY LIBFDD.
000370     COPY LIHIM.
000380     COPY L-JCON.
000390     COPY LSPF.
000400 FD  HSKIF
000410     BLOCK  3 RECORDS
000420     LABEL RECORD IS STANDARD
000430     VALUE OF IDENTIFICATION "HSKIF".
000440 01  HSKI-R.
000450     02  HSKI-NO        PIC  9(007).                              受入№
000460     02  HSKI-NOD   REDEFINES HSKI-NO.
000470       03  HSKI-UNO     PIC  9(006).
000480       03  HSKI-GYO     PIC  9(001).
000490     02  HSKI-DATE      PIC  9(008).
000500     02  HSKI-NGPD  REDEFINES HSKI-DATE.
000510       03  HSKI-NG      PIC  9(006).
000520       03  F            PIC  9(002).
000530     02  HSKI-NGP   REDEFINES HSKI-DATE.
000540       03  F            PIC  9(002).
000550       03  HSKI-NGPS    PIC  9(006).
000560     02  HSKI-HCD       PIC  9(006).
000570     02  HSKI-SIZ       PIC  9(001).                              ｻｲｽﾞ区分
000580     02  HSKI-SUD.                                                数量
000590       03  HSKI-SU      PIC S9(005)  OCCURS  10.
000600     02  HSKI-SKC       PIC  9(001).                              倉庫C
000610     02  HSKI-IDC       PIC  9(001).
000620     02  F              PIC  X(009).
000630     02  HSKI-PRN       PIC  9(001).
000640     02  HSKI-UPD       PIC  9(001).
000650 WORKING-STORAGE SECTION.
000660 77  W-FILE             PIC  X(013).
000670 77  ERR-STAT           PIC  X(002).
000680 77  W-POC              PIC  9(001) VALUE 0.
000690 77  W-IPC              PIC  9(001) VALUE 0.
000700 01  HEAD1.
000710     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000720     02  F              PIC  X(043) VALUE SPACE.
000730     02  F              PIC  N(021) VALUE
000740          NC"＊＊＊　　倉庫間移動　入力リスト　　＊＊＊".
000750     02  F              PIC  X(029) VALUE SPACE.
000760     02  F              PIC  X(005) VALUE "DATE ".
000770     02  H-DATE         PIC 99B99B99.
000780     02  F              PIC  X(007) VALUE "     P.".
000790     02  H-PAGE         PIC Z9.
000800 01  HEAD2.
000810     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000820     02  F              PIC  X(001) VALUE SPACE.
000830     02  F              PIC  N(004) VALUE NC"日　　付".
000840     02  F              PIC  X(003) VALUE SPACE.
000850     02  F              PIC  N(004) VALUE NC"倉　　庫".
000860     02  F              PIC  X(120) VALUE SPACE.
000870 01  HEAD3.
000880     02  F              PIC  X(004) VALUE SPACE.
000890     02  F              PIC  N(004) VALUE NC"　伝票№".
000900     02  F              PIC  X(001) VALUE "-".
000910     02  F              PIC  N(002) VALUE NC"行　".
000920     02  F              PIC  X(006) VALUE "ｺｰﾄﾞ  ".
000930     02  F              PIC  N(008) VALUE NC"品　　　　　名　".
000940     02  F              PIC  X(025) VALUE SPACE.
000950     02  F              PIC  X(001) VALUE "1".
000960     02  F              PIC  X(004) VALUE SPACE.
000970     02  F              PIC  N(002) VALUE NC"３号".
000980     02  F              PIC  X(004) VALUE SPACE.
000990     02  F              PIC  N(002) VALUE NC"２号".
001000     02  F              PIC  X(004) VALUE SPACE.
001010     02  F              PIC  N(002) VALUE NC"１号".
001020     02  F              PIC  X(004) VALUE SPACE.
001030     02  F              PIC  N(002) VALUE NC"０号".
001040     02  F              PIC  X(004) VALUE SPACE.
001050     02  F              PIC  N(002) VALUE NC"　中".
001060     02  F              PIC  X(004) VALUE SPACE.
001070     02  F              PIC  N(002) VALUE NC"　大".
001080     02  F              PIC  X(004) VALUE SPACE.
001090     02  F              PIC  N(002) VALUE NC"特大".
001100     02  F              PIC  X(021) VALUE
001110          "   28.0   29.0   30.0".
001120     02  F              PIC  X(008) VALUE SPACE.
001130 01  HEAD4.
001140     02  F              PIC  X(057) VALUE SPACE.
001150     02  F              PIC  X(039) VALUE
001160          "2   12.5   13.0   13.5   14.0   15.0   ".
001170     02  F              PIC  X(032) VALUE
001180          "16.0   17.0   18.0   19.0   20.0".
001190     02  F              PIC  X(008) VALUE SPACE.
001200 01  HEAD5.
001210     02  F              PIC  X(057) VALUE SPACE.
001220     02  F              PIC  X(039) VALUE
001230          "3   21.0   21.5   22.0   22.5   23.0   ".
001240     02  F              PIC  X(032) VALUE
001250          "23.5   24.0   24.5   25.0       ".
001260     02  F              PIC  X(008) VALUE SPACE.
001270 01  HEAD6.
001280     02  F              PIC  X(057) VALUE SPACE.
001290     02  F              PIC  X(039) VALUE
001300          "4   24.0   24.5   25.0   25.5   26.0   ".
001310     02  F              PIC  X(032) VALUE
001320          "26.5   27.0   27.5              ".
001330     02  F              PIC  X(005) VALUE SPACE.
001340     02  F              PIC  N(002) VALUE NC"合計".
001350 01  W-P1.
001360     02  P-DATE         PIC 99/99/99.
001370     02  F              PIC  X(002).
001380     02  P-SKC          PIC  9(001).
001390     02  F              PIC  X(001).
001400     02  P-SKN          PIC  N(006).
001410     02  F              PIC  X(115).
001420 01  W-P2.
001430     02  F              PIC  X(004).
001440     02  P-UNO          PIC  9(006).
001450     02  P-V            PIC  X(001).
001460     02  P-GYO          PIC  9(001).
001470     02  F              PIC  X(001).
001480     02  P-HCD          PIC  9(006).
001490     02  F              PIC  X(001).
001500     02  P-NAME         PIC  N(024).
001510     02  F              PIC  X(001).
001520     02  P-SIZ          PIC  9(001).
001530     02  P-SU           PIC ---,---       OCCURS  10.
001540     02  P-TSU          PIC ----,--9.
001550 01  W-ID.
001560     02  W-NGP          PIC  9(008).
001570     02  W-NGPD  REDEFINES W-NGP.
001580       03  W-NG.
001590         04  W-NEN      PIC  9(004).
001600         04  W-NENL  REDEFINES W-NEN.
001610           05  W-NEN1   PIC  9(002).
001620           05  W-NEN2   PIC  9(002).
001630         04  W-GET      PIC  9(002).
001640       03  W-PEY        PIC  9(002).
001650     02  W-NGPSD REDEFINES W-NGP.
001660       03  F            PIC  9(002).
001670       03  W-NGPS       PIC  9(006).
001680     02  W-IDM          PIC  9(001).
001690     02  W-IDS          PIC  9(001).
001700     02  W-AMEI.
001710       03  W-MEID  OCCURS   6.
001720         04  W-HCD      PIC  9(006).
001730         04  W-SIZ      PIC  9(001).
001740         04  W-ASUD.
001750           05  W-SUD   OCCURS  10.
001760             06  W-SU   PIC S9(005).
001770         04  W-GSU      PIC S9(006).
001780     02  W-SUT          PIC S9(006).
001790 01  W-DATA.
001800     02  W-LC.
001810       03  W-L.
001820         04  W-L1       PIC  9(002).
001830         04  W-L2       PIC  9(002).
001840       03  W-C          PIC S9(002).
001850     02  W-UNO1         PIC  9(006).
001860     02  W-UNO2         PIC  9(006).
001870     02  W-GN           PIC  9(001).
001880     02  W-SIZD         PIC  9(001).
001890     02  CNT            PIC  9(002).
001900     02  CHK            PIC  9(001).
001910     02  W-SEN          PIC  9(001).
001920     02  W-SNGP         PIC  9(008).
001930     02  W-SDD   REDEFINES W-SNGP.
001940       03  F            PIC  9(002).
001950       03  W-SDAT       PIC  9(006).
001960     02  W-ENGP         PIC  9(008).
001970     02  W-EDD   REDEFINES W-ENGP.
001980       03  F            PIC  9(002).
001990       03  W-EDAT       PIC  9(006).
002000     02  W-SHCD         PIC  9(006).
002010     02  W-EHCD         PIC  9(006).
002020     02  W-DMM          PIC  9(001).
002030     02  W-SNG          PIC  9(006).
002040     02  W-ENG          PIC  9(006).
002050     02  W-TSU          PIC S9(006).
002060     02  W-PAGE         PIC  9(002).
002070     COPY LSTAT.
002080     COPY LWMSG.
002090 SCREEN SECTION.
002100 SD  C-CRT
002110     END STATUS IS ESTAT.
002120 01  C-CLEAR.
002130     02  LINE   1 CLEAR SCREEN.
002140 01  C-ACP.
002150     02  LINE   3.
002160       03  A-NGPS  COLUMN   7  PIC  9(006)
002170            USING W-NGPS  CHECK OVERFLOW NO IFC.
002180       03  A-IDM   COLUMN  26  PIC  9(001)
002190            USING W-IDM   CHECK OVERFLOW NO IFC.
002200       03  A-IDS   COLUMN  49  PIC  9(001)
002210            USING W-IDS   CHECK OVERFLOW NO IFC.
002220     02  LINE W-L1.
002230       03  A-HCD   COLUMN   2  PIC  9(006)
002240            USING W-HCD(W-GN)  CHECK OVERFLOW NO IFC.
002250     02  LINE W-L2.
002260       03  A-SIZ   COLUMN   2  PIC  9(001)
002270            USING W-SIZ(W-GN)  CHECK OVERFLOW NO IFC.
002280       03  A-SU    COLUMN W-C  PIC S9(005)
002290            USING W-SU(W-GN,CNT) CHECK OVERFLOW NO IFC.
002300*
002310     02  A-SEN   LINE   9  COLUMN  49  PIC  9(001)
002320          USING W-SEN   CHECK OVERFLOW NO IFC.
002330     02  LINE  12.
002340       03  A-SDAT  COLUMN  37  PIC  9(006)
002350            USING W-SDAT  CHECK OVERFLOW NO IFC.
002360       03  A-EDAT  COLUMN  47  PIC  9(006)
002370            USING W-EDAT  CHECK OVERFLOW NO IFC.
002380     02  LINE  14.
002390       03  A-SHCD  COLUMN  37  PIC  9(006)
002400            USING W-SHCD  CHECK OVERFLOW NO IFC.
002410       03  A-EHCD  COLUMN  47  PIC  9(006)
002420            USING W-EHCD  CHECK OVERFLOW NO IFC.
002430*
002440     02  A-DMM   LINE  23  COLUMN  60  PIC  9(001)
002450          USING W-DMM   CHECK OVERFLOW NO IFC.
002460 01  C-DSP.
002470     02  LINE   3.
002480       03  D-IDMN  COLUMN  28  PIC  N(006) FROM  JCON3-03.
002490       03  D-IDSN  COLUMN  51  PIC  N(006) FROM  JCON3-03.
002500     02  D-NAME  LINE W-L1 COLUMN   9  PIC  N(024) FROM  HI-NAME.
002510     02  LINE W-L2.
002520       03  D-SU    COLUMN W-C  PIC ZZZZZ-   FROM  W-SU(W-GN,CNT).
002530       03  D-GSU   COLUMN  74  PIC ZZZZZZ-  FROM  W-GSU(W-GN).
002540     02  D-SUT   LINE  21  COLUMN  74  PIC ZZZZZZ-  FROM  W-SUT.
002550     02  D-PRN.
002560       03  LINE   1  COLUMN  19  PIC  N(021) VALUE
002570            NC"＊＊＊　　倉庫間移動　入力リスト　　＊＊＊".
002580       03  LINE   9  COLUMN  27  PIC  X(045) VALUE
002590            "未印字分  YES=1 NO=9  1 ﾘﾀｰﾝ        終了=ｆ･9".
002600       03  LINE  12  COLUMN  27  PIC  X(026) VALUE
002610            "日　付    000000 ～ 999999".
002620       03  LINE  14  COLUMN  27  PIC  X(026) VALUE
002630            "品名ｺｰﾄﾞ  000000 ～ 999999".
002640       03  LINE  23  COLUMN  41  PIC  X(025) VALUE
002650            "確認(OK=1,NO=9)-->   ﾘﾀｰﾝ".
002660 01  C-SPC.
002670     02  C-SPACE.
002680       03  C-HCD   LINE W-L1.
002690         04  COLUMN   1  PIC  X(040) VALUE
002700              "                                        ".
002710         04  COLUMN  41  PIC  X(040) VALUE
002720              "                                        ".
002730       03  C-MEI   LINE W-L2.
002740         04  COLUMN   1  PIC  X(040) VALUE
002750              "                                        ".
002760         04  COLUMN  41  PIC  X(040) VALUE
002770              "                                        ".
002780 01  C-ERR.
002790     02  LINE  24.
002800       03  E-ME1   COLUMN  15  PIC  X(016) VALUE
002810            "***  HIM ﾅｼ  ***".
002820       03  E-ME2   COLUMN  15  PIC  X(021) VALUE
002830            "***  PROGRAM ｴﾗｰ  ***".
002840       03  E-ME4   COLUMN  15  PIC  X(018) VALUE
002850            "***  日付 ｴﾗｰ  ***".
002860       03  E-ME6   COLUMN  15  PIC  N(011) VALUE
002870            NC"コントロールＦ　未登録".
002880       03  E-ME7   COLUMN  15  PIC  N(007) VALUE
002890            NC"倉庫名　未登録".
002900       03  E-ME8   COLUMN  15  PIC  N(009) VALUE
002910            NC"未更新データ　有り".
002920       03  E-ME9   COLUMN  15  PIC  N(008) VALUE
002930            NC"印刷データ　なし".
002940       03  E-ME11  COLUMN  15  PIC  X(019) VALUE
002950            "***  WRITE ｴﾗｰ  ***".
002960       03  E-ME12  COLUMN  15  PIC  X(027) VALUE
002970            "***  JCON ﾃﾞﾝﾋﾟｮｳNO ﾅｼ  ***".
002980       03  E-ME13  COLUMN  15  PIC  X(026) VALUE
002990            "***  JCON REWRITE ｴﾗｰ  ***".
003000     COPY LIBSCR.
003010     COPY LSSEM.
003020 PROCEDURE DIVISION.
003030 M-020.
003040     DISPLAY C-CLEAR.
003050     CALL "SCHD32".
003060*
003070     MOVE ZERO TO W-ID W-DATA.
003080     MOVE 1 TO W-SEN.                                             I.151103
003090     MOVE 999999 TO W-EDAT W-EHCD.                                I.151103
003100     OPEN I-O JCON.
003110     MOVE "6 " TO JCON6-KEY.
003120     READ JCON UNLOCK INVALID
003130         CLOSE JCON
003140         MOVE 255 TO COMPLETION-CODE
003150         DISPLAY E-ME6 E-ME99
003160         STOP RUN.
003170     MOVE JCON6-03 TO W-ENG.
003180     MOVE W-ENG TO W-NG.
003190     SUBTRACT 1 FROM W-GET.
003200     IF W-GET = ZERO
003210         SUBTRACT 1 FROM W-NEN
003220         MOVE 12 TO W-GET.
003230     MOVE W-NG TO W-SNG.
003240*
003250     MOVE "18" TO JCON5-KEY.
003260     READ JCON UNLOCK INVALID
003270         CLOSE JCON
003280         MOVE 255 TO COMPLETION-CODE
003290         DISPLAY E-ME6 E-ME99
003300         STOP RUN.
003310*
003320     OPEN INPUT HI-M.
003330     OPEN EXTEND HSKIF.
003340     COPY LIBCPR.
003350 M-220.
003360     ACCEPT A-NGPS.
003370     DISPLAY E-CL.
003380     IF ESTAT = PF9
003390         GO TO M-600.
003400     IF ESTAT NOT = HTB AND SKP
003410         GO TO M-220.
003420     IF W-NGPS = ZERO
003430         ACCEPT W-NGPS FROM DATE
003440         DISPLAY A-NGPS.
003450     IF W-GET < 1 OR > 12
003460         GO TO M-220.
003470     IF W-PEY < 1 OR > 31
003480         GO TO M-220.
003490     MOVE ZERO TO W-NEN1.
003500     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
003510         ADD DATE-NC1 TO W-NEN.
003520     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
003530         ADD DATE-NC2 TO W-NEN.
003540     IF W-NG NOT = W-SNG AND W-ENG
003550         DISPLAY E-ME4 E-ME98
003560         GO TO M-220.
003570 M-240.
003580     ACCEPT A-IDM.
003590     DISPLAY E-CL.
003600     IF ESTAT = BTB
003610         GO TO M-220.
003620     IF ESTAT NOT = HTB AND SKP
003630         GO TO M-240.
003640     MOVE 3 TO JCON3-01.
003650     MOVE W-IDM TO JCON3-02.
003660     READ JCON UNLOCK INVALID
003670         DISPLAY E-ME7
003680         GO TO M-240.
003690     DISPLAY D-IDMN.
003700 M-245.
003710     ACCEPT A-IDS.
003720     DISPLAY E-CL.
003730     IF ESTAT = BTB
003740         GO TO M-240.
003750     IF ESTAT NOT = HTB AND SKP
003760         GO TO M-245.
003770     MOVE 3 TO JCON3-01.
003780     MOVE W-IDS TO JCON3-02.
003790     READ JCON UNLOCK INVALID
003800         DISPLAY E-ME7
003810         GO TO M-245.
003820     DISPLAY D-IDSN.
003830     IF W-IDM = W-IDS
003840         GO TO M-245.
003850 M-260.
003860     MOVE 0 TO W-GN.
003870     MOVE 7 TO W-L1.
003880     MOVE 8 TO W-L2.
003890 M-270.
003900     ADD 1 TO W-GN.
003910     ADD 2 TO W-L1 W-L2.
003920     IF W-GN = 7
003930         GO TO M-460.
003940 M-280.
003950     ACCEPT A-HCD.
003960     DISPLAY E-CL.
003970     IF ESTAT = BTB
003980         GO TO M-440.
003990     IF ESTAT = ADV
004000         GO TO M-460.
004010     IF ESTAT NOT = HTB AND SKP
004020         GO TO M-280.
004030     MOVE W-HCD(W-GN) TO HI-KEY.
004040     READ HI-M WITH UNLOCK INVALID KEY
004050         DISPLAY E-ME1
004060         GO TO M-280.
004070     DISPLAY D-NAME.
004080     MOVE 0 TO HI-S(4,10).
004090 M-320.
004100     ACCEPT A-SIZ.
004110     DISPLAY E-CL.
004120     IF ESTAT = BTB
004130         GO TO M-280.
004140     IF ESTAT NOT = HTB AND SKP
004150         GO TO M-320.
004160     IF W-SIZ(W-GN) < 1 OR > 4
004170         GO TO M-320.
004180     MOVE W-SIZ(W-GN) TO W-SIZD.
004190     IF HI-SS(W-SIZD) = ZERO
004200         GO TO M-320.
004210*
004220     MOVE 0 TO CNT.
004230     MOVE -3 TO W-C.
004240 M-340.
004250     ADD 1 TO CNT.
004260     ADD 7 TO W-C.
004270     IF CNT = 11
004280         GO TO M-420.
004290     MOVE W-SIZ(W-GN) TO W-SIZD.
004300     IF HI-S(W-SIZD,CNT) = ZERO
004310         MOVE ZERO TO W-SU(W-GN,CNT)
004320         DISPLAY D-SU
004330         GO TO M-340.
004340 M-380.
004350     ACCEPT A-SU.
004360     DISPLAY E-CL.
004370     IF ESTAT = BTB
004380         GO TO M-400.
004390     IF ESTAT NOT = HTB AND SKP AND ADV
004400         GO TO M-380.
004410     DISPLAY D-SU.
004420     GO TO M-340.
004430 M-400.
004440     SUBTRACT 1 FROM CNT.
004450     SUBTRACT 7 FROM W-C.
004460     IF CNT = ZERO
004470         GO TO M-320.
004480     MOVE W-SIZ(W-GN) TO W-SIZD.
004490     IF HI-S(W-SIZD,CNT) = ZERO
004500         MOVE ZERO TO W-SU(W-GN,CNT)
004510         DISPLAY D-SU
004520         GO TO M-400.
004530     GO TO M-380.
004540 M-420.
004550     COMPUTE W-GSU(W-GN) = W-SU(W-GN,01) + W-SU(W-GN,02)
004560                         + W-SU(W-GN,03) + W-SU(W-GN,04)
004570                         + W-SU(W-GN,05) + W-SU(W-GN,06)
004580                         + W-SU(W-GN,07) + W-SU(W-GN,08)
004590                         + W-SU(W-GN,09) + W-SU(W-GN,10).
004600     DISPLAY D-GSU.
004610     IF ZERO = W-SU(W-GN,01) AND W-SU(W-GN,02) AND W-SU(W-GN,03)
004620           AND W-SU(W-GN,04) AND W-SU(W-GN,05) AND W-SU(W-GN,06)
004630           AND W-SU(W-GN,07) AND W-SU(W-GN,08) AND W-SU(W-GN,09)
004640           AND W-SU(W-GN,10)
004650         GO TO M-400.
004660     GO TO M-270.
004670 M-440.
004680     SUBTRACT 1 FROM W-GN.
004690     SUBTRACT 2 FROM W-L1 W-L2.
004700     IF W-GN = ZERO
004710         GO TO M-245.
004720     IF W-HCD(W-GN) = ZERO
004730         GO TO M-440.
004740     MOVE W-HCD(W-GN) TO HI-KEY.
004750     READ HI-M WITH UNLOCK INVALID KEY
004760         DISPLAY E-ME1.
004770     MOVE 0 TO HI-S(4,10).
004780     MOVE 11 TO CNT.
004790     MOVE 74 TO W-C.
004800     GO TO M-400.
004810 M-460.
004820     IF W-GN = 1
004830         GO TO M-280.
004840     IF W-GN < 7
004850         MOVE ZERO TO W-MEID(W-GN)
004860         DISPLAY C-SPACE
004870         ADD 1 TO W-GN
004880         ADD 2 TO W-L1 W-L2
004890         GO TO M-460.
004900     COMPUTE W-SUT = W-GSU(1) + W-GSU(2) + W-GSU(3) + W-GSU(4)
004910                                         + W-GSU(5) + W-GSU(6).
004920     DISPLAY D-SUT.
004930 M-500.
004940     ACCEPT A-DMM.
004950     DISPLAY E-CL.
004960     IF ESTAT = BTB
004970         GO TO M-440.
004980     IF ESTAT NOT = HTB AND SKP
004990         GO TO M-500.
005000     IF W-DMM = 9
005010         GO TO M-260.
005020     IF W-DMM NOT = 1
005030         GO TO M-500.
005040*
005050     PERFORM WRI-RTN THRU WRI-EX.
005060     IF COMPLETION-CODE = 255
005070         GO TO M-980.
005080*
005090     MOVE ZERO TO W-AMEI W-SUT W-GN.
005100     MOVE 7 TO W-L1.
005110     MOVE 8 TO W-L2.
005120 M-520.
005130     ADD 1 TO W-GN.
005140     ADD 2 TO W-L1 W-L2.
005150     IF W-GN < 7
005160         DISPLAY C-SPACE
005170         GO TO M-520.
005180     GO TO M-260.
005190 M-600.
005200     CLOSE HSKIF.
005210     OPEN I-O HSKIF.
005220     DISPLAY C-CLEAR.
005230     DISPLAY D-PRN.
005240 M-620.
005250     ACCEPT A-SEN.
005260     DISPLAY E-CL.
005270     IF ESTAT = PF9
005280         GO TO M-980.
005290     IF ESTAT NOT = HTB AND SKP
005300         GO TO M-620.
005310     IF W-SEN = 1
005320         MOVE ZERO TO W-SNGP W-SHCD
005330         MOVE 99999999 TO W-ENGP
005340         MOVE 999999 TO W-EHCD
005350         DISPLAY A-SDAT A-EDAT A-SHCD A-EHCD
005360         GO TO M-720.
005370     IF W-SEN NOT = 9
005380         GO TO M-620.
005390 M-640.
005400     ACCEPT A-SDAT.
005410     DISPLAY E-CL.
005420     IF ESTAT = BTB
005430         GO TO M-620.
005440     IF ESTAT NOT = HTB AND SKP
005450         GO TO M-640.
005460     IF W-SDAT = ZERO
005470         MOVE ZERO TO W-SNGP
005480         GO TO M-660.
005490     MOVE ZERO TO W-NEN1.
005500     MOVE W-SDAT TO W-NGPS.
005510     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
005520         ADD DATE-NC1 TO W-NEN.
005530     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
005540         ADD DATE-NC2 TO W-NEN.
005550     MOVE W-NGP TO W-SNGP.
005560 M-660.
005570     ACCEPT A-EDAT.
005580     DISPLAY E-CL.
005590     IF ESTAT = BTB
005600         GO TO M-640.
005610     IF ESTAT NOT = HTB AND SKP
005620         GO TO M-660.
005630     IF W-EDAT = 999999
005640         MOVE 99999999 TO W-ENGP
005650         GO TO M-680.
005660     MOVE ZERO TO W-NEN1.
005670     MOVE W-EDAT TO W-NGPS.
005680     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
005690         ADD DATE-NC1 TO W-NEN.
005700     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
005710         ADD DATE-NC2 TO W-NEN.
005720     MOVE W-NGP TO W-ENGP.
005730     IF W-SNGP > W-ENGP
005740         GO TO M-660.
005750 M-680.
005760     ACCEPT A-SHCD.
005770     DISPLAY E-CL.
005780     IF ESTAT = BTB
005790         GO TO M-660.
005800     IF ESTAT NOT = HTB AND SKP
005810         GO TO M-680.
005820 M-700.
005830     ACCEPT A-EHCD.
005840     DISPLAY E-CL.
005850     IF ESTAT = BTB
005860         GO TO M-680.
005870     IF ESTAT NOT = HTB AND SKP
005880         GO TO M-700.
005890     IF W-SHCD > W-EHCD
005900         GO TO M-700.
005910 M-720.
005920     ACCEPT A-DMM.
005930     DISPLAY E-CL.
005940     IF ESTAT = BTB
005950         IF W-SEN = 1
005960             GO TO M-620
005970           ELSE
005980             GO TO M-700.
005990     IF ESTAT NOT = HTB AND SKP
006000         GO TO M-720.
006010     IF W-DMM = 9
006020         GO TO M-620.
006030     IF W-DMM NOT = 1
006040         GO TO M-720.
006050 M-800.
006060     READ HSKIF AT END
006070         DISPLAY E-ME9 E-ME99
006080         GO TO M-980.
006090     IF HSKI-DATE < W-SNGP OR > W-ENGP
006100         GO TO M-800.
006110     IF HSKI-HCD < W-SHCD OR > W-EHCD
006120         GO TO M-800.
006130     IF W-SEN = 1
006140         IF HSKI-UPD NOT = 0
006150             GO TO M-800.
006160 M-820.
006170     MOVE 0 TO CHK.
006180     IF W-SEN = 1
006190         MOVE ZERO TO W-SUT.
006200     MOVE HSKI-UNO TO W-UNO1.
006210 M-840.
006220     PERFORM MEI-RTN THRU MEI-EX.
006230 M-860.
006240     READ HSKIF AT END
006250         GO TO M-980.
006260     IF HSKI-DATE < W-SNGP OR > W-ENGP
006270         GO TO M-860.
006280     IF HSKI-HCD < W-SHCD OR > W-EHCD
006290         GO TO M-860.
006300     IF W-SEN = 1
006310         IF HSKI-UPD NOT = 0
006320             GO TO M-860.
006330     IF HSKI-UNO = W-UNO1
006340         GO TO M-840.
006350     IF W-SEN = 1
006360         PERFORM KEI-RTN THRU KEI-EX.
006370     GO TO M-820.
006380 M-980.
006390     IF W-IPC = 0
006400         MOVE 255 TO COMPLETION-CODE.
006410     IF W-POC NOT = ZERO
006420         IF W-SEN = 9
006430             CLOSE SP-F
006440           ELSE
006450             PERFORM KEI-RTN THRU KEI-EX
006460             CLOSE SP-F.
006470     CLOSE HI-M.
006480     CLOSE JCON.                                                  I.030613
006490     CLOSE HSKIF.                                                 I.970110
006500     DISPLAY C-CLEAR.
006510     STOP RUN.
006520 WRI-RTN.
006530     MOVE ZERO TO W-UNO1 W-UNO2.
006540     MOVE "18" TO JCON5-KEY  ERR-K.
006550     READ JCON INVALID
006560         MOVE 255 TO COMPLETION-CODE
006570         DISPLAY E-ME12 E-ME99
006580         GO TO WRI-EX.
006590     ADD 1 TO JCON5-03.
006600     MOVE JCON5-03 TO W-UNO1.
006610     ADD 1 TO JCON5-03.
006620     MOVE JCON5-03 TO W-UNO2.
006630     REWRITE JCON5-R  INVALID
006640         MOVE 255 TO COMPLETION-CODE
006650         DISPLAY E-ME13 E-ME99
006660         GO TO WRI-EX.
006670     MOVE ZERO TO CHK.
006680 WRI-020.
006690     ADD 1 TO CHK.
006700     IF CHK = 3
006710         GO TO WRI-EX.
006720     MOVE ZERO TO W-GN.
006730 WRI-040.
006740     ADD 1 TO W-GN.
006750     IF W-GN = 7
006760         GO TO WRI-020.
006770     IF W-HCD(W-GN) = ZERO
006780         GO TO WRI-020.
006790 WRI-060.
006800     MOVE ZERO TO HSKI-R.
006810     MOVE W-GN TO HSKI-GYO.
006820     MOVE W-NGP TO HSKI-DATE.
006830     MOVE W-HCD(W-GN) TO HSKI-HCD.
006840     MOVE W-SIZ(W-GN) TO HSKI-SIZ.
006850     IF CHK = 1
006860         MOVE W-UNO1 TO HSKI-UNO
006870         MOVE W-SU(W-GN,01) TO HSKI-SU(01)
006880         MOVE W-SU(W-GN,02) TO HSKI-SU(02)
006890         MOVE W-SU(W-GN,03) TO HSKI-SU(03)
006900         MOVE W-SU(W-GN,04) TO HSKI-SU(04)
006910         MOVE W-SU(W-GN,05) TO HSKI-SU(05)
006920         MOVE W-SU(W-GN,06) TO HSKI-SU(06)
006930         MOVE W-SU(W-GN,07) TO HSKI-SU(07)
006940         MOVE W-SU(W-GN,08) TO HSKI-SU(08)
006950         MOVE W-SU(W-GN,09) TO HSKI-SU(09)
006960         MOVE W-SU(W-GN,10) TO HSKI-SU(10)
006970         MOVE W-IDS TO HSKI-SKC
006980         MOVE 1 TO HSKI-IDC
006990       ELSE
007000         MOVE W-UNO2 TO HSKI-UNO
007010         COMPUTE HSKI-SU(01) = -1 * W-SU(W-GN,01)
007020         COMPUTE HSKI-SU(02) = -1 * W-SU(W-GN,02)
007030         COMPUTE HSKI-SU(03) = -1 * W-SU(W-GN,03)
007040         COMPUTE HSKI-SU(04) = -1 * W-SU(W-GN,04)
007050         COMPUTE HSKI-SU(05) = -1 * W-SU(W-GN,05)
007060         COMPUTE HSKI-SU(06) = -1 * W-SU(W-GN,06)
007070         COMPUTE HSKI-SU(07) = -1 * W-SU(W-GN,07)
007080         COMPUTE HSKI-SU(08) = -1 * W-SU(W-GN,08)
007090         COMPUTE HSKI-SU(09) = -1 * W-SU(W-GN,09)
007100         COMPUTE HSKI-SU(10) = -1 * W-SU(W-GN,10)
007110         MOVE W-IDM TO HSKI-SKC.
007120     WRITE HSKI-R.
007130     IF ERR-STAT NOT = "00"
007140         DISPLAY E-STAT E-ME11 E-ME99
007150         GO TO WRI-100.
007160     IF W-IPC = 0
007170         MOVE 1 TO W-IPC.
007180     GO TO WRI-040.
007190 WRI-100.
007200     IF ERR-STAT NOT = "34"
007210         MOVE 255 TO COMPLETION-CODE
007220         DISPLAY E-ME78 E-ME99
007230         GO TO WRI-EX.
007240     DISPLAY E-CL.
007250     CLOSE HSKIF.
007260     MOVE "HSKIF        " TO W-FILE.
007270     DISPLAY E-ME71 E-ME98 STOP " ".
007280     DISPLAY E-CL.
007290     OPEN EXTEND HSKIF.
007300     GO TO WRI-060.
007310 WRI-EX.
007320     EXIT.
007330 MID-RTN.
007340     MOVE SPACE TO SP-R.
007350     WRITE SP-R AFTER PAGE.
007360 MID-010.
007370     ADD 1 TO W-PAGE.
007380     MOVE W-PAGE TO H-PAGE.
007390     MOVE SPACE TO SP-R.
007400     MOVE HEAD1 TO SP-R.
007410     WRITE SP-R.
007420     MOVE SPACE TO SP-R.
007430     MOVE HEAD2 TO SP-R.
007440     WRITE SP-R AFTER 2.
007450     MOVE SPACE TO SP-R.
007460     MOVE HEAD3 TO SP-R.
007470     WRITE SP-R.
007480     MOVE SPACE TO SP-R.
007490     MOVE HEAD4 TO SP-R.
007500     WRITE SP-R.
007510     MOVE SPACE TO SP-R.
007520     MOVE HEAD5 TO SP-R.
007530     WRITE SP-R.
007540     MOVE SPACE TO SP-R.
007550     MOVE HEAD6 TO SP-R.
007560     WRITE SP-R.
007570     MOVE SPACE TO SP-R.
007580 MID-EX.
007590     EXIT.
007600 MEI-RTN.
007610     IF W-POC = ZERO
007620         MOVE 5 TO W-POC
007630         OPEN OUTPUT SP-F
007640         ACCEPT H-DATE FROM DATE
007650         PERFORM MID-010 THRU MID-EX.
007660     IF CHK NOT = 0
007670         GO TO MEI-020.
007680     MOVE 1 TO CHK.
007690     MOVE 3 TO JCON3-01.
007700     MOVE HSKI-SKC TO JCON3-02.
007710     READ JCON UNLOCK INVALID
007720         MOVE SPACE TO JCON3-03.
007730*
007740     MOVE SPACE TO W-P1.
007750     MOVE SPACE TO P-SKN.
007760     MOVE HSKI-NGPS TO P-DATE.
007770     MOVE HSKI-SKC TO P-SKC.
007780     MOVE JCON3-03 TO P-SKN.
007790     IF LINAGE-COUNTER > 60
007800         PERFORM MID-RTN THRU MID-EX.
007810     MOVE SPACE TO SP-R.
007820     MOVE W-P1 TO SP-R.
007830     WRITE SP-R.
007840     MOVE SPACE TO SP-R.
007850 MEI-020.
007860     MOVE HSKI-HCD TO HI-KEY.
007870     READ HI-M WITH UNLOCK INVALID KEY
007880         MOVE SPACE TO HI-NAME.
007890     COMPUTE W-TSU = HSKI-SU(01) + HSKI-SU(02) + HSKI-SU(03)
007900                   + HSKI-SU(04) + HSKI-SU(05) + HSKI-SU(06)
007910                   + HSKI-SU(07) + HSKI-SU(08) + HSKI-SU(09)
007920                   + HSKI-SU(10).
007930     MOVE SPACE TO W-P2.
007940     MOVE SPACE TO P-NAME.
007950     IF CHK = 1
007960         MOVE 2 TO CHK
007970         MOVE HSKI-UNO TO P-UNO.
007980     MOVE "-" TO P-V.
007990     MOVE HSKI-GYO TO P-GYO.
008000     MOVE HSKI-HCD TO P-HCD.
008010     MOVE HI-NAME TO P-NAME.
008020     MOVE HSKI-SIZ TO P-SIZ.
008030     MOVE HSKI-SU(01) TO P-SU(01).
008040     MOVE HSKI-SU(02) TO P-SU(02).
008050     MOVE HSKI-SU(03) TO P-SU(03).
008060     MOVE HSKI-SU(04) TO P-SU(04).
008070     MOVE HSKI-SU(05) TO P-SU(05).
008080     MOVE HSKI-SU(06) TO P-SU(06).
008090     MOVE HSKI-SU(07) TO P-SU(07).
008100     MOVE HSKI-SU(08) TO P-SU(08).
008110     MOVE HSKI-SU(09) TO P-SU(09).
008120     MOVE HSKI-SU(10) TO P-SU(10).
008130     MOVE W-TSU TO P-TSU.
008140     IF LINAGE-COUNTER > 61
008150         MOVE HSKI-UNO TO P-UNO
008160         PERFORM MID-RTN THRU MID-EX
008170         MOVE SPACE TO SP-R
008180         MOVE W-P1 TO SP-R
008190         WRITE SP-R
008200         MOVE SPACE TO SP-R.
008210     MOVE W-P2 TO SP-R.
008220     WRITE SP-R.
008230     MOVE SPACE TO SP-R.
008240     IF W-SEN = 1
008250         ADD W-TSU TO W-SUT.
008260*
008270     MOVE 1 TO HSKI-PRN.
008280     REWRITE HSKI-R.
008290 MEI-EX.
008300     EXIT.
008310 KEI-RTN.
008320     IF CHK NOT = 2
008330         GO TO KEI-EX.
008340     MOVE SPACE TO W-P2.
008350     MOVE SPACE TO P-NAME.
008360     MOVE NC"　　　　　　　　　　　　　［　合　計　］" TO P-NAME.
008370     MOVE W-SUT TO P-TSU.
008380     IF LINAGE-COUNTER > 61
008390         PERFORM MID-RTN THRU MID-EX
008400         MOVE SPACE TO SP-R
008410         MOVE W-P1 TO SP-R
008420         WRITE SP-R
008430         MOVE SPACE TO SP-R.
008440     MOVE W-P2 TO SP-R.
008450     WRITE SP-R.
008460     MOVE SPACE TO SP-R.
008470 KEI-EX.
008480     EXIT.
