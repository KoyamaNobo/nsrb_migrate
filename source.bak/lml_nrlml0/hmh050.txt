000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMH050.
000030*********************************************************
000040*    PROGRAM         :  履物在庫廃棄明細ワーク　作成  　*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT HAIKI ASSIGN TO HAIKI-MSD.
000160     SELECT HHTF ASSIGN TO HHT1-MSD HHT2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY HHT-KEY
000200         ALTERNATE RECORD KEY HHT-KEY2.
000210     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE RANDOM
000240         RECORD KEY HI-KEY
000250         ALTERNATE RECORD KEY HI-KEY2.
000260     SELECT TSWF ASSIGN TO TSW-MSD.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON HHTF
000290     APPLY SHARED-MODE ON HI-M.
000300 DATA DIVISION.
000310 FILE SECTION.
000320     COPY LIHIM.
000330     COPY LIHHTF.
000340 FD  HAIKI
000350     BLOCK  4 RECORDS
000360     LABEL RECORD IS STANDARD
000370     VALUE OF IDENTIFICATION WK0064ID.
000380 01  HAI-R.
000390     02  HAI-HCD        PIC  9(006).
000400     02  HAI-SIZ        PIC  9(001).
000410     02  HAI-ASUD.
000420       03  HAI-SUD   OCCURS  10.
000430         04  HAI-SU     PIC S9(005).
000440     02  F              PIC  X(007).
000450 FD  TSWF
000460     BLOCK  2 RECORDS
000470     LABEL RECORD IS STANDARD
000480     VALUE OF IDENTIFICATION WK0128ID.
000490 01  TSW-R.
000500     02  TSW-HCD        PIC  9(006).
000510     02  TSW-KSU        PIC S9(006).
000520     02  TSW-HSU        PIC S9(006).
000530     02  TSW-FT         PIC  9(005).
000540     02  TSW-BC1        PIC  9(002).
000550     02  TSW-BC2        PIC  9(002).
000560     02  TSW-BC3        PIC  9(002).
000570     02  TSW-BMC        PIC  9(002).
000580     02  TSW-BMNO       PIC  9(001).
000590     02  F              PIC  X(096).
000600 WORKING-STORAGE SECTION.
000610 77  WK0128ID           PIC  X(009) VALUE SPACE.
000620 77  WK0064ID           PIC  X(009) VALUE SPACE.
000630 01  STN-NO.
000640     02  STN-NO1        PIC  X(003).
000650     02  STN-NO2        PIC  X(003).
000660 01  W-FID1.
000670     02  W-FID11        PIC  X(006) VALUE "WK0064".
000680     02  W-FID12        PIC  X(003).
000690 01  W-FID2.
000700     02  W-FID21        PIC  X(006) VALUE "WK0128".
000710     02  W-FID22        PIC  X(003).
000720 01  W-DATA.
000730     02  W-HCD          PIC  9(006).
000740     02  W-SU           PIC S9(006).
000750     02  CNT            PIC  9(002).
000760     02  W-DC           PIC  9(001).
000770 01  ERR-STAT           PIC  X(002).
000780 SCREEN SECTION.
000790 SD  C-CRT
000800     END STATUS IS ESTAT.
000810 01  C-CLEAR.
000820     02  LINE   1  CLEAR SCREEN.
000830 01  C-MID.
000840     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
000850          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000860     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
000870          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000880     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
000890          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
000900     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
000910          NC"＊＊＊　　履物在庫廃棄ワーク　作成　　＊＊＊".
000920     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
000930          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
000940     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
000950          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000960     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
000970          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000980 01  C-ERR.
000990     02  LINE  24.
001000       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001010       03  E-ME1   COLUMN  15  PIC  X(016) VALUE
001020            "***  HIM ﾅｼ  ***".
001030       03  E-ME2   COLUMN  15  PIC  X(019) VALUE
001040            "***  DATA ｴﾗｰ  ***".
001050       03  E-KEY   COLUMN  40  PIC  9(006) FROM  W-HCD.
001060       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001070       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001080 PROCEDURE DIVISION.
001090 M-05.
001100     DISPLAY C-CLEAR.
001110     DISPLAY C-MID.
001120     OPEN INPUT HI-M.
001130     CALL "CBLSTNNO" USING STN-NO.
001140     MOVE STN-NO2 TO W-FID12 W-FID22.
001150     MOVE W-FID1 TO WK0064ID.
001160     MOVE W-FID2 TO WK0128ID.
001170     OPEN OUTPUT TSWF.
001180     OPEN INPUT HHTF.
001190*
001200     READ HHTF NEXT RECORD WITH UNLOCK AT END
001210         MOVE 255 TO COMPLETION-CODE
001220         CLOSE HHTF
001230         DISPLAY E-ME2 E-ME99
001240         GO TO M-90.
001250     MOVE 0 TO W-DC.
001260 M-10.
001270     MOVE ZERO TO W-SU.
001280     MOVE HHT-HCD TO W-HCD.
001290     MOVE W-HCD TO HI-KEY.                                        I.020507
001300     READ HI-M WITH UNLOCK INVALID KEY
001310         MOVE 255 TO COMPLETION-CODE
001320         DISPLAY E-ME1 E-KEY E-ME99
001330         CLOSE HHTF
001340         GO TO M-90.
001350 M-15.
001360     MOVE ZERO TO CNT.
001370 M-20.
001380     ADD 1 TO CNT.
001390     IF CNT < 11
001400*****    COMPUTE W-SU = W-SU + HHT-ZSU(CNT) + HHT-NSU(CNT)        D.090530
001410*****                                       - HHT-USU(CNT)        D.090530
001420         ADD HHT-ZSU(CNT) TO W-SU                                 I.090530
001430         GO TO M-20.
001440*
001450     READ HHTF NEXT RECORD WITH UNLOCK AT END
001460         GO TO M-25.
001470     IF HHT-HCD = W-HCD                                           I.990507
001480         GO TO M-15.                                              I.990507
001490     PERFORM S-05 THRU S-10.
001500     GO TO M-10.
001510 M-25.
001520     PERFORM S-05 THRU S-10.
001530     CLOSE HHTF.
001540     OPEN INPUT HAIKI.
001550 M-30.
001560     READ HAIKI AT END
001570         MOVE 255 TO COMPLETION-CODE
001580         CLOSE HAIKI
001590         DISPLAY E-ME2 E-ME99
001600         GO TO M-90.
001610     MOVE 1 TO W-DC.
001620 M-35.
001630     MOVE ZERO TO W-SU.
001640     MOVE HAI-HCD TO W-HCD.
001650     MOVE W-HCD TO HI-KEY.
001660     READ HI-M WITH UNLOCK INVALID KEY
001670         MOVE 255 TO COMPLETION-CODE
001680         DISPLAY E-ME1 E-KEY E-ME99
001690         CLOSE HAIKI
001700         GO TO M-90.
001710 M-40.
001720     MOVE ZERO TO CNT.
001730 M-45.
001740     ADD 1 TO CNT.
001750     IF CNT < 11
001760         ADD HAI-SU(CNT) TO W-SU
001770         GO TO M-45.
001780*
001790     READ HAIKI AT END
001800         GO TO M-50.
001810     IF HAI-HCD = W-HCD
001820         GO TO M-40.
001830     PERFORM S-05 THRU S-10.
001840     GO TO M-35.
001850 M-50.
001860     PERFORM S-05 THRU S-10.
001870     CLOSE HAIKI.
001880 M-90.
001890     CLOSE HI-M.
001900     CLOSE TSWF.
001910 M-95.
001920     DISPLAY C-CLEAR.
001930     STOP RUN.
001940 S-05.
001950     IF W-SU = ZERO
001960         GO TO S-10.
001970     MOVE ZERO TO TSW-R.
001980     MOVE W-HCD TO TSW-HCD.
001990     IF W-DC = 0
002000         MOVE W-SU TO TSW-KSU
002010       ELSE
002020         MOVE W-SU TO TSW-HSU.
002030     MOVE HI-FT TO TSW-FT.
002040     MOVE HI-BC1 TO TSW-BC1.
002050     MOVE HI-BC2 TO TSW-BC2.
002060     MOVE HI-BC3 TO TSW-BC3.
002070     MOVE HI-BMC TO TSW-BMC.
002080     MOVE HI-BMNO TO TSW-BMNO.
002090     WRITE TSW-R.
002100 S-10.
002110     EXIT.
