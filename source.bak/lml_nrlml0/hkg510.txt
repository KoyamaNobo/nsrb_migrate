000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKG510.
000030*********************************************************
000040*    PROGRAM         :  入金予定ワーク作成              *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT SMWF ASSIGN TO SMW-MSD.
000170     SELECT SKDF ASSIGN TO SKD-MSD                                I.030625
000180         ORGANIZATION INDEXED                                     I.030625
000190         ACCESS MODE DYNAMIC                                      I.030625
000200         RECORD KEY SKD-KEY.                                      I.030625
000210     SELECT NYWF ASSIGN TO NYW-MSD.
000220     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE RANDOM
000250         RECORD KEY T-KEY
000260         ALTERNATE RECORD KEY T-KEY2.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON M-DATE
000290     APPLY SHARED-MODE ON SKDF                                    I.030625
000300     APPLY SHARED-MODE ON T-M.
000310 DATA DIVISION.
000320 FILE SECTION.
000330     COPY LIBFDD.
000340     COPY LISKDF.                                                 I.030625
000350     COPY LITM.
000360 FD  SMWF
000370     BLOCK  2 RECORDS
000380     LABEL RECORD IS STANDARD
000390     VALUE OF IDENTIFICATION WK0128ID.
000400 01  SMW-R.
000410     02  SMW-TCD        PIC  9(004).
000420     02  SMW-NGP        PIC  9(008).
000430     02  SMW-NGPD  REDEFINES SMW-NGP.
000440       03  SMW-NG       PIC  9(006).
000450       03  SMW-PEY      PIC  9(002).
000460     02  SMW-ZS         PIC S9(009).
000470     02  SMW-ZSZ        PIC S9(007).
000480     02  SMW-UR         PIC S9(009).
000490     02  SMW-URZ        PIC S9(007).
000500     02  SMW-TS         PIC S9(007).
000510     02  SMW-TSZ        PIC S9(005).
000520     02  SMW-NK         PIC S9(009).
000530     02  SMW-NKZ        PIC S9(007).
000540     02  SMW-DATE       PIC  9(006).
000550     02  SMW-SI         PIC  9(003).
000560     02  SMW-SU         PIC  9(001).
000570     02  F              PIC  X(019).
000580     02  SMW-DC         PIC  9(001).
000590     02  F              PIC  X(026).
000600 FD  NYWF
000610     BLOCK  4 RECORDS
000620     LABEL RECORD IS STANDARD
000630     VALUE OF IDENTIFICATION WK0064ID.
000640 01  NYW-R.
000650     02  NYW-DATE       PIC  9(008).
000660     02  NYW-NGP   REDEFINES NYW-DATE.
000670       03  NYW-NEN      PIC  9(004).
000680       03  NYW-GET      PIC  9(002).
000690       03  NYW-PEY      PIC  9(002).
000700     02  NYW-TCD        PIC  9(004).
000710     02  NYW-KIN        PIC S9(009).
000720     02  NYW-SHZ        PIC S9(007).
000730     02  NYW-KEI        PIC S9(009).
000740     02  NYW-NC.
000750       03  NYW-NC1      PIC  9(001).
000760       03  NYW-NC2      PIC  9(001).
000770     02  NYW-TGK        PIC  9(008).
000780     02  NYW-TGKD  REDEFINES NYW-TGK.
000790       03  NYW-TNEN     PIC  9(004).
000800       03  NYW-TGET     PIC  9(002).
000810       03  NYW-TPEY     PIC  9(002).
000820     02  NYW-SS         PIC  9(008).
000830     02  NYW-SSD   REDEFINES NYW-SS.
000840       03  NYW-SNEN     PIC  9(004).
000850       03  NYW-SGET     PIC  9(002).
000860       03  NYW-SPEY     PIC  9(002).
000870     02  NYW-TNC        PIC  9(002).
000880     02  F              PIC  X(007).
000890 WORKING-STORAGE SECTION.
000900 77  W-ME               PIC  X(040).
000910 77  WK0128ID           PIC  X(009) VALUE SPACE.
000920 77  WK0064ID           PIC  X(009) VALUE SPACE.
000930 01  STN-NO.
000940     02  STN-NO1        PIC  X(003).
000950     02  STN-NO2        PIC  X(003).
000960 01  W-FID1.
000970     02  W-FID11        PIC  X(006) VALUE "WK0128".
000980     02  W-FID12        PIC  X(003).
000990 01  W-FID2.
001000     02  W-FID21        PIC  X(006) VALUE "WK0064".
001010     02  W-FID22        PIC  X(003).
001020 01  W-R.
001030     02  WR-TCD         PIC  9(004).
001040     02  WR-NGP         PIC  9(008).
001050     02  WR-NGPD  REDEFINES WR-NGP.
001060       03  WR-NG.
001070         04  WR-NEN     PIC  9(004).
001080         04  WR-GET     PIC  9(002).
001090       03  WR-PEY       PIC  9(002).
001100     02  WR-ZS          PIC S9(009).
001110     02  WR-ZSZ         PIC S9(007).
001120     02  WR-UR          PIC S9(009).
001130     02  WR-URZ         PIC S9(007).
001140     02  WR-TS          PIC S9(007).
001150     02  WR-TSZ         PIC S9(005).
001160     02  WR-NK          PIC S9(009).
001170     02  WR-NKZ         PIC S9(007).
001180     02  WR-DATE        PIC  9(006).
001190     02  WR-SI          PIC  9(003).
001200     02  WR-SU          PIC  9(001).
001210     02  F              PIC  X(019).
001220     02  WR-DC          PIC  9(001).
001230     02  F              PIC  X(026).
001240 01  W-DATA.
001250     02  W-NGP          PIC  9(008).
001260     02  W-NGPD  REDEFINES W-NGP.
001270       03  W-NG.
001280         04  W-NEN      PIC  9(004).
001290         04  W-NENL  REDEFINES W-NEN.
001300           05  W-NEN1   PIC  9(002).
001310           05  W-NEN2   PIC  9(002).
001320         04  W-GET      PIC  9(002).
001330       03  W-PEY        PIC  9(002).
001340     02  W-NGPL  REDEFINES W-NGP.
001350       03  F            PIC  9(002).
001360       03  W-NGPS       PIC  9(006).
001370     02  W-D.
001380       03  W-KIN        PIC S9(009).
001390       03  W-SHZ        PIC S9(007).
001400       03  W-KEI        PIC S9(009).
001410     02  W-RD.
001420       03  W-RKIN       PIC S9(009).
001430       03  W-RSHZ       PIC S9(007).
001440       03  W-RKEI       PIC S9(009).
001450     02  W-FD.
001460       03  W-FKIN       PIC S9(009).
001470       03  W-FSHZ       PIC S9(007).
001480       03  W-FKEI       PIC S9(009).
001490     02  W-NK.                                                    I.030625
001500       03  W-NKIN       PIC S9(009).                              I.030625
001510       03  W-NSHZ       PIC S9(009).                              I.030625
001520     02  W-TCD          PIC  9(004).
001530     02  CHK            PIC  9(001).
001540     02  W-NSU          PIC  9(003).
001550     02  W-KS1          PIC  9(003).
001560     02  W-KS2          PIC  9(001).
001570 01  ERR-STAT           PIC  X(002).
001580 SCREEN SECTION.
001590 SD  C-CRT
001600     END STATUS IS ESTAT.
001610 01  C-CLEAR.
001620     02  LINE   1  CLEAR SCREEN.
001630 01  C-MID.
001640     02  LINE   3  COLUMN  10  PIC  N(020) VALUE
001650          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001660     02  LINE   4  COLUMN  10  PIC  N(020) VALUE
001670          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001680     02  LINE   5  COLUMN  10  PIC  N(020) VALUE
001690          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
001700     02  LINE   6  COLUMN  10  PIC  N(020) VALUE
001710          NC"＊＊＊　　入金予定ワーク　作成　　＊＊＊".
001720     02  LINE   7  COLUMN  10  PIC  N(020) VALUE
001730          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
001740     02  LINE   8  COLUMN  10  PIC  N(020) VALUE
001750          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001760     02  LINE   9  COLUMN  10  PIC  N(020) VALUE
001770          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001780 01  C-ERR.
001790     02  LINE  24.
001800       03  E-ME    COLUMN  15  PIC  X(040) FROM  W-ME.
001810       03  E-KEY   COLUMN  56  PIC  9(004) FROM  SMW-TCD.
001820       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001830       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001840       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001850            "                                                  ".
001860     COPY LIBSCR.
001870 PROCEDURE DIVISION.
001880 M-05.
001890     DISPLAY C-CLEAR.
001900     DISPLAY C-MID.
001910     MOVE ZERO TO W-DATA.
001920     ACCEPT W-NGP FROM DATE.
001930     COPY LIBCPR.
001940     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001950         ADD DATE-NC1 TO W-NEN.
001960     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001970         ADD DATE-NC2 TO W-NEN.
001980     SUBTRACT 1 FROM W-GET.
001990     IF W-GET = ZERO
002000         SUBTRACT 1 FROM W-NEN
002010         MOVE 12 TO W-GET.
002020     SUBTRACT 1 FROM W-GET.
002030     IF W-GET = ZERO
002040         SUBTRACT 1 FROM W-NEN
002050         MOVE 12 TO W-GET.
002060     SUBTRACT 1 FROM W-GET.
002070     IF W-GET = ZERO
002080         SUBTRACT 1 FROM W-NEN
002090         MOVE 12 TO W-GET.
002100     SUBTRACT 1 FROM W-GET.
002110     IF W-GET = ZERO
002120         SUBTRACT 1 FROM W-NEN
002130         MOVE 12 TO W-GET.
002140     SUBTRACT 1 FROM W-GET.
002150     IF W-GET = ZERO
002160         SUBTRACT 1 FROM W-NEN
002170         MOVE 12 TO W-GET.
002180     CALL "CBLSTNNO" USING STN-NO.
002190     MOVE STN-NO2 TO W-FID12 W-FID22.
002200     MOVE W-FID1 TO WK0128ID.
002210     MOVE W-FID2 TO WK0064ID.
002220     OPEN INPUT SMWF.
002230     OPEN INPUT SKDF.                                             I.030625
002240     OPEN INPUT T-M.
002250     OPEN OUTPUT NYWF.
002260 M-10.
002270     READ SMWF AT END
002280         GO TO M-90.
002290     IF W-NG > SMW-NG
002300         GO TO M-10.
002310     IF CHK = 1
002320         IF SMW-TCD = W-TCD
002330             GO TO M-10.
002340 M-15.
002350     MOVE SMW-TCD TO W-TCD.
002360     MOVE 0 TO CHK.
002370     MOVE SMW-TCD TO T-KEY.
002380     READ T-M WITH UNLOCK INVALID KEY
002390         MOVE SPACE TO W-ME
002400         MOVE "***  ﾄｸｲｻｷ ﾅｼ  ***" TO W-ME
002410         DISPLAY E-ME E-KEY E-ME99
002420         DISPLAY E-CL
002430         MOVE 1 TO CHK
002440         GO TO M-10.
002450     IF T-ENG NOT = ZERO
002460         MOVE 1 TO CHK
002470         GO TO M-10.
002480     IF SMW-DATE NOT = ZERO
002490         MOVE 1 TO CHK
002500         GO TO M-10.
002510*
002520     PERFORM S-35 THRU S-45.                                      I.030625
002530     MOVE ZERO TO W-FD.
002540*****COMPUTE W-FKIN = SMW-ZS + SMW-UR + SMW-TS - SMW-NK.          D.030625
002550*****COMPUTE W-FSHZ = SMW-ZSZ + SMW-URZ + SMW-TSZ - SMW-NKZ.      D.030625
002560     COMPUTE W-FKIN = SMW-ZS + SMW-UR + SMW-TS - SMW-NK - W-NKIN. I.030625
002570     COMPUTE W-FSHZ = SMW-ZSZ + SMW-URZ + SMW-TSZ - SMW-NKZ -     I.030625
002580                      W-NSHZ.                                     I.030625
002590     COMPUTE W-FKEI = W-FKIN + W-FSHZ.
002600     IF W-FKEI <= ZERO
002610         MOVE 1 TO CHK
002620         GO TO M-10.
002630 M-20.
002640     MOVE ZERO TO W-R.
002650     MOVE SMW-R TO W-R.
002660     MOVE ZERO TO W-RD.
002670     MOVE W-FD TO W-RD.
002680 M-25.
002690     READ SMWF AT END
002700         GO TO M-85.
002710     IF W-NG > SMW-NG
002720         GO TO M-25.
002730     IF CHK = 1
002740         IF SMW-TCD = W-TCD
002750             GO TO M-25.
002760     MOVE ZERO TO W-FD.
002770     IF SMW-TCD NOT = W-TCD
002780         GO TO M-30.
002790     IF SMW-DATE NOT = ZERO
002800         MOVE 1 TO CHK
002810         GO TO M-25.
002820     COMPUTE W-FKIN = SMW-ZS + SMW-UR + SMW-TS - SMW-NK.
002830     COMPUTE W-FSHZ = SMW-ZSZ + SMW-URZ + SMW-TSZ - SMW-NKZ.
002840     COMPUTE W-FKEI = W-FKIN + W-FSHZ.
002850     IF W-FKEI <= ZERO                                            I.030625
002860         MOVE 1 TO CHK                                            I.030625
002870         GO TO M-25.                                              I.030625
002880*
002890     PERFORM S-05 THRU S-30.
002900     GO TO M-20.
002910 M-30.
002920     PERFORM S-05 THRU S-30.
002930     GO TO M-15.
002940 M-85.
002950     MOVE ZERO TO W-FD.
002960     PERFORM S-05 THRU S-30.
002970 M-90.
002980     CLOSE SKDF.                                                  I.030625
002990     CLOSE T-M.
003000     CLOSE SMWF.
003010     CLOSE NYWF.
003020 M-95.
003030     DISPLAY C-CLEAR.
003040     STOP RUN.
003050 S-05.
003060     MOVE ZERO TO W-D.
003070     COMPUTE W-KIN = W-RKIN - W-FKIN.
003080     COMPUTE W-SHZ = W-RSHZ - W-FSHZ.
003090     COMPUTE W-KEI = W-RKEI - W-FKEI.
003100     IF ZERO = W-KIN AND W-SHZ AND W-KEI
003110         GO TO S-30.
003120     IF W-KEI < 0
003130         GO TO S-30.
003140*
003150     MOVE ZERO TO NYW-R.
003160     IF T-NKY = ZERO
003170         MOVE 99999999 TO NYW-DATE
003180         GO TO S-15.
003190     MOVE WR-NGP TO NYW-DATE.
003200     MOVE NYW-PEY TO W-NSU.
003210     ADD T-NKY TO W-NSU.
003220 S-10.
003230     IF W-NSU > 30
003240         SUBTRACT 30 FROM W-NSU
003250         ADD 1 TO NYW-GET
003260         IF NYW-GET = 13
003270             MOVE 1 TO NYW-GET
003280             ADD 1 TO NYW-NEN
003290             GO TO S-10
003300           ELSE
003310             GO TO S-10.
003320     MOVE W-NSU TO NYW-PEY.
003330     IF NYW-PEY < 28
003340         GO TO S-15.
003350     IF NYW-GET = 2
003360         DIVIDE 4 INTO NYW-NEN GIVING W-KS1 REMAINDER W-KS2.
003370     IF NYW-GET = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12
003380         MOVE 31 TO NYW-PEY
003390         IF NYW-GET = 4 OR 6 OR 9 OR 11
003400             MOVE 30 TO NYW-PEY
003410             IF W-KS2 = 0
003420                 MOVE 29 TO NYW-PEY
003430               ELSE
003440                 MOVE 28 TO NYW-PEY.
003450 S-15.
003460     MOVE W-TCD TO NYW-TCD.
003470     MOVE W-KIN TO NYW-KIN.
003480     MOVE W-SHZ TO NYW-SHZ.
003490     MOVE W-KEI TO NYW-KEI.
003500     MOVE T-SHC1 TO NYW-NC1.
003510     MOVE T-SHC2 TO NYW-NC2.
003520     IF NYW-NC1 NOT = 3
003530         GO TO S-25.
003540     IF T-SSI = ZERO
003550         MOVE 99999999 TO NYW-TGK
003560         GO TO S-25.
003570     MOVE NYW-DATE TO NYW-TGK.
003580     MOVE NYW-TPEY TO W-NSU.
003590     ADD T-SSI TO W-NSU.
003600 S-20.
003610     IF W-NSU > 30
003620         SUBTRACT 30 FROM W-NSU
003630         ADD 1 TO NYW-TGET
003640         IF NYW-TGET = 13
003650             MOVE 1 TO NYW-TGET
003660             ADD 1 TO NYW-TNEN
003670             GO TO S-20
003680           ELSE
003690             GO TO S-20.
003700     MOVE W-NSU TO NYW-TPEY.
003710     IF NYW-TPEY < 28
003720         GO TO S-25.
003730     IF NYW-TGET = 2
003740         DIVIDE 4 INTO NYW-TNEN GIVING W-KS1 REMAINDER W-KS2.
003750     IF NYW-TGET = 1 OR 3 OR 5 OR 7 OR 8 OR 10 OR 12
003760         MOVE 31 TO NYW-TPEY
003770         IF NYW-GET = 4 OR 6 OR 9 OR 11
003780             MOVE 30 TO NYW-TPEY
003790             IF W-KS2 = 0
003800                 MOVE 29 TO NYW-TPEY
003810               ELSE
003820                 MOVE 28 TO NYW-TPEY.
003830 S-25.
003840     MOVE WR-NGP TO NYW-SS.
003850     MOVE T-TNC TO NYW-TNC.
003860     WRITE NYW-R.
003870 S-30.
003880     EXIT.
003890 S-35.                                                            I.030625
003900     MOVE ZERO TO W-NK.                                           I.030625
003910     MOVE SPACE TO SKD-KEY.                                       I.030625
003920     MOVE W-TCD TO SKD-TCD.                                       I.030625
003930     MOVE SMW-NGP TO SKD-DATE.                                    I.030625
003940     MOVE 5 TO SKD-DTC.                                           I.030625
003950     START SKDF KEY NOT < SKD-KEY INVALID KEY                     I.030625
003960         GO TO S-45.                                              I.030625
003970 S-40.                                                            I.030625
003980     READ SKDF NEXT RECORD WITH UNLOCK AT END                     I.030625
003990         GO TO S-45.                                              I.030625
004000     IF W-TCD NOT = SKD-TCD                                       I.030625
004010         GO TO S-45.                                              I.030625
004020     IF SKD-DTC = 3                                               I.030625
004030         ADD SKD-KIN TO W-NKIN                                    I.030625
004040         ADD SKD-SHZ TO W-NSHZ.                                   I.030625
004050     GO TO S-40.                                                  I.030625
004060 S-45.                                                            I.030625
004070     EXIT.                                                        I.030625
