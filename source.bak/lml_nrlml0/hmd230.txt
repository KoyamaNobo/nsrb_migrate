000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. HMD230.
000030*********************************************************
000040*    PROGRAM         :  売上・値引伝票発行  JS-SIGN=0   *
000050*                    :              再発行  JS-SIGN=1   *
000060*    PRINTER TYPE    :  JIPS                            *
000070*    SCREEN          :  ******                          *
000080*    COMPILE TYPE    :  COBOL                           *
000090*    BASE PROGRAM    :  HMD220                          *
000100*********************************************************
000110 ENVIRONMENT DIVISION.
000120 CONFIGURATION SECTION.
000130 SOURCE-COMPUTER. SYSTEM3100.
000140 OBJECT-COMPUTER. SYSTEM3100.
000150 INPUT-OUTPUT SECTION.
000160 FILE-CONTROL.
000170     COPY LIBCSE.
000180     SELECT S-TRAN ASSIGN TO S-MSD
000190         FILE STATUS IS ERR-STAT.
000200     SELECT STRANYR ASSIGN TO STRANY-MSD.
000210     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000220         ORGANIZATION IS INDEXED
000230         ACCESS MODE IS RANDOM
000240         RECORD KEY IS HI-KEY
000250         ALTERNATE RECORD KEY IS HI-KEY2
000260         FILE STATUS IS ERR-STAT.
000270     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000280         ORGANIZATION IS INDEXED
000290         ACCESS MODE IS RANDOM
000300         RECORD KEY IS T-KEY
000310         ALTERNATE  RECORD KEY IS T-KEY2
000320         FILE STATUS IS ERR-STAT.
000330     SELECT TC-M ASSIGN TO TC-MSD
000340         ORGANIZATION INDEXED
000350         RECORD KEY TC-KEY
000360         ACCESS MODE RANDOM
000370         FILE STATUS IS ERR-STAT.
000380     SELECT SP-F ASSIGN TO P-PRN999.
000390 I-O-CONTROL.
000400     APPLY SHARED-MODE ON M-DATE
000410     APPLY SHARED-MODE ON HI-M TC-M
000420     APPLY SHARED-MODE ON T-M
000430     APPLY SHIFT-CODE  ON SP-F.
000440 DATA DIVISION.
000450 FILE SECTION.
000460     COPY LIBFDD.
000470     COPY LIHIM.
000480     COPY LITM.
000490     COPY LITCM.
000500     COPY LSPF.
000510 FD  S-TRAN
000520     BLOCK  2 RECORDS
000530     LABEL RECORD STANDARD
000540     VALUE OF IDENTIFICATION IS "STRAN".
000550 01  S-R                PIC  X(128).
000560 FD  STRANYR
000570     BLOCK  2 RECORDS
000580     LABEL RECORD STANDARD
000590     VALUE OF IDENTIFICATION IS "STRANYR".
000600 01  STRANYR-R          PIC  X(128).
000610 WORKING-STORAGE  SECTION.
000620 77  JS-SIGN            PIC  X(001).
000630 77  W-DCHK             PIC  9(001).
000640 77  W-NCHK             PIC  9(001).                              I.151103
000650 77  W-DZC              PIC  9(001) VALUE 0.
000660 77  W-FILE             PIC  X(013).
000670 01  HEAD1.
000680     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000690     02  F              PIC  N(005) VALUE NC"《　日付　".
000700     02  F              PIC  X(001) VALUE "'".
000710     02  H-NEN          PIC  9(002).
000720     02  F              PIC  N(001) VALUE NC"年".
000730     02  F              PIC  X(001) VALUE SPACE.
000740     02  H-GET          PIC  Z(002).
000750     02  F              PIC  N(001) VALUE NC"月".
000760     02  F              PIC  X(001) VALUE SPACE.
000770     02  H-PEY          PIC  Z(002).
000780     02  F              PIC  N(003) VALUE NC"日　》".
000790     02  F              PIC  X(020) VALUE SPACE.
000800     02  F              PIC  X(008) VALUE ""3F504F40677F4F9B"".
000810     02  F              PIC  N(009) VALUE NC"【　売　上　伝　票".
000820     02  F              PIC  N(002) VALUE NC"　】".
000830     02  F              PIC  X(008) VALUE ""3F504F40674F40A0"".
000840     02  F              PIC  X(005) VALUE SPACE.
000850     02  H-SHC          PIC  N(003) VALUE SPACE.
000860     02  F              PIC  X(010) VALUE SPACE.
000870     02  F              PIC  X(005) VALUE "DATE ".
000880     02  H-DATE         PIC 99/99/99.
000890     02  F              PIC  X(007) VALUE "     P.".
000900     02  H-PAGE         PIC Z9.
000910 01  HEAD2.
000920     02  F              PIC  N(002) VALUE NC"伝区".
000930     02  F              PIC  X(010) VALUE SPACE.
000940     02  F              PIC  X(001) VALUE "(".
000950     02  F              PIC  N(003) VALUE NC"伝票№".
000960     02  F              PIC  X(001) VALUE ")".
000970     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000980     02  F              PIC  X(003) VALUE SPACE.
000990     02  F              PIC  X(004) VALUE "ｺｰﾄﾞ".
001000     02  F              PIC  X(003) VALUE SPACE.
001010     02  F              PIC  N(008) VALUE NC"得　意　先　名　".
001020     02  F              PIC  X(006) VALUE SPACE.
001030     02  F              PIC  X(051) VALUE
001040          "1             SS    S    M    L   LL 28.0 29.0 30.0".
001050     02  F              PIC  X(027) VALUE SPACE.
001060     02  F              PIC  N(004) VALUE NC"請求日　".
001070     02  F              PIC  X(002) VALUE SPACE.
001080 01  HEAD3.
001090     02  F              PIC  X(007) VALUE SPACE.
001100     02  F              PIC  X(004) VALUE "ｺｰﾄﾞ".
001110     02  F              PIC  X(002) VALUE SPACE.
001120     02  F              PIC  N(008) VALUE NC"品　　　　　名　".
001130     02  F              PIC  X(025) VALUE SPACE.
001140     02  F              PIC  X(051) VALUE
001150          "2 12.5 13.0 13.5 14.0 15.0 16.0 17.0 18.0 19.0 20.0".
001160     02  F              PIC  X(035) VALUE SPACE.
001170 01  HEAD4.
001180     02  F              PIC  X(050) VALUE SPACE.
001190     02  F              PIC  X(051) VALUE
001200          "3 21.0 21.5 22.0 22.5 23.0 23.5 24.0 24.5 25.0     ".
001210     02  F              PIC  X(025) VALUE SPACE.
001220     02  F              PIC  N(002) VALUE NC"備考".
001230     02  F              PIC  X(007) VALUE SPACE.
001240 01  HEAD5.
001250     02  F              PIC  X(050) VALUE SPACE.
001260     02  F              PIC  X(051) VALUE
001270          "4 24.0 24.5 25.0 25.5 26.0 26.5 27.0 27.5          ".
001280     02  F              PIC  X(004) VALUE SPACE.
001290     02  F              PIC  N(002) VALUE NC"数量".
001300     02  F              PIC  X(004) VALUE SPACE.
001310     02  F              PIC  N(002) VALUE NC"単価".
001320     02  F              PIC  X(007) VALUE SPACE.
001330     02  F              PIC  N(002) VALUE NC"金額".
001340     02  F              PIC  X(005) VALUE SPACE.
001350     02  F              PIC  N(004) VALUE NC"　総合計".
001360 01  W-P1.
001370     02  P-15K1         PIC  X(005).
001380     02  P-DC           PIC  9(001).
001390     02  P-CSC          PIC  9(001).
001400     02  P-FRC          PIC  X(001).
001410     02  P-DCM          PIC  N(002).
001420     02  F              PIC  X(001).
001430     02  P-DCD          PIC  N(004).
001440     02  F              PIC  X(001).
001450     02  P-F            PIC  X(001).
001460     02  P-DNO          PIC  9(006).
001470     02  P-R            PIC  X(001).
001480     02  F              PIC  X(001).
001490     02  P-TCD          PIC  9(004).
001500     02  P-X            PIC  X(001).
001510     02  P-CCD          PIC  9(003).
001520     02  F              PIC  X(001).
001530     02  P-TNA          PIC  N(026).
001540     02  F              PIC  X(052).
001550     02  P-MNGP         PIC 99/99/99.
001560 01  W-P2.
001570     02  P-15K2         PIC  X(005).
001580     02  F              PIC  X(006).
001590     02  P-HCD          PIC  9(006).
001600     02  F              PIC  X(001).
001610     02  P-HNA          PIC  N(024).
001620     02  F              PIC  X(001).
001630     02  P-SIZ          PIC  9(001).
001640     02  P-20K2         PIC  X(005).
001650     02  P-SUD.
001660       03  P-SU    OCCURS  10  PIC  -(005).
001670     02  P-SUT          PIC ---,--9.
001680     02  P-T            PIC ---,--9.
001690     02  P-KIN          PIC --,---,--9.
001700     02  P-KIND  REDEFINES P-KIN.
001710       03  P-MSM        PIC  N(005).
001720     02  F              PIC  X(001).
001730     02  P-BIK          PIC  X(010).
001740 01  W-P3.
001750     02  P-15K3         PIC  X(005).
001760     02  F              PIC  X(007).
001770     02  P-KOSU         PIC  N(004).
001780     02  P-KO           PIC  N(002).
001790     02  F              PIC  X(004).
001800     02  P-CNAM         PIC  N(032).
001810     02  P-BID   REDEFINES P-CNAM.
001820       03  F            PIC  N(008).
001830       03  P-BI         PIC  N(024).
001840     02  F              PIC  X(004).
001850     02  P-NOM          PIC  N(006).
001860     02  F              PIC  X(001).
001870     02  P-HMN          PIC  9(006).
001880     02  F              PIC  X(007).
001890     02  P-TME          PIC  N(004).
001900     02  P-GSUT         PIC ---,--9.
001910     02  F              PIC  X(001).
001920     02  P-SZM          PIC  N(004).
001930     02  P-GKIN         PIC --,---,--9.
001940     02  P-TKIN         PIC ---,---,--9.
001950 01  W-P8.
001960     02  F              PIC  X(136).
001970 01  W-R.
001980     02  WR-S1.
001990       03  S1-DNO       PIC  9(006).
002000       03  S1-GNO       PIC  9(001).
002010       03  S1-DATE      PIC  9(008).
002020       03  S1-NGP   REDEFINES S1-DATE.
002030         04  S1-NG      PIC  9(006).
002040         04  S1-PEY     PIC  9(002).
002050       03  S1-TCD       PIC  9(004).
002060       03  S1-HCD       PIC  9(006).
002070       03  S1-SIZ       PIC  9(001).
002080       03  S1-ASU.
002090         04  S1-SUD   OCCURS 10.
002100           05  S1-SU    PIC S9(004)   COMP-3.
002110       03  S1-SUT       PIC S9(005).
002120       03  S1-T         PIC  9(005).
002130       03  S1-KIN       PIC S9(008).
002140       03  S1-CSC       PIC  9(001).
002150       03  S1-DC        PIC  9(001).
002160       03  S1-FT        PIC  9(005).
002170       03  S1-CCD       PIC  9(003).
002180       03  F            PIC  X(011).
002190       03  S1-HSC       PIC  9(001).
002200       03  S1-KOSU      PIC  9(003).
002210       03  S1-FRC       PIC  9(001).
002220       03  S1-TCD2      PIC  9(004).
002230       03  S1-BIK       PIC  X(010).
002240       03  F            PIC  X(002).
002250       03  S1-MNGP      PIC  9(006).
002260       03  F            PIC  X(004).
002270       03  S1-DHC       PIC  9(001).
002280       03  S1-UNC       PIC  9(001).
002290     02  WR-S2    REDEFINES WR-S1.
002300       03  S2-DNO       PIC  9(006).
002310       03  S2-GNO       PIC  9(001).
002320       03  S2-DATE      PIC  9(008).
002330       03  S2-TCD       PIC  9(004).
002340       03  S2-BI        PIC  N(024).
002350       03  S2-HNO       PIC  9(006).
002360       03  F            PIC  X(030).
002370       03  S2-TAX       PIC S9(007).
002380       03  S2-SHZZ      PIC S9(007).
002390       03  S2-UZ        PIC S9(009).
002400       03  S2-DHC       PIC  9(001).
002410       03  S2-UNC       PIC  9(001).
002420 01  W-DATA.
002430     02  W-PAGE         PIC  9(002).
002440     02  W-TD.
002450       03  W-ASUT       PIC S9(006).
002460       03  W-AKIN       PIC S9(008).
002470       03  W-SHZ        PIC S9(006).
002480       03  W-TKIN       PIC S9(008).
002490     02  W-D.
002500       03  W-TPC        PIC  9(001).
002510       03  W-GNO        PIC  9(001).
002520       03  W-L          PIC  9(002).
002530       03  W-LC         PIC  9(002).
002540       03  W-ASU.
002550         04  W-SU    OCCURS  10  PIC S9(004).
002560       03  W-SUT        PIC S9(005).
002570       03  W-KIN        PIC S9(008).
002580       03  W-KINZ       PIC S9(007).
002590       03  CNT          PIC  9(002).
002600       03  W-DC         PIC  9(001).
002610       03  W-BE         PIC  9(001).
002620       03  W-HSC        PIC  9(001).
002630       03  W-CSC        PIC  9(001).
002640     02  CHK.
002650       03  CHK1         PIC  9(001).
002660       03  CHK2         PIC  9(001).
002670     02  W-DNO          PIC  9(006).
002680     02  W-TCD          PIC  9(004).
002690     02  W-CCD          PIC  9(003).
002700     02  W-NGPD.
002710       03  W-NG.
002720         04  W-NEN      PIC  9(004).
002730         04  W-NEND  REDEFINES W-NEN.
002740           05  W-NEN1   PIC  9(002).
002750           05  W-NEN2   PIC  9(002).
002760         04  W-GET      PIC  9(002).
002770       03  W-NGL   REDEFINES W-NG.                                I.140110
002780         04  F          PIC  9(002).                              I.140110
002790         04  W-NGS      PIC  9(004).                              I.140110
002800       03  W-PEY        PIC  9(002).
002810     02  W-SENGP.
002820       03  W-SNGP       PIC  9(008).
002830       03  W-SNGPD REDEFINES W-SNGP.
002840         04  W-SNG      PIC  9(006).
002850         04  F          PIC  9(002).
002860       03  W-ENGP       PIC  9(008).
002870       03  W-ENGPD REDEFINES W-ENGP.
002880         04  W-ENG      PIC  9(006).
002890         04  F          PIC  9(002).
002900     02  W-SETCD.
002910       03  W-STCD       PIC  9(004).
002920       03  W-ETCD       PIC  9(004) VALUE 9999.                   I.151103
002930*****  03  W-ETCD       PIC  9(004).                              D.151103
002940     02  W-SEDNO.
002950       03  W-SDNO       PIC  9(006).
002960       03  W-EDNO       PIC  9(006) VALUE 999999.                 I.151103
002970*****  03  W-EDNO       PIC  9(006).                              D.151103
002980     02  W-DMM          PIC  9(001).
002990     02  W-CCC          PIC  9(001).
003000     02  W-NAME         PIC  N(024).
003010     02  W-NAMED REDEFINES W-NAME.
003020       03  W-NAD   OCCURS  24.
003030         04  W-NA       PIC  N(001).
003040 01  ERR-STAT           PIC  X(002).
003050 01  W-AREA.
003060     02  W-KOSU         PIC ZZZZ.
003070     02  N              PIC  9(002).
003080     02  TBL-NAM        PIC  N(032).
003090     02  TBL-NAMR  REDEFINES TBL-NAM.
003100       03  T-NAM        PIC  N(001)  OCCURS  32.
003110     02  SV-KOSU        PIC  9(003).
003120     02  SV-TCD         PIC  9(004).
003130     02  SV-CCD2        PIC  9(003).
003140     COPY LNAMW.
003150     COPY LSTAT.
003160 SCREEN SECTION.
003170 SD  C-CRT
003180     END STATUS IS ESTAT.
003190 01  C-CLEAR.
003200     02  C-CL    LINE   1  CLEAR SCREEN.
003210 01  C-MID.
003220     02  LINE   2  COLUMN  15  PIC  N(023) VALUE
003230          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
003240     02  LINE   3  COLUMN  15  PIC  N(023) VALUE
003250          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
003260     02  LINE   4  COLUMN  15  PIC  N(023) VALUE
003270          NC"＊＊＊　　【ナフコ・ワークマンＡ４】　　＊＊＊".
003280     02  LINE   5  COLUMN  15  PIC  N(023) VALUE
003290          NC"＊＊＊　　売上・返品・値引伝票　作成　　＊＊＊".
003300     02  LINE   6  COLUMN  15  PIC  N(023) VALUE
003310          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
003320     02  LINE   7  COLUMN  15  PIC  N(023) VALUE
003330          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
003340     02  LINE   8  COLUMN  15  PIC  N(023) VALUE
003350          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
003360     02  LINE  16  COLUMN  27  PIC  X(022) VALUE
003370            "確認  OK=1 NO=9   ﾘﾀｰﾝ".
003380 01  C-DSP.
003390     02  D-SHM.
003400       03  LINE   6  COLUMN  33  PIC  N(005) VALUE NC"（再発行）".
003410       03  LINE  10  COLUMN  23  PIC  X(030) VALUE
003420            "伝票№ 000000 より 999999 まで".
003430       03  LINE  12  COLUMN  23  PIC  X(037) VALUE
003440            "'00年00月00日 より '99年99月99日 まで".
003450       03  LINE  14  COLUMN  23  PIC  X(030) VALUE
003460            "得意先   0000 より 9999   まで".
003470 01  C-ACP.
003480     02  LINE  10.
003490       03  A-SDNO  COLUMN  30  PIC  9(006)
003500            USING W-SDNO  CHECK OVERFLOW NO IFC.
003510       03  A-EDNO  COLUMN  42  PIC  9(006)
003520            USING W-EDNO  CHECK OVERFLOW NO IFC.
003530     02  LINE  12.
003540       03  A-SNEN  COLUMN  24  PIC  9(002)
003550            USING W-NEN2  CHECK OVERFLOW NO IFC.
003560       03  A-SGET  COLUMN  28  PIC  9(002)
003570            USING W-GET   CHECK OVERFLOW NO IFC.
003580       03  A-SPEY  COLUMN  32  PIC  9(002)
003590            USING W-PEY   CHECK OVERFLOW NO IFC.
003600       03  A-ENEN  COLUMN  43  PIC  9(002)
003610            USING W-NEN2  CHECK OVERFLOW NO IFC.
003620       03  A-EGET  COLUMN  47  PIC  9(002)
003630            USING W-GET   CHECK OVERFLOW NO IFC.
003640       03  A-EPEY  COLUMN  51  PIC  9(002)
003650            USING W-PEY   CHECK OVERFLOW NO IFC.
003660     02  LINE  14.
003670       03  A-STCD  COLUMN  32  PIC  9(004)
003680            USING W-STCD  CHECK OVERFLOW NO IFC.
003690       03  A-ETCD  COLUMN  42  PIC  9(004)
003700            USING W-ETCD  CHECK OVERFLOW NO IFC.
003710     02  A-DMM   LINE  16  COLUMN  44  PIC  9(001)
003720          USING W-DMM   CHECK OVERFLOW NO IFC.
003730 01  C-ERR.
003740     02  LINE  24.
003750       03  EMSG-JS COLUMN  15  PIC  X(024) VALUE
003760            "***  ｺﾝﾄﾛｰﾙ情報ｴﾗｰ   ***".
003770       03  E-ME3   COLUMN  15  PIC  X(016) VALUE
003780            "***  HIM ﾅｼ  ***".
003790       03  E-ME4   COLUMN  15  PIC  X(034) VALUE
003800            "***  ﾊｯｺｳｸﾌﾞﾝ ﾉ ﾄﾞｳｷｶﾞ ﾄﾚﾃｲﾅｲ  ***".
003810       03  E-ME5   COLUMN  15  PIC  X(026) VALUE
003820            "***  STRAN ｴﾗｰ (OVER)  ***".
003830       03  E-ME6   COLUMN  15  PIC  X(024) VALUE
003840            "***  STRAN ｴﾗｰ (NO)  ***".
003850       03  E-ME7   COLUMN  15  PIC  X(026) VALUE
003860            "***  STRAN ｴﾗｰ (ﾋﾞｺｳ)  ***".
003870       03  E-ME10  COLUMN  15  PIC  X(015) VALUE
003880            "***  TM ﾅｼ  ***".
003890       03  E-ME11  COLUMN  15  PIC  X(018) VALUE
003900            "***  DATA ﾅｼ   ***".
003910       03  E-ME24  COLUMN  15  PIC  X(029) VALUE
003920            "***   STRAN REWRITE ｴﾗｰ   ***".
003930       03  E-TCD   COLUMN  50  PIC  9(004) FROM  S1-TCD.
003940       03  E-HCD   COLUMN  50  PIC  9(006) FROM  S1-HCD.
003950     COPY LSSEM.
003960     COPY LIBSCR.
003970 PROCEDURE DIVISION.
003980 M-020.
003990     ACCEPT JS-SIGN.
004000     DISPLAY C-CLEAR.
004010     DISPLAY C-MID.
004020     IF JS-SIGN NOT = 0 AND 1
004030         MOVE 255 TO COMPLETION-CODE
004040         DISPLAY EMSG-JS E-ME99
004050         STOP RUN.
004060     IF JS-SIGN = 0
004070        GO TO M-080.
004080     DISPLAY D-SHM.
004090 M-040.
004100     ACCEPT A-SDNO.
004110     IF ESTAT = PF9
004120         MOVE 255 TO COMPLETION-CODE
004130         DISPLAY C-CLEAR
004140         STOP RUN.
004150     IF ESTAT NOT = HTB AND SKP
004160         GO TO M-040.
004170 M-060.
004180     ACCEPT A-EDNO.
004190     IF ESTAT = BTB
004200         GO TO M-040.
004210     IF ESTAT = PF9
004220         MOVE 255 TO COMPLETION-CODE
004230         DISPLAY C-CLEAR
004240         STOP RUN.
004250     IF ESTAT NOT = HTB AND SKP
004260         GO TO M-060.
004270     IF W-SDNO > W-EDNO
004280         GO TO M-060.
004290 M-062.
004300     ACCEPT A-SNEN.
004310     IF ESTAT = BTB
004320         GO TO M-060.
004330     IF ESTAT = PF9
004340         MOVE 255 TO COMPLETION-CODE
004350         DISPLAY C-CLEAR
004360         STOP RUN.
004370     IF ESTAT NOT = HTB AND SKP
004380         GO TO M-062.
004390 M-064.
004400     ACCEPT A-SGET.
004410     IF ESTAT = BTB
004420         GO TO M-062.
004430     IF ESTAT = PF9
004440         MOVE 255 TO COMPLETION-CODE
004450         DISPLAY C-CLEAR
004460         STOP RUN.
004470     IF ESTAT NOT = HTB AND SKP
004480         GO TO M-064.
004490 M-066.
004500     ACCEPT A-SPEY.
004510     IF ESTAT = BTB
004520         GO TO M-064.
004530     IF ESTAT = PF9
004540         MOVE 255 TO COMPLETION-CODE
004550         DISPLAY C-CLEAR
004560         STOP RUN.
004570     IF ESTAT NOT = HTB AND SKP
004580         GO TO M-066.
004590     IF W-NEN2 = ZERO
004600         MOVE ZERO TO W-NEN1
004610       ELSE
004620         MOVE 20 TO W-NEN1.
004630     MOVE W-NGPD TO W-SNGP.
004640     IF W-NCHK = 0                                                I.151103
004650         MOVE 1 TO W-NCHK                                         I.151103
004660         MOVE 99 TO W-NEN2 W-GET W-PEY                            I.151103
004670       ELSE                                                       I.151103
004680         MOVE W-ENGP TO W-NGPD.                                   I.151103
004690 M-068.
004700     ACCEPT A-ENEN.
004710     IF ESTAT = BTB
004720         MOVE W-SNGP TO W-NGPD                                    I.151103
004730         GO TO M-066.
004740     IF ESTAT = PF9
004750         MOVE 255 TO COMPLETION-CODE
004760         DISPLAY C-CLEAR
004770         STOP RUN.
004780     IF ESTAT NOT = HTB AND SKP
004790         GO TO M-068.
004800     IF W-NEN2 = ZERO
004810         GO TO M-068.
004820     MOVE W-NGPD TO W-ENGP.                                       I.151103
004830 M-070.
004840     ACCEPT A-EGET.
004850     IF ESTAT = BTB
004860         GO TO M-068.
004870     IF ESTAT = PF9
004880         MOVE 255 TO COMPLETION-CODE
004890         DISPLAY C-CLEAR
004900         STOP RUN.
004910     IF ESTAT NOT = HTB AND SKP
004920         GO TO M-070.
004930     MOVE W-NGPD TO W-ENGP.                                       I.151103
004940 M-072.
004950     ACCEPT A-EPEY.
004960     IF ESTAT = BTB
004970         GO TO M-070.
004980     IF ESTAT = PF9
004990         MOVE 255 TO COMPLETION-CODE
005000         DISPLAY C-CLEAR
005010         STOP RUN.
005020     IF ESTAT NOT = HTB AND SKP
005030         GO TO M-072.
005040     IF W-NEN2 = ZERO
005050         MOVE ZERO TO W-NEN1
005060       ELSE
005070         MOVE 20 TO W-NEN1.
005080     MOVE W-NGPD TO W-ENGP.
005090     IF W-SNGP > W-ENGP
005100         GO TO M-068.
005110 M-074.
005120     ACCEPT A-STCD.
005130     IF ESTAT = BTB
005140         GO TO M-072.
005150     IF ESTAT = PF9
005160         MOVE 255 TO COMPLETION-CODE
005170         DISPLAY C-CLEAR
005180         STOP RUN.
005190     IF ESTAT NOT = HTB AND SKP
005200         GO TO M-074.
005210 M-076.
005220     ACCEPT A-ETCD.
005230     IF ESTAT = BTB
005240         GO TO M-074.
005250     IF ESTAT = PF9
005260         MOVE 255 TO COMPLETION-CODE
005270         DISPLAY C-CLEAR
005280         STOP RUN.
005290     IF ESTAT NOT = HTB AND SKP
005300         GO TO M-076.
005310     IF W-STCD > W-ETCD
005320         GO TO M-076.
005330 M-080.
005340     ACCEPT A-DMM.
005350     IF JS-SIGN NOT = 0
005360         IF ESTAT = BTB
005370             GO TO M-076.
005380     IF ESTAT NOT = HTB AND SKP
005390         GO TO M-080.
005400     IF W-DMM = 9
005410         MOVE 255 TO COMPLETION-CODE
005420         DISPLAY C-CLEAR
005430         STOP RUN.
005440     IF W-DMM NOT = 1
005450         GO TO M-080.
005460     IF JS-SIGN NOT = 0
005470         GO TO M-200.
005480 M-100.
005490     PERFORM CHK-RTN THRU CHK-EX.
005500     IF W-DCHK = 0 OR 2
005510         MOVE 255 TO COMPLETION-CODE
005520         DISPLAY E-ME11 E-ME99
005530         DISPLAY C-CLEAR
005540         STOP RUN.
005550     IF W-DCHK = 3
005560         MOVE 255 TO COMPLETION-CODE
005570         DISPLAY E-ME4 E-ME99
005580         DISPLAY C-CLEAR
005590         STOP RUN.
005600 M-200.
005610     MOVE ZERO TO CHK W-NGPD W-PAGE.
005620     MOVE ALL "-" TO W-P8.
005630     OPEN INPUT HI-M T-M TC-M.
005640     OPEN OUTPUT SP-F.
005650     IF JS-SIGN = 1
005660         OPEN INPUT STRANYR
005670         GO TO M-230.
005680     OPEN I-O S-TRAN.
005690 M-220.
005700     READ S-TRAN AT END
005710         GO TO M-920.
005720     MOVE S-R TO WR-S1.
005730     IF S1-DHC NOT = 1
005740         GO TO M-235.
005750     GO TO M-220.
005760 M-230.
005770     READ STRANYR AT END
005780         GO TO M-920.
005790     MOVE STRANYR-R TO WR-S1.
005800     IF S1-NG < W-SNG
005810         GO TO M-230.
005820     IF S1-NG > W-ENG
005830         GO TO M-920.
005840     IF S1-DNO < W-SDNO OR > W-EDNO
005850         GO TO M-230.
005860     IF S1-DATE < W-SNGP OR > W-ENGP
005870         GO TO M-230.
005880     IF S1-TCD < W-STCD OR > W-ETCD
005890         GO TO M-230.
005900 M-235.
005910     IF S1-DATE = W-NGPD
005920         GO TO M-240.
005930     IF W-NGPD NOT = ZERO
005940         MOVE SPACE TO SP-R
005950         WRITE SP-R AFTER PAGE.
005960     MOVE S1-DATE TO W-NGPD.
005970     MOVE W-NEN2 TO H-NEN.
005980     MOVE W-GET TO H-GET.
005990     MOVE W-PEY TO H-PEY.
006000     IF JS-SIGN = 1
006010         MOVE NC"（再）" TO H-SHC.
006020     ACCEPT H-DATE FROM DATE.
006030     PERFORM MID-010 THRU MID-EX.
006040 M-240.
006050     IF W-DZC = 0
006060         MOVE 1 TO W-DZC.
006070     MOVE ZERO TO W-TD W-D.
006080     MOVE S1-DNO TO W-DNO.
006090     MOVE S1-CSC TO W-CSC.
006100     MOVE S1-HSC TO W-HSC.
006110     MOVE S1-KOSU TO SV-KOSU.
006120     MOVE S1-TCD2 TO SV-TCD.
006130     MOVE S1-CCD TO SV-CCD2.
006140     MOVE S1-TCD TO T-KEY.
006150     READ T-M WITH UNLOCK INVALID KEY
006160         DISPLAY E-ME10 E-TCD E-ME99
006170         GO TO M-980.
006180*
006190     MOVE 0 TO W-CCC.
006200     IF S1-CCD = ZERO OR 001
006210         GO TO M-300.
006220     MOVE S1-TCD2 TO TC-TCD.
006230     MOVE S1-CCD TO TC-CCD.
006240     READ TC-M WITH UNLOCK INVALID KEY
006250         MOVE 0 TO TC-DHC.
006260     IF TC-DHC NOT = 0
006270         MOVE 1 TO W-CCC.
006280 M-300.
006290     MOVE SPACE TO W-P1.
006300     MOVE W-15K TO P-15K1.
006310     MOVE SPACE TO P-DCM P-DCD P-TNA.
006320     MOVE S1-CSC TO P-CSC.
006330     IF S1-UNC = 0
006340         IF S1-DC = 4
006350             MOVE 0 TO P-DC
006360           ELSE
006370             MOVE S1-DC TO P-DC.
006380     IF S1-FRC NOT = 0
006390         MOVE S1-FRC TO P-FRC.
006400     MOVE "(" TO P-F.
006410     MOVE W-DNO TO P-DNO.
006420     MOVE ")" TO P-R.
006430     IF S1-UNC = 0
006440         IF S1-DC = 0 OR 6
006450             MOVE NC"売上" TO P-DCM
006460           ELSE
006470             IF S1-DC = 1 OR 2 OR 5
006480                 MOVE NC"返品" TO P-DCM
006490               ELSE
006500                 IF S1-DC = 3 OR 4 OR 7
006510                     IF S1-SUT < ZERO
006520                         MOVE NC"値引" TO P-DCM
006530                       ELSE
006540                         MOVE NC"売上" TO P-DCM.
006550     IF S1-UNC = 1
006560         IF S1-KIN < 0
006570             MOVE NC"売上" TO P-DCM
006580           ELSE
006590             MOVE NC"値引" TO P-DCM.
006600     IF S1-DC = 2
006610         MOVE NC"不良返品" TO P-DCD.
006620     IF S1-DC = 3
006630         MOVE NC"預り保管" TO P-DCD.
006640     IF S1-DC = 8
006650         MOVE NC"税調整分" TO P-DCD.
006660     IF W-CCC = 1
006670         MOVE TC-NAME TO WN-NAME
006680       ELSE
006690         MOVE T-NAME TO WN-NAME.
006700     MOVE WN-NAME TO P-TNA.
006710     MOVE S1-TCD TO P-TCD.
006720     IF W-CCC = 1
006730         MOVE "-" TO P-X
006740         MOVE S1-CCD TO P-CCD.
006750     IF S1-MNGP NOT = ZERO AND 99999999
006760         MOVE S1-MNGP TO P-MNGP.
006770     IF LINAGE-COUNTER > 62
006780         PERFORM MID-RTN THRU MID-EX.
006790     MOVE SPACE TO SP-R.
006800     MOVE W-P1 TO SP-R.
006810     WRITE SP-R.
006820     IF S1-DC NOT = 8
006830         GO TO M-360.
006840     ADD S1-KIN TO W-AKIN.
006850     PERFORM MEI-120 THRU MEI-EX.
006860     GO TO M-400.
006870 M-360.
006880     ADD 1 TO W-GNO.
006890     IF W-GNO = 7
006900         DISPLAY E-ME5 E-ME99
006910         GO TO M-980.
006920     IF W-GNO NOT = S1-GNO
006930         DISPLAY E-ME6 E-ME99.
006940     PERFORM MEI-RTN THRU MEI-EX.
006950 M-400.
006960     IF JS-SIGN = 1
006970         GO TO M-420.
006980     READ S-TRAN AT END
006990         DISPLAY E-ME7 E-ME99
007000         GO TO M-980.
007010     MOVE S-R TO WR-S1.
007020     GO TO M-440.
007030 M-420.
007040     READ STRANYR AT END
007050         DISPLAY E-ME7 E-ME99
007060         GO TO M-980.
007070     MOVE STRANYR-R TO WR-S1.
007080 M-440.
007090     IF S1-DNO = W-DNO
007100         IF S1-GNO NOT = 9
007110             GO TO M-360.
007120     IF S1-DNO NOT = W-DNO
007130         DISPLAY E-ME7 E-ME99
007140         GO TO M-980.
007150     PERFORM KEI-RTN THRU KEI-EX.
007160     IF JS-SIGN = 1
007170         GO TO M-230
007180       ELSE
007190         GO TO M-220.
007200 M-920.
007210     IF W-DZC = 0
007220         DISPLAY E-ME11 E-ME99.
007230 M-980.
007240     CLOSE HI-M T-M TC-M.
007250     CLOSE SP-F.
007260     IF JS-SIGN = 1
007270         CLOSE STRANYR
007280         GO TO M-040
007290       ELSE
007300         CLOSE S-TRAN.
007310     DISPLAY C-CLEAR.
007320     STOP RUN.
007330 MID-RTN.
007340     MOVE SPACE TO SP-R.
007350     WRITE SP-R AFTER PAGE.
007360 MID-010.
007370     ADD 1 TO W-PAGE.
007380     MOVE W-PAGE TO H-PAGE.
007390     MOVE SPACE TO SP-R.
007400     MOVE HEAD1 TO SP-R.
007410     WRITE SP-R.
007420     MOVE SPACE TO SP-R.
007430     MOVE HEAD2 TO SP-R.
007440     WRITE SP-R AFTER 2.
007450     MOVE SPACE TO SP-R.
007460     MOVE HEAD3 TO SP-R.
007470     WRITE SP-R.
007480     MOVE SPACE TO SP-R.
007490     MOVE HEAD4 TO SP-R.
007500     WRITE SP-R.
007510     MOVE SPACE TO SP-R.
007520     MOVE HEAD5 TO SP-R.
007530     WRITE SP-R.
007540     MOVE SPACE TO SP-R.
007550*****MOVE ZERO TO W-GNO.
007560 MID-EX.
007570     EXIT.
007580 MEI-RTN.
007590     MOVE S1-DC TO W-DC.
007600     MOVE SPACE TO W-P2.
007610     MOVE SPACE TO P-HNA.
007620     MOVE W-15K TO P-15K2.
007630     MOVE W-20K TO P-20K2.
007640     IF (S1-UNC = 1) OR (S1-HCD > 999899) OR (S1-DC = 3)
007650         GO TO MEI-040.
007660     MOVE ZERO TO CNT W-ASU.
007670 MEI-020.
007680     ADD 1 TO CNT.
007690     IF CNT = 11
007700         GO TO MEI-040.
007710     MOVE S1-SU(CNT) TO W-SU(CNT).
007720     IF W-SU(CNT) NOT = ZERO
007730         MOVE W-SU(CNT) TO P-SU(CNT).
007740     GO TO MEI-020.
007750 MEI-040.
007760     IF S1-HCD NOT = ZERO
007770         MOVE S1-HCD TO P-HCD
007780         IF S1-UNC = 0
007790             MOVE S1-SIZ TO P-SIZ.
007800     MOVE S1-SUT TO W-SUT.
007810     IF S1-HCD = ZERO
007820         GO TO MEI-100.
007830     IF S1-DC = 3 OR 4 OR 7
007840         IF W-SUT < ZERO
007850             COMPUTE W-SUT = W-SUT * -1.
007860     MOVE W-SUT TO P-SUT.
007870     IF S1-DC NOT = 4
007880         GO TO MEI-060.
007890     IF S1-SUT < ZERO
007900         MOVE NC"預りへ戻し" TO P-MSM
007910       ELSE
007920         MOVE NC"預り出荷　" TO P-MSM.
007930     GO TO MEI-080.
007940 MEI-060.
007950     IF S1-DC = 9
007960         MOVE NC"預り振替　"    TO P-MSM
007970         GO TO MEI-080.
007980     MOVE S1-T TO P-T.
007990     MOVE S1-KIN TO W-KIN.
008000     IF (S1-DC = 3) OR (S1-UNC = 1)
008010         IF W-KIN < ZERO
008020             COMPUTE W-KIN = W-KIN * -1.
008030     MOVE W-KIN TO P-KIN.
008040 MEI-080.
008050     MOVE S1-HCD TO HI-KEY.
008060     READ HI-M WITH UNLOCK INVALID KEY
008070         DISPLAY E-ME3 E-HCD E-ME99
008080         MOVE SPACE TO HI-NAME.
008090     IF S1-TCD = 0013 OR 0458 OR 0459 OR 0460
008100         MOVE HI-NAME TO W-NAME
008110         MOVE SPACE TO W-NA(24)
008120         MOVE W-NAME TO P-HNA
008130       ELSE
008140         MOVE HI-NAME TO P-HNA.
008150     IF S1-UNC = 0
008160         IF S1-BIK NOT = SPACE
008170             MOVE S1-BIK TO P-BIK.
008180 MEI-100.
008190     IF LINAGE-COUNTER > 63
008200         PERFORM MID-RTN THRU MID-EX.
008210     MOVE SPACE TO SP-R.
008220     MOVE W-P2 TO SP-R.
008230     WRITE SP-R.
008240     MOVE SPACE TO SP-R.
008250     IF S1-HCD <  999900
008260         ADD W-SUT TO W-ASUT.
008270     IF S1-DC NOT = 4 AND 9
008280         ADD S1-KIN TO W-AKIN.
008290 MEI-120.
008300     IF JS-SIGN = 1
008310         GO TO MEI-EX.
008320     MOVE 1 TO S1-DHC.
008330     MOVE WR-S1 TO S-R.
008340     REWRITE S-R.
008350     IF ERR-STAT NOT = "00"
008360         DISPLAY E-ME78 E-STAT E-ME24 E-ME99
008370         DISPLAY E-CL.
008380 MEI-EX.
008390     EXIT.
008400 KEI-RTN.
008410     MOVE SPACE TO W-P3.
008420     MOVE W-15K TO P-15K3.
008430     MOVE ALL NC"　" TO P-KOSU P-KO P-CNAM P-NOM P-TME P-SZM.
008440     IF SV-KOSU NOT = ZERO
008450        MOVE SV-KOSU TO   W-KOSU
008460        MOVE W-KOSU  TO   P-KOSU
008470        MOVE NC"個口" TO  P-KO.
008480     IF SV-CCD2 NOT = ZERO AND 001
008490         IF W-CCC = 0
008500             PERFORM TNA-RTN THRU TNA-EX.
008510     MOVE NC"　合　計" TO P-TME.
008520     IF S2-HNO NOT = ZERO
008530         MOVE NC"発送明細書№" TO P-NOM
008540         MOVE S2-HNO TO P-HMN.
008550     IF W-GNO = ZERO
008560         MOVE W-AKIN TO W-SHZ W-KINZ
008570         MOVE ZERO TO W-AKIN W-KIN
008580         GO TO KEI-060.
008590     MOVE W-ASUT TO P-GSUT.                                       数計
008600     MOVE W-AKIN TO W-KIN.
008610*****IF W-NGS < 1404                                              D.140328
008620*****    IF W-HSC = 0                                             D.140328
008630*****        COMPUTE W-SHZ ROUNDED = W-KIN * 0.05.                D.140328
008640*****IF W-NGS < 1404                                              D.140328
008650*****    IF W-HSC = 3                                             D.140328
008660*****        COMPUTE W-SHZ ROUNDED = W-KIN * 0.03.                D.140328
008670*****IF W-NGS NOT < 1404                                          D.140328
008680     IF W-HSC = 8                                                 I.140110
008690         COMPUTE W-SHZ ROUNDED = W-KIN * 0.08                     I.140110
008700       ELSE                                                       I.140110
008710         IF W-HSC = 5                                             I.140110
008720             COMPUTE W-SHZ ROUNDED = W-KIN * 0.05                 I.140110
008730           ELSE                                                   I.140110
008740             IF W-HSC = 3                                         I.140110
008750                 COMPUTE W-SHZ ROUNDED = W-KIN * 0.03             I.140110
008760               ELSE                                               I.140110
008770                 IF W-HSC = 1                                     I.140110
008780                     COMPUTE W-SHZ ROUNDED = W-KIN * 0.10.        I.140110
008790     MOVE W-SHZ TO W-KINZ.
008800     IF (W-DC = 3) OR (S2-UNC = 1)
008810         IF W-KIN < ZERO
008820             COMPUTE W-KIN = W-KIN * -1
008830             COMPUTE W-KINZ = W-KINZ * -1.
008840 KEI-060.
008850     MOVE W-KIN TO P-GKIN.                                        計
008860     IF LINAGE-COUNTER > 63
008870         PERFORM MID-RTN THRU MID-EX.
008880     MOVE SPACE TO SP-R.
008890     MOVE W-P3 TO SP-R.
008900     WRITE SP-R.
008910     MOVE SPACE TO SP-R.
008920*
008930     MOVE SPACE TO W-P3.
008940     MOVE W-15K TO P-15K3.
008950     MOVE ALL NC"　" TO P-KOSU P-KO P-CNAM P-NOM P-TME P-SZM.
008960     MOVE S2-BI TO P-BI.
008970     MOVE NC"消費税　" TO P-SZM.
008980     MOVE W-KINZ TO P-GKIN.                                       消
008990     COMPUTE W-TKIN = W-KIN + W-KINZ.
009000     MOVE W-TKIN TO P-TKIN.                                       総
009010     IF LINAGE-COUNTER > 63
009020         PERFORM MID-RTN THRU MID-EX.
009030     MOVE SPACE TO SP-R.
009040     MOVE W-P3 TO SP-R.
009050     WRITE SP-R.
009060     MOVE SPACE TO SP-R.
009070     MOVE W-P8 TO SP-R.
009080     WRITE SP-R.
009090     MOVE SPACE TO SP-R.
009100     IF JS-SIGN = 0
009110         IF W-DC = 1 OR 2 OR 5
009120             COMPUTE W-AKIN = W-AKIN * -1
009130             COMPUTE W-SHZ = W-SHZ * -1.
009140     IF JS-SIGN = 1
009150         GO TO KEI-EX.
009160     MOVE W-SHZ TO S2-TAX.
009170     MOVE 1 TO S2-DHC.
009180     MOVE WR-S2 TO S-R.
009190     REWRITE S-R.
009200     IF ERR-STAT NOT = "00"
009210         DISPLAY E-ME78 E-STAT E-ME24 E-ME99
009220         DISPLAY E-CL.
009230 KEI-EX.
009240     EXIT.
009250 TNA-RTN.
009260     MOVE SV-TCD TO TC-TCD.
009270     MOVE SV-CCD2 TO TC-CCD.
009280     READ TC-M UNLOCK INVALID KEY
009290         MOVE SPACE TO TC-NAME.
009300     MOVE TC-NAME TO P-CNAM.
009310     MOVE P-CNAM TO TBL-NAM.
009320     MOVE 26 TO N.
009330 TNA-020.
009340     IF N = 0
009350         GO TO TNA-EX.
009360     IF T-NAM(N) NOT = SPACE AND NC"　"
009370         GO TO TNA-040.
009380     COMPUTE N = N - 1.
009390     GO TO TNA-020.
009400 TNA-040.
009410     IF W-DC = 1 OR 2
009420         ADD 1 TO N
009430         MOVE NC"様" TO T-NAM(N)
009440         ADD 1 TO N
009450         MOVE NC"よ" TO T-NAM(N)
009460         ADD 1 TO N
009470         MOVE NC"り" TO T-NAM(N)
009480         ADD 1 TO N
009490         MOVE NC"返" TO T-NAM(N)
009500         ADD 1 TO N
009510         MOVE NC"品" TO T-NAM(N)
009520         MOVE TBL-NAM TO P-CNAM
009530         GO TO TNA-EX.
009540     ADD 1 TO N.
009550     MOVE NC"様" TO T-NAM(N).
009560     ADD 1 TO N.
009570     MOVE NC"　" TO T-NAM(N).
009580     ADD 1 TO N.
009590     MOVE NC"直" TO T-NAM(N).
009600     ADD 1 TO N.
009610     MOVE NC"送" TO T-NAM(N).
009620     MOVE TBL-NAM TO P-CNAM.
009630 TNA-EX.
009640     EXIT.
009650 CHK-RTN.
009660     MOVE 0 TO W-DCHK.
009670     OPEN INPUT S-TRAN.
009680 CHK-020.
009690     READ S-TRAN AT END
009700         GO TO CHK-040.
009710     MOVE S-R TO WR-S1.
009720     IF W-DCHK = 1
009730         IF S1-DHC = 1
009740             MOVE 3 TO W-DCHK
009750             GO TO CHK-040
009760           ELSE
009770             GO TO CHK-020.
009780     IF W-DCHK = 2
009790         IF S1-DHC NOT = 1
009800             MOVE 3 TO W-DCHK
009810             GO TO CHK-040
009820           ELSE
009830             GO TO CHK-020.
009840     IF S1-DHC NOT = 1
009850         MOVE 1 TO W-DCHK
009860       ELSE
009870         MOVE 2 TO W-DCHK.
009880     GO TO CHK-020.
009890 CHK-040.
009900     CLOSE S-TRAN.
009910 CHK-EX.
009920     EXIT.
009930 ERR-RTN.
009940     DISPLAY E-ME99
009950     GO TO ERR-RTN.
009960 ERR-EX.
009970     EXIT.
