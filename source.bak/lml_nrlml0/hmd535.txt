000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMD530.
000030 AUTHOR. S-NAKAO.
000040 DATE-WRITTEN. 1974-05-03.
000050*********************************************************
000060*    PROGRAM         :  入金　累積・更新・クリア　　　　*
000070*    PRINTER TYPE    :  JIPS                            *
000080*    SCREEN          :  ******                          *
000090*    COMPILE TYPE    :  COBOL                           *
000100*********************************************************
000110 ENVIRONMENT DIVISION.
000120 CONFIGURATION SECTION.
000130 SOURCE-COMPUTER. SYSTEM3100.
000140 OBJECT-COMPUTER. SYSTEM3100.
000150 INPUT-OUTPUT SECTION.
000160 FILE-CONTROL.
000170     COPY LIBCSE.
000180     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000190         ORGANIZATION INDEXED
000200         ACCESS MODE RANDOM
000210         RECORD KEY T-KEY
000220         ALTERNATE RECORD KEY T-KEY2
000230         FILE STATUS ERR-STAT.
000240     SELECT NYU-F ASSIGN TO NYU-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE DYNAMIC
000270         RECORD KEY N-KEY
000280         FILE STATUS ERR-STAT.
000290     SELECT NYUR-F ASSIGN TO NYUR-MSD
000300         FILE STATUS ERR-STAT.
000310     SELECT NYURYR ASSIGN TO NYURY-MSD
000320         FILE STATUS ERR-STAT.
000330     SELECT HKBM ASSIGN TO HKB-MSD
000340         ORGANIZATION INDEXED
000350         RECORD KEY HKB-KEY
000360         ACCESS MODE RANDOM
000370         FILE STATUS IS ERR-STAT.
000380     SELECT TUKF ASSIGN TO TUK1-MSD TUK2-MSD
000390         ORGANIZATION INDEXED
000400         ACCESS MODE RANDOM
000410         RECORD KEY TUK-KEY
000420         ALTERNATE RECORD KEY TUK-KEY2
000430         FILE STATUS IS ERR-STAT.
000440     SELECT SKDF ASSIGN TO SKD-MSD
000450         ORGANIZATION INDEXED
000460         ACCESS MODE DYNAMIC
000470         RECORD KEY SKD-KEY
000480         FILE STATUS IS ERR-STAT.
000490     SELECT TT-M ASSIGN TO TT-MSD
000500         ORGANIZATION INDEXED
000510         ACCESS MODE RANDOM
000520         RECORD KEY TT-KEY
000530         FILE STATUS IS ERR-STAT.
000540 I-O-CONTROL.
000550     APPLY SHARED-MODE ON M-DATE
000560     APPLY SHARED-MODE ON T-M
000570     APPLY SHARED-MODE ON TT-M
000580     APPLY SHARED-MODE ON HKBM
000590     APPLY SHARED-MODE ON TUKF
000600     APPLY SHARED-MODE ON SKDF
000610     APPLY SHARED-MODE ON NYUR-F.
000620 DATA DIVISION.
000630 FILE SECTION.
000640     COPY LIBFDD.
000650     COPY LITM.
000660     COPY LITTM.
000670     COPY LSNYUR.
000680     COPY LIHKBM.
000690     COPY LITUKF.
000700     COPY LISKDF.
000710 FD  NYU-F
000720     BLOCK  5 RECORDS
000730     LABEL RECORD IS STANDARD
000740     VALUE OF IDENTIFICATION IS "NYUF".
000750 01  NYU-R.
000760     02  NYU-RD.
000770       03  N-DATE       PIC  9(008).
000780       03  N-TCD        PIC  9(004).
000790       03  N-KIN        PIC S9(008).
000800       03  N-NC.
000810         04  N-NC1      PIC  9(001).
000820         04  N-NC2      PIC  9(001).
000830       03  F            PIC  X(015).
000840       03  N-BC         PIC  9(001).
000850       03  N-TNC        PIC  9(002).
000860       03  F            PIC  X(003).
000870       03  N-KEY.
000880         04  N-NO       PIC  9(006).
000890         04  N-GNO      PIC  9(001).
000900       03  F            PIC  X(008).
000910       03  N-SKD        PIC  9(008).
000920       03  N-DCC        PIC  9(001).
000930       03  F            PIC  X(014).
000940       03  N-RSC        PIC  9(001).
000950       03  N-DPC        PIC  9(001).
000960       03  F            PIC  X(002).
000970     02  F              PIC  X(017).
000980 FD  NYURYR
000990     BLOCK  5 RECORDS
001000     LABEL RECORD IS STANDARD
001010     VALUE OF IDENTIFICATION IS "NYURYR".
001020 01  NYURY-R            PIC  X(102).
001030 WORKING-STORAGE SECTION.
001040 77  W-FILE             PIC  X(013).
001050 77  W-END              PIC  9(001) VALUE 0.
001060 01  W-DATA.
001070     02  W-NKD.
001080       03  WN-NO        PIC  9(006).
001090       03  WN-DATE      PIC  9(008).
001100       03  WN-TCD       PIC  9(004).
001110       03  WN-TNC       PIC  9(002).
001120       03  WN-BC        PIC  9(001).
001130       03  WN-DCC       PIC  9(001).
001140       03  WN-SKD       PIC  9(008).
001150       03  WN-KIN       PIC S9(009).
001160       03  WN-SHZ       PIC S9(007).
001170     02  W-FD.
001180       03  W-FC         PIC  9(001).
001190       03  W-FTCD       PIC  9(004).
001200       03  W-FNG        PIC  9(006).
001210     02  W-KEY.
001220       03  WK-TCD       PIC  9(004).
001230       03  F            PIC  X(009).
001240       03  WK-DNO       PIC  9(006).
001250       03  F            PIC  X(001).
001260     02  W-DMM          PIC  9(001).
001270     02  W-TUK.
001280       03  W-TCD        PIC  9(004).
001290       03  W-DATE       PIC  9(008).
001300       03  W-DC         PIC  9(001).
001310       03  W-KIN        PIC S9(009).
001320       03  W-SHZ        PIC S9(007).
001330       03  W-DNO        PIC  9(006).
001340       03  W-GNO        PIC  9(001).
001350     02  WT-D.
001360       03  WT-TZZ       PIC S9(009).
001370       03  WT-TUA       PIC S9(009).
001380       03  WT-TNB       PIC S9(009).
001390       03  WT-TNK       PIC S9(009).
001400       03  WT-TUZ       PIC S9(009).
001410       03  WT-TUZW      PIC S9(009).
001420 01  ERR-STAT           PIC  X(002).
001430     COPY LDAIW.
001440     COPY LSTAT.
001450 SCREEN SECTION.
001460 SD  C-CRT
001470     END STATUS IS ESTAT.
001480 01  C-CLEAR.
001490     02  C-CL    LINE   1  CLEAR SCREEN.
001500 01  C-MID.
001510     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
001520          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001530     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
001540          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001550     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
001560          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001570     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
001580          NC"＊＊＊　　入金　累積・更新・クリア　　＊＊＊".
001590     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
001600          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001610     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
001620          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001630     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
001640          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001650     02  LINE  20  COLUMN  30  PIC  X(022) VALUE
001660            "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001670 01  C-ACP.
001680     02  A-DMM   LINE  20  COLUMN  47  PIC  9(001)
001690          USING W-DMM  CHECK OVERFLOW NO IFC.
001700 01  C-DSP.
001710     02  D-ZM.
001720       03  LINE  14.
001730         04  COLUMN  08  PIC  X(004) VALUE "ｺｰﾄﾞ".
001740         04  COLUMN  13  PIC  9(004) FROM  TT-TCD.
001750       03  LINE  15.
001760         04  COLUMN  14  PIC  N(006) VALUE NC"　　　前月残".
001770         04  COLUMN  26  PIC  N(006) VALUE NC"　　　売　上".
001780         04  COLUMN  38  PIC  N(006) VALUE NC"　　　値　引".
001790         04  COLUMN  50  PIC  N(006) VALUE NC"　　　入　金".
001800         04  COLUMN  62  PIC  N(006) VALUE NC"　　　売掛残".
001810       03  LINE  16.
001820         04  COLUMN  08  PIC  N(003) VALUE NC"本　体".
001830         04  COLUMN  14  PIC ----,---,--9  FROM TT-TZZ.
001840         04  COLUMN  26  PIC ----,---,--9  FROM TT-TUA.
001850         04  COLUMN  38  PIC ----,---,--9  FROM TT-TNB.
001860         04  COLUMN  50  PIC ----,---,--9  FROM TT-TNK.
001870         04  COLUMN  62  PIC ----,---,--9  FROM TT-TUZ.
001880       03  LINE  17.
001890         04  COLUMN  08  PIC  N(003) VALUE NC"消費税".
001900         04  COLUMN  14  PIC ----,---,--9  FROM TT-TZZZ.
001910         04  COLUMN  26  PIC ----,---,--9  FROM TT-TUAZ.
001920         04  COLUMN  38  PIC ----,---,--9  FROM TT-TNBZ.
001930         04  COLUMN  50  PIC ----,---,--9  FROM TT-TNKZ.
001940         04  COLUMN  62  PIC ----,---,--9  FROM TT-TUZZ.
001950       03  LINE  18.
001960         04  COLUMN  08  PIC  N(003) VALUE NC"合　計".
001970         04  COLUMN  14  PIC ----,---,--9  FROM WT-TZZ.
001980         04  COLUMN  26  PIC ----,---,--9  FROM WT-TUA.
001990         04  COLUMN  38  PIC ----,---,--9  FROM WT-TNB.
002000         04  COLUMN  50  PIC ----,---,--9  FROM WT-TNK.
002010         04  COLUMN  62  PIC ----,---,--9  FROM WT-TUZ.
002020     02  D-ZMC.
002030       03  LINE  14.
002040         04  COLUMN  08  PIC  X(004) VALUE "    ".
002050         04  COLUMN  13  PIC  X(004) VALUE "    ".
002060       03  LINE  15.
002070         04  COLUMN  14  PIC  X(012) VALUE "            ".
002080         04  COLUMN  26  PIC  X(012) VALUE "            ".
002090         04  COLUMN  38  PIC  X(012) VALUE "            ".
002100         04  COLUMN  50  PIC  X(012) VALUE "            ".
002110         04  COLUMN  62  PIC  X(012) VALUE "            ".
002120       03  LINE  16.
002130         04  COLUMN  14  PIC  X(012) VALUE "            ".
002140         04  COLUMN  26  PIC  X(012) VALUE "            ".
002150         04  COLUMN  38  PIC  X(012) VALUE "            ".
002160         04  COLUMN  50  PIC  X(012) VALUE "            ".
002170         04  COLUMN  62  PIC  X(012) VALUE "            ".
002180       03  LINE  17.
002190         04  COLUMN  14  PIC  X(012) VALUE "            ".
002200         04  COLUMN  26  PIC  X(012) VALUE "            ".
002210         04  COLUMN  38  PIC  X(012) VALUE "            ".
002220         04  COLUMN  50  PIC  X(012) VALUE "            ".
002230         04  COLUMN  62  PIC  X(012) VALUE "            ".
002240       03  LINE  18.
002250         04  COLUMN  14  PIC  X(012) VALUE "            ".
002260         04  COLUMN  26  PIC  X(012) VALUE "            ".
002270         04  COLUMN  38  PIC  X(012) VALUE "            ".
002280         04  COLUMN  50  PIC  X(012) VALUE "            ".
002290         04  COLUMN  62  PIC  X(012) VALUE "            ".
002300 01  C-ERR.
002310     02  LINE 24.
002320       03  E-ME1.
002330         04  COLUMN  15  PIC  X(036) VALUE
002340              "***  NYUF DELETE ｴﾗｰ (      - )  ***".
002350         04  COLUMN  37  PIC  9(006) FROM  N-NO.
002360         04  COLUMN  44  PIC  9(001) FROM  N-GNO.
002370       03  E-ME2   COLUMN  15  PIC  X(025) VALUE
002380            "***  NYURF WRITE ｴﾗｰ  ***".
002390       03  E-ME7   COLUMN  15  PIC  X(026) VALUE
002400            "***  NYURYR WRITE ｴﾗｰ  ***".
002410       03  E-ME8   COLUMN  15  PIC  X(026) VALUE
002420            "***  NYUF REWRITE ｴﾗｰ  ***".
002430       03  E-ME19  COLUMN  15  PIC  X(024) VALUE
002440            "***  HKBM WRITE ｴﾗｰ  ***".
002450       03  E-ME20  COLUMN  15  PIC  X(026) VALUE
002460            "***  HKBM REWRITE ｴﾗｰ  ***".
002470       03  E-ME21  COLUMN  15  PIC  X(017) VALUE
002480            "***  HKBM ﾅｼ  ***".
002490       03  E-ME22  COLUMN  15  PIC  X(016) VALUE
002500            "***  TTM ﾅｼ  ***".
002510       03  E-ME25  COLUMN  15  PIC  X(024) VALUE
002520            "***  TM REWRITE ｴﾗｰ  ***".
002530       03  E-ME27  COLUMN  15  PIC  X(025) VALUE
002540            "***  TTM REWRITE ｴﾗｰ  ***".
002550       03  E-ME28  COLUMN  15  PIC  X(026) VALUE
002560            "***   TUKF WRITE ｴﾗｰ   ***".
002570       03  E-ME29  COLUMN  15  PIC  X(026) VALUE
002580            "***   SKDF WRITE ｴﾗｰ   ***".
002590       03  E-ME30  COLUMN  15  PIC  X(026) VALUE
002600            "***  SKDF REWRITE ｴﾗｰ  ***".
002610       03  E-ME40  COLUMN  15  PIC  X(026) VALUE
002620            "***   ﾀﾞｲﾁｮｳNO ｵｰﾊﾞｰ   ***".
002630       03  E-TCD   COLUMN  45  PIC  9(004) FROM  WK-TCD.
002640     COPY LSSEM.
002650 PROCEDURE DIVISION.
002660 M-05.
002670     DISPLAY C-CLEAR.
002680     DISPLAY C-MID.
002690     MOVE ZERO TO W-DATA.
002700 M-10.
002710     ACCEPT A-DMM.
002720     IF ESTAT = PF9
002730         MOVE 255 TO COMPLETION-CODE
002740         GO TO M-95.
002750     IF ESTAT NOT = HTB AND SKP
002760         GO TO M-10.
002770     IF W-DMM = 9
002780         MOVE 255 TO COMPLETION-CODE
002790         GO TO M-95.
002800     IF W-DMM NOT = 1
002810         GO TO M-10.
002820*
002830     OPEN I-O T-M.
002840     OPEN I-O SKDF.
002850     OPEN I-O TT-M.
002860     OPEN I-O HKBM.
002870     OPEN I-O TUKF.
002880     OPEN I-O NYU-F.
002890     OPEN EXTEND NYUR-F.
002900     OPEN EXTEND NYURYR.
002910     MOVE ZERO TO W-NKD.
002920 M-15.
002930     READ NYU-F NEXT RECORD AT END
002940         GO TO M-40.
002950     IF N-DPC = 0
002960         GO TO M-15.
002970 M-20.
002980     MOVE ZERO TO NYUR-R.
002990     MOVE NYU-R TO NYUR-R.
003000     WRITE NYUR-R.
003010     IF ERR-STAT = "00"
003020         CALL "CBLTCLS" USING NYUR-F
003030         GO TO M-25.
003040     DISPLAY E-STAT E-ME2 E-ME99.
003050     IF ERR-STAT NOT = "34"
003060         MOVE 255 TO COMPLETION-CODE
003070         DISPLAY E-ME78 E-ME99
003080         GO TO M-45.
003090     DISPLAY E-CL.
003100     CLOSE NYUR-F.
003110     MOVE "NYURF        " TO W-FILE.
003120     DISPLAY E-ME71 E-ME98 STOP " ".
003130     DISPLAY E-CL.
003140     OPEN EXTEND NYUR-F.
003150     GO TO M-20.
003160 M-25.
003170     MOVE ZERO TO NYURY-R.
003180     MOVE NYU-R TO NYURY-R.
003190     WRITE NYURY-R.
003200     IF ERR-STAT = "00"
003210         CALL "CBLTCLS" USING NYURYR
003220         GO TO M-30.
003230     DISPLAY E-STAT E-ME7 E-ME99.
003240     IF ERR-STAT NOT = "34"
003250         MOVE 255 TO COMPLETION-CODE
003260         DISPLAY E-ME78 E-ME99
003270         GO TO M-45.
003280     DISPLAY E-CL.
003290     CLOSE NYURYR.
003300     MOVE "NYURYR       " TO W-FILE.
003310     DISPLAY E-ME71 E-ME98 STOP " ".
003320     DISPLAY E-CL.
003330     OPEN EXTEND NYURYR.
003340     GO TO M-25.
003350 M-30.
003360     IF WN-TCD = ZERO
003370         MOVE N-DATE TO WN-DATE
003380         MOVE N-TCD TO WN-TCD
003390         MOVE N-NO TO WN-NO
003400         MOVE N-TNC TO WN-TNC
003410         MOVE N-BC TO WN-BC
003420         MOVE N-DCC TO WN-DCC
003430         MOVE N-SKD TO WN-SKD
003440       ELSE
003450         IF N-NO NOT = WN-NO
003460             GO TO M-35.
003470     IF N-NC2 > 7
003480         ADD N-KIN TO WN-SHZ
003490       ELSE
003500         ADD N-KIN TO WN-KIN.
003510     MOVE 1 TO N-RSC.
003520     REWRITE NYU-R INVALID KEY
003530         MOVE 255 TO COMPLETION-CODE
003540         DISPLAY E-STAT E-ME8 E-ME99
003550         DISPLAY E-ME78 E-ME99
003560         GO TO M-45.
003570*
003580     MOVE ZERO TO W-FD.
003590     MOVE 2 TO W-FC.
003600     MOVE NUR-TCD TO W-FTCD.
003610     MOVE NUR-NG TO W-FNG.
003620     PERFORM DNG-RTN THRU DNG-EX.
003630     GO TO M-15.
003640 M-35.
003650     MOVE WN-TCD TO TT-KEY.
003660     READ TT-M INVALID KEY
003670         MOVE 255 TO COMPLETION-CODE
003680         DISPLAY E-ME22 E-TCD E-ME99
003690         GO TO M-45.
003700     ADD WN-KIN TO TT-TNK.
003710     ADD WN-SHZ TO TT-TNKZ.
003720     SUBTRACT WN-KIN FROM TT-TUZ.
003730     SUBTRACT WN-SHZ FROM TT-TUZZ.
003740     COMPUTE WT-TZZ = TT-TZZ + TT-TZZZ.
003750     COMPUTE WT-TUA = TT-TUA + TT-TUAZ.
003760     COMPUTE WT-TNB = TT-TNB + TT-TNBZ.
003770     COMPUTE WT-TNK = TT-TNK + TT-TNKZ.
003780     COMPUTE WT-TUZ = TT-TUZ + TT-TUZZ.
003790     COMPUTE WT-TUZW = WT-TZZ + WT-TUA - WT-TNB - WT-TNK.
003800     IF WT-TUZ NOT = WT-TUZW
003810         DISPLAY D-ZM E-ME99
003820         DISPLAY D-ZMC.
003830     REWRITE TT-R INVALID KEY
003840         MOVE 255 TO COMPLETION-CODE
003850         DISPLAY E-STAT E-ME27 E-TCD E-ME99
003860         GO TO M-45.
003870*-------------------------------------------------------------------------
003880     PERFORM SKDW-RTN THRU SKDW-EX.
003890     IF W-END = 9
003900         MOVE 255 TO COMPLETION-CODE
003910         GO TO M-45.
003920     PERFORM DNO2-RTN THRU DNO2-EX.
003930     MOVE ZERO TO W-TUK.
003940     MOVE WN-TCD TO W-TCD.
003950     MOVE WN-DATE TO W-DATE.
003960     MOVE 3 TO W-DC.
003970     MOVE WN-KIN TO W-KIN.
003980     MOVE WN-SHZ TO W-SHZ.
003990     MOVE WN-NO TO W-DNO.
004000     MOVE 0 TO W-GNO.
004010     PERFORM TUK-RTN THRU TUK-EX.
004020     MOVE ZERO TO W-NKD.
004030     GO TO M-30.
004040 M-40.
004050     IF WN-TCD = ZERO
004060         GO TO M-45.
004070     MOVE WN-TCD TO TT-KEY.
004080     READ TT-M INVALID KEY
004090         MOVE 255 TO COMPLETION-CODE
004100         DISPLAY E-ME22 E-TCD E-ME99
004110         GO TO M-45.
004120     ADD WN-KIN TO TT-TNK.
004130     ADD WN-SHZ TO TT-TNKZ.
004140     SUBTRACT WN-KIN FROM TT-TUZ.
004150     SUBTRACT WN-SHZ FROM TT-TUZZ.
004160     COMPUTE WT-TZZ = TT-TZZ + TT-TZZZ.
004170     COMPUTE WT-TUA = TT-TUA + TT-TUAZ.
004180     COMPUTE WT-TNB = TT-TNB + TT-TNBZ.
004190     COMPUTE WT-TNK = TT-TNK + TT-TNKZ.
004200     COMPUTE WT-TUZ = TT-TUZ + TT-TUZZ.
004210     COMPUTE WT-TUZW = WT-TZZ + WT-TUA - WT-TNB - WT-TNK.
004220     IF WT-TUZ NOT = WT-TUZW
004230         DISPLAY D-ZM E-ME99
004240         DISPLAY D-ZMC.
004250     REWRITE TT-R INVALID KEY
004260         MOVE 255 TO COMPLETION-CODE
004270         DISPLAY E-STAT E-ME27 E-TCD E-ME99
004280         GO TO M-45.
004290     PERFORM SKDW-RTN THRU SKDW-EX.
004300     IF W-END = 9
004310         MOVE 255 TO COMPLETION-CODE
004320         GO TO M-45.
004330     PERFORM DNO2-RTN THRU DNO2-EX.
004340     MOVE ZERO TO W-TUK.
004350     MOVE WN-TCD TO W-TCD.
004360     MOVE WN-DATE TO W-DATE.
004370     MOVE 3 TO W-DC.
004380     MOVE WN-KIN TO W-KIN.
004390     MOVE WN-SHZ TO W-SHZ.
004400     MOVE WN-NO TO W-DNO.
004410     MOVE 0 TO W-GNO.
004420     PERFORM TUK-RTN THRU TUK-EX.
004430 M-45.
004440     CLOSE SKDF.
004450     CLOSE TUKF.
004460     CLOSE HKBM.
004470     CLOSE NYU-F.
004480     CLOSE NYUR-F.
004490     CLOSE NYURYR.
004500     CLOSE TT-M.
004510     CLOSE T-M.
004520     IF COMPLETION-CODE = 255
004530         GO TO M-95.
004540     OPEN I-O NYU-F.
004550 M-50.
004560     READ NYU-F NEXT RECORD AT END
004570         GO TO M-55.
004580     IF N-RSC NOT = 1
004590         GO TO M-50.
004600     DELETE NYU-F INVALID KEY
004610         MOVE 255 TO COMPLETION-CODE
004620         DISPLAY E-STAT E-ME1 E-ME99.
004630     GO TO M-50.
004640 M-55.
004650     CLOSE NYU-F.
004660 M-95.
004670     DISPLAY C-CLEAR.
004680     STOP RUN.
004690 SKDW-RTN.
004700     INITIALIZE SKD-R.
004710     MOVE ZERO TO SKD-HNO.
004720     MOVE SPACE TO SKD-BI.
004730     MOVE WN-TCD TO SKD-TCD.
004740     MOVE WN-DATE TO SKD-DATE.
004750     MOVE 3 TO SKD-DTC.
004760     MOVE WN-NO TO SKD-DNO.
004770     MOVE WN-KIN TO SKD-KIN.
004780     MOVE WN-SKD TO SKD-SKD.
004790     MOVE WN-TNC TO SKD-TNC.
004800     MOVE WN-BC TO SKD-BMC.
004810     MOVE WN-DCC TO SKD-DCC.
004820     MOVE WN-SHZ TO SKD-SHZ.
004830     WRITE SKD-R INVALID KEY
004840         DISPLAY E-STAT E-ME29 E-ME99
004850         GO TO SKDW-030.
004860     IF SKD-DNO NOT = WK-DNO
004870         MOVE SKD-KEY TO W-KEY.
004880     GO TO SKDW-EX.
004890 SKDW-030.
004900     IF ERR-STAT NOT = "24"
004910         MOVE 255 TO COMPLETION-CODE
004920         MOVE 9 TO W-END
004930         DISPLAY E-ME78 E-ME99
004940         GO TO SKDW-EX.
004950     DISPLAY E-CL.
004960     CLOSE SKDF.
004970     MOVE "SKDF         " TO W-FILE.
004980     DISPLAY E-ME71 E-ME98 STOP " ".
004990     DISPLAY E-CL.
005000     OPEN I-O SKDF.
005010     GO TO SKDW-RTN.
005020 SKDW-EX.
005030     EXIT.
005040 DNO2-RTN.
005050     MOVE SPACE TO HKB-KEY.
005060     MOVE "05" TO HKB-NO.
005070     READ HKBM INVALID KEY
005080         DISPLAY E-ME21 E-ME99
005090         DISPLAY E-CL
005100         GO TO DNO2-020.
005110     MOVE HKB-DAI TO W-DAI.
005120     GO TO DNO2-EX.
005130 DNO2-020.
005140     INITIALIZE HKB-R.
005150     MOVE SPACE TO HKB-KEY.
005160     MOVE "05" TO HKB-NO.
005170     WRITE HKB-R INVALID KEY
005180         DISPLAY E-STAT E-ME19 E-ME99.
005190     INITIALIZE W-DAI.
005200 DNO2-EX.
005210     EXIT.
005220 TUK-RTN.
005230     COPY LDAIP.
005240     IF W-DAI1 = "999"
005250         DISPLAY E-ME78 E-ME40 E-ME99
005260         DISPLAY E-CL.
005270     MOVE W-DAI TO HKB-DAI.
005280     REWRITE HKB-R INVALID KEY
005290         DISPLAY E-STAT E-ME20 E-ME99
005300         MOVE 8 TO W-END
005310         GO TO TUK-EX.
005320 TUK-010.
005330     INITIALIZE TUK-R.
005340     MOVE W-TCD TO TUK-TCD TUK-TCD2.
005350     MOVE W-DAI TO TUK-DAI.
005360     MOVE W-DATE TO TUK-DATE.
005370     MOVE W-DC TO TUK-DC.
005380     MOVE W-KIN TO TUK-KIN.
005390     MOVE W-SHZ TO TUK-SHZ.
005400     MOVE W-DNO TO TUK-DNO.
005410     MOVE W-GNO TO TUK-GNO.
005420     MOVE W-TCD TO T-KEY.
005430     READ T-M WITH UNLOCK INVALID KEY
005440         MOVE ZERO TO T-TNC T-DCC.
005450     MOVE T-TNC TO TUK-TNC.
005460     MOVE T-DCC TO TUK-DCC.
005470     MOVE 0 TO TUK-BMC.
005480     WRITE TUK-R INVALID KEY
005490         DISPLAY E-STAT E-ME28 E-ME99
005500         GO TO TUK-020.
005510     GO TO TUK-EX.
005520 TUK-020.
005530     IF ERR-STAT NOT = "24"
005540         MOVE 8 TO W-END
005550         DISPLAY E-ME78 E-ME99
005560         GO TO TUK-EX.
005570     DISPLAY E-CL.
005580     CLOSE TUKF.
005590     MOVE "TUKF         " TO W-FILE.
005600     DISPLAY E-ME71 E-ME98 STOP " ".
005610     DISPLAY E-CL.
005620     OPEN I-O TUKF.
005630     GO TO TUK-010.
005640 TUK-EX.
005650     EXIT.
005660 DNG-RTN.
005670     MOVE W-FTCD TO T-KEY.
005680     READ T-M INVALID KEY
005690         GO TO DNG-EX.
005700     IF W-FNG NOT > T-DNG
005710         GO TO DNG-EX.
005720     MOVE W-FNG TO T-DNG.
005730     IF T-ENG NOT = ZERO
005740         MOVE ZERO TO T-ENG.
005750     REWRITE T-R INVALID KEY
005760         DISPLAY E-STAT E-ME25 E-ME99
005770         DISPLAY E-CL.
005780 DNG-EX.
005790     EXIT.
