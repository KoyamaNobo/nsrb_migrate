000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         HMT820.
000030**************************************************************
000040*    PROGRAM         :  品名別売上前年対比ワーク作成         *
000050*    PRINTER TYPE    :  JIPS                                 *
000060*    SCREEN          :  ------                               *
000070*    COMPILE TYPE    :  COBOL                                *
000080*    JS-SIGN         :  色あり(6ｹﾀ)=0 , 色なし(4ｹﾀ)=1        *
000090**************************************************************
000100 ENVIRONMENT         DIVISION.
000110 CONFIGURATION       SECTION.
000120 SOURCE-COMPUTER.    SYSTEM3100.
000130 OBJECT-COMPUTER.    SYSTEM3100.
000140 INPUT-OUTPUT        SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT SSRYF ASSIGN TO SSRY-MSD.
000180     SELECT HY-F ASSIGN TO HY-MSD.
000190 I-O-CONTROL.
000200     APPLY SHARED-MODE ON M-DATE.
000210 DATA                DIVISION.
000220 FILE                SECTION.
000230     COPY LIBFDD.
000240 FD  SSRYF
000250     BLOCK  4 RECORDS
000260     LABEL RECORD IS STANDARD
000270     VALUE OF IDENTIFICATION IS WK0064ID.
000280 01  SSRY-R.
000290     02  F              PIC  9(004).
000300     02  SSRY-HCD       PIC  9(006).
000310     02  SSRY-HCDD  REDEFINES  SSRY-HCD.
000320       03  SSRY-HCD1    PIC  9(004).
000330       03  SSRY-HCD2    PIC  9(002).
000340     02  SSRY-SU        PIC S9(007).
000350     02  SSRY-KIN       PIC S9(010).
000360     02  F              PIC  X(014).
000370     02  SSRY-BC.
000380       03  SSRY-BC1     PIC  9(002).
000390       03  SSRY-BC2     PIC  9(002).
000400       03  SSRY-BC3     PIC  9(002).
000410     02  SSRY-BMC       PIC  9(002).
000420     02  SSRY-BMNO      PIC  9(001).
000430     02  F              PIC  X(002).
000440     02  SSRY-NG        PIC  9(006).
000450     02  F              PIC  X(006).
000460 FD  HY-F
000470     BLOCK  1 RECORDS
000480     LABEL RECORD IS STANDARD
000490     VALUE OF IDENTIFICATION IS WK0512ID.
000500 01  HY-R.
000510     02  HY-HCD         PIC  9(006).
000520     02  HY-HCDD  REDEFINES  HY-HCD.
000530       03  HY-HCD1      PIC  9(004).
000540       03  HY-HCD2      PIC  9(002).
000550     02  HY-ZAD.
000560       03  HY-ZD    OCCURS  12.
000570         04  HY-ZSU     PIC S9(007).
000580         04  HY-ZKN     PIC S9(010).
000590     02  HY-KAD.
000600       03  HY-KD    OCCURS  12.
000610         04  HY-KSU     PIC S9(007).
000620         04  HY-KKN     PIC S9(010).
000630     02  HY-BC.
000640       03  HY-BC1       PIC  9(002).
000650       03  HY-BC2       PIC  9(002).
000660       03  HY-BC3       PIC  9(002).
000670     02  HY-BMC         PIC  9(002).
000680     02  HY-BMNO        PIC  9(001).
000690     02  F              PIC  X(089).
000700 WORKING-STORAGE     SECTION.
000710 77  JS-SIGN            PIC  9(001).
000720 77  WK0064ID           PIC  X(009) VALUE SPACE.
000730 77  WK0512ID           PIC  X(009) VALUE SPACE.
000740 01  STN-NO.
000750     02  STN-NO1        PIC  X(003).
000760     02  STN-NO2        PIC  X(003).
000770 01  W-FID1.
000780     02  W-FID11        PIC  X(006) VALUE "WK0064".
000790     02  W-FID12        PIC  X(003).
000800 01  W-FID2.
000810     02  W-FID21        PIC  X(006) VALUE "WK0512".
000820     02  W-FID22        PIC  X(003).
000830 01  W-DATA.
000840     02  W-HCD          PIC  9(006).
000850     02  W-HCDD  REDEFINES  W-HCD.
000860       03  W-HCD1       PIC  9(004).
000870       03  W-HCD2       PIC  9(002).
000880     02  CNT.
000890       03  CNT1         PIC  9(002).
000900       03  CNT2         PIC  9(002).
000910     02  W-NG.
000920       03  W-N          PIC  9(004).
000930       03  W-ND    REDEFINES W-N.
000940         04  W-N1       PIC  9(002).
000950         04  W-N2       PIC  9(002).
000960       03  W-G          PIC  9(002).
000970     02  W-NGL   REDEFINES W-NG.
000980       03  F            PIC  9(002).
000990       03  W-NGS        PIC  9(004).
001000     02  W-YMD.
001010       03  W-YM1   OCCURS  12.
001020         04  W-Y1       PIC  9(004).
001030         04  W-YD1   REDEFINES W-Y1.
001040           05  W-Y11    PIC  9(002).
001050           05  W-Y12    PIC  9(002).
001060         04  W-M1       PIC  9(002).
001070       03  W-YM2   OCCURS  12.
001080         04  W-Y2       PIC  9(004).
001090         04  W-YD2   REDEFINES W-Y2.
001100           05  W-Y21    PIC  9(002).
001110           05  W-Y22    PIC  9(002).
001120         04  W-M2       PIC  9(002).
001130 01  ERR-STAT           PIC  X(002).
001140 SCREEN              SECTION.
001150 SD  C-CRT
001160     END  STATUS  IS  ESTAT.
001170 01  C-CLEAR.
001180     02  C-CL    LINE   1  CLEAR SCREEN.
001190 01  C-MID.
001200     02  LINE   3  COLUMN  10  PIC  N(023) VALUE
001210          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001220     02  LINE   4  COLUMN  10  PIC  N(023) VALUE
001230          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001240     02  LINE   5  COLUMN  10  PIC  N(023) VALUE
001250          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001260     02  LINE   6  COLUMN  10  PIC  N(023) VALUE
001270          NC"＊＊＊　　品名月別前年対比ワーク作成　　＊＊＊".
001280     02  LINE   7  COLUMN  10  PIC  N(023) VALUE
001290          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001300     02  LINE   8  COLUMN  10  PIC  N(023) VALUE
001310          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001320     02  LINE   9  COLUMN  10  PIC  N(023) VALUE
001330          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001340 01  C-ERR.
001350     02  LINE  24.
001360       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001370             "***  ﾃﾞｰﾀ ﾅｼ  *** ".
001380       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
001390             "***  ﾃﾞｰﾀ ｴﾗｰ  ***".
001400       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001410       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001420       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001430            "                                                  ".
001440     COPY  LIBSCR.
001450 PROCEDURE           DIVISION.
001460 M-05.
001470     ACCEPT JS-SIGN.
001480     IF JS-SIGN > 1
001490         GO TO M-95.
001500     DISPLAY C-CLEAR.
001510     DISPLAY C-MID.
001520     MOVE ZERO TO W-DATA.
001530     COPY LIBCPR.
001540     MOVE ZERO TO W-NG.
001550     MOVE D-NHNG TO W-NGS.
001560     IF W-N2 >= DATE-NF1 AND <= DATE-NT1
001570         ADD DATE-NC1 TO W-N.
001580     IF W-N2 >= DATE-NF2 AND <= DATE-NT2
001590         ADD DATE-NC2 TO W-N.
001600*****SUBTRACT 1 FROM W-G.
001610*****IF W-G = ZERO
001620*****    MOVE 12 TO W-G
001630*****    SUBTRACT 1 FROM W-N.
001640     IF W-G < 5
001650         SUBTRACT 1 FROM W-N.
001660     MOVE 4 TO W-G.
001670     MOVE ZERO TO CNT1.
001680     MOVE 1 TO CNT2.
001690 M-10.
001700     IF CNT1 = ZERO
001710         MOVE W-NG TO W-YM2(CNT2)
001720       ELSE
001730         MOVE W-YM2(CNT1) TO W-YM2(CNT2).
001740     ADD 1 TO W-M2(CNT2).
001750     IF W-M2(CNT2) = 13
001760         ADD 1 TO W-Y2(CNT2)
001770         MOVE 1 TO W-M2(CNT2).
001780     MOVE W-YM2(CNT2) TO W-YM1(CNT2).
001790     SUBTRACT 1 FROM W-Y1(CNT2).
001800     ADD 1 TO CNT1 CNT2.
001810     IF CNT1 NOT = 12
001820         GO TO M-10.
001830*
001840     CALL "CBLSTNNO" USING STN-NO.
001850     MOVE STN-NO2 TO W-FID12 W-FID22.
001860     MOVE W-FID1 TO WK0064ID.
001870     MOVE W-FID2 TO WK0512ID.
001880     OPEN INPUT SSRYF.
001890     OPEN OUTPUT HY-F.
001900 M-15.
001910     READ SSRYF AT END
001920         MOVE 255 TO COMPLETION-CODE
001930         DISPLAY E-ME1 E-ME99
001940         GO TO M-90.
001950     IF W-YM1(1) > SSRY-NG
001960         GO TO M-15.
001970     IF ZERO = SSRY-SU AND SSRY-KIN
001980         GO TO M-15.
001990 M-20.
002000     MOVE ZERO TO W-HCD.
002010     IF JS-SIGN = 0
002020         MOVE SSRY-HCD TO W-HCD
002030       ELSE
002040         MOVE SSRY-HCD1 TO W-HCD1.
002050     MOVE ZERO TO HY-R.
002060     MOVE W-HCD TO HY-HCD.
002070     MOVE SSRY-BC TO HY-BC.
002080     MOVE SSRY-BMC TO HY-BMC.
002090     MOVE SSRY-BMNO TO HY-BMNO.
002100 M-25.
002110     MOVE ZERO TO CNT.
002120 M-30.
002130     ADD 1 TO CNT1.
002140     IF CNT1 > 12
002150         MOVE 255 TO COMPLETION-CODE
002160         DISPLAY E-ME2 E-ME99
002170         GO TO M-90.
002180     IF SSRY-NG = W-YM1(CNT1)
002190         ADD SSRY-SU TO HY-ZSU(CNT1)
002200         ADD SSRY-KIN TO HY-ZKN(CNT1)
002210         GO TO M-35.
002220     IF SSRY-NG = W-YM2(CNT1)
002230         ADD SSRY-SU TO HY-KSU(CNT1)
002240         ADD SSRY-KIN TO HY-KKN(CNT1)
002250         GO TO M-35.
002260     GO TO M-30.
002270 M-35.
002280     READ SSRYF AT END
002290         GO TO M-80.
002300     IF W-YM1(1) > SSRY-NG
002310         GO TO M-35.
002320     IF ZERO = SSRY-SU AND SSRY-KIN
002330         GO TO M-35.
002340     IF JS-SIGN = 0
002350         IF SSRY-HCD = W-HCD
002360             GO TO M-25.
002370     IF JS-SIGN = 1
002380         IF SSRY-HCD1 = W-HCD1
002390             GO TO M-25.
002400 M-40.
002410     WRITE HY-R.
002420     GO TO M-20.
002430 M-80.
002440     WRITE HY-R.
002450 M-90.
002460     CLOSE SSRYF.
002470     CLOSE HY-F.
002480 M-95.
002490     DISPLAY C-CLEAR.
002500     STOP RUN.
