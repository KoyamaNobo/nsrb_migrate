000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMN170.
000030*********************************************************
000040*    PROGRAM         :  棚卸Ｗチェック作表ワーク　作成　*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT HZW-F ASSIGN TO HZW-MSD.
000160     SELECT HTWCF ASSIGN TO HTWC-MSD.
000170     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000180         ORGANIZATION IS INDEXED
000190         ACCESS MODE IS RANDOM
000200         RECORD KEY IS HI-KEY
000210         ALTERNATE RECORD KEY IS HI-KEY2
000220         FILE STATUS IS ERR-STAT.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON HI-M.
000250 DATA DIVISION.
000260 FILE SECTION.
000270     COPY LIHIM.
000280 FD  HTWCF
000290     BLOCK  1 RECORDS
000300     LABEL RECORD IS STANDARD
000310     VALUE OF IDENTIFICATION WK0256ID.
000320 01  HTWC-R.
000330     02  HTWC-KEY.
000340       03  HTWC-HCD     PIC  9(006).
000350       03  HTWC-SIZ     PIC  9(001).
000360     02  HTWC-ASUD.                                               前月残数
000370       03  HTWC-AASU  OCCURS  10.
000380         04  HTWC-ASU   PIC S9(006).
000390     02  HTWC-BSUD.                                               前月残数
000400       03  HTWC-ABSU  OCCURS  10.
000410         04  HTWC-BSU   PIC S9(006).
000420     02  F              PIC  X(129).
000430 FD  HZW-F
000440     BLOCK  2 RECORDS
000450     LABEL RECORD IS STANDARD
000460     VALUE OF IDENTIFICATION IS WK0128ID.
000470 01  HZW-R.
000480     02  HZW-HCD        PIC  9(006).
000490     02  HZW-KBN        PIC  9(001).
000500     02  HZW-SIZ        PIC  9(001).
000510     02  HZW-AZS.
000520       03  HZW-ZSD   OCCURS  10.
000530         04  HZW-ZS     PIC S9(006).
000540     02  HZW-TSU        PIC S9(006).
000550     02  HZW-TC         PIC  9(001).
000560     02  HZW-BC         PIC  9(006).
000570     02  HZW-BMC        PIC  9(002).
000580     02  HZW-BMNO       PIC  9(001).
000590     02  HZW-NO         PIC  9(001).
000600     02  HZW-FT         PIC  9(005).
000610     02  F              PIC  X(038).
000620 WORKING-STORAGE SECTION.
000630 77  WK0128ID           PIC  X(009) VALUE SPACE.
000640 77  WK0256ID           PIC  X(009) VALUE SPACE.
000650 01  STN-NO.
000660     02  STN-NO1        PIC  X(003).
000670     02  STN-NO2        PIC  X(003).
000680 01  W-FID1.
000690     02  W-FID11        PIC  X(006) VALUE "WK0128".
000700     02  W-FID12        PIC  X(003).
000710 01  W-FID2.
000720     02  W-FID21        PIC  X(006) VALUE "WK0256".
000730     02  W-FID22        PIC  X(003).
000740 01  W-DATA.
000750     02  W-DC           PIC  9(001).
000760     02  CNT            PIC  9(002).
000770     02  W-C            PIC  9(001).
000780     02  CHK.
000790       03  CHK0         PIC  9(001).
000800       03  CHK1         PIC  9(001).
000810       03  CHK2         PIC  9(001).
000820     02  W-ZCD.
000830       03  W-ZCD0.
000840         04  W-ZC0   OCCURS   4  PIC  9(001).
000850       03  W-ZCD1.
000860         04  W-ZC1   OCCURS   4  PIC  9(001).
000870       03  W-ZCD2.
000880         04  W-ZC2   OCCURS   4  PIC  9(001).
000890     02  W-ZSD.
000900       03  W-ZSD0.
000910         04  W-ZS0   OCCURS  10  PIC S9(006).
000920       03  W-ZSD1.
000930         04  W-ZS1   OCCURS  10  PIC S9(006).
000940       03  W-ZSD2.
000950         04  W-ZS2   OCCURS  10  PIC S9(006).
000960     02  W-D.
000970       03  W-HCD        PIC  9(006).
000980       03  W-ASUD0.
000990         04  W-ASU0  OCCURS  4.
001000           05  W-SUD0  OCCURS  10.
001010             06  W-SU0  PIC S9(006).
001020       03  W-TSU0       PIC S9(006).
001030       03  W-ASUD1.
001040         04  W-ASU1  OCCURS  4.
001050           05  W-SUD1  OCCURS  10.
001060             06  W-SU1  PIC S9(006).
001070       03  W-TSU1       PIC S9(006).
001080       03  W-ASUD2.
001090         04  W-ASU2  OCCURS  4.
001100           05  W-SUD2  OCCURS  10.
001110             06  W-SU2  PIC S9(006).
001120       03  W-TSU2       PIC S9(006).
001130 01  ERR-STAT           PIC  X(002).
001140 SCREEN SECTION.
001150 SD  C-CRT
001160     END STATUS IS ESTAT.
001170 01  C-CLEAR.
001180     02  C-CL    LINE   1  CLEAR SCREEN.
001190 01  C-MID.
001200     02  LINE   3  COLUMN  10  PIC N(025) VALUE
001210          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001220     02  LINE   4  COLUMN  10  PIC N(025) VALUE
001230          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001240     02  LINE   5  COLUMN  10  PIC N(025) VALUE
001250          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001260     02  LINE   6  COLUMN  10  PIC N(025) VALUE
001270          NC"＊＊＊　　棚卸Ｗチェック作表ワーク　作成　　＊＊＊".
001280     02  LINE   7  COLUMN  10  PIC N(025) VALUE
001290          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001300     02  LINE   8  COLUMN  10  PIC N(025) VALUE
001310          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001320     02  LINE   9  COLUMN  10  PIC N(025) VALUE
001330          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001340 01  C-ERR.
001350     02  LINE  24.
001360       03  E-ME2.
001370         04  COLUMN  15  PIC  X(016) VALUE
001380              "***  HIM ﾅｼ  ***".
001390         04  COLUMN  33  PIC  9(006) FROM  W-HCD.
001400       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001410       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001420       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001430            "                                                  ".
001440 PROCEDURE DIVISION.
001450 M-05.
001460     DISPLAY C-CLEAR.
001470     DISPLAY C-MID.
001480*
001490     CALL "CBLSTNNO" USING STN-NO.
001500     MOVE STN-NO2 TO W-FID12 W-FID22.
001510     MOVE W-FID1 TO WK0128ID.
001520     MOVE W-FID2 TO WK0256ID.
001530     OPEN INPUT HTWCF.
001540     OPEN INPUT HI-M.
001550     OPEN OUTPUT HZW-F.
001560*
001570     READ HTWCF AT END
001580         MOVE 255 TO COMPLETION-CODE
001590         GO TO M-95.
001600 M-10.
001610     MOVE ZERO TO W-D W-ZCD.
001620     MOVE HTWC-HCD TO W-HCD.
001630 M-15.
001640     PERFORM S-05 THRU S-20.
001650*
001660     READ HTWCF AT END
001670         GO TO M-80.
001680     IF HTWC-HCD = W-HCD
001690         GO TO M-15.
001700*
001710     PERFORM S-25 THRU S-45.
001720     GO TO M-10.
001730 M-80.
001740     PERFORM S-25 THRU S-45.
001750 M-95.
001760     CLOSE HI-M.
001770     CLOSE HTWCF.
001780     CLOSE HZW-F.
001790     DISPLAY C-CLEAR.
001800     STOP RUN.
001810 S-05.
001820     MOVE ZERO TO W-ZSD.
001830     MOVE ZERO TO CNT CHK.
001840 S-10.
001850     ADD 1 TO CNT.
001860     IF CNT = 11
001870         GO TO S-15.
001880     MOVE HTWC-ASU(CNT) TO W-ZS0(CNT).
001890     IF CHK0 = 0
001900         IF W-ZS0(CNT) NOT = ZERO
001910             MOVE 1 TO CHK0.
001920     ADD W-ZS0(CNT) TO W-TSU0.
001930*
001940     MOVE HTWC-BSU(CNT) TO W-ZS1(CNT).
001950     IF CHK1 = 0
001960         IF W-ZS1(CNT) NOT = ZERO
001970             MOVE 1 TO CHK1.
001980     ADD W-ZS1(CNT) TO W-TSU1.
001990*
002000     COMPUTE W-ZS2(CNT) = W-ZS0(CNT) - W-ZS1(CNT).
002010     IF CHK2 = 0
002020         IF W-ZS2(CNT) NOT = ZERO
002030             MOVE 1 TO CHK2.
002040     ADD W-ZS2(CNT) TO W-TSU2.
002050     GO TO S-10.
002060 S-15.
002070     IF CHK0 NOT = 0
002080         MOVE CHK0 TO W-ZC0(HTWC-SIZ)
002090         MOVE W-ZSD0 TO W-ASU0(HTWC-SIZ).
002100     IF CHK1 NOT = 0
002110         MOVE CHK1 TO W-ZC1(HTWC-SIZ)
002120         MOVE W-ZSD1 TO W-ASU1(HTWC-SIZ).
002130     IF CHK2 NOT = 0
002140         MOVE CHK2 TO W-ZC2(HTWC-SIZ)
002150         MOVE W-ZSD2 TO W-ASU2(HTWC-SIZ).
002160 S-20.
002170     EXIT.
002180 S-25.
002190     MOVE W-HCD TO HI-KEY.
002200     READ HI-M WITH UNLOCK INVALID KEY
002210         DISPLAY E-ME2 E-ME99
002220         MOVE ZERO TO HI-R.
002230*
002240     MOVE ZERO TO W-C.
002250 S-30.
002260     ADD 1 TO W-C.
002270     IF W-C = 5
002280         GO TO S-45.
002290     IF W-ZC0(W-C) = 0
002300         GO TO S-35.
002310*
002320     MOVE ZERO TO HZW-R.
002330     MOVE W-HCD TO HZW-HCD.
002340     MOVE 0 TO HZW-KBN.
002350     MOVE W-C TO HZW-SIZ.
002360     MOVE W-ASU0(W-C) TO HZW-AZS.
002370     MOVE HI-BC TO HZW-BC.
002380     MOVE HI-BMC TO HZW-BMC.
002390     MOVE HI-BMNO TO HZW-BMNO.
002400     MOVE HI-FT TO HZW-FT.
002410     COMPUTE HZW-NO = W-C - 1.
002420     IF HZW-NO = 0
002430         MOVE 4 TO HZW-NO.
002440     IF (W-C = 1) OR ((W-C = 4) AND (W-ZC0(1) = 0)) OR
002450        ((W-C = 3) AND (W-ZC0(1) = 0) AND (W-ZC0(4) = 0)) OR
002460        ((W-C = 2) AND
002470            (W-ZC0(1) = 0) AND (W-ZC0(4) = 0) AND (W-ZC0(3) = 0))
002480         MOVE 1 TO HZW-TC
002490         MOVE W-TSU0 TO HZW-TSU.
002500     WRITE HZW-R.
002510 S-35.
002520     IF W-ZC1(W-C) = 0
002530         GO TO S-40.
002540*
002550     MOVE ZERO TO HZW-R.
002560     MOVE W-HCD TO HZW-HCD.
002570     MOVE 1 TO HZW-KBN.
002580     MOVE W-C TO HZW-SIZ.
002590     MOVE W-ASU1(W-C) TO HZW-AZS.
002600     MOVE HI-BC TO HZW-BC.
002610     MOVE HI-BMC TO HZW-BMC.                                      I.020516
002620     MOVE HI-BMNO TO HZW-BMNO.                                    I.020516
002630     MOVE HI-FT TO HZW-FT.                                        I.050905
002640     COMPUTE HZW-NO = W-C - 1.
002650     IF HZW-NO = 0
002660         MOVE 4 TO HZW-NO.
002670     IF (W-C = 1) OR ((W-C = 4) AND (W-ZC1(1) = 0)) OR
002680        ((W-C = 3) AND (W-ZC1(1) = 0) AND (W-ZC1(4) = 0)) OR
002690        ((W-C = 2) AND
002700            (W-ZC1(1) = 0) AND (W-ZC1(4) = 0) AND (W-ZC1(3) = 0))
002710         MOVE 1 TO HZW-TC
002720         MOVE W-TSU1 TO HZW-TSU.
002730     WRITE HZW-R.
002740 S-40.
002750     IF W-ZC2(W-C) = 0
002760         GO TO S-30.
002770*
002780     MOVE ZERO TO HZW-R.
002790     MOVE W-HCD TO HZW-HCD.
002800     MOVE 2 TO HZW-KBN.
002810     MOVE W-C TO HZW-SIZ.
002820     MOVE W-ASU2(W-C) TO HZW-AZS.
002830     MOVE HI-BC TO HZW-BC.
002840     MOVE HI-BMC TO HZW-BMC.
002850     MOVE HI-BMNO TO HZW-BMNO.
002860     MOVE HI-FT TO HZW-FT.
002870     COMPUTE HZW-NO = W-C - 1.
002880     IF HZW-NO = 0
002890         MOVE 4 TO HZW-NO.
002900     IF (W-C = 1) OR ((W-C = 4) AND (W-ZC2(1) = 0)) OR
002910        ((W-C = 3) AND (W-ZC2(1) = 0) AND (W-ZC2(4) = 0)) OR
002920        ((W-C = 2) AND
002930            (W-ZC2(1) = 0) AND (W-ZC2(4) = 0) AND (W-ZC2(3) = 0))
002940         MOVE 1 TO HZW-TC
002950         MOVE W-TSU2 TO HZW-TSU.
002960     WRITE HZW-R.
002970     GO TO S-30.
002980 S-45.
002990     EXIT.
