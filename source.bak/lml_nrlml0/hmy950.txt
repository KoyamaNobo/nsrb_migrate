000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMY950.
000030*********************************************************
000040*    PROGRAM         :  品種月サイズ別受払　抽出        *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*        変更　　　  :  99/05/12                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT HHTYR ASSIGN TO HHTYR-MSD.
000180*****SELECT HI-M ASSIGN TO HI-MSD                                 D.010808
000190     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD                        I.010808
000200         ORGANIZATION INDEXED
000210         ACCESS MODE RANDOM
000220         RECORD KEY HI-KEY                                        I.010808
000230         ALTERNATE RECORD KEY HI-KEY2.                            I.010808
000240*****    RECORD KEY HI-KEY.                                       D.010808
000250     SELECT HHTWF ASSIGN TO HHTW-MSD.
000260 I-O-CONTROL.
000270     APPLY SHARED-MODE ON M-DATE
000280     APPLY SHARED-MODE ON HI-M.
000290 DATA DIVISION.
000300 FILE SECTION.
000310     COPY LIBFDD.
000320     COPY LIHIM.
000330 FD  HHTYR
000340     BLOCK  1 RECORDS
000350     LABEL RECORD IS STANDARD
000360     VALUE OF IDENTIFICATION "HHTYR".
000370 01  HHTY-R.
000380     02  HHTY-MHCD      PIC  9(006).                              I.030114
000390     02  HHTY-KEY.
000400       03  HHTY-HCD     PIC  9(006).                              品名ｺｰﾄﾞ
000410       03  HHTY-SIZ     PIC  9(001).                              ｻｲｽﾞ区分
000420     02  HHTY-AZSU.                                               前月残数
000430       03  HHTY-ZSUD  OCCURS  10.
000440         04  HHTY-ZSU   PIC S9(006) COMP-3.
000450     02  HHTY-ANSU.                                               入庫数
000460       03  HHTY-NSUD  OCCURS  10.
000470         04  HHTY-NSU   PIC S9(006) COMP-3.
000480     02  HHTY-AUSU.                                               出庫数
000490       03  HHTY-USUD  OCCURS  10.
000500         04  HHTY-USU   PIC S9(006) COMP-3.
000510     02  HHTY-AASS.                                               預り出荷
000520       03  HHTY-ASSD  OCCURS  10.
000530         04  HHTY-ASS   PIC S9(004) COMP-3.                       I.030114
000540*****    04  HHTY-ASS   PIC S9(006) COMP-3.                       D.030114
000550     02  HHTY-AKSU.                                               I.030114
000560       03  HHTY-KSUD  OCCURS  10.                                 I.030114
000570         04  HHTY-KSU   PIC S9(006) COMP-3.                       I.030114
000580     02  HHTY-ATSU.                                               棚卸数
000590       03  HHTY-TSUD  OCCURS  10.
000600         04  HHTY-TSU   PIC S9(006) COMP-3.
000610     02  HHTY-BC        PIC  9(006).
000620     02  F              PIC  X(001).                              I.030114
000630*****02  F              PIC  X(037).                              D.030114
000640     02  HHTY-NG        PIC  9(006).
000650 FD  HHTWF
000660     BLOCK  1 RECORDS
000670     LABEL RECORD IS STANDARD
000680     VALUE OF IDENTIFICATION "WK0256".                            I.000519
000690*****VALUE OF IDENTIFICATION WK0256ID.                            D.000519
000700 01  HHTW-R.
000710     02  HHTW-HCD       PIC  X(006).
000720     02  HHTW-NAME      PIC  N(024).
000730     02  HHTW-NG        PIC  X(006).
000740     02  HHTW-SIZ       PIC  X(001).
000750     02  HHTW-AZSU.
000760       03  HHTW-ZSUD  OCCURS  10.
000770         04  HHTW-ZSU   PIC S9(006) COMP-3.
000780     02  HHTW-ANSU.
000790       03  HHTW-NSUD  OCCURS  10.
000800         04  HHTW-NSU   PIC S9(006) COMP-3.
000810     02  HHTW-AUSU.
000820       03  HHTW-USUD  OCCURS  10.
000830         04  HHTW-USU   PIC S9(006) COMP-3.
000840     02  HHTW-AYSU.
000850       03  HHTW-YSUD  OCCURS  10.
000860         04  HHTW-YSU   PIC S9(006) COMP-3.
000870     02  HHTW-BC        PIC  9(006).
000880     02  HHTW-NO        PIC  9(005).
000890     02  F              PIC  X(024).
000900 WORKING-STORAGE SECTION.
000910*77  WK0256ID           PIC  X(009) VALUE SPACE.                  D.000519
000920*01  STN-NO.                                                      D.000519
000930*****02  STN-NO1        PIC  X(003).                              D.000519
000940*****02  STN-NO2        PIC  X(003).                              D.000519
000950*01  W-FID.                                                       D.000519
000960*****02  W-FID1         PIC  X(006) VALUE "WK0256".               D.000519
000970*****02  W-FID2         PIC  X(003).                              D.000519
000980 01  W-DATA.
000990     02  W-NG.
001000       03  W-SNGD.
001010         04  W-SND.
001020           05  F        PIC  9(002).
001030           05  W-SND2   PIC  9(002).
001040         04  W-SGD      PIC  9(002).
001050       03  W-ENGD.
001060         04  W-END      PIC  9(004).
001070         04  W-ENDL  REDEFINES  W-END.
001080           05  W-END1   PIC  9(002).
001090           05  W-END2   PIC  9(002).
001100         04  W-EGD      PIC  9(002).
001110       03  W-ENGDL REDEFINES  W-ENGD.
001120         04  F          PIC  9(002).
001130         04  W-ENGDS    PIC  9(004).
001140       03  W-SNG.
001150         04  W-SN       PIC  9(004).
001160         04  W-SNL   REDEFINES  W-SN.
001170           05  W-SN1    PIC  9(002).
001180           05  W-SN2    PIC  9(002).
001190         04  W-SG       PIC  9(002).
001200       03  W-SNGL  REDEFINES  W-SNG.
001210         04  F          PIC  9(002).
001220         04  W-SGNS     PIC  9(004).
001230       03  W-ENG.
001240         04  W-EN       PIC  9(004).
001250         04  W-ENL   REDEFINES  W-EN.
001260           05  W-EN1    PIC  9(002).
001270           05  W-EN2    PIC  9(002).
001280         04  W-EG       PIC  9(002).
001290       03  W-ENGL  REDEFINES  W-ENG.
001300         04  F          PIC  9(002).
001310         04  W-EGNS     PIC  9(004).
001320       03  W-NG.
001330         04  W-NEN      PIC  9(004).
001340         04  W-GET      PIC  9(002).
001350     02  W-DMM          PIC  9(001).
001360     02  W-DZC          PIC  9(001).
001370     02  CNT            PIC  9(002).
001380     02  W-NO           PIC  9(005).
001390 01  ERR-STAT           PIC  X(002).
001400     COPY LSTAT.
001410 SCREEN SECTION.
001420 SD  C-CRT
001430     END STATUS IS ESTAT.
001440 01  C-CLEAR.
001450     02  C-CL    LINE   1  CLEAR SCREEN.
001460 01  C-MID.
001470     02  LINE   3  COLUMN  16  PIC  N(022) VALUE
001480          NC"＊＊＊　　品種月サイズ別受払　抽出　　＊＊＊".
001490     02  LINE  11  COLUMN  20  PIC  X(040) VALUE
001500          "ＤＡＴＡ期間    '  年   月 〜 '  年   月".
001510     02  LINE  13  COLUMN  20  PIC  X(040) VALUE
001520          "作 表 期 間     '  年   月 〜 '  年   月".
001530     02  LINE  16  COLUMN  28  PIC  N(012) VALUE
001540          NC"変換用フロッピー　セット" BLINK.
001550     02  LINE  20  COLUMN  34  PIC X(22) VALUE
001560          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001570 01  C-DSP.
001580     02  D-NGD   LINE  11.
001590       03  COLUMN 37  PIC  9(002) FROM  W-SND2.
001600       03  COLUMN 42  PIC  Z(002) FROM  W-SGD.
001610       03  COLUMN 51  PIC  9(002) FROM  W-END2.
001620       03  COLUMN 56  PIC  Z(002) FROM  W-EGD.
001630 01  C-ACP.
001640     02  LINE  13.
001650       03  A-SN2   COLUMN 37  PIC  9(002)
001660            USING W-SN2   CHECK OVERFLOW NO IFC.
001670       03  A-SG    COLUMN 42  PIC  9(002)
001680            USING W-SG    CHECK OVERFLOW NO IFC.
001690       03  A-EN2   COLUMN 51  PIC  9(002)
001700            USING W-EN2   CHECK OVERFLOW NO IFC.
001710       03  A-EG    COLUMN 56  PIC  9(002)
001720            USING W-EG    CHECK OVERFLOW NO IFC.
001730     02  A-DMM   LINE  20  COLUMN  51  PIC  9(001)
001740          USING W-DMM   CHECK OVERFLOW NO IFC.
001750 01  C-ERR.
001760     02  LINE  24.
001770       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001780       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001790            "***  DATA ﾅｼ  ***".
001800       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
001810            "***  DATEM ﾅｼ  ***".
001820       03  E-ME3   COLUMN  15  PIC  X(027) VALUE
001830            "***  DATEM REWRITE ｴﾗｰ  ***".
001840       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001850       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001860       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001870            "                                                  ".
001880     COPY LIBSCR.
001890 PROCEDURE DIVISION.
001900 M-05.
001910     DISPLAY C-CLEAR.
001920     DISPLAY C-MID.
001930     MOVE ZERO TO W-DATA.
001940     OPEN INPUT HHTYR.
001950     READ HHTYR AT END
001960         CLOSE HHTYR
001970         MOVE 255 TO COMPLETION-CODE
001980         DISPLAY E-ME1 E-ME99
001990         DISPLAY C-CLEAR
002000         STOP RUN.
002010     MOVE HHTY-NG TO W-SNGD.
002020     CLOSE HHTYR.
002030*
002040     COPY LIBCPR.
002050     MOVE D-NHNG TO W-ENGDS.
002060     SUBTRACT 1 FROM W-EGD.
002070     IF W-EGD = ZERO
002080         MOVE 12 TO W-EGD
002090         IF W-END2 = ZERO
002100             MOVE 99 TO W-END2
002110           ELSE
002120             SUBTRACT 1 FROM W-END2.
002130     IF W-END2 >= DATE-NF1 AND <= DATE-NT1
002140         ADD DATE-NC1 TO W-END.
002150     IF W-END2 >= DATE-NF2 AND <= DATE-NT2
002160         ADD DATE-NC2 TO W-END.
002170     DISPLAY D-NGD.
002180 M-10.
002190     ACCEPT A-SN2.
002200     IF ESTAT = PF9
002210         MOVE 255 TO COMPLETION-CODE
002220         DISPLAY C-CLEAR
002230         STOP RUN.
002240     IF ESTAT NOT = HTB AND SKP
002250         GO TO M-10.
002260     MOVE ZERO TO W-SN1.                                          I.030114
002270     IF W-SN2 >= DATE-NF1 AND <= DATE-NT1
002280         ADD DATE-NC1 TO W-SN.
002290     IF W-SN2 >= DATE-NF2 AND <= DATE-NT2
002300         ADD DATE-NC2 TO W-SN.
002310     IF W-SN < W-SND OR > W-END
002320         GO TO M-10.
002330 M-15.
002340     ACCEPT A-SG.
002350     IF ESTAT = BTB
002360         GO TO M-10.
002370     IF ESTAT NOT = HTB AND SKP
002380         GO TO M-15.
002390     IF W-SG < 1 OR > 12
002400         GO TO M-15.
002410     IF W-SNG < W-SNGD OR > W-ENGD
002420         GO TO M-15.
002430 M-20.
002440     ACCEPT A-EN2.
002450     IF ESTAT = BTB
002460         GO TO M-15.
002470     IF ESTAT NOT = HTB AND SKP
002480         GO TO M-20.
002490     MOVE ZERO TO W-EN1.                                          I.030114
002500     IF W-EN2 >= DATE-NF1 AND <= DATE-NT1
002510         ADD DATE-NC1 TO W-EN.
002520     IF W-EN2 >= DATE-NF2 AND <= DATE-NT2
002530         ADD DATE-NC2 TO W-EN.
002540     IF W-EN < W-SND OR > W-END OR < W-SN
002550         GO TO M-20.
002560 M-25.
002570     ACCEPT A-EG.
002580     IF ESTAT = BTB
002590         GO TO M-20.
002600     IF ESTAT NOT = HTB AND SKP
002610         GO TO M-25.
002620     IF W-EG < 1 OR > 12
002630         GO TO M-25.
002640     IF W-ENG < W-SNGD OR > W-ENGD OR < W-SNG
002650         GO TO M-25.
002660 M-30.
002670     ACCEPT A-DMM.
002680     IF ESTAT = BTB
002690         GO TO M-25.
002700     IF ESTAT NOT = HTB AND SKP
002710         GO TO M-30.
002720     IF W-DMM = 9
002730         GO TO M-10.
002740     IF W-DMM NOT = 1
002750         GO TO M-30.
002760*
002770     OPEN INPUT HHTYR.
002780 M-35.
002790     READ HHTYR AT END
002800         CLOSE HHTYR
002810         MOVE 255 TO COMPLETION-CODE
002820         DISPLAY E-ME1 E-ME99
002830         DISPLAY C-CLEAR
002840         STOP RUN.
002850     IF HHTY-NG > W-ENG
002860         CLOSE HHTYR
002870         MOVE 255 TO COMPLETION-CODE
002880         DISPLAY E-ME1 E-ME99
002890         DISPLAY C-CLEAR
002900         STOP RUN.
002910     IF HHTY-NG < W-SNG
002920         GO TO M-35.
002930     PERFORM S-05 THRU S-15.
002940     IF W-DZC = 0
002950         GO TO M-35.
002960*
002970*****CALL "CBLSTNNO" USING STN-NO.                                D.000519
002980*****MOVE STN-NO2 TO W-FID2.                                      D.000519
002990*****MOVE W-FID TO WK0256ID.                                      D.000519
003000     OPEN OUTPUT HHTWF.
003010     OPEN INPUT HI-M.
003020 M-45.
003030     MOVE HHTY-HCD TO HI-KEY.
003040     READ HI-M WITH UNLOCK INVALID KEY
003050         MOVE SPACE TO HI-NAME
003060         MOVE NC"　マスターなし　" TO HI-NAME.
003070*
003080     INITIALIZE HHTW-R.
003090     MOVE HHTY-HCD TO HHTW-HCD.
003100     MOVE HI-NAME TO HHTW-NAME.
003110     MOVE HHTY-NG TO HHTW-NG.
003120     MOVE HHTY-SIZ TO HHTW-SIZ.
003130     MOVE HHTY-ZSU(01) TO HHTW-ZSU(01).
003140     MOVE HHTY-ZSU(02) TO HHTW-ZSU(02).
003150     MOVE HHTY-ZSU(03) TO HHTW-ZSU(03).
003160     MOVE HHTY-ZSU(04) TO HHTW-ZSU(04).
003170     MOVE HHTY-ZSU(05) TO HHTW-ZSU(05).
003180     MOVE HHTY-ZSU(06) TO HHTW-ZSU(06).
003190     MOVE HHTY-ZSU(07) TO HHTW-ZSU(07).
003200     MOVE HHTY-ZSU(08) TO HHTW-ZSU(08).
003210     MOVE HHTY-ZSU(09) TO HHTW-ZSU(09).
003220     IF HHTY-SIZ NOT = 4
003230         MOVE HHTY-ZSU(10) TO HHTW-ZSU(10).
003240     MOVE HHTY-NSU(01) TO HHTW-NSU(01).
003250     MOVE HHTY-NSU(02) TO HHTW-NSU(02).
003260     MOVE HHTY-NSU(03) TO HHTW-NSU(03).
003270     MOVE HHTY-NSU(04) TO HHTW-NSU(04).
003280     MOVE HHTY-NSU(05) TO HHTW-NSU(05).
003290     MOVE HHTY-NSU(06) TO HHTW-NSU(06).
003300     MOVE HHTY-NSU(07) TO HHTW-NSU(07).
003310     MOVE HHTY-NSU(08) TO HHTW-NSU(08).
003320     MOVE HHTY-NSU(09) TO HHTW-NSU(09).
003330     MOVE HHTY-NSU(10) TO HHTW-NSU(10).
003340     COMPUTE HHTW-USU(01) = HHTY-USU(01) + HHTY-ASS(01).
003350     COMPUTE HHTW-USU(02) = HHTY-USU(02) + HHTY-ASS(02).
003360     COMPUTE HHTW-USU(03) = HHTY-USU(03) + HHTY-ASS(03).
003370     COMPUTE HHTW-USU(04) = HHTY-USU(04) + HHTY-ASS(04).
003380     COMPUTE HHTW-USU(05) = HHTY-USU(05) + HHTY-ASS(05).
003390     COMPUTE HHTW-USU(06) = HHTY-USU(06) + HHTY-ASS(06).
003400     COMPUTE HHTW-USU(07) = HHTY-USU(07) + HHTY-ASS(07).
003410     COMPUTE HHTW-USU(08) = HHTY-USU(08) + HHTY-ASS(08).
003420     COMPUTE HHTW-USU(09) = HHTY-USU(09) + HHTY-ASS(09).
003430     COMPUTE HHTW-USU(10) = HHTY-USU(10) + HHTY-ASS(10).
003440     COMPUTE HHTW-YSU(01) =
003450                      HHTW-ZSU(01) + HHTW-NSU(01) - HHTW-USU(01).
003460     COMPUTE HHTW-YSU(02) =
003470                      HHTW-ZSU(02) + HHTW-NSU(02) - HHTW-USU(02).
003480     COMPUTE HHTW-YSU(03) =
003490                      HHTW-ZSU(03) + HHTW-NSU(03) - HHTW-USU(03).
003500     COMPUTE HHTW-YSU(04) =
003510                      HHTW-ZSU(04) + HHTW-NSU(04) - HHTW-USU(04).
003520     COMPUTE HHTW-YSU(05) =
003530                      HHTW-ZSU(05) + HHTW-NSU(05) - HHTW-USU(05).
003540     COMPUTE HHTW-YSU(06) =
003550                      HHTW-ZSU(06) + HHTW-NSU(06) - HHTW-USU(06).
003560     COMPUTE HHTW-YSU(07) =
003570                      HHTW-ZSU(07) + HHTW-NSU(07) - HHTW-USU(07).
003580     COMPUTE HHTW-YSU(08) =
003590                      HHTW-ZSU(08) + HHTW-NSU(08) - HHTW-USU(08).
003600     COMPUTE HHTW-YSU(09) =
003610                      HHTW-ZSU(09) + HHTW-NSU(09) - HHTW-USU(09).
003620     COMPUTE HHTW-YSU(10) =
003630                      HHTW-ZSU(10) + HHTW-NSU(10) - HHTW-USU(10).
003640     MOVE HHTY-BC TO HHTW-BC.
003650     ADD 1 TO W-NO.
003660     MOVE W-NO TO HHTW-NO.
003670     WRITE HHTW-R.
003680 M-50.
003690     READ HHTYR AT END
003700         GO TO M-95.
003710     IF HHTY-NG > W-ENG
003720         GO TO M-95.
003730     PERFORM S-05 THRU S-15.
003740     IF W-DZC = 0
003750         GO TO M-50.
003760     GO TO M-45.
003770 M-95.
003780     CLOSE HI-M.
003790     CLOSE HHTYR.
003800     CLOSE HHTWF.
003810     DISPLAY C-CLEAR.
003820     STOP RUN.
003830 S-05.
003840     MOVE ZERO TO W-DZC CNT.
003850 S-10.
003860     ADD 1 TO CNT.
003870     IF CNT = 11
003880         GO TO S-15.
003890     IF HHTY-SIZ = 4
003900         IF CNT = 10
003910             GO TO S-10.
003920     IF ZERO = HHTY-ZSU(CNT) AND HHTY-NSU(CNT)
003930                             AND HHTY-USU(CNT) AND HHTY-ASS(CNT)
003940         GO TO S-10.
003950     MOVE 1 TO W-DZC.
003960 S-15.
003970     EXIT.
