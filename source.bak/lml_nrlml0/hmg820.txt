000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMG820.
000030*********************************************************
000040*    履物在庫表ワーク　作成　（親コード"−"分のみ）     *
000050*********************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT CODEF ASSIGN TO CODE-MSD.
000130     SELECT ZCMF ASSIGN TO ZCM-MSD.
000140     SELECT ZCOF ASSIGN TO ZCO-MSD
000150         ORGANIZATION IS INDEXED
000160         ACCESS MODE IS RANDOM
000170         RECORD KEY IS ZCO-KEY
000180         FILE STATUS IS ERR-STAT.
000190     SELECT HHTF ASSIGN TO HHT1-MSD HHT2-MSD
000200         ORGANIZATION IS INDEXED
000210         ACCESS MODE IS DYNAMIC
000220         RECORD KEY IS HHT-KEY
000230         ALTERNATE RECORD KEY IS HHT-KEY2
000240         FILE STATUS IS ERR-STAT.
000250 I-O-CONTROL.
000260     APPLY SHARED-MODE ON HHTF.
000270 DATA DIVISION.
000280 FILE SECTION.
000290     COPY LIHHTF.
000300 FD  CODEF
000310     BLOCK  4 RECORDS
000320     LABEL RECORD IS STANDARD
000330     VALUE OF IDENTIFICATION WK0064ID.
000340 01  CODE-R.
000350     02  CODE-MHCD      PIC  9(006).
000360     02  CODE-HCD       PIC  9(006).
000370     02  CODE-CHK       PIC  9(001).
000380     02  F              PIC  X(051).
000390 FD  ZCMF
000400     BLOCK  1 RECORDS
000410     LABEL RECORD IS STANDARD
000420     VALUE OF IDENTIFICATION IS WK0512ID.
000430 01  ZCM-R.
000440     02  ZCM-KEY.
000450       03  ZCM-MHCD     PIC  9(006).
000460       03  ZCM-HCD      PIC  9(006).
000470       03  ZCM-SIZ      PIC  9(001).
000480     02  ZCM-AZS.
000490       03  ZCM-ZSD   OCCURS  10.
000500         04  ZCM-ZS     PIC S9(006).
000510     02  F              PIC  X(439).
000520 FD  ZCOF
000530     BLOCK  3 RECORDS
000540     LABEL RECORD IS STANDARD
000550     VALUE OF IDENTIFICATION IS "ZCOF".
000560 01  ZCO-R.
000570     02  ZCO-KEY.
000580       03  ZCO-MHCD     PIC  9(006).
000590       03  ZCO-HCD      PIC  9(006).
000600       03  ZCO-SIZ      PIC  9(001).
000610     02  ZCO-AZS.
000620       03  ZCO-ZSD   OCCURS  10.
000630         04  ZCO-ZS     PIC S9(006).
000640     02  F              PIC  X(012).
000650 WORKING-STORAGE SECTION.
000660 77  W-END              PIC  9(001) VALUE 0.
000670 77  W-FILE             PIC  X(013).
000680 77  WK0064ID           PIC  X(009) VALUE SPACE.
000690 77  WK0512ID           PIC  X(009) VALUE SPACE.
000700 01  STN-NO.
000710     02  STN-NO1        PIC  X(003).
000720     02  STN-NO2        PIC  X(003).
000730 01  W-FID1.
000740     02  W-FID11        PIC  X(006) VALUE "WK0064".
000750     02  W-FID12        PIC  X(003).
000760 01  W-FID2.
000770     02  W-FID21        PIC  X(006) VALUE "WK0512".
000780     02  W-FID22        PIC  X(003).
000790 01  W-DATA.
000800     02  CNT            PIC  9(002).
000810     02  W-C            PIC  9(001).
000820     02  W-ASD.
000830       03  W-ASIZ  OCCURS   4.
000840         04  W-SIZD  OCCURS  10.
000850           05  W-SIZ    PIC  9(001).
000860     02  W-ZSD.
000870       03  W-ZS    OCCURS  10  PIC S9(006).
000880     02  W-D.
000890       03  W-MHCD       PIC  9(006).
000900       03  W-HCD        PIC  9(006).
000910       03  W-ASUD.
000920         04  W-ASU   OCCURS  4.
000930           05  W-SUD   OCCURS  10.
000940             06  W-SU   PIC S9(006).
000950 01  ERR-STAT           PIC  X(002).
000960 SCREEN SECTION.
000970 SD  C-CRT
000980     END STATUS IS ESTAT.
000990 01  C-CLEAR.
001000     02  C-CL    LINE   1  CLEAR SCREEN.
001010 01  C-MID.
001020     02  LINE   3  COLUMN  10  PIC N(021) VALUE
001030          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001040     02  LINE   4  COLUMN  10  PIC N(021) VALUE
001050          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001060     02  LINE   5  COLUMN  10  PIC N(021) VALUE
001070          NC"＊＊＊　　　　　　　　　　　　　　　＊＊＊".
001080     02  LINE   6  COLUMN  10  PIC N(021) VALUE
001090          NC"＊＊＊　　履物在庫表ワーク　作成　　＊＊＊".
001100     02  LINE   7  COLUMN  10  PIC N(021) VALUE
001110          NC"＊＊＊　　（親コード”−”分のみ）　＊＊＊".
001120     02  LINE   8  COLUMN  10  PIC N(021) VALUE
001130          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001140     02  LINE   9  COLUMN  10  PIC N(021) VALUE
001150          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001160 01  C-ERR.
001170     02  LINE  24.
001180       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001190            "***  DATA ｴﾗｰ  ***".
001200       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001210            "***  DATA ﾅｼ  ***".
001220       03  E-ME3   COLUMN  15  PIC  X(024) VALUE
001230            "***  ZCOF WRITE ｴﾗｰ  ***".
001240     COPY LSSEM.
001250 PROCEDURE DIVISION.
001260 M-05.
001270     DISPLAY C-CLEAR.
001280     DISPLAY C-MID.
001290     CALL "CBLSTNNO" USING STN-NO.
001300     MOVE STN-NO2 TO W-FID12 W-FID22.
001310     MOVE W-FID1 TO WK0064ID.
001320     MOVE W-FID2 TO WK0512ID.
001330     OPEN OUTPUT ZCMF ZCOF.
001340     OPEN INPUT CODEF.
001350     OPEN INPUT HHTF.
001360 M-10.
001370     READ CODEF AT END
001380         DISPLAY E-ME2 E-ME99
001390         GO TO M-95.
001400     IF CODE-CHK = 1
001410         GO TO M-10.
001420 M-15.
001430     PERFORM RED-RTN THRU RED-EX.
001440     IF W-HCD NOT = ZERO
001450         PERFORM WRI-RTN THRU WRI-EX.
001460 M-20.
001470     READ CODEF AT END
001480         GO TO M-95.
001490     IF CODE-CHK = 1
001500         IF W-ASD = ZERO
001510             GO TO M-20.
001520     GO TO M-15.
001530 M-95.
001540     CLOSE HHTF.
001550     CLOSE CODEF.
001560     CLOSE ZCMF ZCOF.
001570     DISPLAY C-CLEAR.
001580     STOP RUN.
001590 RED-RTN.
001600     IF CODE-CHK = 0
001610         MOVE ZERO TO W-ASD.
001620     MOVE ZERO TO W-D.
001630*
001640     MOVE SPACE TO HHT-KEY.
001650     MOVE CODE-MHCD TO HHT-MHCD.
001660     MOVE CODE-HCD TO HHT-HCD.
001670     START HHTF KEY NOT < HHT-KEY INVALID KEY
001680         GO TO RED-EX.
001690     READ HHTF NEXT RECORD WITH UNLOCK AT END
001700         GO TO RED-EX.
001710     IF (CODE-MHCD NOT = HHT-MHCD) OR (CODE-HCD NOT = HHT-HCD)
001720         GO TO RED-EX.
001730*
001740     MOVE HHT-MHCD TO W-MHCD.
001750     MOVE HHT-HCD TO W-HCD.
001760 RED-010.
001770     PERFORM SET-RTN THRU SET-EX.
001780*
001790     READ HHTF NEXT RECORD WITH UNLOCK AT END
001800         GO TO RED-EX.
001810     IF (HHT-MHCD = CODE-MHCD) AND (HHT-HCD = CODE-HCD)
001820         GO TO RED-010.
001830 RED-EX.
001840     EXIT.
001850 SET-RTN.
001860     MOVE ZERO TO W-ZSD.
001870     MOVE ZERO TO CNT.
001880 SET-010.
001890     ADD 1 TO CNT.
001900     IF CNT = 11
001910         GO TO SET-020.
001920     IF HHT-SIZ = 4
001930         IF CNT = 10
001940             GO TO SET-010.
001950     IF CODE-CHK = 1
001960         IF W-SIZ(HHT-SIZ,CNT) = 0
001970             GO TO SET-010.
001980     COMPUTE W-ZS(CNT) = HHT-ZSU(CNT) + HHT-NSU(CNT)
001990                       - HHT-USU(CNT) - HHT-ASS(CNT).
002000     IF CODE-CHK = 0
002010         IF W-ZS(CNT) < ZERO
002020             MOVE 1 TO W-SIZ(HHT-SIZ,CNT)
002030           ELSE
002040             MOVE ZERO TO W-ZS(CNT).
002050     GO TO SET-010.
002060 SET-020.
002070     MOVE W-ZSD TO W-ASU(HHT-SIZ).
002080 SET-EX.
002090     EXIT.
002100 WRI-RTN.
002110     MOVE ZERO TO W-C.
002120 WRI-010.
002130     ADD 1 TO W-C.
002140     IF W-C = 5
002150         GO TO WRI-EX.
002160     IF 0 = W-SIZ(W-C,01) AND W-SIZ(W-C,02) AND W-SIZ(W-C,03) AND
002170            W-SIZ(W-C,04) AND W-SIZ(W-C,05) AND W-SIZ(W-C,06) AND
002180            W-SIZ(W-C,07) AND W-SIZ(W-C,08) AND W-SIZ(W-C,09) AND
002190            W-SIZ(W-C,10)
002200         GO TO WRI-010.
002210     IF ZERO = W-SU(W-C,01) AND W-SU(W-C,02) AND W-SU(W-C,03) AND
002220               W-SU(W-C,04) AND W-SU(W-C,05) AND W-SU(W-C,06) AND
002230               W-SU(W-C,07) AND W-SU(W-C,08) AND W-SU(W-C,09) AND
002240               W-SU(W-C,10)
002250         GO TO WRI-010.
002260*
002270     IF W-MHCD = W-HCD
002280         MOVE ZERO TO ZCM-R
002290         MOVE W-MHCD TO ZCM-MHCD
002300         MOVE W-HCD TO ZCM-HCD
002310         MOVE W-C TO ZCM-SIZ
002320         MOVE W-ASU(W-C) TO ZCM-AZS
002330         WRITE ZCM-R
002340         GO TO WRI-010.
002350 WRI-020.
002360     MOVE ZERO TO ZCO-R.
002370     MOVE W-MHCD TO ZCO-MHCD.
002380     MOVE W-HCD TO ZCO-HCD.
002390     MOVE W-C TO ZCO-SIZ.
002400     MOVE W-ASU(W-C) TO ZCO-AZS.
002410     WRITE ZCO-R INVALID KEY
002420         DISPLAY E-STAT E-ME3 E-ME99
002430         GO TO WRI-030.
002440     GO TO WRI-010.
002450 WRI-030.
002460     IF ERR-STAT NOT = "24"
002470         MOVE 1 TO W-END
002480         MOVE 255 TO COMPLETION-CODE
002490         DISPLAY E-ME78 E-ME99
002500         GO TO WRI-EX.
002510     DISPLAY E-CL.
002520     CLOSE ZCOF.
002530     MOVE "ZCOF         " TO W-FILE.
002540     DISPLAY E-ME71 E-ME98 STOP " ".
002550     DISPLAY E-CL.
002560     OPEN I-O ZCOF.
002570     GO TO WRI-020.
002580 WRI-EX.
002590     EXIT.
