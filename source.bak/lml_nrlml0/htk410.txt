000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKT410.
000030*********************************************************
000040*    PROGRAM         :  得意先別入金明細問合せ　　　　  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCHK41                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY T-KEY
000200         ALTERNATE RECORD KEY T-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT HKBM ASSIGN TO HKB-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE RANDOM
000250         RECORD KEY HKB-KEY
000260         FILE STATUS IS ERR-STAT.
000270     SELECT NYU-F ASSIGN TO NYU-MSD.
000280 I-O-CONTROL.
000290     APPLY SHARED-MODE ON M-DATE
000300     APPLY SHARED-MODE ON T-M
000310     APPLY SHARED-MODE ON HKBM.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIBFDD.
000350     COPY LITM.
000360     COPY LIHKBM.
000370 FD  NYU-F
000380     BLOCK  2 RECORDS
000390     LABEL RECORD IS STANDARD
000400     VALUE OF IDENTIFICATION WK0128ID.
000410 01  NYU-R.
000420     02  N-DATE.
000430       03  N-NEN        PIC  9(004).
000440       03  N-GP         PIC  9(004).
000450     02  N-TCD          PIC  9(004).
000460     02  N-KIN          PIC S9(008).
000470     02  N-NC.
000480       03  N-NC1        PIC  9(001).
000490       03  N-NC2        PIC  9(001).
000500     02  N-NSC          PIC  9(001).
000510     02  F              PIC  9(002).
000520     02  N-TD           PIC  9(006).
000530     02  F              PIC  9(002).
000540     02  N-SS           PIC  9(004).
000550     02  N-BC           PIC  9(001).
000560     02  N-TC           PIC  9(002).
000570     02  F              PIC  X(003).
000580     02  N-KEY.
000590       03  N-NO         PIC  9(006).
000600       03  N-GNO        PIC  9(001).
000610     02  N-FNO          PIC  9(008).
000620     02  N-SKD          PIC  9(008).
000630     02  N-DCC          PIC  9(001).
000640     02  F              PIC  X(013).
000650     02  N-DC           PIC  9(001).
000660     02  F              PIC  X(001).
000670     02  N-DPC          PIC  9(001).
000680     02  N-ACT          PIC  9(001).
000690     02  N-PRC          PIC  9(001).
000700     02  F              PIC  X(043).
000710 WORKING-STORAGE SECTION.
000720 77  WK0128ID           PIC  X(009) VALUE SPACE.
000730 01  STN-NO.
000740     02  STN-NO1        PIC  X(003).
000750     02  STN-NO2        PIC  X(003).
000760 01  W-FID.
000770     02  W-FID1         PIC  X(006) VALUE "WK0128".
000780     02  W-FID2         PIC  X(003).
000790 01  ERR-STAT           PIC  X(002).
000800 01  W-FILE             PIC  X(013).
000810 01  W-MSG              PIC  X(030).
000820 01  W-DATA.
000830     02  W-DMM          PIC  9(001).
000840     02  W-S            PIC  9(001).
000850     02  W-TCD          PIC  9(004).
000860     02  W-NO           PIC  9(006).
000870     02  W-NOC          PIC  9(001).
000880     02  W-L            PIC  9(002).
000890     02  W-KBN          PIC  N(006).
000900     02  W-KIN          PIC S9(009).
000910     02  W-SHZ          PIC S9(007).
000920     02  W-NG.
000930       03  W-NEN        PIC  9(004).
000940       03  W-NENL  REDEFINES W-NEN.
000950         04  W-NEN1     PIC  9(002).
000960         04  W-NEN2     PIC  9(002).
000970       03  W-GET        PIC  9(002).
000980     02  W-NGL   REDEFINES W-NG.
000990       03  F            PIC  9(002).
001000       03  W-NGS        PIC  9(004).
001010     02  W-NGPD.
001020       03  W-NEND       PIC  9(004).
001030       03  W-GPD.
001040         04  W-GETD     PIC  9(002).
001050         04  W-PEYD     PIC  9(002).
001060     COPY LSTAT.
001070 SCREEN SECTION.
001080 SD  C-CRT
001090     END STATUS IS ESTAT.
001100 01  C-CLEAR.
001110     02  LINE   1  CLEAR SCREEN.
001120 01  C-ACP.
001130     02  A-TCD   LINE   3  COLUMN   7  PIC  9(004)
001140          USING W-TCD   CHECK OVERFLOW NO IFC.
001150     02  A-GP    LINE   6  COLUMN   2  PIC  9(004)
001160          USING W-GPD   CHECK OVERFLOW NO IFC.
001170     02  A-DMM   LINE  23  COLUMN  77  PIC  9(001)
001180          USING W-DMM   CHECK OVERFLOW NO IFC.
001190 01  C-DSP.
001200*****02  D-NAME  LINE   3  COLUMN  21  PIC  N(024) FROM  T-NAME.  D.020410
001210     02  D-NAME  LINE   3  COLUMN  21  PIC  N(026) FROM  T-NAME.  I.020410
001220     02  LINE W-L.
001230       03  D-GP    COLUMN   2  PIC  9(004)      FROM  N-GP.
001240       03  D-KIN   COLUMN   7  PIC ---,---,--9  FROM  N-KIN.
001250       03  D-SRI   COLUMN  19  PIC  N(006)      FROM  W-KBN.
001260       03  D-TD    COLUMN  32  PIC 99/99/99     FROM  N-TD.
001270       03  D-SS    COLUMN  42  PIC 99/99        FROM  N-SS.
001280       03  D-TKIN  COLUMN  48  PIC ----,---,--9 FROM  W-KIN.
001290       03  D-TSHZ  COLUMN  61  PIC --,---,--9   FROM  W-SHZ.
001300       03  D-NO    COLUMN  72  PIC  9(006)      FROM  W-NO.
001310 01  C-ERR.
001320     02  LINE  24.
001330       03  E-ME    COLUMN  15  PIC  X(030) FROM  W-MSG.
001340     COPY LSSEM.
001350     COPY LIBSCR.
001360 PROCEDURE DIVISION.
001370 M-05.
001380     COPY LIBCPR.
001390     MOVE ZERO TO W-DATA.
001400     MOVE D-NHNG TO W-NGS.
001410     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001420         ADD DATE-NC1 TO W-NEN.
001430     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001440         ADD DATE-NC2 TO W-NEN.
001450     OPEN INPUT T-M HKBM.
001460     CALL "CBLSTNNO" USING STN-NO.
001470     MOVE STN-NO2 TO W-FID2.
001480     MOVE W-FID TO WK0128ID.
001490 M-10.
001500     DISPLAY C-CLEAR.
001510     CALL "SCHK41".
001520 M-15.
001530     ACCEPT A-TCD.
001540     DISPLAY E-CL.
001550     IF ESTAT = PF9
001560         GO TO M-90.
001570     IF ESTAT NOT = HTB AND SKP
001580         GO TO M-15.
001590     MOVE W-TCD TO T-KEY.
001600     READ T-M WITH UNLOCK INVALID KEY
001610         MOVE SPACE TO W-MSG
001620         MOVE "***  ﾄｸｲｻｷ ﾅｼ  ***" TO W-MSG
001630         DISPLAY E-ME
001640         GO TO M-15.
001650     DISPLAY D-NAME.
001660 M-20.
001670     ACCEPT A-GP.
001680     IF ESTAT = BTB
001690         GO TO M-15.
001700     IF ESTAT NOT = HTB AND SKP
001710         GO TO M-20.
001720     IF W-GETD < 1 OR > 12
001730         GO TO M-20.
001740     IF W-PEYD < 1 OR > 31
001750         GO TO M-20.
001760     IF W-GET < W-GETD
001770         COMPUTE W-NEND = W-NEN - 1
001780       ELSE
001790         MOVE W-NEN TO W-NEND.
001800*
001810     MOVE 0 TO W-S.                                               I.021128
001820     OPEN INPUT NYU-F.
001830 M-25.
001840     READ NYU-F AT END
001850         MOVE 9 TO W-S
001860         MOVE SPACE TO W-MSG                                      I.021128
001870         MOVE "***  DATA ﾅｼ  ***" TO W-MSG                        I.021128
001880         DISPLAY E-ME                                             I.021128
001890         GO TO M-40.
001900     IF N-TCD < W-TCD
001910         GO TO M-25.
001920     IF N-TCD > W-TCD
001930         MOVE 9 TO W-S
001940         MOVE SPACE TO W-MSG                                      I.021128
001950         MOVE "***  DATA ﾅｼ  ***" TO W-MSG                        I.021128
001960         DISPLAY E-ME                                             I.021128
001970         GO TO M-40.
001980     IF N-DATE < W-NGPD
001990         GO TO M-25.
002000*
002010     MOVE ZERO TO W-NO W-KIN W-SHZ.                               I.021128
002020     MOVE 5 TO W-L.
002030 M-30.
002040     IF W-NO = ZERO
002050         MOVE N-NO TO W-NO
002060         MOVE 0 TO W-NOC
002070         GO TO M-35.
002080     IF N-NO NOT = W-NO
002090         DISPLAY D-TKIN D-TSHZ
002100         MOVE ZERO TO W-KIN W-SHZ
002110         MOVE N-NO TO W-NO
002120         MOVE 0 TO W-NOC.
002130 M-35.
002140     ADD 1 TO W-L.
002150     IF W-L = 23
002160*****    MOVE 1 TO W-S                                            D.021128
002170         GO TO M-40.
002180     PERFORM KBN-RTN THRU KBN-EX.
002190     IF W-NOC = 0
002200         MOVE 1 TO W-NOC
002210         DISPLAY D-NO.
002220     DISPLAY D-GP D-KIN D-SRI.
002230     IF N-TD NOT = ZERO
002240         DISPLAY D-TD.
002250     IF N-SS NOT = ZERO
002260         DISPLAY D-SS.
002270*
002280     READ NYU-F AT END
002290         DISPLAY D-TKIN D-TSHZ
002300         MOVE 9 TO W-S
002310         GO TO M-40.
002320     IF N-TCD NOT = W-TCD
002330         DISPLAY D-TKIN D-TSHZ
002340         MOVE 9 TO W-S
002350         GO TO M-40.
002360     GO TO M-30.
002370 M-40.
002380     ACCEPT A-DMM.
002390     IF ESTAT = PF9
002400         CLOSE NYU-F
002410         GO TO M-90.
002420     IF W-DMM = 9
002430         CLOSE NYU-F                                              I.021128
002440         GO TO M-10.                                              I.021128
002450*****IF W-S = 1                                                   D.021128
002460     IF W-S NOT = 9                                               I.021128
002470         DISPLAY C-CLEAR
002480         CALL "SCHK41"
002490         DISPLAY A-TCD D-NAME
002500         MOVE 5 TO W-L
002510         MOVE 0 TO W-NOC
002520         GO TO M-35.
002530     CLOSE NYU-F.
002540     GO TO M-10.
002550 M-90.
002560     CLOSE T-M HKBM.
002570 M-95.
002580     DISPLAY C-CLEAR.
002590     STOP RUN.
002600 KBN-RTN.
002610     MOVE SPACE TO W-KBN.
002620     IF N-NC2 = 8
002630         MOVE NC"消費税　　　" TO W-KBN
002640         ADD N-KIN TO W-SHZ
002650         GO TO KBN-EX.
002660     IF N-NC2 = 9
002670         MOVE NC"消費税取消し" TO W-KBN
002680         ADD N-KIN TO W-SHZ
002690         GO TO KBN-EX.
002700     ADD N-KIN TO W-KIN.
002710     IF N-NC1 = 6
002720         GO TO KBN-010.
002730     MOVE SPACE TO HKB-KEY.
002740     MOVE "31" TO HKB-NO.
002750     MOVE N-NC1 TO HKB-NKC1.
002760     READ HKBM WITH UNLOCK INVALID KEY
002770         MOVE SPACE TO HKB-NKNA.
002780     MOVE HKB-NKNA TO W-KBN.
002790     GO TO KBN-EX.
002800 KBN-010.
002810     MOVE SPACE TO HKB-KEY.
002820     MOVE "32" TO HKB-NO.
002830     MOVE N-NSC TO HKB-NSC.
002840     READ HKBM WITH UNLOCK INVALID KEY
002850         MOVE SPACE TO HKB-NSNA.
002860     MOVE HKB-NSNA TO W-KBN.
002870 KBN-EX.
002880     EXIT.
