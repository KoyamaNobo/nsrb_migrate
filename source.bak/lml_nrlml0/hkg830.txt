000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKG830.
000030*******************************************************************
000040*    PROGRAM         :  請求書発行予定　問合せ　                  *
000050*    PRINTER TYPE    :  JIPS                                      *
000060*    SCREEN          :  ******                                    *
000070*    JS-SIGN         :  0=予定 , 1=月末ﾁｪｯｸ                       *
000080*******************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION IS INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY IS T-KEY
000200         ALTERNATE RECORD KEY T-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT NGPF ASSIGN TO NGP-MSD.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON M-DATE
000250     APPLY SHARED-MODE ON T-M.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LIBFDD.
000290     COPY LITM.
000300 FD  NGPF
000310     BLOCK  4 RECORDS
000320     LABEL RECORD IS STANDARD
000330     VALUE OF IDENTIFICATION WK0064ID.
000340 01  NGP-R.
000350     02  NGP-DATE       PIC  9(008).
000360     02  NGP-NGP   REDEFINES NGP-DATE.
000370       03  NGP-NG.
000380         04  NGP-NEN    PIC  9(004).
000390         04  NGP-GET    PIC  9(002).
000400       03  NGP-PEY      PIC  9(002).
000410     02  NGP-TCD        PIC  9(004).
000420     02  F              PIC  X(052).
000430 WORKING-STORAGE SECTION.
000440 77  JS-SIGN            PIC  9(001).
000450 77  W-FILE             PIC  X(013).
000460 77  WK0064ID           PIC  X(009) VALUE SPACE.
000470 01  STN-NO.
000480     02  STN-NO1        PIC  X(003).
000490     02  STN-NO2        PIC  X(003).
000500 01  W-FID.
000510     02  W-FID1         PIC  X(006) VALUE "WK0064".
000520     02  W-FID2         PIC  X(003).
000530 01  W-DATA.
000540     02  W-DATE         PIC  9(008).
000550     02  W-NGPD.
000560       03  W-NEND       PIC  9(004).
000570       03  W-GETD       PIC  9(002).
000580       03  W-PEYD       PIC  9(002).
000590     02  W-NG.
000600       03  W-NEN        PIC  9(004).
000610       03  W-NENL  REDEFINES W-NEN.
000620         04  W-NEN1     PIC  9(002).
000630         04  W-NEN2     PIC  9(002).
000640       03  W-GET        PIC  9(002).
000650     02  W-NGL   REDEFINES W-NG.
000660       03  F            PIC  9(002).
000670       03  W-NGS        PIC  9(004).
000680     02  W-DMM          PIC  9(001).
000690     02  W-L            PIC  9(002).
000700     02  W-END          PIC  9(001).
000710 01  ERR-STAT           PIC  X(002).
000720     COPY LSTAT.
000730 SCREEN SECTION.
000740 SD  C-CRT
000750     END STATUS IS ESTAT.
000760 01  C-CLEAR.
000770     02  C-CL    LINE   1  CLEAR SCREEN.
000780 01  C-MID.
000790     02  LINE   1  COLUMN  20  PIC  N(022) VALUE
000800          NC"＊＊＊　　請求書　発行予定　　＊＊＊".
000810     02  LINE   3.
000820       03  COLUMN   7  PIC  N(005) VALUE NC"発行予定日".
000830       03  COLUMN  21  PIC  X(004) VALUE "ｺｰﾄﾞ".
000840       03  COLUMN  26  PIC  N(007) VALUE NC"得　意　先　名".
000850     02  LINE   4.
000860       03  COLUMN   9  PIC  N(001) VALUE NC"年".
000870       03  COLUMN  13  PIC  N(001) VALUE NC"月".
000880       03  COLUMN  17  PIC  N(001) VALUE NC"日".
000890     02  LINE  23  COLUMN  35  PIC  X(039) VALUE
000900          "NEXT=ﾘﾀｰﾝ  日付入力=ｆ･10  終了=ｆ･9   ".
000910 01  C-ACP.
000920     02  LINE   4.
000930       03  A-NEN   COLUMN   5  PIC  9(004)
000940            USING W-NEND  CHECK OVERFLOW NO IFC.
000950       03  A-GET   COLUMN  11  PIC  9(002)
000960            USING W-GETD  CHECK OVERFLOW NO IFC.
000970       03  A-PEY   COLUMN  15  PIC  9(002)
000980            USING W-PEYD  CHECK OVERFLOW NO IFC.
000990     02  A-DMM   LINE  23  COLUMN  73  PIC  9(001)
001000          USING W-DMM   CHECK OVERFLOW NO IFC.
001010 01  C-DSP.
001020     02  LINE  W-L.
001030       03  D-NGP.
001040         04  COLUMN   5  PIC  9(004) FROM  NGP-NEN.
001050         04  COLUMN   9  PIC  N(001) VALUE NC"年".
001060         04  COLUMN  11  PIC Z9      FROM  NGP-GET.
001070         04  COLUMN  13  PIC  N(001) VALUE NC"月".
001080         04  COLUMN  15  PIC Z9      FROM  NGP-PEY.
001090         04  COLUMN  17  PIC  N(001) VALUE NC"日".
001100       03  D-DATA.
001110         04  COLUMN  21  PIC  9(004) FROM  NGP-TCD.
001120         04  COLUMN  26  PIC  N(026) FROM  T-NAME.
001130 01  C-ERR.
001140     02  LINE  24.
001150       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001160            "***  DATA ﾅｼ  ***".
001170     COPY LSSEM.
001180     COPY LIBSCR.
001190 PROCEDURE DIVISION.
001200 M-05.
001210     ACCEPT JS-SIGN.
001220     IF JS-SIGN > 1
001230         MOVE 255 TO COMPLETION-CODE
001240         STOP RUN.
001250 M-07.
001260     DISPLAY C-CLEAR.
001270     DISPLAY C-MID.
001280     MOVE ZERO TO W-DATA.
001290     IF JS-SIGN = 0
001300         GO TO M-10.
001310     COPY LIBCPR.
001320     MOVE D-NHNG TO W-NGS.
001330     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001340         ADD DATE-NC1 TO W-NEN.
001350     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001360         ADD DATE-NC2 TO W-NEN.
001370 M-10.
001380     CALL "CBLSTNNO" USING STN-NO.
001390     MOVE STN-NO2 TO W-FID2.
001400     MOVE W-FID TO WK0064ID.
001410     OPEN INPUT NGPF.
001420     READ NGPF AT END
001430         GO TO M-15.
001440     IF JS-SIGN = 1
001450         IF NGP-NG NOT = W-NG
001460             CLOSE NGPF
001470             GO TO M-95.
001480     GO TO M-20.
001490 M-15.
001500     CLOSE NGPF.
001510     IF JS-SIGN = 0
001520         DISPLAY E-ME1 E-ME99.
001530     GO TO M-95.
001540 M-20.
001550     OPEN INPUT T-M.
001560     MOVE 3 TO W-L.
001570 M-25.
001580     ADD 1 TO W-L.
001590     IF W-L = 22
001600         GO TO M-35.
001610     MOVE NGP-TCD TO T-KEY.
001620     READ T-M WITH UNLOCK INVALID KEY
001630         MOVE SPACE TO T-NAME
001640         MOVE NC"　＊得意先なし＊" TO T-NAME.
001650     IF NGP-NGP NOT = W-DATE
001660         MOVE NGP-NGP TO W-DATE
001670         DISPLAY D-NGP.
001680     DISPLAY D-DATA.
001690 M-30.
001700     READ NGPF AT END
001710         MOVE 1 TO W-END
001720         GO TO M-35.
001730     GO TO M-25.
001740 M-35.
001750     ACCEPT A-DMM.
001760     IF ESTAT = PF9
001770         GO TO M-90.
001780     IF ESTAT = HTB
001790         IF W-END = 1
001800             CLOSE NGPF
001810             CLOSE T-M
001820             GO TO M-07
001830           ELSE
001840             DISPLAY C-CLEAR
001850             DISPLAY C-MID
001860             MOVE 3 TO W-L
001870             MOVE ZERO TO W-DATE
001880             GO TO M-25.
001890     IF ESTAT NOT = ADV
001900         GO TO M-35.
001910 M-40.
001920     ACCEPT A-NEN.
001930     IF ESTAT = PF9
001940         GO TO M-95.
001950     IF ESTAT NOT = HTB AND SKP
001960         GO TO M-40.
001970 M-45.
001980     ACCEPT A-GET.
001990     IF ESTAT = BTB
002000         GO TO M-40.
002010     IF ESTAT NOT = HTB AND SKP
002020         GO TO M-45.
002030 M-50.
002040     ACCEPT A-PEY.
002050     IF ESTAT = BTB
002060         GO TO M-45.
002070     IF ESTAT NOT = HTB AND SKP
002080         GO TO M-50.
002090*
002100     CLOSE NGPF.
002110     OPEN INPUT NGPF.
002120 M-55.
002130     READ NGPF AT END
002140         DISPLAY E-ME1 E-ME98
002150         GO TO M-40.
002160     IF NGP-DATE < W-DATE
002170         GO TO M-55.
002180     DISPLAY C-CLEAR.
002190     DISPLAY C-MID.
002200     MOVE 3 TO W-L.
002210     MOVE ZERO TO W-DATE.
002220     GO TO M-25.
002230 M-90.
002240     CLOSE NGPF.
002250     CLOSE T-M.
002260 M-95.
002270     DISPLAY C-CLEAR.
002280     STOP RUN.
