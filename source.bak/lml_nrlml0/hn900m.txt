000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HN900M.
000030******************************************************
000040*    得意先品名単価マスタ　一括削除（得意先・品名毎）*
000050******************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT THTM ASSIGN TO THT1-MSD THT2-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE DYNAMIC
000150         RECORD KEY THT-KEY
000160         ALTERNATE RECORD KEY THT-KEY2
000170         FILE STATUS IS ERR-STAT.
000180 I-O-CONTROL.
000190     APPLY SHARED-MODE ON THTM.
000200 DATA DIVISION.
000210 FILE SECTION.
000220     COPY LITHTM.
000230 WORKING-STORAGE SECTION.
000240 77  W-FILE             PIC  X(013).
000250 77  W-END              PIC  9(001) VALUE 0.
000260 77  W-EC               PIC  9(001) VALUE 0.
000270 77  CHK                PIC  9(001) VALUE 0.
000280 77  W-INV              PIC  9(001) VALUE 0.
000290 01  ERR-STAT           PIC  X(002).
000300 01  W-DATA.
000310     02  W-SEN          PIC  9(001).
000320     02  W-SCO          PIC  9(004).
000330     02  W-ECO          PIC  9(004).
000340     02  W-DMM          PIC  9(001).
000350     COPY LSTAT.
000360 SCREEN SECTION.
000370 SD  C-CRT
000380     END STATUS IS ESTAT.
000390 01  C-CLEAR.
000400     02  LINE   1  CLEAR SCREEN.
000410 01  C-MID.
000420     02  LINE   1  COLUMN  15  PIC  N(023) VALUE
000430          NC"＊＊＊　　得意先品名単価マスタ　削除　　＊＊＊".
000440     02  LINE  10  COLUMN  20  PIC  X(035) VALUE
000450            "得意先別 = 1  ,  品名別 = 2    ﾘﾀｰﾝ".
000460     02  LINE  20  COLUMN  26  PIC  X(022) VALUE
000470          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000480 01  C-ACP.
000490     02  A-SEN   LINE  10  COLUMN  49  PIC  9(001)
000500          USING W-SEN   CHECK OVERFLOW NO IFC.
000510     02  LINE  14.
000520       03  A-SCO   COLUMN  37  PIC  9(004)
000530            USING W-SCO   CHECK OVERFLOW NO IFC.
000540       03  A-ECO   COLUMN  45  PIC  9(004)
000550            USING W-ECO   CHECK OVERFLOW NO IFC.
000560     02  A-DMM   LINE  20  COLUMN  43  PIC  9(001)
000570          USING W-DMM   CHECK OVERFLOW NO IFC.
000580 01  C-DSP.
000590     02  LINE  14.
000600       03  D-M1    COLUMN  25  PIC  X(024) VALUE
000610            "得意先ｺｰﾄﾞ       〜     ".
000620       03  D-M2    COLUMN  25  PIC  X(024) VALUE
000630            "  品名ｺｰﾄﾞ       〜     ".
000640 01  C-ERR.
000650     02  LINE  24.
000660       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
000670            "***  THTM ﾅｼ  ***".
000680       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
000690            "***  THTM DELETE ｴﾗｰ  ***".
000700       03  E-KEY   COLUMN  45  PIC  X(011) FROM  THT-KEY.
000710     COPY LSSEM.
000720     COPY LIBSCR.
000730 PROCEDURE DIVISION.
000740 M-05.
000750     DISPLAY C-CLEAR.
000760     DISPLAY C-MID.
000770 M-10.
000780     ACCEPT A-SEN.
000790     IF ESTAT = PF9
000800         GO TO M-95.
000810     IF ESTAT NOT = HTB AND SKP
000820         GO TO M-10.
000830     IF W-SEN NOT = 1 AND 2
000840         GO TO M-10.
000850*
000860     IF W-SEN = 1
000870         DISPLAY D-M1
000880       ELSE
000890         IF W-SEN = 2
000900             DISPLAY D-M2.
000910 M-15.
000920     ACCEPT A-SCO.
000930     DISPLAY E-CL.
000940     IF ESTAT = PF9
000950         GO TO M-95.
000960     IF ESTAT = BTB
000970         GO TO M-10.
000980     IF ESTAT NOT = HTB AND SKP
000990         GO TO M-15.
001000 M-20.
001010     ACCEPT A-ECO.
001020     IF ESTAT = BTB
001030         GO TO M-15.
001040     IF ESTAT NOT = HTB AND SKP
001050         GO TO M-20.
001060     IF W-SCO > W-ECO
001070         GO TO M-20.
001080 M-25.
001090     ACCEPT A-DMM.
001100     IF ESTAT = BTB
001110         GO TO M-20.
001120     IF ESTAT NOT = HTB AND SKP
001130         GO TO M-25.
001140     IF W-DMM = 9
001150         GO TO M-10.
001160     IF W-DMM NOT = 1
001170         GO TO M-25.
001180*
001190     OPEN I-O THTM.
001200*
001210     MOVE 0 TO CHK.
001220     IF W-SEN NOT = 1
001230         GO TO M-40.
001240     MOVE SPACE TO THT-KEY.
001250     MOVE W-SCO TO THT-TCD.
001260     START THTM KEY NOT < THT-KEY INVALID KEY
001270         GO TO M-50.
001280 M-35.
001290     READ THTM NEXT RECORD AT END
001300         GO TO M-50.
001310     IF THT-TCD > W-ECO
001320         GO TO M-50.
001330     DELETE THTM INVALID KEY
001340         DISPLAY E-STAT E-ME2 E-KEY E-ME99
001350         GO TO M-50.
001360     IF CHK = 0
001370         MOVE 1 TO CHK.
001380     IF W-EC = 0
001390         MOVE 1 TO W-EC.
001400     GO TO M-35.
001410 M-40.
001420     MOVE SPACE TO THT-KEY2.
001430     MOVE W-SCO TO THT-HCDF.
001440     START THTM KEY NOT < THT-KEY2 INVALID KEY
001450         GO TO M-50.
001460 M-45.
001470     READ THTM NEXT RECORD AT END
001480         GO TO M-50.
001490     IF THT-HCDF > W-ECO
001500         GO TO M-50.
001510     DELETE THTM INVALID KEY
001520         DISPLAY E-STAT E-ME2 E-KEY E-ME99
001530         GO TO M-50.
001540     IF CHK = 0
001550         MOVE 1 TO CHK.
001560     IF W-EC = 0
001570         MOVE 1 TO W-EC.
001580     GO TO M-45.
001590 M-50.
001600     CLOSE THTM.
001610     IF CHK = 0
001620         DISPLAY E-ME1.
001630     GO TO M-15.
001640 M-95.
001650     IF W-EC = 0
001660         MOVE 255 TO COMPLETION-CODE.
001670     DISPLAY C-CLEAR.
001680     STOP RUN.
