000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID.      HMM090.
000030*********************************************************
000040*    PROGRAM         :  履物品名マスター年間使用チェック*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ______                          *
000070*    DATA WRITTN     :  00/06/22                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT      DIVISION.
000110 CONFIGURATION    SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT     SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT HI-M ASSIGN TO HI1-MSD  HI2-MSD
000180         ORGANIZATION IS INDEXED
000190         ACCESS MODE IS DYNAMIC
000200         RECORD KEY IS HI-KEY
000210         ALTERNATE RECORD KEY IS HI-KEY2
000220         FILE STATUS IS ERR-STAT.
000230     SELECT HUH-M ASSIGN TO HUH-MSD
000240         ORGANIZATION IS INDEXED
000250         ACCESS MODE IS RANDOM
000260         RECORD KEY IS HUH-KEY
000270         FILE STATUS IS ERR-STAT.
000280     SELECT HIYF ASSIGN TO HIY-MSD.
000290     SELECT RSTRANYR ASSIGN TO RSTRANYR-RDB.
000300     SELECT UTRYR ASSIGN TO UTRYR-RDB.
000310 I-O-CONTROL.
000320     APPLY SHARED-MODE ON M-DATE
000330     APPLY SHARED-MODE ON HI-M
000340     APPLY SHARED-MODE ON HUH-M.
000350 DATA DIVISION.
000360 FILE SECTION.
000370     COPY LIBFDD.
000380     COPY LIHIM.
000390     COPY LIHUHM.
000400 FD  HIYF
000410     BLOCK  5 RECORDS
000420     LABEL RECORD IS STANDARD
000430     VALUE OF IDENTIFICATION "HIYF".
000440 01  HIY-R.
000450     02  HIY-KEY.
000460       03  HIY-HCD      PIC  9(006).                              品名ｺｰﾄﾞ
000470     02  HIY-NG.
000480       03  HIY-NEN      PIC  9(004).
000490       03  HIY-GET      PIC  9(002).
000500     02  HIY-D.
000510       03  HIY-ZS       PIC S9(006).                              前繰数
000520       03  HIY-ZK       PIC S9(009).                              前繰額
000530       03  HIY-NS       PIC S9(007).                              入庫数
000540       03  HIY-NK       PIC S9(010).                              入庫額
000550       03  HIY-SS       PIC S9(008).                              出荷数
000560       03  HIY-SK       PIC S9(010).                              出荷額
000570       03  HIY-YS       PIC S9(006).                              翌繰数
000580       03  HIY-YK       PIC S9(009).                              翌繰額
000590       03  HIY-UG       PIC S9(010).                              売上原価
000600     02  HIY-BCD12.
000610       03  HIY-BCD1     PIC  9(003).
000620       03  HIY-BC22     PIC  9(001).
000630     02  HIY-BC3        PIC  9(002).                              分類CD3
000640     02  HIY-BMC        PIC  9(002).
000650     02  HIY-BMNO       PIC  9(001).
000660     02  F              PIC  X(006).
000670 FD  RSTRANYR
000680     BLOCK  2 RECORDS
000690     LABEL RECORD IS STANDARD
000700     VALUE OF IDENTIFICATION "STRANYR-RDB".
000710 01  STR-R.
000720     02  F              PIC  X(019).
000730     02  STR-HCD        PIC  9(006).                              品名ｺｰﾄﾞ
000740     02  F              PIC  X(103).
000750 FD  UTRYR
000760     BLOCK  2 RECORDS
000770     LABEL RECORD IS STANDARD
000780     VALUE OF IDENTIFICATION "UTRYR-RDB".
000790 01  UTR-R.
000800     02  F              PIC  X(015).
000810     02  UTR-HCD        PIC  9(006).                              品名ｺｰﾄﾞ
000820     02  F              PIC  X(107).
000830 WORKING-STORAGE  SECTION.
000840 77  ERR-STAT           PIC  X(002).
000850 77  W-FILE             PIC  X(013).
000860 01  W-DATA.
000870     02  CHK            PIC  9(001).
000880     02  W-DMM          PIC  9(001).
000890     02  W-NGM          PIC  9(006).
000900     02  W-NG           PIC  9(006).
000910     02  W-NGD   REDEFINES W-NG.
000920       03  W-NEN        PIC  9(004).
000930       03  W-NENL  REDEFINES W-NEN.
000940         04  W-NEN1     PIC  9(002).
000950         04  W-NEN2     PIC  9(002).
000960       03  W-GET        PIC  9(002).
000970     02  W-NGL   REDEFINES W-NG.
000980       03  F            PIC  9(002).
000990       03  W-NGS        PIC  9(004).
001000 SCREEN      SECTION.
001010 SD  C-CRT
001020     END  STATUS IS  ESTAT.
001030 01  C-CLEAR.
001040     02  C-CL    LINE   1  CLEAR SCREEN.
001050 01  C-MID.
001060     02  LINE   3  COLUMN  10  PIC  N(026) VALUE
001070         NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001080     02  LINE   4  COLUMN  10  PIC  N(026) VALUE
001090         NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001100     02  LINE   5  COLUMN  10  PIC  N(026) VALUE
001110         NC"＊＊＊　　　　　　　　　　　　　　　　　　　　＊＊＊".
001120     02  LINE   6  COLUMN  10  PIC  N(026) VALUE
001130         NC"＊＊＊　　履物品名マスター年間使用チェック　　＊＊＊".
001140     02  LINE   7  COLUMN  10  PIC  N(026) VALUE
001150         NC"＊＊＊　　　　　　　　　　　　　　　　　　　　＊＊＊".
001160     02  LINE   8  COLUMN  10  PIC  N(026) VALUE
001170         NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001180     02  LINE   9  COLUMN  10  PIC  N(026) VALUE
001190         NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001200 01  C-ERR.
001210     02  LINE  24.
001220       03  E-ME1   COLUMN  15  PIC  N(013) VALUE
001230            NC"＊　　ＤＡＴＡ　なし　　＊".
001240       03  E-ME2   COLUMN  15  PIC  N(013) VALUE
001250            NC"＊　　ＨＩＭ　なし　　＊　".
001260       03  E-ME3   COLUMN  15  PIC  N(013) VALUE
001270            NC"＊ＲＥＷＲＩＴＥエラー＊　".
001280       03  E-ME4   COLUMN  15  PIC  N(013) VALUE
001290            NC"＊　　ＨＵＨＭ　なし　　＊".
001300       03  E-KEY   COLUMN  55  PIC  X(006) FROM  HI-KEY.
001310     COPY LIBSCR.
001320     COPY LSSEM.
001330 PROCEDURE DIVISION.
001340 M-05.
001350     DISPLAY C-CLEAR.
001360     DISPLAY C-MID.
001370     MOVE ZERO TO W-DATA.
001380     COPY LIBCPR.
001390     MOVE D-NHNG TO W-NGS.
001400     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001410         ADD DATE-NC1 TO W-NEN.
001420     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001430         ADD DATE-NC2 TO W-NEN.
001440     SUBTRACT 1 FROM W-GET.
001450     IF W-GET = ZERO
001460         SUBTRACT 1 FROM W-NEN
001470         MOVE 12 TO W-GET.
001480     SUBTRACT 1 FROM W-GET.
001490     IF W-GET = ZERO
001500         SUBTRACT 1 FROM W-NEN
001510         MOVE 12 TO W-GET.
001520     MOVE W-NG TO W-NGM.
001530*
001540     OPEN I-O HI-M.
001550     OPEN INPUT HUH-M.
001560 M-10.
001570     READ HI-M NEXT RECORD AT END
001580         GO TO M-20.
001590     MOVE ZERO TO W-NGD.
001600     MOVE HI-SNG TO W-NGS.
001610     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001620         ADD DATE-NC1 TO W-NEN.
001630     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001640         ADD DATE-NC2 TO W-NEN.
001650     IF W-NG > W-NGM
001660         MOVE 1 TO HI-DELC
001670         GO TO M-15.
001680     MOVE HI-KEY TO HUH-KEY.
001690     READ HUH-M WITH UNLOCK INVALID KEY
001700         MOVE ZERO TO HUH-R
001710         DISPLAY E-ME2 E-KEY E-ME99.
001720     IF ZERO = HUH-ZS AND HUH-ZK AND HUH-NS AND HUH-NK AND
001730               HUH-SS AND HUH-SK AND HUH-YS AND HUH-YK AND HUH-UG
001740         MOVE 0 TO HI-DELC
001750       ELSE
001760         MOVE 1 TO HI-DELC.
001770 M-15.
001780     REWRITE HI-R INVALID KEY
001790         DISPLAY E-ME3 E-KEY E-ME99
001800         GO TO M-90.
001810     GO TO M-10.
001820 M-20.
001830     CLOSE HUH-M.
001840     OPEN INPUT HIYF.
001850 M-25.
001860     READ HIYF AT END
001870         GO TO M-30.
001880     IF ZERO = HIY-ZS AND HIY-ZK AND HIY-NS AND HIY-NK AND
001890               HIY-SS AND HIY-SK AND HIY-YS AND HIY-YK AND HIY-UG
001900         GO TO M-25.
001910     MOVE HIY-HCD TO HI-KEY.
001920     READ HI-M INVALID KEY
001930         DISPLAY E-ME2 E-KEY E-ME99
001940         GO TO M-25.
001950     IF HI-DELC = 1
001960         GO TO M-25.
001970     MOVE 1 TO HI-DELC.
001980     REWRITE HI-R INVALID KEY
001990         CLOSE HIYF
002000         DISPLAY E-ME3 E-KEY E-ME99
002010         GO TO M-90.
002020     GO TO M-25.
002030 M-30.
002040     CLOSE HIYF.
002050     OPEN INPUT RSTRANYR.
002060 M-35.
002070     READ RSTRANYR AT END
002080         GO TO M-40.
002090     IF STR-HCD = ZERO
002100         GO TO M-35.
002110     MOVE STR-HCD TO HI-KEY.
002120     READ HI-M INVALID KEY
002130         DISPLAY E-ME2 E-KEY E-ME99
002140         DISPLAY E-CL
002150         GO TO M-35.
002160     IF HI-DELC NOT = 0
002170         GO TO M-35.
002180     MOVE 1 TO HI-DELC.
002190     REWRITE HI-R INVALID KEY
002200         CLOSE RSTRANYR
002210         DISPLAY E-ME3 E-KEY E-ME99
002220         GO TO M-90.
002230     GO TO M-35.
002240 M-40.
002250     CLOSE RSTRANYR.
002260     OPEN INPUT UTRYR.
002270 M-45.
002280     READ UTRYR AT END
002290         GO TO M-50.
002300     MOVE UTR-HCD TO HI-KEY.
002310     READ HI-M INVALID KEY
002320         DISPLAY E-ME2 E-KEY E-ME99
002330         DISPLAY E-CL
002340         GO TO M-45.
002350     IF HI-DELC NOT = 0
002360         GO TO M-45.
002370     MOVE 1 TO HI-DELC.
002380     REWRITE HI-R INVALID KEY
002390         CLOSE UTRYR
002400         DISPLAY E-ME3 E-KEY E-ME99
002410         GO TO M-95.
002420     GO TO M-45.
002430 M-50.
002440     CLOSE UTRYR.
002450 M-90.
002460     CLOSE HI-M.
002470 M-95.
002480     DISPLAY C-CLEAR.
002490     STOP RUN.
