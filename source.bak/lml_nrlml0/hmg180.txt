000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMG180.
000030***********************************************************
000040*    PROGRAM         :  履物担当得意先別販売実績表        *
000050*    PRINTER TYPE    :  JIPS                              *
000060*    SCREEN          :  ______                            *
000070*    COMPILE TYPE    :  COBOL                             *
000080*    JS-SIGN         :  0=作表 , 1=ＥＸＣＥＬ , 2=作表(参 *
000090***********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000180         ORGANIZATION IS INDEXED
000190         ACCESS MODE IS RANDOM
000200         RECORD KEY IS T-KEY
000210         ALTERNATE RECORD KEY IS T-KEY2
000220         FILE STATUS IS ERR-STAT.
000230     SELECT SNTRF ASSIGN TO SNTR-MSD
000240         FILE STATUS IS ERR-STAT.
000250     SELECT EXL-F ASSIGN TO EXL-MSD.
000260     SELECT SP-F ASSIGN TO P-PRN999.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON M-DATE
000290     APPLY SHARED-MODE ON T-M
000300     APPLY SHIFT-CODE  ON SP-F.
000310 DATA DIVISION.
000320 FILE SECTION.
000330     COPY LIBFDD.
000340     COPY LITM.
000350     COPY LSSNTW.
000360     COPY LSPF.
000370 FD  EXL-F
000380     BLOCK  1 RECORDS
000390     LABEL RECORD IS STANDARD
000400     VALUE OF IDENTIFICATION IS "WK0256000".                      I.070110
000410*****VALUE OF IDENTIFICATION IS WK0256ID.                         D.070110
000420 01  EXL-R.
000430     02  EXL-TNC        PIC  9(002).
000440     02  EXL-TCD        PIC  9(004).
000450     02  EXL-TNAME      PIC  N(026).
000460     02  EXL-U          PIC S9(009).
000470     02  EXL-UG         PIC S9(009).
000480     02  EXL-AR         PIC S9(009).
000490     02  EXL-RR         PIC S9(003)V9(01).
000500     02  EXL-IU         PIC S9(009).
000510     02  EXL-IUG        PIC S9(009).
000520     02  EXL-IAR        PIC S9(009).
000530     02  EXL-IRR        PIC S9(003)V9(01).
000540     02  EXL-WU         PIC S9(009).
000550     02  EXL-WUG        PIC S9(009).
000560     02  EXL-WAR        PIC S9(009).
000570     02  EXL-WRR        PIC S9(003)V9(01).
000580     02  EXL-KU         PIC S9(009).
000590     02  EXL-KUG        PIC S9(009).
000600     02  EXL-KAR        PIC S9(009).
000610     02  EXL-KRR        PIC S9(003)V9(01).
000620     02  F              PIC  X(074).
000630 WORKING-STORAGE SECTION.
000640 01  JS-SIGN            PIC  9(001).
000650*77  WK0256ID           PIC  X(009) VALUE SPACE.                  D.070110
000660 77  WK0064ID           PIC  X(009) VALUE SPACE.
000670 01  STN-NO.
000680     02  STN-NO1        PIC  X(003).
000690     02  STN-NO2        PIC  X(003).
000700 01  W-FID.
000710     02  W-FID1         PIC  X(006) VALUE "WK0064".
000720     02  W-FID2         PIC  X(003).
000730*01  W-FIDE.                                                      D.070110
000740*****02  W-FIDE1        PIC  X(006) VALUE "WK0256".               D.070110
000750*****02  W-FIDE2        PIC  X(003).                              D.070110
000760 01  HEAD1.
000770     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000780*****02  F              PIC  X(046) VALUE SPACE.                  D.070406
000790     02  H-SAN          PIC  N(001) VALUE SPACE.                  I.070406
000800     02  F              PIC  X(037) VALUE SPACE.                  I.070406
000810     02  F              PIC  N(024) VALUE
000820          NC"＊＊＊　　履物担当得意先別　販売実績表　　＊＊＊".
000830     02  F              PIC  X(027) VALUE SPACE.                  D.070406
000840*****02  F              PIC  X(032) VALUE SPACE.                  D.070406
000850     02  F              PIC  X(005) VALUE "DATE ".
000860     02  H-DATE         PIC 99B99B99.
000870     02  F              PIC  X(007) VALUE "     P.".
000880     02  H-PAGE         PIC Z9.
000890 01  HEAD2.
000900     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000910     02  F              PIC  N(002) VALUE NC"担当".
000920     02  F              PIC  X(001) VALUE SPACE.
000930     02  F              PIC  X(004) VALUE "ｺｰﾄﾞ".
000940     02  F              PIC  X(001) VALUE SPACE.
000950     02  F              PIC  N(010) VALUE
000960          NC"得　　意　　先　　名".
000970     02  F              PIC  X(030) VALUE SPACE.
000980     02  F              PIC  N(004) VALUE NC"売上金額".
000990     02  F              PIC  X(006) VALUE SPACE.
001000     02  F              PIC  N(004) VALUE NC"売上粗利".
001010     02  F              PIC  N(004) VALUE NC"　利益率".
001020     02  F              PIC  X(001) VALUE "%".
001030     02  F              PIC  X(003) VALUE SPACE.
001040     02  F              PIC  N(006) VALUE NC"一般売上金額".
001050     02  F              PIC  N(004) VALUE NC"　利益率".
001060     02  F              PIC  X(001) VALUE "%".
001070     02  F              PIC  N(008) VALUE NC"　ワーク売上金額".
001080     02  F              PIC  N(004) VALUE NC"　利益率".
001090     02  F              PIC  X(001) VALUE "%".
001100     02  F              PIC  X(003) VALUE SPACE.
001110     02  F              PIC  N(006) VALUE NC"教育売上金額".
001120     02  F              PIC  N(004) VALUE NC"　利益率".
001130     02  F              PIC  X(001) VALUE "%".
001140 01  W-P.
001150     02  F              PIC  X(001).
001160     02  P-TNC          PIC  9(002).
001170     02  F              PIC  X(001).
001180     02  P-TCD          PIC  9(004).
001190     02  F              PIC  X(001).
001200     02  P-TNAME        PIC  N(026).
001210     02  P-U            PIC ----,---,--9.
001220     02  P-AR           PIC ----,---,--9.
001230     02  P-RR           PIC ----9.9.
001240     02  P-IU           PIC ----,---,--9.
001250     02  P-IRR          PIC ----9.9.
001260     02  P-WU           PIC ----,---,--9.
001270     02  P-WRR          PIC ----9.9.
001280     02  P-KU           PIC ----,---,--9.
001290     02  P-KRR          PIC ----9.9.
001300 01  W-DATA.
001310     02  W-STNC         PIC  9(002).
001320     02  W-ETNC         PIC  9(002) VALUE 99.                     I.151103
001330*****02  W-ETNC         PIC  9(002).                              D.151103
001340     02  W-DMM          PIC  9(001).
001350     02  W-TNC.
001360       03  W-TNC1       PIC  9(001).
001370       03  W-TNC2       PIC  9(001).
001380     02  W-TCD          PIC  9(004).
001390     02  W-UD           PIC S9(009).
001400     02  W-ALL          PIC S9(009)V9(05).
001410     02  W-PAGE         PIC  9(002).
001420     02  CNT            PIC  9(003).
001430     02  CHK            PIC  9(001).
001440     02  W-KIN.
001450       03  W-UKIN       PIC S9(008).
001460       03  W-GKIN       PIC S9(008).
001470     02  W-RR           PIC S9(003)V9(01).
001480     02  W-IRR          PIC S9(003)V9(01).
001490     02  W-WRR          PIC S9(003)V9(01).
001500     02  W-KRR          PIC S9(003)V9(01).
001510 01  WN-D.
001520     02  W-U            PIC S9(009).
001530     02  W-UG           PIC S9(009).
001540     02  W-AR           PIC S9(009).
001550     02  W-IU           PIC S9(009).
001560     02  W-IUG          PIC S9(009).
001570     02  W-IAR          PIC S9(009).
001580     02  W-WU           PIC S9(009).
001590     02  W-WUG          PIC S9(009).
001600     02  W-WAR          PIC S9(009).
001610     02  W-KU           PIC S9(009).
001620     02  W-KUG          PIC S9(009).
001630     02  W-KAR          PIC S9(009).
001640 01  WT-D.
001650     02  WT-U           PIC S9(009).
001660     02  WT-UG          PIC S9(009).
001670     02  WT-AR          PIC S9(009).
001680     02  WT-IU          PIC S9(009).
001690     02  WT-IUG         PIC S9(009).
001700     02  WT-IAR         PIC S9(009).
001710     02  WT-WU          PIC S9(009).
001720     02  WT-WUG         PIC S9(009).
001730     02  WT-WAR         PIC S9(009).
001740     02  WT-KU          PIC S9(009).
001750     02  WT-KUG         PIC S9(009).
001760     02  WT-KAR         PIC S9(009).
001770 01  WS-D.
001780     02  WS-U           PIC S9(009).
001790     02  WS-UG          PIC S9(009).
001800     02  WS-AR          PIC S9(009).
001810     02  WS-IU          PIC S9(009).
001820     02  WS-IUG         PIC S9(009).
001830     02  WS-IAR         PIC S9(009).
001840     02  WS-WU          PIC S9(009).
001850     02  WS-WUG         PIC S9(009).
001860     02  WS-WAR         PIC S9(009).
001870     02  WS-KU          PIC S9(009).
001880     02  WS-KUG         PIC S9(009).
001890     02  WS-KAR         PIC S9(009).
001900 01  WA-D.
001910     02  WA-U           PIC S9(009).
001920     02  WA-UG          PIC S9(009).
001930     02  WA-AR          PIC S9(009).
001940     02  WA-IU          PIC S9(009).
001950     02  WA-IUG         PIC S9(009).
001960     02  WA-IAR         PIC S9(009).
001970     02  WA-WU          PIC S9(009).
001980     02  WA-WUG         PIC S9(009).
001990     02  WA-WAR         PIC S9(009).
002000     02  WA-KU          PIC S9(009).
002010     02  WA-KUG         PIC S9(009).
002020     02  WA-KAR         PIC S9(009).
002030 01  ERR-STAT           PIC  X(002).
002040     COPY LSTAT.
002050 SCREEN SECTION.
002060 SD  C-CRT
002070     END STATUS IS ESTAT.
002080 01  C-CLEAR.
002090     02  C-CL    LINE   1  CLEAR SCREEN.
002100 01  C-MID.
002110     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
002120          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002130     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
002140          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002150     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
002160          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
002170     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
002180          NC"＊＊＊　　担当得意先別　売上集計表　　＊＊＊".
002190     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
002200          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
002210     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
002220          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002230     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
002240          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
002250     02  LINE  12  COLUMN  23  PIC  X(018) VALUE
002260            "担当ｺｰﾄﾞ  00 〜 99".
002270     02  LINE  20  COLUMN  40  PIC  X(022) VALUE
002280            "確認  OK=1 NO=9   ﾘﾀｰﾝ".
002290 01  C-ACP.
002300     02  LINE  12.
002310       03  A-STNC  COLUMN  33  PIC  9(002)
002320            USING W-STNC  CHECK OVERFLOW NO IFC.
002330       03  A-ETNC  COLUMN  39  PIC  9(002)
002340            USING W-ETNC  CHECK OVERFLOW NO IFC.
002350     02  A-DMM   LINE  20  COLUMN  57  PIC  9(001)
002360            USING W-DMM   CHECK OVERFLOW NO IFC.
002370 01  C-ERR.
002380     02  LINE  24.
002390       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002400            "***  DATA ﾅｼ  ***".
002410       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
002420       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
002430     COPY LIBSCR.
002440 PROCEDURE DIVISION.
002450 M-05.
002460     ACCEPT JS-SIGN.
002470*****IF JS-SIGN > 1                                               D.070406
002480     IF JS-SIGN > 2                                               I.070406
002490         STOP RUN.
002500     COPY LIBCPR.
002510     DISPLAY C-CLEAR.
002520     DISPLAY C-MID.
002530     CALL "CBLSTNNO" USING STN-NO.
002540     MOVE STN-NO2 TO W-FID2.
002550     MOVE W-FID TO WK0064ID.
002560     IF JS-SIGN = 1
002570         MOVE 00 TO W-STNC
002580         MOVE 99 TO W-ETNC
002590*****    MOVE STN-NO2 TO W-FIDE2                                  D.070110
002600*****    MOVE W-FIDE TO WK0256ID                                  D.070110
002610         GO TO M-25.
002620 M-10.
002630     ACCEPT A-STNC.
002640     IF ESTAT = PF9
002650         GO TO M-95.
002660     IF ESTAT NOT = HTB AND SKP
002670         GO TO M-10.
002680 M-15.
002690     ACCEPT A-ETNC.
002700     IF ESTAT = BTB
002710         GO TO M-10.
002720     IF ESTAT NOT = HTB AND SKP
002730         GO TO M-15.
002740     IF W-STNC > W-ETNC
002750         GO TO M-15.
002760 M-20.
002770     ACCEPT A-DMM.
002780     IF ESTAT = BTB
002790         GO TO M-15.
002800     IF ESTAT NOT = HTB AND SKP
002810         GO TO M-20.
002820     IF W-DMM = 9
002830         GO TO M-95.
002840     IF W-DMM NOT = 1
002850         GO TO M-20.
002860 M-25.
002870     OPEN INPUT SNTRF.
002880 M-30.
002890     READ SNTRF AT END
002900         CLOSE SNTRF
002910         DISPLAY E-ME1 E-ME99
002920         GO TO M-95.
002930     IF SNTR-TNC < W-STNC
002940         GO TO M-30.
002950     IF SNTR-TNC > W-ETNC
002960         CLOSE SNTRF
002970         DISPLAY E-ME1 E-ME99
002980         GO TO M-95.
002990     IF SNTR-DC = 4 OR 8
003000         GO TO M-30.
003010     MOVE ZERO TO W-KIN.
003020     IF (SNTR-SNC = 0) OR (SNTR-DC NOT = 2)
003030         COMPUTE W-GKIN = SNTR-SU * SNTR-FT.
003040     IF (SNTR-SNC = 1) OR (SNTR-DC = 1 OR 2 OR 5)
003050         COMPUTE W-GKIN = W-GKIN * -1
003060         COMPUTE W-UKIN = SNTR-KIN * -1
003070       ELSE
003080         MOVE SNTR-KIN TO W-UKIN.
003090     IF ZERO = W-UKIN AND W-GKIN
003100         GO TO M-30.
003110     OPEN INPUT T-M.
003120     MOVE ZERO TO WA-D W-PAGE.
003130     IF JS-SIGN = 1
003140         OPEN OUTPUT EXL-F
003150         GO TO M-35.
003160     OPEN OUTPUT SP-F.
003170     MOVE DATE-02R TO H-DATE.
003180     IF JS-SIGN = 2                                               I.070406
003190         MOVE NC"参" TO H-SAN.                                    I.070406
003200     PERFORM MID-010 THRU MID-EX.
003210 M-35.
003220     MOVE SNTR-TNC1 TO W-TNC1.
003230     MOVE ZERO TO WS-D.
003240 M-40.
003250     MOVE SNTR-TNC2 TO W-TNC2.
003260     MOVE ZERO TO WT-D CHK CNT.
003270 M-45.
003280     MOVE SNTR-TCD TO W-TCD.
003290     MOVE ZERO TO WN-D.
003300     MOVE SNTR-TCD TO T-KEY.
003310     READ T-M WITH UNLOCK INVALID KEY
003320         MOVE SPACE TO T-NAME
003330         MOVE NC"　＊＊　マスター　なし　＊＊　　" TO T-NAME.
003340 M-50.
003350     ADD W-UKIN TO W-U.
003360     ADD W-GKIN TO W-UG.
003370     IF SNTR-BC3 = 10
003380         ADD W-UKIN TO W-IU
003390         ADD W-GKIN TO W-IUG
003400       ELSE
003410         IF SNTR-BC3 = 20
003420             ADD W-UKIN TO W-WU
003430             ADD W-GKIN TO W-WUG
003440           ELSE
003450             IF SNTR-BC3 = 30
003460                 ADD W-UKIN TO W-KU
003470                 ADD W-GKIN TO W-KUG.
003480 M-55.
003490     READ SNTRF AT END
003500         GO TO M-90.
003510     IF SNTR-TNC > W-ETNC
003520         GO TO M-90.
003530     IF SNTR-DC = 4 OR 8
003540         GO TO M-55.
003550     MOVE ZERO TO W-KIN.
003560     IF (SNTR-SNC = 0) OR (SNTR-DC NOT = 2)
003570         COMPUTE W-GKIN = SNTR-SU * SNTR-FT.
003580     IF (SNTR-SNC = 1) OR (SNTR-DC = 1 OR 2 OR 5)
003590         COMPUTE W-GKIN = W-GKIN * -1
003600         COMPUTE W-UKIN = SNTR-KIN * -1
003610       ELSE
003620         MOVE SNTR-KIN TO W-UKIN.
003630     IF ZERO = W-UKIN AND W-GKIN
003640         GO TO M-55.
003650     IF SNTR-TNC1 NOT = W-TNC1
003660         GO TO M-70.
003670     IF SNTR-TNC2 NOT = W-TNC2
003680         GO TO M-65.
003690     IF SNTR-TCD = W-TCD
003700         GO TO M-50.
003710*
003720     PERFORM MEI-RTN THRU MEI-EX.
003730     GO TO M-45.
003740 M-65.
003750     PERFORM MEI-RTN THRU MEI-EX.
003760     PERFORM TOT-RTN THRU TOT-EX.
003770     GO TO M-40.
003780 M-70.
003790     PERFORM MEI-RTN THRU MEI-EX.
003800     PERFORM TOT-RTN THRU TOT-EX.
003810     PERFORM SUB-RTN THRU SUB-EX.
003820     GO TO M-35.
003830 M-90.
003840     PERFORM MEI-RTN THRU MEI-EX.
003850     PERFORM TOT-RTN THRU TOT-EX.
003860     PERFORM SUB-RTN THRU SUB-EX.
003870     PERFORM ALL-RTN THRU ALL-EX.
003880*
003890     CLOSE T-M.
003900     CLOSE SNTRF.
003910     IF JS-SIGN = 1
003920         CLOSE EXL-F
003930       ELSE
003940         CLOSE SP-F.
003950 M-95.
003960     DISPLAY C-CLEAR.
003970     STOP RUN.
003980 MID-RTN.
003990     MOVE SPACE TO SP-R.
004000     WRITE SP-R AFTER PAGE.
004010 MID-010.
004020     ADD 1 TO W-PAGE.
004030     MOVE W-PAGE TO H-PAGE.
004040     MOVE SPACE TO SP-R.
004050     MOVE HEAD1 TO SP-R.
004060     WRITE SP-R.
004070     MOVE SPACE TO SP-R.
004080     MOVE HEAD2 TO SP-R.
004090     WRITE SP-R AFTER 2.
004100     MOVE SPACE TO SP-R.
004110 MID-EX.
004120     EXIT.
004130 MEI-RTN.
004140     IF ZERO = W-U AND W-UG AND W-IU AND W-IUG AND
004150                       W-WU AND W-WUG AND W-KU AND W-KUG
004160         GO TO MEI-EX.
004170     IF W-TNC > 89
004180         MOVE W-U TO W-UG.
004190     COMPUTE W-AR = W-U - W-UG.
004200     COMPUTE W-IAR = W-IU - W-IUG.
004210     COMPUTE W-WAR = W-WU - W-WUG.
004220     COMPUTE W-KAR = W-KU - W-KUG.
004230*
004240     MOVE ZERO TO W-RR.
004250     IF ZERO = W-U OR W-AR
004260         GO TO MEI-010.
004270     MOVE W-U TO W-UD.
004280     IF W-UD < ZERO
004290         COMPUTE W-UD = W-UD * -1.
004300     COMPUTE W-ALL ROUNDED = (W-AR / W-UD) * 100.
004310     COMPUTE W-RR ROUNDED = W-ALL * 1.
004320 MEI-010.
004330     MOVE ZERO TO W-IRR.
004340     IF ZERO = W-IU OR W-IAR
004350         GO TO MEI-020.
004360     MOVE W-IU TO W-UD.
004370     IF W-UD < ZERO
004380         COMPUTE W-UD = W-UD * -1.
004390     COMPUTE W-ALL ROUNDED = (W-IAR / W-UD) * 100.
004400     COMPUTE W-IRR ROUNDED = W-ALL * 1.
004410 MEI-020.
004420     MOVE ZERO TO W-WRR.
004430     IF ZERO = W-WU OR W-WAR
004440         GO TO MEI-030.
004450     MOVE W-WU TO W-UD.
004460     IF W-UD < ZERO
004470         COMPUTE W-UD = W-UD * -1.
004480     COMPUTE W-ALL ROUNDED = (W-WAR / W-UD) * 100.
004490     COMPUTE W-WRR ROUNDED = W-ALL * 1.
004500 MEI-030.
004510     MOVE ZERO TO W-KRR.
004520     IF ZERO = W-KU OR W-KAR
004530         GO TO MEI-040.
004540     MOVE W-KU TO W-UD.
004550     IF W-UD < ZERO
004560         COMPUTE W-UD = W-UD * -1.
004570     COMPUTE W-ALL ROUNDED = (W-KAR / W-UD) * 100.
004580     COMPUTE W-KRR ROUNDED = W-ALL * 1.
004590 MEI-040.
004600     IF JS-SIGN = 1
004610         INITIALIZE EXL-R
004620         MOVE SPACE TO EXL-TNAME
004630       ELSE
004640         MOVE SPACE TO W-P.
004650     IF CHK = ZERO
004660         MOVE 5 TO CHK
004670         IF JS-SIGN = 1
004680             MOVE W-TNC TO EXL-TNC
004690           ELSE
004700             MOVE W-TNC TO P-TNC.
004710     IF JS-SIGN = 1
004720         MOVE W-TCD TO EXL-TCD
004730         MOVE T-NAME TO EXL-TNAME
004740         MOVE W-U TO EXL-U
004750         MOVE W-UG TO EXL-UG
004760         MOVE W-AR TO EXL-AR
004770         MOVE W-RR TO EXL-RR
004780         MOVE W-IU TO EXL-IU
004790         MOVE W-IUG TO EXL-IUG
004800         MOVE W-IAR TO EXL-IAR
004810         MOVE W-IRR TO EXL-IRR
004820         MOVE W-WU TO EXL-WU
004830         MOVE W-WUG TO EXL-WUG
004840         MOVE W-WAR TO EXL-WAR
004850         MOVE W-WRR TO EXL-WRR
004860         MOVE W-KU TO EXL-KU
004870         MOVE W-KUG TO EXL-KUG
004880         MOVE W-KAR TO EXL-KAR
004890         MOVE W-KRR TO EXL-KRR
004900         WRITE EXL-R
004910         GO TO MEI-050.
004920     MOVE W-TCD TO P-TCD.
004930     MOVE T-NAME TO P-TNAME.
004940     MOVE W-U TO P-U.
004950     MOVE W-AR TO P-AR.
004960     MOVE W-RR TO P-RR.
004970     IF (W-IU NOT = ZERO) OR (W-IRR NOT = ZERO)
004980         MOVE W-IU TO P-IU
004990         MOVE W-IRR TO P-IRR.
005000     IF (W-WU NOT = ZERO) OR (W-WRR NOT = ZERO)
005010         MOVE W-WU TO P-WU
005020         MOVE W-WRR TO P-WRR.
005030     IF (W-KU NOT = ZERO) OR (W-KRR NOT = ZERO)
005040         MOVE W-KU TO P-KU
005050         MOVE W-KRR TO P-KRR.
005060     IF LINAGE-COUNTER > 62
005070         MOVE W-TNC TO P-TNC
005080         PERFORM MID-RTN THRU MID-EX.
005090     MOVE SPACE TO SP-R.
005100     MOVE W-P TO SP-R.
005110     WRITE SP-R.
005120     MOVE SPACE TO SP-R.
005130 MEI-050.
005140     ADD W-U TO WT-U.
005150     ADD W-UG TO WT-UG.
005160     ADD W-AR TO WT-AR.
005170     ADD W-IU TO WT-IU.
005180     ADD W-IUG TO WT-IUG.
005190     ADD W-IAR TO WT-IAR.
005200     ADD W-WU TO WT-WU.
005210     ADD W-WUG TO WT-WUG.
005220     ADD W-WAR TO WT-WAR.
005230     ADD W-KU TO WT-KU.
005240     ADD W-KUG TO WT-KUG.
005250     ADD W-KAR TO WT-KAR.
005260     ADD 1 TO CNT.
005270 MEI-EX.
005280     EXIT.
005290 TOT-RTN.
005300     IF JS-SIGN NOT = 1
005310         IF CNT = 1
005320             MOVE SPACE TO SP-R
005330             WRITE SP-R
005340             GO TO TOT-050.
005350     MOVE ZERO TO W-RR.
005360     IF ZERO = WT-U OR WT-AR
005370         GO TO TOT-010.
005380     MOVE WT-U TO W-UD.
005390     IF W-UD < ZERO
005400         COMPUTE W-UD = W-UD * -1.
005410     COMPUTE W-ALL ROUNDED = (WT-AR / W-UD) * 100.
005420     COMPUTE W-RR ROUNDED = W-ALL * 1.
005430 TOT-010.
005440     MOVE ZERO TO W-IRR.
005450     IF ZERO = WT-IU OR WT-IAR
005460         GO TO TOT-020.
005470     MOVE WT-IU TO W-UD.
005480     IF W-UD < ZERO
005490         COMPUTE W-UD = W-UD * -1.
005500     COMPUTE W-ALL ROUNDED = (WT-IAR / W-UD) * 100.
005510     COMPUTE W-IRR ROUNDED = W-ALL * 1.
005520 TOT-020.
005530     MOVE ZERO TO W-WRR.
005540     IF ZERO = WT-WU OR WT-WAR
005550         GO TO TOT-030.
005560     MOVE WT-WU TO W-UD.
005570     IF W-UD < ZERO
005580         COMPUTE W-UD = W-UD * -1.
005590     COMPUTE W-ALL ROUNDED = (WT-WAR / W-UD) * 100.
005600     COMPUTE W-WRR ROUNDED = W-ALL * 1.
005610 TOT-030.
005620     MOVE ZERO TO W-KRR.
005630     IF ZERO = WT-KU OR WT-KAR
005640         GO TO TOT-040.
005650     MOVE WT-KU TO W-UD.
005660     IF W-UD < ZERO
005670         COMPUTE W-UD = W-UD * -1.
005680     COMPUTE W-ALL ROUNDED = (WT-KAR / W-UD) * 100.
005690     COMPUTE W-KRR ROUNDED = W-ALL * 1.
005700 TOT-040.
005710     IF JS-SIGN = 1
005720         INITIALIZE EXL-R
005730         MOVE SPACE TO EXL-TNAME
005740         MOVE NC"　　　　　　　　（　　合　計　　）" TO EXL-TNAME
005750         MOVE WT-U TO EXL-U
005760         MOVE WT-UG TO EXL-UG
005770         MOVE WT-AR TO EXL-AR
005780         MOVE W-RR TO EXL-RR
005790         MOVE WT-IU TO EXL-IU
005800         MOVE WT-IUG TO EXL-IUG
005810         MOVE WT-IAR TO EXL-IAR
005820         MOVE W-IRR TO EXL-IRR
005830         MOVE WT-WU TO EXL-WU
005840         MOVE WT-WUG TO EXL-WUG
005850         MOVE WT-WAR TO EXL-WAR
005860         MOVE W-WRR TO EXL-WRR
005870         MOVE WT-KU TO EXL-KU
005880         MOVE WT-KUG TO EXL-KUG
005890         MOVE WT-KAR TO EXL-KAR
005900         MOVE W-KRR TO EXL-KRR
005910         WRITE EXL-R
005920         GO TO TOT-050.
005930     MOVE SPACE TO W-P.
005940     MOVE NC"　　　　　　　　　（　　合　計　　）　" TO P-TNAME.
005950     MOVE WT-U TO P-U.
005960     MOVE WT-AR TO P-AR.
005970     MOVE W-RR TO P-RR.
005980     IF (WT-IU NOT = ZERO) OR (W-IRR NOT = ZERO)
005990         MOVE WT-IU TO P-IU
006000         MOVE W-IRR TO P-IRR.
006010     IF (WT-WU NOT = ZERO) OR (W-WRR NOT = ZERO)
006020         MOVE WT-WU TO P-WU
006030         MOVE W-WRR TO P-WRR.
006040     IF (WT-KU NOT = ZERO) OR (W-KRR NOT = ZERO)
006050         MOVE WT-KU TO P-KU
006060         MOVE W-KRR TO P-KRR.
006070     IF LINAGE-COUNTER > 62
006080         MOVE W-TNC TO P-TNC
006090         PERFORM MID-RTN THRU MID-EX.
006100     MOVE SPACE TO SP-R.
006110     MOVE W-P TO SP-R.
006120     WRITE SP-R.
006130     MOVE SPACE TO SP-R.
006140     WRITE SP-R.
006150 TOT-050.
006160     ADD WT-U TO WS-U.
006170     ADD WT-UG TO WS-UG.
006180     ADD WT-AR TO WS-AR.
006190     ADD WT-IU TO WS-IU.
006200     ADD WT-IUG TO WS-IUG.
006210     ADD WT-IAR TO WS-IAR.
006220     ADD WT-WU TO WS-WU.
006230     ADD WT-WUG TO WS-WUG.
006240     ADD WT-WAR TO WS-WAR.
006250     ADD WT-KU TO WS-KU.
006260     ADD WT-KUG TO WS-KUG.
006270     ADD WT-KAR TO WS-KAR.
006280 TOT-EX.
006290     EXIT.
006300 SUB-RTN.
006310     MOVE ZERO TO W-RR.
006320     IF ZERO = WS-U OR WS-AR
006330         GO TO SUB-010.
006340     MOVE WS-U TO W-UD.
006350     IF W-UD < ZERO
006360         COMPUTE W-UD = W-UD * -1.
006370     COMPUTE W-ALL ROUNDED = (WS-AR / W-UD) * 100.
006380     COMPUTE W-RR ROUNDED = W-ALL * 1.
006390 SUB-010.
006400     MOVE ZERO TO W-IRR.
006410     IF ZERO = WS-IU OR WS-IAR
006420         GO TO SUB-020.
006430     MOVE WS-IU TO W-UD.
006440     IF W-UD < ZERO
006450         COMPUTE W-UD = W-UD * -1.
006460     COMPUTE W-ALL ROUNDED = (WS-IAR / W-UD) * 100.
006470     COMPUTE W-IRR ROUNDED = W-ALL * 1.
006480 SUB-020.
006490     MOVE ZERO TO W-WRR.
006500     IF ZERO = WS-WU OR WS-WAR
006510         GO TO SUB-030.
006520     MOVE WS-WU TO W-UD.
006530     IF W-UD < ZERO
006540         COMPUTE W-UD = W-UD * -1.
006550     COMPUTE W-ALL ROUNDED = (WS-WAR / W-UD) * 100.
006560     COMPUTE W-WRR ROUNDED = W-ALL * 1.
006570 SUB-030.
006580     MOVE ZERO TO W-KRR.
006590     IF ZERO = WS-KU OR WS-KAR
006600         GO TO SUB-040.
006610     MOVE WS-KU TO W-UD.
006620     IF W-UD < ZERO
006630         COMPUTE W-UD = W-UD * -1.
006640     COMPUTE W-ALL ROUNDED = (WS-KAR / W-UD) * 100.
006650     COMPUTE W-KRR ROUNDED = W-ALL * 1.
006660 SUB-040.
006670     IF JS-SIGN = 1
006680         INITIALIZE EXL-R
006690         MOVE SPACE TO EXL-TNAME
006700         MOVE NC"　　　　　［　　小　計　　］　" TO EXL-TNAME
006710         MOVE WS-U TO EXL-U
006720         MOVE WS-UG TO EXL-UG
006730         MOVE WS-AR TO EXL-AR
006740         MOVE W-RR TO EXL-RR
006750         MOVE WS-IU TO EXL-IU
006760         MOVE WS-IUG TO EXL-IUG
006770         MOVE WS-IAR TO EXL-IAR
006780         MOVE W-IRR TO EXL-IRR
006790         MOVE WS-WU TO EXL-WU
006800         MOVE WS-WUG TO EXL-WUG
006810         MOVE WS-WAR TO EXL-WAR
006820         MOVE W-WRR TO EXL-WRR
006830         MOVE WS-KU TO EXL-KU
006840         MOVE WS-KUG TO EXL-KUG
006850         MOVE WS-KAR TO EXL-KAR
006860         MOVE W-KRR TO EXL-KRR
006870         WRITE EXL-R
006880         GO TO SUB-050.
006890     MOVE SPACE TO W-P.
006900     MOVE NC"　　　　　［　　小　計　　］　　　　　" TO P-TNAME.
006910     MOVE WS-U TO P-U.
006920     MOVE WS-AR TO P-AR.
006930     MOVE W-RR TO P-RR.
006940     IF (WS-IU NOT = ZERO) OR (W-IRR NOT = ZERO)
006950         MOVE WS-IU TO P-IU
006960         MOVE W-IRR TO P-IRR.
006970     IF (WS-WU NOT = ZERO) OR (W-WRR NOT = ZERO)
006980         MOVE WS-WU TO P-WU
006990         MOVE W-WRR TO P-WRR.
007000     IF (WS-KU NOT = ZERO) OR (W-KRR NOT = ZERO)
007010         MOVE WS-KU TO P-KU
007020         MOVE W-KRR TO P-KRR.
007030     IF LINAGE-COUNTER > 62
007040         MOVE W-TNC TO P-TNC
007050         PERFORM MID-RTN THRU MID-EX.
007060     MOVE SPACE TO SP-R.
007070     MOVE W-P TO SP-R.
007080     WRITE SP-R.
007090     MOVE SPACE TO SP-R.
007100     WRITE SP-R.
007110 SUB-050.
007120     ADD WS-U TO WA-U.
007130     ADD WS-UG TO WA-UG.
007140     ADD WS-AR TO WA-AR.
007150     ADD WS-IU TO WA-IU.
007160     ADD WS-IUG TO WA-IUG.
007170     ADD WS-IAR TO WA-IAR.
007180     ADD WS-WU TO WA-WU.
007190     ADD WS-WUG TO WA-WUG.
007200     ADD WS-WAR TO WA-WAR.
007210     ADD WS-KU TO WA-KU.
007220     ADD WS-KUG TO WA-KUG.
007230     ADD WS-KAR TO WA-KAR.
007240 SUB-EX.
007250     EXIT.
007260 ALL-RTN.
007270     MOVE ZERO TO W-RR.
007280     IF ZERO = WA-U OR WA-AR
007290         GO TO ALL-010.
007300     MOVE WA-U TO W-UD.
007310     IF W-UD < ZERO
007320         COMPUTE W-UD = W-UD * -1.
007330     COMPUTE W-ALL ROUNDED = (WA-AR / W-UD) * 100.
007340     COMPUTE W-RR ROUNDED = W-ALL * 1.
007350 ALL-010.
007360     MOVE ZERO TO W-IRR.
007370     IF ZERO = WA-IU OR WA-IAR
007380         GO TO ALL-020.
007390     MOVE WA-IU TO W-UD.
007400     IF W-UD < ZERO
007410         COMPUTE W-UD = W-UD * -1.
007420     COMPUTE W-ALL ROUNDED = (WA-IAR / W-UD) * 100.
007430     COMPUTE W-IRR ROUNDED = W-ALL * 1.
007440 ALL-020.
007450     MOVE ZERO TO W-WRR.
007460     IF ZERO = WA-WU OR WA-WAR
007470         GO TO ALL-030.
007480     MOVE WA-WU TO W-UD.
007490     IF W-UD < ZERO
007500         COMPUTE W-UD = W-UD * -1.
007510     COMPUTE W-ALL ROUNDED = (WA-WAR / W-UD) * 100.
007520     COMPUTE W-WRR ROUNDED = W-ALL * 1.
007530 ALL-030.
007540     MOVE ZERO TO W-KRR.
007550     IF ZERO = WA-KU OR WA-KAR
007560         GO TO ALL-040.
007570     MOVE WA-KU TO W-UD.
007580     IF W-UD < ZERO
007590         COMPUTE W-UD = W-UD * -1.
007600     COMPUTE W-ALL ROUNDED = (WA-KAR / W-UD) * 100.
007610     COMPUTE W-KRR ROUNDED = W-ALL * 1.
007620 ALL-040.
007630     IF JS-SIGN = 1
007640         INITIALIZE EXL-R
007650         MOVE SPACE TO EXL-TNAME
007660         MOVE NC"　【　　総　合　計　　】" TO EXL-TNAME
007670         MOVE WA-U TO EXL-U
007680         MOVE WA-UG TO EXL-UG
007690         MOVE WA-AR TO EXL-AR
007700         MOVE W-RR TO EXL-RR
007710         MOVE WA-IU TO EXL-IU
007720         MOVE WA-IUG TO EXL-IUG
007730         MOVE WA-IAR TO EXL-IAR
007740         MOVE W-IRR TO EXL-IRR
007750         MOVE WA-WU TO EXL-WU
007760         MOVE WA-WUG TO EXL-WUG
007770         MOVE WA-WAR TO EXL-WAR
007780         MOVE W-WRR TO EXL-WRR
007790         MOVE WA-KU TO EXL-KU
007800         MOVE WA-KUG TO EXL-KUG
007810         MOVE WA-KAR TO EXL-KAR
007820         MOVE W-KRR TO EXL-KRR
007830         WRITE EXL-R
007840         GO TO ALL-EX.
007850     MOVE SPACE TO W-P.
007860     MOVE NC"　【　　総　合　計　　】　　　　　　" TO P-TNAME.
007870     MOVE WA-U TO P-U.
007880     MOVE WA-AR TO P-AR.
007890     MOVE W-RR TO P-RR.
007900     IF (WA-IU NOT = ZERO) OR (W-IRR NOT = ZERO)
007910         MOVE WA-IU TO P-IU
007920         MOVE W-IRR TO P-IRR.
007930     IF (WA-WU NOT = ZERO) OR (W-WRR NOT = ZERO)
007940         MOVE WA-WU TO P-WU
007950         MOVE W-WRR TO P-WRR.
007960     IF (WA-KU NOT = ZERO) OR (W-KRR NOT = ZERO)
007970         MOVE WA-KU TO P-KU
007980         MOVE W-KRR TO P-KRR.
007990     IF LINAGE-COUNTER > 62
008000         PERFORM MID-RTN THRU MID-EX.
008010     MOVE SPACE TO SP-R.
008020     MOVE W-P TO SP-R.
008030     WRITE SP-R.
008040 ALL-EX.
008050     EXIT.
