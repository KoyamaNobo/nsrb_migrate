000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKG520.
000030*******************************
000040*    日付別　入金予定表   　  *
000050*******************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE RANDOM
000150         RECORD KEY T-KEY
000160         ALTERNATE RECORD KEY T-KEY2
000170         FILE STATUS IS ERR-STAT.
000180     SELECT NYWF ASSIGN TO NYW-MSD.
000190     SELECT SP-F ASSIGN TO P-PRN999.
000200 I-O-CONTROL.
000210     APPLY SHARED-MODE ON T-M
000220     APPLY SHIFT-CODE  ON SP-F.
000230 DATA DIVISION.
000240 FILE SECTION.
000250     COPY LITM.
000260     COPY LSPF.
000270 FD  NYWF
000280     BLOCK  4 RECORDS
000290     LABEL RECORD IS STANDARD
000300     VALUE OF IDENTIFICATION WK0064ID.
000310 01  NYW-R.
000320     02  NYW-DATE       PIC  9(008).
000330     02  NYW-NGP   REDEFINES NYW-DATE.
000340       03  NYW-NEN      PIC  9(004).
000350       03  NYW-GET      PIC  9(002).
000360       03  NYW-PEY      PIC  9(002).
000370     02  NYW-TCD        PIC  9(004).
000380     02  NYW-KIN        PIC S9(009).
000390     02  NYW-SHZ        PIC S9(007).
000400     02  NYW-KEI        PIC S9(009).
000410     02  NYW-NC.
000420       03  NYW-NC1      PIC  9(001).
000430       03  NYW-NC2      PIC  9(001).
000440     02  NYW-TGK        PIC  9(008).
000450     02  NYW-TGKD  REDEFINES NYW-TGK.
000460       03  F            PIC  9(002).
000470       03  NYW-TGKS     PIC  9(006).
000480     02  NYW-SS         PIC  9(008).
000490     02  NYW-SSD   REDEFINES NYW-SS.
000500       03  NYW-SNEN     PIC  9(004).
000510       03  NYW-SGET     PIC  9(002).
000520       03  NYW-SPEY     PIC  9(002).
000530     02  NYW-TNC        PIC  9(002).
000540     02  F              PIC  X(007).
000550 WORKING-STORAGE SECTION.
000560 77  W-PAGE             PIC  9(002) VALUE ZERO.
000570 77  WK0064ID           PIC  X(009) VALUE SPACE.
000580 01  STN-NO.
000590     02  STN-NO1        PIC  X(003).
000600     02  STN-NO2        PIC  X(003).
000610 01  W-FID.
000620     02  W-FID1         PIC  X(006) VALUE "WK0064".
000630     02  W-FID2         PIC  X(003).
000640 01  ERR-STAT           PIC  X(002).
000650 01  W-FILE             PIC  X(013).
000660 01  HEAD1.
000670     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000680     02  F              PIC  X(038) VALUE SPACE.
000690     02  F              PIC  N(019) VALUE
000700          NC"＊＊＊　　日付別　入金予定表　　＊＊＊".
000710     02  F              PIC  X(023) VALUE SPACE.
000720     02  F              PIC  X(005) VALUE "DATE ".
000730     02  H-DATE         PIC 99B99B99.
000740     02  F              PIC  X(007) VALUE "     P.".
000750     02  H-PAGE         PIC Z9.
000760 01  HEAD2.
000770     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000780     02  F              PIC  N(004) VALUE NC"入金予定".
000790     02  F              PIC  X(002) VALUE SPACE.
000800     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
000810     02  F              PIC  N(010) VALUE
000820          NC"得　　意　　先　　名".
000830     02  F              PIC  X(030) VALUE SPACE.
000840     02  F              PIC  N(004) VALUE NC"　商品代".
000850     02  F              PIC  X(004) VALUE SPACE.
000860     02  F              PIC  N(004) VALUE NC"　消費税".
000870     02  F              PIC  X(006) VALUE SPACE.
000880     02  F              PIC  N(004) VALUE NC"合計金額".
000890     02  F              PIC  X(017) VALUE SPACE.
000900     02  F              PIC  N(004) VALUE NC"手形期日".
000910     02  F              PIC  X(002) VALUE SPACE.
000920     02  F              PIC  N(004) VALUE NC"　請求日".
000930     02  F              PIC  X(001) VALUE SPACE.
000940     02  F              PIC  N(002) VALUE NC"担当".
000950 01  W-P.
000960     02  F              PIC  X(001).
000970     02  P-GET          PIC Z9.
000980     02  P-S1           PIC  X(001).
000990     02  P-PEY          PIC Z9.
001000     02  F              PIC  X(002).
001010     02  P-TCD          PIC  9(004).
001020     02  F              PIC  X(001).
001030     02  P-TNA          PIC  N(026).
001040     02  P-KIN          PIC ZZZZ,ZZZ,ZZ9.
001050     02  P-SHZ          PIC ZZ,ZZZ,ZZ9.
001060     02  P-KEI          PIC ZZZZ,ZZZ,ZZ9.
001070     02  F              PIC  X(002).
001080     02  P-NS1          PIC  N(004).
001090     02  P-NS2          PIC  N(004).
001100     02  F              PIC  X(002).
001110     02  P-TD           PIC 99/99/99.
001120     02  F              PIC  X(002).
001130     02  P-SG           PIC Z9.
001140     02  P-S2           PIC  X(001).
001150     02  P-SP           PIC Z9.
001160     02  F              PIC  X(002).
001170     02  P-TNC          PIC  9(002).
001180 01  W-DATA.
001190     02  W-SNGP.
001200       03  W-SNEN       PIC  9(004).
001210       03  W-SNENL REDEFINES W-SNEN.
001220         04  W-SNEN1    PIC  9(002).
001230         04  W-SNEN2    PIC  9(002).
001240       03  W-SGET       PIC  9(002).
001250       03  W-SPEY       PIC  9(002).
001260     02  W-ENGP.
001270       03  W-ENEN       PIC  9(004).
001280       03  W-ENENL REDEFINES W-ENEN.
001290         04  W-ENEN1    PIC  9(002).
001300         04  W-ENEN2    PIC  9(002).
001310       03  W-EGET       PIC  9(002).
001320       03  W-EPEY       PIC  9(002).
001330     02  W-DMM          PIC  9(001).
001340     02  W-MC           PIC  9(001).
001350     02  W-KC           PIC  9(001).
001360     02  W-NGP.
001370       03  W-NEN        PIC  9(004).
001380       03  W-GET        PIC  9(002).
001390       03  W-PEY        PIC  9(002).
001400     02  WN-D.
001410       03  WN-KIN       PIC S9(009).
001420       03  WN-SHZ       PIC S9(007).
001430       03  WN-KEI       PIC S9(009).
001440     02  WS-D.
001450       03  WS-KIN       PIC S9(009).
001460       03  WS-SHZ       PIC S9(007).
001470       03  WS-KEI       PIC S9(009).
001480     02  WA-D.
001490       03  WA-KIN       PIC S9(009).
001500       03  WA-SHZ       PIC S9(007).
001510       03  WA-KEI       PIC S9(009).
001520     COPY LSTAT.
001530 SCREEN SECTION.
001540 SD  C-CRT
001550     END STATUS IS ESTAT.
001560 01  C-CLEAR.
001570     02  LINE   1  CLEAR SCREEN.
001580 01  C-MID.
001590     02  LINE   3  COLUMN  10  PIC  N(019) VALUE
001600          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001610     02  LINE   4  COLUMN  10  PIC  N(019) VALUE
001620          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001630     02  LINE   5  COLUMN  10  PIC  N(019) VALUE
001640          NC"＊＊＊　　　　　　　　　　　　　＊＊＊".
001650     02  LINE   6  COLUMN  10  PIC  N(019) VALUE
001660          NC"＊＊＊　　日付別　入金予定表　　＊＊＊".
001670     02  LINE   7  COLUMN  10  PIC  N(019) VALUE
001680          NC"＊＊＊　　　　　　　　　　　　　＊＊＊".
001690     02  LINE   8  COLUMN  10  PIC  N(019) VALUE
001700          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001710     02  LINE   9  COLUMN  10  PIC  N(019) VALUE
001720          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001730     02  LINE  14  COLUMN  16  PIC  X(026) VALUE
001740          "'0000.00.00 〜 '9999.99.99".
001750     02  LINE  20  COLUMN  18  PIC  X(022) VALUE
001760          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001770 01  C-ACP.
001780     02  LINE  14.
001790       03  A-SNEN  COLUMN  17  PIC  9(004)
001800            USING W-SNEN                 NO IFC.
001810       03  A-SGET  COLUMN  22  PIC  9(002)
001820            USING W-SGET                 NO IFC.
001830       03  A-SPEY  COLUMN  25  PIC  9(002)
001840            USING W-SPEY  CHECK OVERFLOW NO IFC.
001850       03  A-ENEN  COLUMN  32  PIC  9(004)
001860            USING W-ENEN                 NO IFC.
001870       03  A-EGET  COLUMN  37  PIC  9(002)
001880            USING W-EGET                 NO IFC.
001890       03  A-EPEY  COLUMN  40  PIC  9(002)
001900            USING W-EPEY  CHECK OVERFLOW NO IFC.
001910     02  A-DMM   LINE  20  COLUMN  35  PIC  9(001)
001920          USING W-DMM   CHECK OVERFLOW NO IFC.
001930 01  C-ERR.
001940     02  LINE  24.
001950       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001960            "***  DATA ﾅｼ  ***".
001970     COPY LSSEM.
001980 PROCEDURE DIVISION.
001990 M-05.
002000     DISPLAY C-CLEAR.
002010     DISPLAY C-MID.
002020     MOVE ZERO TO W-DATA.
002030     MOVE 99999999 TO W-ENGP.
002040     GO TO M-40.
002050 M-10.
002060     ACCEPT A-SNEN.
002070     IF ESTAT = PF9
002080         GO TO M-95.
002090     IF ESTAT NOT = NOC AND HTB AND SKP
002100         GO TO M-10.
002110 M-15.
002120     ACCEPT A-SGET.
002130     IF ESTAT = BTB
002140         GO TO M-10.
002150     IF ESTAT NOT = NOC AND HTB AND SKP
002160         GO TO M-15.
002170     IF W-SNEN = ZERO
002180         IF W-SGET NOT = ZERO
002190             GO TO M-15.
002200     IF W-SNEN NOT = ZERO
002210         IF W-SGET < 1 OR > 12
002220             GO TO M-15.
002230 M-20.
002240     ACCEPT A-SPEY.
002250     IF ESTAT = BTB
002260         GO TO M-15.
002270     IF ESTAT NOT = HTB AND SKP
002280         GO TO M-20.
002290     IF W-SGET = ZERO
002300         IF W-SPEY NOT = ZERO
002310             GO TO M-20.
002320     IF W-SGET NOT = ZERO
002330         IF W-SPEY < 1 OR > 31
002340             GO TO M-20.
002350 M-25.
002360     ACCEPT A-ENEN.
002370     IF ESTAT = BTB
002380         GO TO M-20.
002390     IF ESTAT NOT = NOC AND HTB AND SKP
002400         GO TO M-25.
002410     IF W-ENEN < W-SNEN
002420         GO TO M-25.
002430 M-30.
002440     ACCEPT A-EGET.
002450     IF ESTAT = BTB
002460         GO TO M-25.
002470     IF ESTAT NOT = NOC AND HTB AND SKP
002480         GO TO M-30.
002490     IF W-ENEN = ZERO
002500         IF W-EGET NOT = ZERO
002510             GO TO M-30.
002520     IF W-ENEN NOT = ZERO
002530         IF W-EGET < 1 OR > 12
002540             GO TO M-30.
002550 M-35.
002560     ACCEPT A-EPEY.
002570     IF ESTAT = BTB
002580         GO TO M-30.
002590     IF ESTAT NOT = HTB AND SKP
002600         GO TO M-35.
002610     IF W-EGET = ZERO
002620         IF W-EPEY NOT = ZERO
002630             GO TO M-35.
002640     IF W-EGET NOT = ZERO
002650         IF W-EPEY < 1 OR > 31
002660             GO TO M-35.
002670     IF W-SNGP > W-ENGP
002680         GO TO M-25.
002690 M-40.
002700     ACCEPT A-DMM.
002710     IF ESTAT = BTB
002720         GO TO M-35.
002730     IF ESTAT NOT = HTB AND SKP
002740         GO TO M-40.
002750     IF W-DMM = 9
002760         GO TO M-95.
002770     IF W-DMM NOT = 1
002780         GO TO M-40.
002790*
002800     CALL "CBLSTNNO" USING STN-NO.
002810     MOVE STN-NO2 TO W-FID2.
002820     MOVE W-FID TO WK0064ID.
002830     OPEN INPUT NYWF.
002840 M-45.
002850     READ NYWF AT END
002860         CLOSE NYWF
002870         DISPLAY E-ME1 E-ME99
002880         GO TO M-95.
002890     IF NYW-DATE < W-SNGP
002900         GO TO M-45.
002910     IF NYW-DATE > W-ENGP
002920         CLOSE NYWF
002930         DISPLAY E-ME1 E-ME99
002940         GO TO M-95.
002950*
002960     ACCEPT H-DATE FROM DATE.
002970     OPEN INPUT T-M.
002980     OPEN OUTPUT SP-F.
002990     PERFORM S-10 THRU S-15.
003000 M-50.
003010     MOVE ZERO TO WS-D.
003020     MOVE NYW-DATE TO W-NGP.
003030 M-55.
003040     MOVE ZERO TO WN-D W-MC W-KC.
003050     MOVE NYW-PEY TO W-PEY.
003060 M-60.
003070     MOVE NYW-TCD TO T-KEY.
003080     READ T-M WITH UNLOCK INVALID KEY
003090         MOVE SPACE TO T-NAME
003100         MOVE NC"＊＊　得意先なし　＊＊" TO T-NAME.
003110*
003120     MOVE SPACE TO W-P.
003130     MOVE SPACE TO P-TNA P-NS1 P-NS2.
003140     IF W-MC = 0
003150         MOVE 1 TO W-MC
003160         MOVE NYW-GET TO P-GET
003170         MOVE "/" TO P-S1
003180         MOVE NYW-PEY TO P-PEY.
003190     MOVE NYW-TCD TO P-TCD.
003200     MOVE T-NAME TO P-TNA.
003210     MOVE NYW-KIN TO P-KIN.
003220     MOVE NYW-SHZ TO P-SHZ.
003230     MOVE NYW-KEI TO P-KEI.
003240     IF NYW-NC1 = 1
003250         MOVE NC"現　金　" TO P-NS1.
003260     IF NYW-NC1 = 2
003270         MOVE NC"小切手　" TO P-NS1.
003280     IF NYW-NC1 = 3
003290         MOVE NC"手　形　" TO P-NS1.
003300     IF NYW-NC2 = 1
003310         MOVE NC"現　金　" TO P-NS2.
003320     IF NYW-NC2 = 2
003330         MOVE NC"小切手　" TO P-NS2.
003340     IF NYW-NC2 = 3
003350         MOVE NC"手　形　" TO P-NS2.
003360     IF NYW-TGK NOT = ZERO
003370         MOVE NYW-TGKS TO P-TD.
003380     MOVE NYW-SGET TO P-SG.
003390     MOVE "/" TO P-S2.
003400     MOVE NYW-SPEY TO P-SP.
003410     MOVE NYW-TNC TO P-TNC.
003420     IF LINAGE-COUNTER > 60
003430         MOVE NYW-GET TO P-GET
003440         MOVE "/" TO P-S1
003450         MOVE NYW-PEY TO P-PEY
003460         PERFORM S-05 THRU S-15.
003470     MOVE SPACE TO SP-R.
003480     MOVE W-P TO SP-R.
003490     WRITE SP-R.
003500     MOVE SPACE TO SP-R.
003510*
003520     ADD NYW-KIN TO WN-KIN.
003530     ADD NYW-SHZ TO WN-SHZ.
003540     ADD NYW-KEI TO WN-KEI.
003550     IF W-KC = 1
003560         MOVE 2 TO W-KC.
003570     IF W-KC = 0
003580         MOVE 1 TO W-KC.
003590 M-65.
003600     READ NYWF AT END
003610         GO TO M-85.
003620     IF NYW-DATE > W-ENGP
003630         GO TO M-85.
003640     IF NYW-GET NOT = W-GET
003650         GO TO M-70.
003660     IF NYW-PEY = W-PEY
003670         GO TO M-60.
003680     PERFORM S-20 THRU S-30.
003690     GO TO M-55.
003700 M-70.
003710     PERFORM S-20 THRU S-30.
003720     PERFORM S-35 THRU S-40.
003730     GO TO M-50.
003740 M-85.
003750     PERFORM S-20 THRU S-30.
003760     PERFORM S-35 THRU S-40.
003770     PERFORM S-45 THRU S-50.
003780 M-90.
003790     CLOSE T-M.
003800     CLOSE NYWF.
003810     CLOSE SP-F.
003820 M-95.
003830     DISPLAY C-CLEAR.
003840     STOP RUN.
003850 S-05.
003860     MOVE SPACE TO SP-R.
003870     WRITE SP-R AFTER PAGE.
003880 S-10.
003890     ADD 1 TO W-PAGE.
003900     MOVE W-PAGE  TO H-PAGE.
003910     MOVE SPACE TO SP-R.
003920     MOVE HEAD1 TO SP-R.
003930     WRITE SP-R.
003940     MOVE SPACE TO SP-R.
003950     MOVE HEAD2 TO SP-R.
003960     WRITE SP-R AFTER 2.
003970     MOVE SPACE TO SP-R.
003980 S-15.
003990     EXIT.
004000 S-20.
004010     IF W-KC < 2
004020         GO TO S-25.
004030     MOVE SPACE TO W-P.
004040     MOVE SPACE TO P-TNA P-NS1 P-NS2.
004050     MOVE NC"　　　　　　　　　　　　　　　（　計　）" TO P-TNA.
004060     MOVE WN-KIN TO P-KIN.
004070     MOVE WN-SHZ TO P-SHZ.
004080     MOVE WN-KEI TO P-KEI.
004090     IF LINAGE-COUNTER > 60
004100         MOVE NYW-GET TO P-GET
004110         MOVE "/" TO P-S1
004120         MOVE NYW-PEY TO P-PEY
004130         PERFORM S-05 THRU S-15.
004140     MOVE SPACE TO SP-R.
004150     MOVE W-P TO SP-R.
004160     WRITE SP-R.
004170 S-25.
004180     MOVE SPACE TO SP-R.
004190     WRITE SP-R.
004200     ADD WN-KIN TO WS-KIN.
004210     ADD WN-SHZ TO WS-SHZ.
004220     ADD WN-KEI TO WS-KEI.
004230 S-30.
004240     EXIT.
004250 S-35.
004260     MOVE SPACE TO W-P.
004270     MOVE SPACE TO P-TNA P-NS1 P-NS2.
004280     MOVE NC"　　　　　　　　　　［　小　計　］　　　" TO P-TNA.
004290     MOVE WS-KIN TO P-KIN.
004300     MOVE WS-SHZ TO P-SHZ.
004310     MOVE WS-KEI TO P-KEI.
004320     IF LINAGE-COUNTER > 60
004330         PERFORM S-05 THRU S-15.
004340     MOVE SPACE TO SP-R.
004350     MOVE W-P TO SP-R.
004360     WRITE SP-R.
004370     MOVE SPACE TO SP-R.
004380     WRITE SP-R.
004390     ADD WS-KIN TO WA-KIN.
004400     ADD WS-SHZ TO WA-SHZ.
004410     ADD WS-KEI TO WA-KEI.
004420 S-40.
004430     EXIT.
004440 S-45.
004450     MOVE SPACE TO W-P.
004460     MOVE SPACE TO P-TNA P-NS1 P-NS2.
004470     MOVE NC"　　　　　【　総　合　計　】　　　　　　" TO P-TNA.
004480     MOVE WA-KIN TO P-KIN.
004490     MOVE WA-SHZ TO P-SHZ.
004500     MOVE WA-KEI TO P-KEI.
004510     IF LINAGE-COUNTER > 60
004520         PERFORM S-05 THRU S-15.
004530     MOVE SPACE TO SP-R.
004540     MOVE W-P TO SP-R.
004550     WRITE SP-R.
004560 S-50.
004570     EXIT.
