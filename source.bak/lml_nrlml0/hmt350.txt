000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMT350.
000030*********************************************************
000040*    PROGRAM         :  履物部門担当得意先別売上問合せ  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCHT35                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION IS INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY IS T-KEY
000200         ALTERNATE RECORD KEY IS T-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT HKBM ASSIGN TO HKB-MSD
000230         ORGANIZATION IS INDEXED
000240         ACCESS MODE IS RANDOM
000250         RECORD KEY IS HKB-KEY
000260         FILE STATUS IS ERR-STAT.
000270     SELECT SNTRF ASSIGN TO SNTR-MSD
000280         FILE STATUS IS ERR-STAT.
000290 I-O-CONTROL.
000300     APPLY SHARED-MODE ON M-DATE
000310     APPLY SHARED-MODE ON T-M
000320     APPLY SHARED-MODE ON HKBM.
000330 DATA DIVISION.
000340 FILE SECTION.
000350     COPY LIBFDD.
000360     COPY LITM.
000370     COPY LIHKBM.
000380     COPY LSSNTW.
000390 WORKING-STORAGE SECTION.
000400 77  WK0064ID           PIC  X(009) VALUE SPACE.
000410 01  STN-NO.
000420     02  STN-NO1        PIC  X(003).
000430     02  STN-NO2        PIC  X(003).
000440 01  W-FID.
000450     02  W-FID1         PIC  X(006) VALUE "WK0064".
000460     02  W-FID2         PIC  X(003).
000470 01  W-DATA.
000480     02  W-DMM          PIC  9(001).
000490     02  W-BC3          PIC  9(002).
000500     02  W-TNC          PIC  9(002).
000510     02  W-L            PIC  9(002).
000520     02  W-TCD          PIC  9(004).
000530     02  W-DATE.
000540       03  W-NEN        PIC  9(002).
000550       03  W-GET        PIC  9(002).
000560       03  W-PEY        PIC  9(002).
000570     02  W-KIN.
000580       03  W-U          PIC S9(008).
000590       03  W-UG         PIC S9(008).
000600       03  W-UA         PIC S9(008).
000610     02  WN-D.
000620       03  WN-U         PIC S9(009).
000630       03  WN-UA        PIC S9(009).
000640     02  WA-D.
000650       03  WA-U         PIC S9(009).
000660       03  WA-UA        PIC S9(009).
000670     02  W-BRN3         PIC  N(003).
000680     02  W-NEM          PIC  X(030).
000690 01  ERR-STAT           PIC  X(002).
000700     COPY LSTAT.
000710 SCREEN SECTION.
000720 SD  C-CRT
000730     END STATUS IS ESTAT.
000740 01  C-CLEAR.
000750     02  C-CL    LINE   1  CLEAR SCREEN.
000760 01  C-MID.
000770     02  LINE   3  COLUMN  10  PIC  N(024) VALUE
000780          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000790     02  LINE   4  COLUMN  10  PIC  N(024) VALUE
000800          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
000810     02  LINE   5  COLUMN  10  PIC  N(024) VALUE
000820          NC"＊＊＊　　部門担当得意先別　売上問合せ　　＊＊＊".
000830     02  LINE   6  COLUMN  10  PIC  N(024) VALUE
000840          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
000850     02  LINE   7  COLUMN  10  PIC  N(024) VALUE
000860          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000870     02  LINE  15.                                                I.020521
000880       03  COLUMN  11  PIC  N(005) VALUE NC"カジュアル".          I.020521
000890       03  COLUMN  21  PIC  X(006) VALUE "=10 , ".                I.020521
000900       03  COLUMN  27  PIC  N(003) VALUE NC"ワーク".              I.020521
000910       03  COLUMN  33  PIC  X(006) VALUE "=20 , ".                I.020521
000920       03  COLUMN  39  PIC  N(003) VALUE NC"教　育".              I.020521
000930       03  COLUMN  45  PIC  X(012) VALUE "=30 .....   ".          I.020521
000940*****02  LINE  15  COLUMN  16  PIC  X(036) VALUE                  D.020521
000950*****     "内作=10 , 一般=20 , 教育=30 .....   ".                 D.020521
000960 01  C-ACP.
000970*****02  A-BC3   LINE  15  COLUMN  50  PIC  9(002)                D.020521
000980     02  A-BC3   LINE  15  COLUMN  56  PIC  9(002)                I.020521
000990          USING W-BC3   CHECK OVERFLOW NO IFC.
001000     02  A-TNC   LINE   3  COLUMN   6  PIC  9(002)
001010          USING W-TNC   CHECK OVERFLOW NO IFC.
001020     02  A-DMM   LINE  23  COLUMN  62  PIC  9(001)
001030          USING W-DMM   CHECK OVERFLOW NO IFC.
001040 01  C-DSP.
001050     02  D-MM    LINE  3.
001060       03  COLUMN  61  PIC  N(003) FROM  W-BRN3  REVERSE.
001070       03  COLUMN  71  PIC Z9      FROM  W-GET.
001080       03  COLUMN  73  PIC  X(001) VALUE "/".
001090       03  COLUMN  75  PIC  9(001) VALUE 1.
001100       03  COLUMN  76  PIC  N(001) VALUE NC"〜".
001110       03  COLUMN  78  PIC Z9      FROM  W-PEY.
001120     02  D-DATA  LINE W-L.
001130       03  COLUMN   1  PIC  9(004)       FROM  T-TCD.
001140       03  COLUMN   6  PIC  N(024)       FROM  T-NAME.
001150       03  COLUMN  55  PIC ----,---,--9  FROM  WN-U.
001160       03  COLUMN  68  PIC ----,---,--9  FROM  WN-UA.
001170     02  D-TD    LINE W-L.
001180       03  COLUMN   6  PIC  N(019) VALUE
001190            NC"　　　　　　　　　　［　　合　計　　］".
001200       03  COLUMN  55  PIC ----,---,--9  FROM  WA-U.
001210       03  COLUMN  68  PIC ----,---,--9  FROM  WA-UA.
001220     02  D-NEM   LINE  23  COLUMN  33  PIC  X(030) FROM  W-NEM.
001230 01  C-ERR.
001240     02  LINE  24.
001250       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001260            "***  DATA ﾅｼ  ***".
001270       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001280       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001290       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001300            "                                                  ".
001310     COPY LIBSCR.
001320 PROCEDURE DIVISION.
001330 M-05.
001340     DISPLAY C-CLEAR.
001350     DISPLAY C-MID.
001360     MOVE ZERO TO W-DATA.
001370     CALL "CBLSTNNO" USING STN-NO.
001380     MOVE STN-NO2 TO W-FID2.
001390     MOVE W-FID TO WK0064ID.
001400     OPEN INPUT SNTRF.
001410 M-10.
001420     READ SNTRF AT END
001430         CLOSE SNTRF
001440         DISPLAY E-ME1 E-ME99
001450         GO TO M-95.
001460     IF SNTR-DC = 4 OR 8
001470         GO TO M-10.
001480*
001490     COPY LIBCPR.
001500     MOVE D-HSD TO W-DATE.
001510     OPEN INPUT T-M HKBM.
001520 M-15.
001530     ACCEPT A-BC3.
001540     IF ESTAT = PF9
001550         GO TO M-90.
001560     IF ESTAT NOT = HTB AND SKP
001570         GO TO M-15.
001580     MOVE SPACE TO HKB-KEY.
001590     MOVE 14 TO HKB-NO.
001600     MOVE W-BC3 TO HKB-BR3.
001610     READ HKBM WITH UNLOCK INVALID KEY
001620         GO TO M-15.
001630     MOVE HKB-BRN3 TO W-BRN3.
001640 M-20.
001650     CALL "SCHT35".
001660     DISPLAY D-MM.
001670 M-25.
001680     ACCEPT A-TNC.
001690     DISPLAY E-CL.
001700     IF ESTAT = PF9
001710         GO TO M-90.
001720     IF ESTAT = BTB
001730         DISPLAY C-CLEAR
001740         DISPLAY C-MID
001750         GO TO M-15.
001760     IF ESTAT NOT = HTB AND SKP
001770         GO TO M-25.
001780     IF W-TNC NOT = 99
001790         MOVE SPACE TO HKB-KEY
001800         MOVE 04 TO HKB-NO
001810         MOVE W-TNC TO HKB-TNC
001820         READ HKBM WITH UNLOCK INVALID KEY
001830             GO TO M-25.
001840     CLOSE SNTRF.
001850     OPEN INPUT SNTRF.
001860     MOVE ZERO TO WA-D.
001870     MOVE 4 TO W-L.
001880 M-30.
001890     READ SNTRF AT END
001900         DISPLAY E-ME1
001910         GO TO M-25.
001920     IF SNTR-DC = 4 OR 8
001930         GO TO M-30.
001940     IF SNTR-BC3 NOT = W-BC3
001950         GO TO M-30.
001960     IF W-TNC NOT = 99
001970         IF SNTR-TNC NOT = W-TNC
001980             GO TO M-30.
001990*
002000     PERFORM COM-RTN THRU COM-EX.
002010     IF ZERO = W-U AND W-UA
002020         GO TO M-30.
002030 M-35.
002040     IF W-TNC = 99
002050         GO TO M-40.
002060     MOVE ZERO TO WN-D.
002070     MOVE SNTR-TCD TO W-TCD.
002080     MOVE W-TCD TO T-KEY.
002090     READ T-M WITH UNLOCK INVALID KEY
002100         MOVE SPACE TO T-NAME
002110         MOVE NC"　＊＊　得意先なし　＊＊" TO T-NAME.
002120 M-40.
002130     ADD W-U TO WN-U WA-U.
002140     ADD W-UA TO WN-UA WA-UA.
002150 M-45.
002160     READ SNTRF AT END
002170         GO TO M-50.                                              I.060529
002180*****    GO TO M-55.                                              D.060529
002190     IF SNTR-DC = 4 OR 8
002200         GO TO M-45.
002210     IF SNTR-BC3 NOT = W-BC3
002220         GO TO M-45.
002230     PERFORM COM-RTN THRU COM-EX.
002240     IF ZERO = W-U AND W-UA
002250         GO TO M-45.
002260*****IF W-TNC NOT = 99                                            D.060529
002270*****    IF SNTR-TNC NOT = W-TNC                                  D.060529
002280*****        GO TO M-50.                                          D.060529
002290*****IF W-TNC = 99                                                D.060529
002300*****    IF SNTR-TNC NOT = W-TNC                                  D.060529
002310*****        GO TO M-50.                                          D.060529
002320     IF W-TNC = 99
002330         GO TO M-40.                                              I.060529
002340     IF SNTR-TNC NOT = W-TNC                                      I.060529
002350         GO TO M-50.                                              D.060529
002360*****    GO TO M-40                                               D.060529
002370*****  ELSE                                                       D.060529
002380     IF SNTR-TCD = W-TCD
002390         GO TO M-40.
002400     PERFORM MEI-RTN THRU MEI-EX.
002410     IF W-L = 23
002420         GO TO M-20.
002430     GO TO M-35.
002440 M-50.
002450     IF W-TNC = 99                                                I.060529
002460         GO TO M-55.                                              I.060529
002470     PERFORM MEI-RTN THRU MEI-EX.
002480     IF W-L = 23
002490         GO TO M-20.
002500 M-55.
002510     PERFORM KEI-RTN THRU KEI-EX.
002520     GO TO M-20.
002530 M-90.
002540     CLOSE T-M HKBM.
002550 M-95.
002560     DISPLAY C-CLEAR.
002570     STOP RUN.
002580 COM-RTN.
002590     MOVE ZERO TO W-KIN.
002600     IF (SNTR-SNC = 0) AND (SNTR-DC NOT = 2)
002610         COMPUTE W-UG = SNTR-SU * SNTR-FT.
002620     IF (SNTR-SNC = 1) OR (SNTR-DC = 1 OR 2 OR 5)
002630         COMPUTE W-UG = W-UG * -1
002640         COMPUTE W-U = SNTR-KIN * -1
002650       ELSE
002660         MOVE SNTR-KIN TO W-U.
002670     COMPUTE W-UA = W-U - W-UG.
002680 COM-EX.
002690     EXIT.
002700 MEI-RTN.
002710     ADD 1 TO W-L.
002720     IF W-L NOT = 23
002730         DISPLAY D-DATA
002740         GO TO MEI-EX.
002750     MOVE SPACE TO W-NEM.
002760     MOVE "ＮＥＸＴ=ﾘﾀｰﾝ , 担当入力=BS   " TO W-NEM.
002770     DISPLAY D-NEM.
002780 MEI-020.
002790     ACCEPT A-DMM.
002800     IF ESTAT NOT = BTB
002810         DISPLAY C-CLEAR
002820         CALL "SCHT35"
002830         DISPLAY D-MM A-TNC
002840         MOVE 4 TO W-L
002850         GO TO MEI-RTN.
002860 MEI-EX.
002870     EXIT.
002880 KEI-RTN.
002890     ADD 1 TO W-L.
002900     IF W-L = 23
002910         MOVE SPACE TO W-NEM
002920         MOVE "ＮＥＸＴ=ﾘﾀｰﾝ , 担当入力=BS   " TO W-NEM
002930       ELSE
002940         DISPLAY D-TD
002950         MOVE SPACE TO W-NEM
002960         MOVE "　　　　　 ＥＮＤ　ＤＡＴＡ   " TO W-NEM.
002970     DISPLAY D-NEM.
002980 KEI-020.
002990     ACCEPT A-DMM.
003000     IF W-L = 23
003010         IF ESTAT NOT = BTB
003020             DISPLAY C-CLEAR
003030             CALL "SCHT35"
003040             DISPLAY D-MM A-TNC
003050             MOVE 4 TO W-L
003060             GO TO KEI-RTN.
003070 KEI-EX.
003080     EXIT.
