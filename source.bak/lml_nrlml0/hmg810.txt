000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMG810.
000030*********************************************************
000040*    PROGRAM         :  親子コード抽出          　　　　*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    COMPILE TYPE    :  COBOL                           *
000070*    JS-SIGN         :  0=月末在庫一括振替 , 1=その他   *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000170         ORGANIZATION IS INDEXED
000180         ACCESS MODE IS DYNAMIC
000190         RECORD KEY IS HI-KEY
000200         ALTERNATE RECORD KEY IS HI-KEY2
000210         FILE STATUS IS ERR-STAT.
000220     SELECT CODEF ASSIGN TO CODE-MSD.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON M-DATE
000250     APPLY SHARED-MODE ON HI-M.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LIBFDD.
000290     COPY LIHIM.
000300 FD  CODEF
000310     BLOCK  4 RECORDS
000320     LABEL RECORD IS STANDARD
000330     VALUE OF IDENTIFICATION WK0064ID.
000340 01  CODE-R.
000350     02  CODE-MHCD      PIC  9(006).
000360     02  CODE-HCD       PIC  9(006).
000370     02  CODE-CHK       PIC  9(001).
000380     02  CODE-BC1       PIC  9(002).                              I.020603
000390     02  F              PIC  X(049).                              I.020603
000400*****02  F              PIC  X(051).                              D.020603
000410 WORKING-STORAGE SECTION.
000420 77  JS-SIGN            PIC  9(001).                              I.020606
000430 77  WK0064ID           PIC  X(009) VALUE SPACE.
000440 01  STN-NO.
000450     02  STN-NO1        PIC  X(003).
000460     02  STN-NO2        PIC  X(003).
000470 01  W-FID.
000480     02  W-FID1         PIC  X(006) VALUE "WK0064".
000490     02  W-FID2         PIC  X(003).
000500 01  W-DATA.
000510     02  CHK            PIC  9(001).
000520 01  ERR-STAT           PIC  X(002).
000530 SCREEN SECTION.
000540 SD  C-CRT
000550     END STATUS IS ESTAT.
000560 01  C-CLEAR.
000570     02  C-CL    LINE   1  CLEAR SCREEN.
000580 01  C-MID.
000590     02  LINE   3  COLUMN  10  PIC N(023) VALUE
000600          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000610     02  LINE   4  COLUMN  10  PIC N(023) VALUE
000620          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000630     02  LINE   5  COLUMN  10  PIC N(023) VALUE
000640          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
000650     02  LINE   6  COLUMN  10  PIC N(023) VALUE
000660          NC"＊＊＊　　在庫調整用　親子コード抽出　　＊＊＊".
000670     02  LINE   7  COLUMN  10  PIC N(023) VALUE
000680          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
000690     02  LINE   8  COLUMN  10  PIC N(023) VALUE
000700          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000710     02  LINE   9  COLUMN  10  PIC N(023) VALUE
000720          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000730 01  C-ERR.
000740     02  LINE  24.
000750       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
000760            "***  DATA ｴﾗｰ  ***".
000770       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
000780            "***  ﾋﾝﾒｲ ﾌﾘｶｴ ｼｮﾘｽﾞﾐ  ***".
000790       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
000800       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
000810     COPY LIBSCR.
000820 PROCEDURE DIVISION.
000830 M-05.
000840     ACCEPT JS-SIGN.                                              I.020606
000850     DISPLAY C-CLEAR.
000860     DISPLAY C-MID.
000870     IF JS-SIGN = 1                                               I.020606
000880         GO TO M-10.                                              I.020606
000890     COPY LIBCPR.
000900     IF DATE-HFC NOT = 0
000910         MOVE 255 TO COMPLETION-CODE
000920         DISPLAY E-ME2 E-ME99
000930         GO TO M-95.
000940 M-10.                                                            I.020606
000950     CALL "CBLSTNNO" USING STN-NO.
000960     MOVE STN-NO2 TO W-FID2.
000970     MOVE W-FID TO WK0064ID.
000980     OPEN OUTPUT CODEF.
000990     OPEN INPUT HI-M.
001000 M-15.
001010     READ HI-M NEXT RECORD WITH UNLOCK AT END
001020         GO TO M-90.
001030     IF HI-MHCD = HI-HCD
001040         GO TO M-15.
001050     IF HI-MHCD > 999899
001060         GO TO M-15.
001070     IF HI-HCD > 999899
001080         GO TO M-15.
001090     MOVE ZERO TO CODE-R.
001100     MOVE HI-MHCD TO CODE-MHCD.
001110     MOVE HI-HCD TO CODE-HCD.
001120     MOVE 1 TO CODE-CHK.
001130     MOVE HI-BC1 TO CODE-BC1.                                     I.020603
001140     WRITE CODE-R.
001150*
001160     MOVE ZERO TO CODE-R.
001170     MOVE HI-MHCD TO CODE-MHCD.
001180     MOVE HI-MHCD TO CODE-HCD.
001190     MOVE HI-BC1 TO CODE-BC1.                                     I.020603
001200     WRITE CODE-R.
001210     GO TO M-15.
001220 M-90.
001230     CLOSE HI-M.
001240     CLOSE CODEF.
001250 M-95.
001260     DISPLAY C-CLEAR.
001270     STOP RUN.
