000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HKG550.
000030 AUTHOR.     _______.
000040 DATE-WRITTEN.    1999-08-18.
000050*********************************************************
000060*    PROGRAM         :  入金予定ワーク作成（パソコン用）*
000070*    PRINTER TYPE    :  JIPS                            *
000080*    SCREEN          :  ______                          *
000090*        変更　　　  :  ________                        *
000100*    COMPILE TYPE    :  COBOL                           *
000110*********************************************************
000120 ENVIRONMENT DIVISION.
000130 CONFIGURATION SECTION.
000140 SOURCE-COMPUTER. SYSTEM3100.
000150 OBJECT-COMPUTER. SYSTEM3100.
000160 INPUT-OUTPUT SECTION.
000170 FILE-CONTROL.
000180     COPY LIBCSE.
000190     SELECT NYWM ASSIGN TO NYW-MSD
000200         ORGANIZATION IS INDEXED
000210         ACCESS MODE IS DYNAMIC
000220         RECORD KEY IS NYW-KEY
000230         FILE STATUS IS ERR-STAT.
000240*****SELECT T-M ASSIGN TO T-MSD                                   D.000407
000250     SELECT T-M ASSIGN TO T1-MSD T2-MSD                           I.000407
000260         ORGANIZATION IS INDEXED
000270         ACCESS MODE IS RANDOM
000280         RECORD KEY IS T-KEY
000290         ALTERNATE RECORD KEY IS T-KEY2                           I.000407
000300         FILE STATUS IS ERR-STAT.
000310     SELECT SM-F ASSIGN TO SM-MSD
000320         FILE STATUS IS ERR-STAT.
000330     SELECT SMW-F ASSIGN TO SMW-MSD
000340         FILE STATUS IS ERR-STAT.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON M-DATE
000370     APPLY SHARED-MODE ON T-M.
000380 DATA DIVISION.
000390 FILE SECTION.
000400     COPY LIBFDD.
000410     COPY LITM.
000420 FD  SM-F
000430     BLOCK  5 RECORDS
000440     LABEL RECORD IS STANDARD
000450     VALUE OF IDENTIFICATION "SMF".
000460 01  SM-R.
000470     02  SM-TCD         PIC  X(004).
000480     02  SM-DATE.
000490       03  SM-NG        PIC  9(006).
000500       03  F            PIC  9(002).
000510     02  SM-SZZ         PIC S9(009).
000520     02  SM-SZZZ        PIC S9(007).
000530     02  SM-SUA         PIC S9(009).
000540     02  SM-SUAZ        PIC S9(007).
000550     02  SM-STS         PIC S9(007).
000560     02  SM-STSZ        PIC S9(005).
000570     02  SM-SNK         PIC S9(009).
000580     02  SM-SNKZ        PIC S9(007).
000590     02  F              PIC  X(010).
000600     02  SM-DNO         PIC  9(006).
000610     02  SM-SP          PIC  9(002).
000620     02  SM-SK          PIC  9(001).
000630     02  SM-CHK         PIC  9(001).
000640     02  F              PIC  X(010).
000650 FD  SMW-F
000660     BLOCK  2 RECORDS
000670     LABEL RECORD IS STANDARD
000680     VALUE OF IDENTIFICATION WK0128ID.
000690 01  SMW-R.
000700     02  SMW-TCD        PIC  X(004).
000710     02  SMW-DATE.
000720       03  SMW-NG       PIC  9(006).
000730       03  F            PIC  9(002).
000740     02  SMW-SZZ        PIC S9(009).
000750     02  SMW-SZZZ       PIC S9(007).
000760     02  SMW-SUA        PIC S9(009).
000770     02  SMW-SUAZ       PIC S9(007).
000780     02  SMW-STS        PIC S9(007).
000790     02  SMW-STSZ       PIC S9(005).
000800     02  SMW-SNK        PIC S9(009).
000810     02  SMW-SNKZ       PIC S9(007).
000820     02  SMW-NKD.
000830       03  F            PIC  9(004).
000840       03  SMW-NPEY     PIC  9(002).
000850     02  SMW-TS         PIC  9(003).
000860     02  F              PIC  X(001).
000870     02  SMW-DNO        PIC  9(006).
000880     02  SMW-SP         PIC  9(002).
000890     02  SMW-SK         PIC  9(001).
000900     02  SMW-CHK        PIC  9(001).
000910     02  F              PIC  X(036).
000920 FD  NYWM
000930*****BLOCK  7 RECORDS                                             D.020423
000940     BLOCK  3 RECORDS                                             I.020423
000950     LABEL RECORD IS STANDARD
000960     VALUE OF IDENTIFICATION "NYWM".
000970 01  NYW-R.
000980     02  NYW-KEY.
000990       03  NYW-NG       PIC  9(006).
001000       03  NYW-TCD      PIC  9(004).
001010*****02  NYW-NAME       PIC  N(024).                              D.020423
001020     02  NYW-NAME       PIC  N(026).                              I.020423
001030     02  NYW-NSR        PIC  N(002).
001040     02  NYW-KIN        PIC S9(009).
001050     02  NYW-NYD        PIC  X(002).
001060 WORKING-STORAGE SECTION.
001070 77  W-FILE             PIC  X(013).
001080 77  WK0128ID           PIC  X(009) VALUE SPACE.
001090 01  STN-NO.
001100     02  STN-NO1        PIC  X(003).
001110     02  STN-NO2        PIC  X(003).
001120 01  W-FID.
001130     02  W-FID1         PIC  X(006) VALUE "WK0128".
001140     02  W-FID2         PIC  X(003).
001150 01  W-DATA.
001160     02  W-NGP.
001170       03  W-NG.
001180         04  W-NEN      PIC  9(004).
001190         04  W-NENL  REDEFINES W-NEN.
001200           05  W-NEN1   PIC  9(002).
001210           05  W-NEN2   PIC  9(002).
001220         04  W-GET      PIC  9(002).
001230       03  W-PEY        PIC  9(002).
001240     02  W-NGPL  REDEFINES W-NGP.
001250       03  F            PIC  9(002).
001260       03  W-NGPS       PIC  9(006).
001270     02  W-NGD.
001280       03  W-NEND       PIC  9(004).
001290       03  W-GETD       PIC  9(002).
001300     02  W-NGH.
001310       03  W-NENH       PIC  9(004).
001320       03  W-GETH       PIC  9(002).
001330     02  W-DMM          PIC  9(001).
001340     02  W-KIN          PIC S9(009).
001350 01  ERR-STAT           PIC  X(002).
001360     COPY LSTAT.
001370 SCREEN SECTION.
001380 SD  C-CRT
001390     END STATUS IS ESTAT.
001400 01  C-CLEAR.
001410     02  C-CL    LINE   1  CLEAR SCREEN.
001420 01  C-MID.
001430     02  LINE   3  COLUMN  10  PIC  N(020) VALUE
001440          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001450     02  LINE   4  COLUMN  10  PIC  N(020) VALUE
001460          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001470     02  LINE   5  COLUMN  10  PIC  N(020) VALUE
001480          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
001490     02  LINE   6  COLUMN  10  PIC  N(020) VALUE
001500          NC"＊＊＊　　入金予定ワーク　作成　　＊＊＊".
001510     02  LINE   7  COLUMN  10  PIC  N(020) VALUE
001520          NC"＊＊＊　　（パソコン変換用）　　　＊＊＊".
001530     02  LINE   8  COLUMN  10  PIC  N(020) VALUE
001540          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001550     02  LINE   9  COLUMN  10  PIC  N(020) VALUE
001560          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001570     02  LINE  15.
001580       03  COLUMN  21  PIC  9(004) FROM  W-NEN.
001590       03  COLUMN  25  PIC  N(001) VALUE NC"年".
001600       03  COLUMN  28  PIC Z9      FROM  W-GET.
001610       03  COLUMN  30  PIC  N(001) VALUE NC"月".
001620       03  COLUMN  33  PIC  N(003) VALUE NC"請求分".
001630     02  LINE  20  COLUMN  19  PIC  X(022) VALUE
001640          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001650 01  C-ACP.
001660     02  LINE  15.
001670       03  A-NEN   COLUMN  21  PIC  9(004)
001680            USING W-NEN   CHECK OVERFLOW NO IFC.
001690       03  A-GET   COLUMN  28  PIC  9(002)
001700            USING W-GET   CHECK OVERFLOW NO IFC.
001710     02  A-DMM   LINE  20  COLUMN  36  PIC  9(001)
001720          USING W-DMM   CHECK OVERFLOW NO IFC.
001730 01  C-ERR.
001740     02  LINE  24.
001750       03  E-ME1   COLUMN  15  PIC  X(024) VALUE
001760            "***  NYWM WRITE ｴﾗｰ  ***".
001770       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
001780            "***  NYWM REWRITE ｴﾗｰ  ***".
001790       03  E-ME3   COLUMN  15  PIC  X(017) VALUE
001800            "***  DATA ﾅｼ  ***".
001810     COPY LSSEM.                                                  I.940707
001820     COPY LIBSCR.                                                 I.950228
001830 PROCEDURE DIVISION.
001840 M-05.
001850     COPY LIBCPR.                                                 I.950228
001860     INITIALIZE W-DATA.
001870     ACCEPT W-NGPS FROM DATE.
001880     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001890         ADD DATE-NC1 TO W-NEN.
001900     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001910         ADD DATE-NC2 TO W-NEN.
001920     MOVE W-NG TO W-NGH.
001930     DISPLAY C-CLEAR.
001940     DISPLAY C-MID.
001950 M-10.
001960     ACCEPT A-NEN.
001970     IF ESTAT = PF9
001980         GO TO M-95.
001990     IF ESTAT NOT = HTB AND SKP
002000         GO TO M-10.
002010     IF W-NGH < W-NEN
002020         GO TO M-10.
002030 M-15.
002040     ACCEPT A-GET.
002050     IF ESTAT = BTB
002060         GO TO M-10.
002070     IF ESTAT NOT = HTB AND SKP
002080         GO TO M-15.
002090     IF W-GET < 1 OR > 12
002100         GO TO M-15.
002110     IF W-NGH < W-NG
002120         GO TO M-15.
002130 M-20.
002140     ACCEPT A-DMM.
002150     IF ESTAT = BTB
002160         GO TO M-15.
002170     IF ESTAT NOT = HTB AND SKP
002180         GO TO M-20.
002190     IF W-DMM = 9
002200         GO TO M-10.
002210     IF W-DMM NOT = 1
002220         GO TO M-20.
002230*-------------------------------------------------------------------------
002240     MOVE W-NG TO W-NGD.
002250     SUBTRACT 1 FROM W-GETD.
002260     IF W-GETD = ZERO
002270         MOVE 12 TO W-GETD
002280         SUBTRACT 1 FROM W-NEND.
002290*
002300     OPEN OUTPUT NYWM.
002310     CLOSE NYWM.
002320     OPEN INPUT SM-F.
002330     OPEN INPUT T-M.
002340     OPEN I-O NYWM.
002350*-------------------------------------------------------------------------
002360 M-25.
002370     READ SM-F AT END
002380         GO TO M-35.
002390     IF SM-NG NOT = W-NG
002400         GO TO M-25.
002410     MOVE SM-TCD TO T-KEY.
002420     READ T-M WITH UNLOCK INVALID KEY
002430         MOVE SPACE TO T-NAME
002440         MOVE NC"　＊　得意先　なし　＊　" TO T-NAME.
002450     COMPUTE W-KIN = SM-SZZ + SM-SUA - SM-SNK + SM-STS +
002460                     SM-SZZZ + SM-SUAZ - SM-SNKZ + SM-STSZ.
002470*
002480     INITIALIZE NYW-R.
002490     MOVE SM-NG TO NYW-NG.
002500     MOVE SM-TCD TO NYW-TCD.
002510     READ NYWM INVALID KEY
002520         GO TO M-30.
002530     MOVE T-NAME TO NYW-NAME.
002540     MOVE W-KIN TO NYW-KIN.
002550     REWRITE NYW-R INVALID KEY
002560         CLOSE SM-F
002570         DISPLAY E-STAT E-ME2 E-ME99
002580         GO TO M-90.
002590     GO TO M-25.
002600 M-30.
002610     MOVE T-NAME TO NYW-NAME.
002620     MOVE W-KIN TO NYW-KIN.
002630     WRITE NYW-R INVALID KEY
002640         CLOSE SM-F
002650         DISPLAY E-STAT E-ME1 E-ME99
002660         GO TO M-90.
002670     GO TO M-25.
002680*-------------------------------------------------------------------------
002690 M-35.
002700     MOVE ZERO TO NYW-KEY.
002710     START NYWM KEY NOT < NYW-KEY INVALID KEY
002720         DISPLAY E-ME3 E-ME99
002730         GO TO M-90.
002740     READ NYWM NEXT RECORD AT END
002750         DISPLAY E-ME3 E-ME99
002760         GO TO M-90.
002770     CALL "CBLSTNNO" USING STN-NO.
002780     MOVE STN-NO2 TO W-FID2.
002790     MOVE W-FID TO WK0128ID.
002800     OPEN INPUT SMW-F.
002810 M-40.
002820     CLOSE SMW-F.
002830     OPEN INPUT SMW-F.
002840 M-45.
002850     READ SMW-F AT END
002860         GO TO M-50.
002870*****IF W-NGD > SMW-NG
002880*****    GO TO M-50.
002890     IF NYW-TCD NOT = SMW-TCD
002900         GO TO M-45.
002910     IF SMW-NPEY = ZERO
002920         GO TO M-45.
002930*
002940     IF SMW-TS NOT = ZERO
002950         MOVE NC"手形" TO NYW-NSR.
002960     IF SMW-NPEY NOT = ZERO
002970         MOVE SMW-NPEY TO NYW-NYD.
002980     REWRITE NYW-R INVALID KEY
002990         CLOSE SMW-F
003000         DISPLAY E-STAT E-ME2 E-ME99
003010         GO TO M-90.
003020 M-50.
003030     READ NYWM NEXT RECORD AT END
003040         CLOSE SMW-F
003050         GO TO M-90.
003060     GO TO M-40.
003070 M-90.
003080     CLOSE NYWM.
003090     CLOSE T-M.
003100 M-95.
003110     DISPLAY C-CLEAR.
003120     STOP RUN.
