000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID.  KHG030.
000030*********************************************************
000040*    PROGRAM         :  工品　販売実績・製品受払表 (参  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT KH-M ASSIGN TO KH-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY KH-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT KHT-M ASSIGN TO KHT-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE DYNAMIC
000240         RECORD KEY KHT-KEYD
000250         FILE STATUS IS ERR-STAT.
000260     SELECT SP-F ASSIGN TO P-PRN999.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON M-DATE
000290     APPLY SHARED-MODE ON KH-M
000300     APPLY SHARED-MODE ON KHT-M
000310     APPLY SHIFT-CODE  ON SP-F.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIBFDD.
000350     COPY LIKHM.
000360     COPY LIKHT2.
000370     COPY LSPF.
000380 WORKING-STORAGE SECTION.
000390 77  JS-SIN             PIC  9(001).
000400 01  HEAD1.
000410     02  F              PIC  X(005) VALUE ""3FE04FE080"".
000420     02  F              PIC  N(006) VALUE NC"（参考資料）".
000430     02  F              PIC  X(027) VALUE SPACE.
000440     02  F              PIC  N(024) VALUE
000450          NC"＊＊＊　　工品品種別　販売実績・受払表　　＊＊＊".
000460     02  F              PIC  X(027) VALUE SPACE.
000470     02  F              PIC  X(005) VALUE "DATE ".
000480     02  H-DATE         PIC 99B99B99.
000490     02  F              PIC  X(007) VALUE "     P.".
000500     02  H-PAGE         PIC Z9.
000510 01  HEAD2.
000520     02  F              PIC  X(005) VALUE ""3FE04F40A0"".
000530     02  F              PIC  N(002) VALUE NC"区分".
000540     02  F              PIC  X(006) VALUE " ｺｰﾄﾞ ".
000550     02  F              PIC  N(004) VALUE NC"品　　名".
000560     02  F              PIC  X(011) VALUE SPACE.
000570     02  F              PIC  X(009) VALUE " I------ ".
000580     02  F              PIC  N(004) VALUE NC"前月繰越".
000590     02  F              PIC  X(017) VALUE " ------I I------ ".
000600     02  F              PIC  N(004) VALUE NC"当月入庫".
000610     02  F              PIC  X(017) VALUE " ------I I------ ".
000620     02  F              PIC  N(004) VALUE NC"当月売上".
000630     02  F              PIC  X(017) VALUE " ------I I------ ".
000640     02  F              PIC  N(004) VALUE NC"翌月繰越".
000650     02  F              PIC  X(009) VALUE " ------I(".
000660     02  F              PIC  X(005) VALUE SPACE.
000670     02  F              PIC  N(004) VALUE NC"平均売価".
000680     02  F              PIC  X(001) VALUE ")".
000690     02  F              PIC  X(005) VALUE SPACE.
000700 01  HEAD3.
000710     02  F              PIC  X(020) VALUE SPACE.
000720     02  F              PIC  N(004) VALUE NC"予定原価".
000730     02  F              PIC  X(006) VALUE SPACE.
000740     02  F              PIC  N(004) VALUE NC"数　　量".
000750     02  F              PIC  X(005) VALUE SPACE.
000760     02  F              PIC  N(004) VALUE NC"金　　額".
000770     02  F              PIC  X(006) VALUE SPACE.
000780     02  F              PIC  N(004) VALUE NC"数　　量".
000790     02  F              PIC  X(005) VALUE SPACE.
000800     02  F              PIC  N(004) VALUE NC"金　　額".
000810     02  F              PIC  X(006) VALUE SPACE.
000820     02  F              PIC  N(004) VALUE NC"数　　量".
000830     02  F              PIC  X(005) VALUE SPACE.
000840     02  F              PIC  N(004) VALUE NC"金　　額".
000850     02  F              PIC  X(006) VALUE SPACE.
000860     02  F              PIC  N(004) VALUE NC"数　　量".
000870     02  F              PIC  X(005) VALUE SPACE.
000880     02  F              PIC  N(004) VALUE NC"金　　額".
000890     02  F              PIC  X(005) VALUE SPACE.
000900     02  F              PIC  N(004) VALUE NC"売上粗利".
000910     02  F              PIC  X(003) VALUE SPACE.
000920     02  F              PIC  N(002) VALUE NC"　率".
000930     02  F              PIC  X(001) VALUE "%".
000940 01  W-P1.
000950     02  P-YC           PIC  9(002).
000960     02  F              PIC  X(001).
000970     02  P-HCD          PIC  X(005).
000980     02  F              PIC  X(001).
000990     02  P-NAME         PIC  X(020).
001000     02  F              PIC  X(089).
001010     02  P-F            PIC  X(001).
001020     02  P-BT           PIC ----,---.--.
001030     02  P-R            PIC  X(001).
001040     02  F              PIC  X(005).
001050 01  W-P2.
001060     02  P-TM           PIC  N(010).
001070     02  P-GT           PIC ----,---.--.
001080     02  P-ZS           PIC -----,---.--.
001090     02  P-ZK           PIC ---,---,---.
001100     02  P-SS           PIC -----,---.--.
001110     02  P-SK           PIC ---,---,---.
001120     02  P-US           PIC -----,---.--.
001130     02  P-UK           PIC ---,---,---.
001140     02  P-YS           PIC -----,---.--.
001150     02  P-YK           PIC ---,---,---.
001160     02  P-AR           PIC ---,---,---.
001170     02  P-RR           PIC ----9.9.
001180 01  WS-D.
001190     02  WS-ZK          PIC S9(008).
001200     02  WS-SK          PIC S9(008).
001210     02  WS-UG          PIC S9(008).
001220     02  WS-UK          PIC S9(008).
001230     02  WS-YK          PIC S9(008).
001240     02  WS-AR          PIC S9(008).
001250 01  WT-D.
001260     02  WT-ZK          PIC S9(008).
001270     02  WT-SK          PIC S9(008).
001280     02  WT-UG          PIC S9(008).
001290     02  WT-UK          PIC S9(008).
001300     02  WT-YK          PIC S9(008).
001310     02  WT-AR          PIC S9(008).
001320 01  WA-D.
001330     02  WA-ZK          PIC S9(008).
001340     02  WA-SK          PIC S9(008).
001350     02  WA-UG          PIC S9(008).
001360     02  WA-UK          PIC S9(008).
001370     02  WA-YK          PIC S9(008).
001380     02  WA-AR          PIC S9(008).
001390 01  W-DATA.
001400     02  W-D.
001410       03  W-GT         PIC  9(006)V9(02).
001420       03  W-BT         PIC S9(006)V9(02).
001430       03  W-SK         PIC S9(008).
001440       03  W-ZK         PIC S9(008).
001450*****  03  W-SS         PIC S9(005)V9(02).                        D.120305
001460       03  W-SS         PIC S9(006)V9(02).                        I.120305
001470       03  W-UK         PIC S9(008).
001480       03  W-GK         PIC S9(008).
001490*****  03  W-YS         PIC S9(005)V9(02).                        D.120305
001500       03  W-YS         PIC S9(006)V9(02).                        I.120305
001510       03  W-YK         PIC S9(008).
001520       03  W-AR         PIC S9(008).
001530       03  W-RR         PIC S9(003)V9(01).
001540     02  W-PAGE         PIC  9(002) VALUE ZERO.
001550     02  W-YC           PIC  9(002).
001560     02  W-YCC          PIC  9(001).
001570     02  W-NC           PIC  9(001).
001580     02  CHK            PIC  9(001).
001590 01  ERR-STAT           PIC  X(002).
001600     COPY LSTAT.
001610 SCREEN SECTION.
001620 SD  C-CRT
001630     END STATUS IS ESTAT.
001640 01  C-CLEAR.
001650     02  C-CL    LINE   1  CLEAR SCREEN.
001660 01  C-MID.
001670     02  LINE   3  COLUMN  10  PIC  N(024) VALUE
001680          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001690     02  LINE   4  COLUMN  10  PIC  N(024) VALUE
001700          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001710     02  LINE   5  COLUMN  10  PIC  N(024) VALUE
001720          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
001730     02  LINE   6  COLUMN  10  PIC  N(024) VALUE
001740          NC"＊＊＊　　工品品種別　販売実績・受払表　　＊＊＊".
001750     02  LINE   7  COLUMN  10  PIC  N(024) VALUE
001760          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
001770     02  LINE   8  COLUMN  10  PIC  N(024) VALUE
001780          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001790     02  LINE   9  COLUMN  10  PIC  N(024) VALUE
001800          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001810 01  C-ERR.
001820     02  LINE  24.
001830       03  E-ME2   COLUMN  15  PIC  X(016) VALUE
001840            "***  KHM ﾅｼ  ***".
001850       03  E-KEY   COLUMN  35  PIC  X(005) FROM  KHT-KEY.
001860       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001870       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001880     COPY LIBSCR.
001890 PROCEDURE DIVISION.
001900 M-05.
001910     COPY LIBCPR.
001920     DISPLAY C-CLEAR.
001930     DISPLAY C-MID.
001940*
001950     OPEN INPUT KHT-M.
001960 M-10.
001970     READ KHT-M NEXT RECORD WITH UNLOCK AT END
001980         CLOSE KHT-M
001990         DISPLAY C-CLEAR
002000         STOP RUN.
002010     IF KHT-YC = ZERO
002020         GO TO M-10.
002030     IF ZERO = KHT-ZSU AND KHT-KSU AND KHT-ISU AND KHT-HSU
002040           AND KHT-SSU
002050           AND KHT-UKIN AND KHT-NKIN
002060         GO TO M-10.
002070*
002080     OPEN INPUT KH-M.
002090     OPEN OUTPUT SP-F.
002100     MOVE ZERO TO WA-D.
002110     MOVE DATE-03R TO H-DATE.
002120     PERFORM S-10 THRU S-15.
002130 M-15.
002140     MOVE KHT-YC TO W-YC.
002150     MOVE ZERO TO WT-D W-YCC.
002160 M-20.
002170     MOVE KHT-NC TO W-NC.
002180     MOVE ZERO TO WS-D CHK.
002190 M-25.
002200     MOVE KHT-KEY TO KH-KEY.
002210     READ KH-M WITH UNLOCK INVALID KEY
002220         DISPLAY E-ME2 E-KEY E-ME99
002230         GO TO M-95.
002240     MOVE ZERO TO W-D.
002250     IF KH-YGT1 = ZERO
002260         MOVE KH-GT1 TO W-GT
002270       ELSE
002280         MOVE KH-YGT1 TO W-GT.
002290     COMPUTE W-ZK = KHT-ZSU * W-GT.
002300     COMPUTE W-SS = KHT-KSU - KHT-HSU + KHT-ISU.
002310     COMPUTE W-SK = W-SS * W-GT.
002320     COMPUTE W-UK = KHT-UKIN - KHT-NKIN.
002330     IF KHT-SSU NOT = ZERO
002340         COMPUTE W-BT ROUNDED = W-UK / KHT-SSU.
002350     IF W-GT = ZERO
002360         MOVE ZERO TO W-YS
002370       ELSE
002380         COMPUTE W-YS = KHT-ZSU + W-SS - KHT-SSU.
002390     COMPUTE W-GK = KHT-SSU * W-GT.
002400     COMPUTE W-YK = W-YS * W-GT.
002410     COMPUTE W-AR = W-UK - W-GK.
002420     IF W-UK = ZERO
002430         GO TO M-30.
002440     IF W-AR NOT = ZERO
002450         IF W-UK > ZERO
002460             COMPUTE W-RR ROUNDED = (W-AR * 100) / W-UK
002470           ELSE
002480             COMPUTE W-RR ROUNDED = (W-AR * -100) / W-UK.
002490 M-30.
002500     MOVE SPACE TO W-P1 W-P2.
002510     MOVE SPACE TO P-TM.
002520     IF W-YCC = 0
002530         MOVE 1 TO W-YCC
002540         MOVE W-YC TO P-YC.
002550     MOVE KHT-KEY TO P-HCD.
002560     MOVE KH-NAME TO P-NAME.
002570     IF W-BT NOT = ZERO
002580         MOVE "(" TO P-F
002590         MOVE ")" TO P-R
002600         MOVE W-BT TO P-BT.
002610     MOVE W-GT TO P-GT.
002620     MOVE KHT-ZSU TO P-ZS.
002630     MOVE W-ZK TO P-ZK.
002640     MOVE W-SS TO P-SS.
002650     MOVE W-SK TO P-SK
002660     MOVE KHT-SSU TO P-US.
002670     MOVE W-UK TO P-UK.
002680     MOVE W-YS TO P-YS.
002690     MOVE W-YK TO P-YK.
002700     MOVE W-AR TO P-AR.
002710     IF W-RR NOT = ZERO
002720         MOVE W-RR TO P-RR.
002730*
002740     MOVE SPACE TO SP-R.
002750*****IF LINAGE-COUNTER > 62                                       D.101005
002760     IF LINAGE-COUNTER > 61                                       I.101005
002770         MOVE W-YC TO P-YC
002780         PERFORM S-05 THRU S-15.
002790     MOVE SPACE TO SP-R.
002800     MOVE W-P1 TO SP-R.
002810     WRITE SP-R.
002820     MOVE SPACE TO SP-R.
002830     MOVE W-P2 TO SP-R.
002840     WRITE SP-R.
002850     MOVE SPACE TO SP-R.
002860*
002870     ADD W-ZK TO WS-ZK.
002880     ADD W-SK TO WS-SK.
002890     ADD W-GK TO WS-UG.
002900     ADD W-UK TO WS-UK.
002910     ADD W-YK TO WS-YK.
002920     ADD W-AR TO WS-AR.
002930     IF CHK = 1
002940         MOVE 2 TO CHK.
002950     IF CHK = 0
002960         MOVE 1 TO CHK.
002970 M-35.
002980     READ KHT-M NEXT RECORD WITH UNLOCK AT END
002990         GO TO M-90.
003000     IF KHT-YC = ZERO
003010         GO TO M-35.
003020     IF ZERO = KHT-ZSU AND KHT-KSU AND KHT-ISU AND KHT-HSU
003030           AND KHT-SSU
003040           AND KHT-UKIN AND KHT-NKIN
003050         GO TO M-35.
003060     IF KHT-YC NOT = W-YC
003070         GO TO M-40.
003080     IF KHT-NC = W-NC
003090         GO TO M-25.
003100     PERFORM S-20 THRU S-35.
003110     GO TO M-20.
003120 M-40.
003130     PERFORM S-20 THRU S-35.
003140     PERFORM S-45 THRU S-55.
003150     GO TO M-15.
003160 M-90.
003170     PERFORM S-20 THRU S-35.
003180     PERFORM S-45 THRU S-55.
003190     PERFORM S-60 THRU S-70.
003200 M-95.
003210     CLOSE KH-M.
003220     CLOSE KHT-M.
003230     CLOSE SP-F.
003240     DISPLAY C-CLEAR.
003250     STOP RUN.
003260 S-05.
003270     MOVE SPACE TO SP-R.
003280     WRITE SP-R AFTER PAGE.
003290 S-10.
003300     MOVE SPACE TO SP-R.
003310     ADD 1 TO W-PAGE.
003320     MOVE W-PAGE TO H-PAGE.
003330     MOVE HEAD1 TO SP-R.
003340     WRITE SP-R.
003350     MOVE SPACE TO SP-R.
003360     MOVE HEAD2 TO SP-R.
003370     WRITE SP-R AFTER 2.
003380     MOVE SPACE TO SP-R.
003390     MOVE HEAD3 TO SP-R.
003400     WRITE SP-R.
003410     MOVE SPACE TO SP-R.
003420 S-15.
003430     EXIT.
003440 S-20.
003450     MOVE ZERO TO W-RR.
003460     IF WS-UK = ZERO
003470         GO TO S-25.
003480     IF WS-AR NOT = ZERO
003490         IF WS-UK > ZERO
003500             COMPUTE W-RR ROUNDED = (WS-AR * 100) / WS-UK
003510           ELSE
003520             COMPUTE W-RR ROUNDED = (WS-AR * -100) / WS-UK.
003530 S-25.
003540     IF CHK NOT = 2
003550         MOVE SPACE TO SP-R
003560         GO TO S-30.
003570     MOVE SPACE TO W-P2.
003580     MOVE NC"　　　（　小　計　）" TO P-TM.
003590     MOVE WS-ZK TO P-ZK.
003600     MOVE WS-SK TO P-SK.
003610     MOVE WS-UK TO P-UK.
003620     MOVE WS-YK TO P-YK.
003630     MOVE WS-AR TO P-AR.
003640     IF W-RR NOT = ZERO
003650         MOVE W-RR TO P-RR.
003660*****IF LINAGE-COUNTER > 63                                       D.101005
003670     IF LINAGE-COUNTER > 62                                       I.101005
003680         PERFORM S-05 THRU S-15.
003690     MOVE SPACE TO SP-R.
003700     MOVE W-P2 TO SP-R.
003710 S-30.
003720     WRITE SP-R.
003730     MOVE SPACE TO SP-R.
003740     ADD WS-ZK TO WT-ZK.
003750     ADD WS-SK TO WT-SK.
003760     ADD WS-UG TO WT-UG.
003770     ADD WS-UK TO WT-UK.
003780     ADD WS-YK TO WT-YK.
003790     ADD WS-AR TO WT-AR.
003800 S-35.
003810     EXIT.
003820 S-40.
003830     MOVE ZERO TO W-RR.
003840     IF WT-UK = ZERO
003850         GO TO S-45.
003860     IF WT-AR NOT = ZERO
003870         IF WT-UK > ZERO
003880             COMPUTE W-RR ROUNDED = (WT-AR * 100) / WT-UK
003890           ELSE
003900             COMPUTE W-RR ROUNDED = (WT-AR * -100) / WT-UK.
003910 S-45.
003920     MOVE SPACE TO W-P2.
003930     MOVE NC"　［　合　計　］　　" TO P-TM.
003940     MOVE WT-ZK TO P-ZK.
003950     MOVE WT-SK TO P-SK.
003960     MOVE WT-UK TO P-UK.
003970     MOVE WT-YK TO P-YK.
003980     MOVE WT-AR TO P-AR.
003990     IF W-RR NOT = ZERO
004000         MOVE W-RR TO P-RR.
004010*****IF LINAGE-COUNTER > 63                                       D.101005
004020     IF LINAGE-COUNTER > 62                                       I.101005
004030         PERFORM S-05 THRU S-15.
004040     MOVE SPACE TO SP-R.
004050     MOVE W-P2 TO SP-R.
004060     WRITE SP-R.
004070     MOVE SPACE TO SP-R.
004080     WRITE SP-R.
004090*
004100     ADD WT-ZK TO WA-ZK.
004110     ADD WT-SK TO WA-SK.
004120     ADD WT-UG TO WA-UG.
004130     ADD WT-UK TO WA-UK.
004140     ADD WT-YK TO WA-YK.
004150     ADD WT-AR TO WA-AR.
004160 S-55.
004170     EXIT.
004180 S-60.
004190     MOVE ZERO TO W-RR.
004200     IF WA-UK = ZERO
004210         GO TO S-65.
004220     IF WA-AR NOT = ZERO
004230         IF WA-UK > ZERO
004240             COMPUTE W-RR ROUNDED = (WA-AR * 100) / WA-UK
004250           ELSE
004260             COMPUTE W-RR ROUNDED = (WA-AR * -100) / WA-UK.
004270 S-65.
004280     MOVE SPACE TO W-P2.
004290     MOVE NC"【　総　合　計　】　" TO P-TM.
004300     MOVE WA-ZK TO P-ZK.
004310     MOVE WA-SK TO P-SK.
004320     MOVE WA-UK TO P-UK.
004330     MOVE WA-YK TO P-YK.
004340     MOVE WA-AR TO P-AR.
004350     IF W-RR NOT = ZERO
004360         MOVE W-RR TO P-RR.
004370*****IF LINAGE-COUNTER > 63                                       D.101005
004380     IF LINAGE-COUNTER > 62                                       I.101005
004390         PERFORM S-05 THRU S-15.
004400     MOVE SPACE TO SP-R.
004410     MOVE W-P2 TO SP-R.
004420     WRITE SP-R.
004430 S-70.
004440     EXIT.
