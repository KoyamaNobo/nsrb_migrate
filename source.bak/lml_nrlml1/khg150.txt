000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHG150.
000030*********************************************************
000040*    PROGRAM         :  防振ゴム　作業別労働時間表      *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*        変更　　　  :  62/04/07                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT KH-M ASSIGN TO KH-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS MODE DYNAMIC
000200         RECORD KEY KH-KEY
000210         FILE STATUS IS ERR-STAT.
000220     SELECT KHT-M ASSIGN TO KHT-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE DYNAMIC
000250         RECORD KEY KHT-KEYD
000260         FILE STATUS IS ERR-STAT.
000270     SELECT SP-F ASSIGN TO P-PRN999.
000280 I-O-CONTROL.
000290     APPLY SHARED-MODE ON M-DATE
000300     APPLY SHARED-MODE ON KH-M
000310     APPLY SHARED-MODE ON KHT-M
000320     APPLY SHIFT-CODE  ON SP-F.                                   A 62/04
000330 DATA DIVISION.
000340 FILE SECTION.
000350     COPY LIBFDD.
000360     COPY LIKHM.
000370     COPY LIKHT2.
000380     COPY LSPF.
000390 WORKING-STORAGE SECTION.
000400 01  HEAD1.
000410     02  F              PIC  X(005) VALUE ""3FE04FE080"".
000420     02  F              PIC  X(024) VALUE SPACE.
000430     02  F              PIC  N(024) VALUE
000440          NC"＊＊＊　　防振ゴム　作業別　労働時間表　　＊＊＊".
000450     02  F              PIC  X(017) VALUE SPACE.
000460     02  F              PIC  X(005) VALUE  "DATE ".
000470     02  H-DATE         PIC 99B99B99.
000480     02  F              PIC  X(007) VALUE  "     P.".
000490     02  H-PAGE         PIC Z9.
000500 01  HEAD2.
000510     02  F              PIC  X(027) VALUE SPACE.
000520     02  F              PIC  X(043) VALUE
000530          ":I------------  生産ベース　------------I :".
000540     02  F              PIC  X(041) VALUE
000550          " I------------  出荷ベース  ------------I".
000560 01  HEAD3.
000570     02  F              PIC  X(048) VALUE
000580          " ｺ-ﾄﾞ  品　　　名          :    ゴムMH    金具MH".
000590     02  F              PIC  X(043) VALUE
000600          "    加硫MH      合計 :     ゴムMH    金具MH".
000610     02  F              PIC  X(020) VALUE "    加硫MH      合計".
000620 01  W-P.
000630     02  P-HC           PIC  X(005).
000640     02  F              PIC  X(002).
000650     02  P-NAME         PIC  X(020).
000660     02  P-X1           PIC  X(001).
000670     02  P-GK1          PIC ----,--9.9.
000680     02  P-KK1          PIC ----,--9.9.
000690     02  P-KRK1         PIC ----,--9.9.
000700     02  P-AK1          PIC ----,--9.9.
000710     02  F              PIC  X(001).
000720     02  P-X2           PIC  X(001).
000730     02  F              PIC  X(001).
000740     02  P-GK2          PIC ----,--9.9.
000750     02  P-KK2          PIC ----,--9.9.
000760     02  P-KRK2         PIC ----,--9.9.
000770     02  P-AK2          PIC ----,--9.9.
000780 01  W-N.
000790     02  W-GK1          PIC S9(004)V9(01).
000800     02  W-KK1          PIC S9(004)V9(01).
000810     02  W-KRK1         PIC S9(004)V9(01).
000820     02  W-AK1          PIC S9(004)V9(01).
000830     02  W-GK2          PIC S9(004)V9(01).
000840     02  W-KK2          PIC S9(004)V9(01).
000850     02  W-KRK2         PIC S9(004)V9(01).
000860     02  W-AK2          PIC S9(004)V9(01).
000870 01  W-S.
000880     02  WS-GK1         PIC S9(004)V9(01).
000890     02  WS-KK1         PIC S9(004)V9(01).
000900     02  WS-KRK1        PIC S9(004)V9(01).
000910     02  WS-AK1         PIC S9(004)V9(01).
000920     02  WS-GK2         PIC S9(004)V9(01).
000930     02  WS-KK2         PIC S9(004)V9(01).
000940     02  WS-KRK2        PIC S9(004)V9(01).
000950     02  WS-AK2         PIC S9(004)V9(01).
000960 01  W-A.
000970     02  WA-GK1         PIC S9(004)V9(01).
000980     02  WA-KK1         PIC S9(004)V9(01).
000990     02  WA-KRK1        PIC S9(004)V9(01).
001000     02  WA-AK1         PIC S9(004)V9(01).
001010     02  WA-GK2         PIC S9(004)V9(01).
001020     02  WA-KK2         PIC S9(004)V9(01).
001030     02  WA-KRK2        PIC S9(004)V9(01).
001040     02  WA-AK2         PIC S9(004)V9(01).
001050 01  W-D.
001060     02  W-ALL          PIC S9(009)V9(04).
001070     02  W-CHK.
001080       03  W-CHK1       PIC  9(001).
001090       03  W-CHK2       PIC  9(001).
001100     02  W-YC           PIC  9(002).
001110     02  W-PAGE         PIC  9(002) VALUE ZERO.
001120 01  ERR-STAT           PIC  X(002).
001130 SCREEN SECTION.
001140 SD  C-CRT
001150     END STATUS IS ESTAT.
001160 01  C-CLEAR.
001170     02  LINE  1  CLEAR SCREEN.
001180 01  C-MID.
001190     02  LINE   3  COLUMN  10  PIC  N(023) VALUE
001200          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001210     02  LINE   4  COLUMN  10  PIC  N(023) VALUE
001220          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001230     02  LINE   5  COLUMN  10  PIC  N(023) VALUE
001240          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001250     02  LINE   6  COLUMN  10  PIC  N(023) VALUE
001260          NC"＊＊＊　　防振ゴム　作業別労働時間表　　＊＊＊".
001270     02  LINE   7  COLUMN  10  PIC  N(023) VALUE
001280          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001290     02  LINE   8  COLUMN  10  PIC  N(023) VALUE
001300          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001310     02  LINE   9  COLUMN  10  PIC  N(023) VALUE
001320          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001330 01  C-ERR.
001340     02  LINE 24.
001350       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001360            "***  DATA ﾅｼ  ***".
001370       03  E-ME2   COLUMN  15  PIC  X(016) VALUE
001380            "***  KHM ﾅｼ  ***".
001390       03  E-KEY   COLUMN  35  PIC  X(005) FROM  KHT-KEY.
001400       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001410       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001420     COPY LIBSCR.
001430 PROCEDURE DIVISION.
001440 M-05.
001450     COPY LIBCPR.
001460     DISPLAY C-CLEAR.
001470     DISPLAY C-MID.
001480     OPEN INPUT KHT-M.
001490 M-10.
001500     READ KHT-M NEXT RECORD WITH UNLOCK AT END
001510         DISPLAY E-ME1 E-ME99
001520         CLOSE KHT-M
001530         DISPLAY C-CLEAR
001540         STOP RUN.
001550     IF KHT-YC < 10
001560         GO TO M-10.
001570     IF KHT-YC > 11
001580         DISPLAY E-ME1 E-ME99
001590         CLOSE KHT-M
001600         DISPLAY C-CLEAR
001610         STOP RUN.
001620     MOVE ZERO TO W-CHK.
001630     IF KHT-KSU NOT = ZERO
001640         MOVE 5 TO W-CHK1.
001650     IF KHT-SSU NOT = ZERO
001660         MOVE 5 TO W-CHK2.
001670     IF W-CHK = ZERO
001680         GO TO M-10.
001690     OPEN INPUT KH-M.
001700     OPEN OUTPUT SP-F.
001710     MOVE DATE-03R TO H-DATE.
001720     PERFORM S-10 THRU S-15.
001730     MOVE ZERO TO W-A.
001740 M-15.
001750     MOVE ZERO TO W-S.
001760     MOVE KHT-YC TO W-YC.
001770 M-20.
001780     MOVE KHT-KEY TO KH-KEY.
001790     READ KH-M WITH UNLOCK INVALID KEY
001800         DISPLAY E-ME2 E-KEY E-ME99
001810         GO TO M-95.
001820     PERFORM S-20 THRU S-55.
001830 M-25.
001840     READ KHT-M NEXT RECORD WITH UNLOCK AT END
001850         GO TO M-90.
001860     IF KHT-YC < 10
001870         GO TO M-25.
001880     IF KHT-YC > 11
001890         GO TO M-90.
001900     MOVE ZERO TO W-CHK.
001910     IF KHT-KSU NOT = ZERO
001920         MOVE 5 TO W-CHK1.
001930     IF KHT-SSU NOT = ZERO
001940         MOVE 5 TO W-CHK2.
001950     IF W-CHK = ZERO
001960         GO TO M-25.
001970     IF W-YC = KHT-YC
001980         GO TO M-20.
001990 M-30.
002000     PERFORM S-60 THRU S-70.
002010     GO TO M-15.
002020 M-90.
002030     PERFORM S-60 THRU S-70.
002040     PERFORM S-75 THRU S-85.
002050 M-95.
002060     CLOSE KH-M.
002070     CLOSE KHT-M.
002080     CLOSE SP-F.
002090     DISPLAY C-CLEAR.
002100     STOP RUN.
002110 S-05.
002120     MOVE SPACE TO SP-R.
002130     WRITE SP-R AFTER PAGE.
002140 S-10.
002150     ADD 1 TO W-PAGE.
002160     MOVE W-PAGE TO H-PAGE.
002170     MOVE SPACE TO SP-R.
002180     MOVE HEAD1 TO SP-R.
002190     WRITE SP-R.
002200     MOVE SPACE TO SP-R.
002210     MOVE HEAD2 TO SP-R.
002220     WRITE SP-R AFTER 2.
002230     MOVE SPACE TO SP-R.
002240     MOVE HEAD3 TO SP-R.
002250     WRITE SP-R.
002260     MOVE SPACE TO SP-R.
002270 S-15.
002280     EXIT.
002290 S-20.
002300     MOVE SPACE TO W-P.
002310     MOVE ZERO TO W-N.
002320     MOVE KHT-KEY TO P-HC.
002330     MOVE KH-NAME TO P-NAME.
002340     IF W-CHK1 = ZERO
002350         GO TO S-30.
002360     IF KH-MGS NOT = ZERO
002370         COMPUTE W-GK1 ROUNDED = (KHT-KSU * KH-MGS) / 60.
002380     MOVE W-GK1 TO P-GK1.
002390     COMPUTE W-ALL = KH-MKM + KH-MKH + KH-MTS.
002400     IF W-ALL NOT = ZERO
002410         COMPUTE W-KK1 ROUNDED = (KHT-KSU * W-ALL) / 60.
002420     MOVE W-KK1 TO P-KK1.
002430     IF KH-MKR NOT = ZERO
002440         COMPUTE W-KRK1 ROUNDED = (KHT-KSU * KH-MKR) / 60.
002450     MOVE W-KRK1 TO P-KRK1.
002460     COMPUTE W-AK1 = W-GK1 + W-KK1 + W-KRK1.
002470     MOVE W-AK1 TO P-AK1.
002480 S-30.
002490     IF W-CHK2 = ZERO
002500         GO TO S-40.
002510     IF KH-MGS NOT = ZERO
002520         COMPUTE W-GK2 ROUNDED = (KHT-SSU * KH-MGS) / 60.
002530     MOVE W-GK2 TO P-GK2.
002540     COMPUTE W-ALL = KH-MKM + KH-MKH + KH-MTS.
002550     IF W-ALL NOT = ZERO
002560         COMPUTE W-KK2 ROUNDED = (KHT-SSU * W-ALL) / 60.
002570     MOVE W-KK2 TO P-KK2.
002580     IF KH-MKR NOT = ZERO
002590         COMPUTE W-KRK2 ROUNDED = (KHT-SSU * KH-MKR) / 60.
002600     MOVE W-KRK2 TO P-KRK2.
002610     COMPUTE W-AK2 = W-GK2 + W-KK2 + W-KRK2.
002620     MOVE W-AK2 TO P-AK2.
002630 S-40.
002640     IF ZERO = W-GK1 AND W-KK1 AND W-KRK1 AND W-AK1
002650           AND W-GK2 AND W-KK2 AND W-KRK2 AND W-AK2
002660         GO TO S-55.
002670     MOVE ":" TO P-X1 P-X2.
002680     IF LINAGE-COUNTER > 60
002690         PERFORM S-05 THRU S-15.
002700     MOVE SPACE TO SP-R.
002710     MOVE W-P TO SP-R.
002720     WRITE SP-R.
002730     MOVE SPACE TO SP-R.
002740*
002750     ADD W-GK1 TO WS-GK1.
002760     ADD W-KK1 TO WS-KK1.
002770     ADD W-KRK1 TO WS-KRK1.
002780     ADD W-AK1 TO WS-AK1.
002790     ADD W-GK2 TO WS-GK2.
002800     ADD W-KK2 TO WS-KK2.
002810     ADD W-KRK2 TO WS-KRK2.
002820     ADD W-AK2 TO WS-AK2.
002830 S-55.
002840     EXIT.
002850 S-60.
002860     MOVE SPACE TO W-P.
002870     MOVE "   <  SUB TOTAL  >  " TO P-NAME.
002880     MOVE WS-GK1 TO P-GK1.
002890     MOVE WS-KK1 TO P-KK1.
002900     MOVE WS-KRK1 TO P-KRK1.
002910     MOVE WS-AK1 TO P-AK1.
002920     MOVE WS-GK2 TO P-GK2.
002930     MOVE WS-KK2 TO P-KK2.
002940     MOVE WS-KRK2 TO P-KRK2.
002950     MOVE WS-AK2 TO P-AK2.
002960     IF LINAGE-COUNTER > 59
002970         PERFORM S-05 THRU S-15.
002980     MOVE SPACE TO SP-R.
002990     MOVE W-P TO SP-R.
003000     WRITE SP-R AFTER 2.
003010     MOVE SPACE TO SP-R.
003020     WRITE SP-R.
003030*
003040     ADD WS-GK1 TO WA-GK1.
003050     ADD WS-KK1 TO WA-KK1.
003060     ADD WS-KRK1 TO WA-KRK1.
003070     ADD WS-AK1 TO WA-AK1.
003080     ADD WS-GK2 TO WA-GK2.
003090     ADD WS-KK2 TO WA-KK2.
003100     ADD WS-KRK2 TO WA-KRK2.
003110     ADD WS-AK2 TO WA-AK2.
003120 S-70.
003130     EXIT.
003140 S-75.
003150     MOVE SPACE TO W-P.
003160     MOVE "  [  ALL TOTAL  ]  " TO P-NAME.
003170     MOVE WA-GK1 TO P-GK1.
003180     MOVE WA-KK1 TO P-KK1.
003190     MOVE WA-KRK1 TO P-KRK1.
003200     MOVE WA-AK1 TO P-AK1.
003210     MOVE WA-GK2 TO P-GK2.
003220     MOVE WA-KK2 TO P-KK2.
003230     MOVE WA-KRK2 TO P-KRK2.
003240     MOVE WA-AK2 TO P-AK2.
003250     IF LINAGE-COUNTER > 60
003260         PERFORM S-05 THRU S-15.
003270     MOVE SPACE TO SP-R.
003280     MOVE W-P TO SP-R.
003290     WRITE SP-R.
003300 S-85.
003310     EXIT.
