000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHT050.
000030*********************************************************
000040*    PROGRAM         :  çHïiîÑè„ÅEílà¯ì`ï[Å@ñ‚çáÇπ    Å@*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCKT05 , SCKT06                 *
000070*    COMPILE TYPE    :  COBOL                           *
000080*    JS-SIGN         :  ïiñºï =0 , ìæà”êÊï =1           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT URI-F ASSIGN TO URI-MSD.
000180     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000190         ORGANIZATION INDEXED
000200         ACCESS MODE RANDOM
000210         RECORD KEY T-KEY
000220         ALTERNATE RECORD KEY T-KEY2
000230         FILE STATUS IS ERR-STAT.
000240     SELECT KH-M ASSIGN TO KH-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE RANDOM
000270         RECORD KEY KH-KEY
000280         FILE STATUS IS ERR-STAT.
000290 I-O-CONTROL.
000300     APPLY SHARED-MODE ON M-DATE
000310     APPLY SHARED-MODE ON T-M
000320     APPLY SHARED-MODE ON KH-M
000330     APPLY EXCLUSIVE-MODE ON URI-F.
000340 DATA DIVISION.
000350 FILE SECTION.
000360     COPY LIBFDD.
000370     COPY LITM.
000380     COPY LIKHM.
000390 FD  URI-F
000400     BLOCK  2 RECORDS
000410     LABEL RECORD STANDARD
000420     VALUE OF IDENTIFICATION WK0128ID.
000430 01  URI-R.
000440     02  URI-DC         PIC  9(001).
000450     02  URI-NGP        PIC  9(008).
000460     02  URI-NGPD  REDEFINES URI-NGP.
000470       03  F            PIC  9(002).
000480       03  URI-NGPS     PIC  9(006).
000490     02  URI-TCD        PIC  9(004).
000500     02  URI-HCD        PIC  X(005).
000510     02  URI-SU         PIC S9(006)V9(02).
000520     02  URI-T          PIC S9(006)V9(02).
000530     02  URI-KIN        PIC S9(008).
000540     02  F              PIC  X(006).
000550     02  URI-NNO        PIC  X(006).
000560     02  F              PIC  X(012).
000570     02  URI-DNO        PIC  9(006).
000580     02  URI-GNO        PIC  9(001).
000590     02  URI-JCD        PIC  9(006).
000600     02  F              PIC  X(008).
000610     02  URI-TEK        PIC  N(008).
000620     02  F              PIC  X(025).
000630 WORKING-STORAGE SECTION.
000640 77  JS-SIGN            PIC  9(001).
000650 77  W-MSG              PIC  X(040).
000660 77  WK0128ID           PIC  X(009) VALUE SPACE.
000670 01  STN-NO.
000680     02  STN-NO1        PIC  X(003).
000690     02  STN-NO2        PIC  X(003).
000700 01  W-FID.
000710     02  W-FID1         PIC  X(006) VALUE "WK0128".
000720     02  W-FID2         PIC  X(003).
000730 01  W-DATA.
000740     02  W-DATE         PIC  9(006).
000750     02  W-SDATE        PIC  9(006).
000760     02  W-EDATE        PIC  9(006).
000770     02  W-SNGP.
000780       03  W-SNEN       PIC  9(002).
000790       03  W-SGET       PIC  9(002).
000800       03  W-SPEY       PIC  9(002).
000810     02  W-SNGPD REDEFINES W-SNGP.
000820       03  W-SNG        PIC  9(004).
000830       03  F            PIC  9(002).
000840     02  W-ENGP.
000850       03  W-ENEN       PIC  9(002).
000860       03  W-EGET       PIC  9(002).
000870       03  W-EPEY       PIC  9(002).
000880     02  W-ENGPD REDEFINES W-ENGP.
000890       03  W-ENG        PIC  9(004).
000900       03  F            PIC  9(002).
000910     02  W-NG.
000920       03  W-NEN        PIC  9(002).
000930       03  W-GET        PIC  9(002).
000940     02  W-HCD          PIC  X(005).
000950     02  W-STCD         PIC  9(004).
000960     02  W-ETCD         PIC  9(004).
000970     02  W-TCD          PIC  9(004).
000980     02  W-SHCD         PIC  X(005).
000990     02  W-EHCD         PIC  X(005).
001000     02  W-L1           PIC  9(002).
001010     02  W-L2           PIC  9(002).
001020     02  CNT            PIC  9(002).
001030     02  W-DMM          PIC  9(001).
001040     02  W-INV          PIC  9(001).
001050     02  W-DCN          PIC  N(002).
001060     02  W-HNA          PIC  N(024).
001070 01  ERR-STAT           PIC  X(002).
001080     COPY LSTAT.
001090 SCREEN SECTION.
001100 SD  C-CRT
001110     END STATUS IS ESTAT.
001120 01  C-CLEAR.
001130     02  LINE   1  CLEAR SCREEN.
001140 01  C-ACP.
001150     02  LINE   1.
001160       03  A-SNGP  COLUMN  67  PIC  9(006)
001170            USING W-SNGP  CHECK OVERFLOW NO IFC.
001180       03  A-ENGP  COLUMN  75  PIC  9(006)
001190            USING W-ENGP  CHECK OVERFLOW NO IFC.
001200     02  LINE   2.
001210       03  A-HCD   COLUMN   7  PIC  X(005)
001220            USING W-HCD   CHECK OVERFLOW NO IFC.
001230       03  A-STCD  COLUMN  71  PIC  9(004)
001240            USING W-STCD  CHECK OVERFLOW NO IFC.
001250       03  A-ETCD  COLUMN  77  PIC  9(004)
001260            USING W-ETCD  CHECK OVERFLOW NO IFC.
001270*
001280       03  A-TCD   COLUMN   8  PIC  9(004)
001290            USING W-TCD   CHECK OVERFLOW NO IFC.
001300       03  A-SHCD  COLUMN  69  PIC  X(005)
001310            USING W-SHCD  CHECK OVERFLOW NO IFC.
001320       03  A-EHCD  COLUMN  76  PIC  X(005)
001330            USING W-EHCD  CHECK OVERFLOW NO IFC.
001340*****02  A-GN    LINE  22  COLUMN   1  PIC  9(002)
001350*****     USING W-GN    CHECK OVERFLOW NO IFC.
001360     02  A-DMM   LINE  23  COLUMN  70  PIC  9(001)
001370          USING W-DMM   CHECK OVERFLOW NO IFC.
001380 01  C-DSP.
001390     02  LINE   2.
001400       03  D-HNA   COLUMN  13  PIC  N(024) FROM  W-HNA.
001410       03  D-TNA   COLUMN  13  PIC  N(025) FROM  T-NAME.
001420     02  D-MD1.
001430       03  LINE W-L1.
001440         04  COLUMN   1  PIC  9(006) FROM  URI-NGPS.
001450         04  COLUMN   8  PIC  N(002) FROM  W-DCN.
001460         04  COLUMN  13  PIC  9(004) FROM  URI-TCD.
001470         04  COLUMN  18  PIC  N(026) FROM  T-NAME.
001480       03  LINE W-L2.
001490         04  COLUMN  11  PIC  N(008) FROM  URI-TEK.
001500         04  COLUMN  36  PIC  9(006) FROM  URI-DNO.
001510         04  COLUMN  42  PIC  X(001) VALUE  "-".
001520         04  COLUMN  43  PIC  9(001) FROM  URI-GNO.
001530     02  D-MD2.
001540       03  LINE W-L1.
001550         04  COLUMN   1  PIC  9(006) FROM  URI-NGPS.
001560         04  COLUMN   8  PIC  N(002) FROM  W-DCN.
001570         04  COLUMN  19  PIC  N(024) FROM  W-HNA.
001580       03  LINE W-L2.
001590         04  COLUMN  11  PIC  N(008) FROM  URI-TEK.
001600         04  COLUMN  36  PIC  9(006) FROM  URI-DNO.
001610         04  COLUMN  42  PIC  X(001) VALUE  "-".
001620         04  COLUMN  43  PIC  9(001) FROM  URI-GNO.
001630     02  LINE W-L1.
001640       03  D-HCD   COLUMN  13  PIC  X(005) FROM  URI-HCD.
001650       03  D-JCD   COLUMN  74  PIC  9(006) FROM  URI-JCD.
001660     02  LINE W-L2.
001670       03  D-NNO   COLUMN  29  PIC  X(006)      FROM  URI-NNO.
001680       03  D-SU    COLUMN  45  PIC ----,--9.99  FROM  URI-SU.
001690       03  D-T     COLUMN  57  PIC ----,--9.99  FROM  URI-T.
001700       03  D-KIN   COLUMN  70  PIC ---,---,--9  FROM  URI-KIN.
001710 01  C-ERR.
001720     02  LINE  24.
001730       03  E-ME    COLUMN  15  PIC  X(040) FROM  W-MSG.
001740       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001750       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001760       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001770            "                                                  ".
001780     COPY LIBSCR.
001790 PROCEDURE DIVISION.
001800 M-05.
001810     ACCEPT JS-SIGN.
001820     IF JS-SIGN NOT = 0 AND 1
001830         STOP RUN.
001840     DISPLAY C-CLEAR.
001850     IF JS-SIGN = 0
001860         CALL "SCKT05"
001870       ELSE
001880         CALL "SCKT06".
001890     MOVE ZERO TO W-DATA.
001900     COPY LIBCPR.
001910     MOVE D-NKNG TO W-SNG W-ENG.
001920     MOVE 31 TO W-EPEY.
001930     MOVE 1 TO W-SPEY.
001940     ADD 1 TO W-SGET.
001950     IF W-SGET = 13
001960         MOVE 1 TO W-SGET
001970       ELSE
001980         SUBTRACT 1 FROM W-SNEN.
001990     MOVE W-SNGP TO W-SDATE.
002000     MOVE W-ENGP TO W-EDATE.
002010*
002020     CALL "CBLSTNNO" USING STN-NO.
002030     MOVE STN-NO2 TO W-FID2.
002040     MOVE W-FID TO WK0128ID.
002050     OPEN INPUT T-M KH-M.
002060 M-10.
002070     ACCEPT A-SNGP.
002080     IF ESTAT = PF9
002090         GO TO M-95.
002100     IF ESTAT NOT = HTB AND SKP
002110         GO TO M-10.
002120     IF W-SNGP = ZERO
002130         MOVE W-SDATE TO W-SNGP
002140         GO TO M-15.
002150     IF W-SGET < 1 OR > 12
002160         GO TO M-10.
002170     IF W-SPEY < 1 OR > 31
002180         GO TO M-10.
002190 M-15.
002200     ACCEPT A-ENGP.
002210     IF ESTAT = BTB
002220         GO TO M-10.
002230     IF ESTAT NOT = HTB AND SKP
002240         GO TO M-15.
002250     IF W-ENGP = 999999
002260         MOVE W-EDATE TO W-ENGP
002270         GO TO M-17.
002280     IF W-EGET < 1 OR > 12
002290         GO TO M-15.
002300     IF W-EPEY < 1 OR > 31
002310         GO TO M-15.
002320 M-17.
002330     IF W-SNGP > W-ENGP
002340         GO TO M-15.
002350     IF JS-SIGN = 1
002360         GO TO M-25.
002370 M-20.
002380     ACCEPT A-HCD.
002390     DISPLAY E-CL.
002400     IF ESTAT = PF9
002410         GO TO M-95.
002420     IF ESTAT = BTB
002430         GO TO M-15.
002440     IF ESTAT NOT = HTB AND SKP
002450         GO TO M-20.
002460*
002470     MOVE W-HCD TO KH-KEY.
002480     READ KH-M WITH UNLOCK INVALID KEY
002490         MOVE SPACE TO W-MSG
002500         MOVE "***  À›“≤ ≈º  ***" TO W-MSG
002510         DISPLAY E-ME
002520         GO TO M-20.
002530     MOVE SPACE TO W-HNA.
002540     IF KH-KNA NOT = SPACE
002550         MOVE KH-KNA TO W-HNA
002560       ELSE
002570         MOVE KH-NAME TO W-HNA.
002580     DISPLAY D-HNA.
002590     PERFORM SEA-RTN THRU SEA-EX.
002600     IF ESTAT = BTB
002610         GO TO M-20.
002620     GO TO M-30.
002630 M-25.
002640     ACCEPT A-TCD.
002650     DISPLAY E-CL.
002660     IF ESTAT = PF9
002670         GO TO M-95.
002680     IF ESTAT = BTB
002690         GO TO M-15.
002700     IF ESTAT NOT = HTB AND SKP
002710         GO TO M-25.
002720*
002730     MOVE W-TCD TO T-KEY.
002740     READ T-M WITH UNLOCK INVALID KEY
002750         MOVE SPACE TO W-MSG
002760         MOVE "***  ƒ∏≤ª∑ ≈º  ***" TO W-MSG
002770         DISPLAY E-ME
002780         GO TO M-25.
002790     DISPLAY D-TNA.
002800     IF T-BC = 0
002810         GO TO M-25.
002820     PERFORM SEA-RTN THRU SEA-EX.
002830     IF ESTAT = BTB
002840         GO TO M-25.
002850 M-30.
002860     MOVE 0 TO W-DMM.
002870     MOVE 3 TO W-L1.
002880     MOVE 4 TO W-L2.
002890     OPEN INPUT URI-F.
002900 M-35.
002910     READ URI-F AT END
002920         CLOSE URI-F
002930         MOVE SPACE TO W-MSG
002940         MOVE "***  DATA ≈º  ***" TO W-MSG
002950         DISPLAY E-ME
002960         GO TO M-70.
002970     IF URI-NGPS < W-SNGP OR > W-ENGP
002980         GO TO M-35.
002990     IF JS-SIGN = 0
003000         IF URI-HCD < W-HCD
003010             GO TO M-35.
003020     IF JS-SIGN = 0
003030         IF URI-HCD > W-HCD
003040             CLOSE URI-F
003050             MOVE SPACE TO W-MSG
003060             MOVE "***  DATA ≈º  ***" TO W-MSG
003070             DISPLAY E-ME
003080             GO TO M-70.
003090     IF JS-SIGN = 0
003100         IF URI-TCD < W-STCD OR > W-ETCD
003110             GO TO M-35.
003120     IF JS-SIGN = 1
003130         IF URI-TCD < W-TCD
003140             GO TO M-35.
003150     IF JS-SIGN = 1
003160         IF URI-TCD > W-TCD
003170             CLOSE URI-F
003180             MOVE SPACE TO W-MSG
003190             MOVE "***  DATA ≈º  ***" TO W-MSG
003200             DISPLAY E-ME
003210             GO TO M-70.
003220     IF JS-SIGN = 1
003230         IF URI-HCD < W-SHCD OR > W-EHCD
003240             GO TO M-35.
003250 M-40.
003260     PERFORM MEI-RTN THRU MEI-EX.
003270     IF ESTAT = PF9
003280         CLOSE URI-F
003290         GO TO M-95.
003300     IF W-DMM = 9
003310         CLOSE URI-F
003320         GO TO M-17.
003330 M-50.
003340     READ URI-F AT END
003350         CLOSE URI-F
003360         MOVE SPACE TO W-MSG
003370         MOVE "***  END DATA  ***" TO W-MSG
003380         DISPLAY E-ME
003390         GO TO M-70.
003400     IF URI-NGPS < W-SNGP OR > W-ENGP
003410         GO TO M-50.
003420*****IF JS-SIGN = 0
003430*****    IF URI-HCD < W-HCD
003440*****        GO TO M-50.
003450     IF JS-SIGN = 0
003460         IF URI-HCD > W-HCD
003470             CLOSE URI-F
003480             MOVE SPACE TO W-MSG
003490             MOVE "***  END DATA  ***" TO W-MSG
003500             DISPLAY E-ME
003510             GO TO M-70.
003520     IF JS-SIGN = 0
003530         IF URI-TCD < W-STCD OR > W-ETCD
003540             GO TO M-50.
003550*****IF JS-SIGN = 1
003560*****    IF URI-TCD < W-TCD
003570*****        GO TO M-50.
003580     IF JS-SIGN = 1
003590         IF URI-TCD > W-TCD
003600             CLOSE URI-F
003610             MOVE SPACE TO W-MSG
003620             MOVE "***  END DATA  ***" TO W-MSG
003630             DISPLAY E-ME
003640             GO TO M-70.
003650     IF JS-SIGN = 1
003660         IF URI-HCD < W-SHCD OR > W-EHCD
003670             GO TO M-50.
003680     GO TO M-40.
003690 M-70.
003700     ACCEPT A-DMM.
003710     IF ESTAT = PF9
003720         GO TO M-95.
003730     IF ESTAT NOT = HTB AND SKP
003740         GO TO M-70.
003750*
003760     DISPLAY C-CLEAR.
003770     IF JS-SIGN = 0
003780         CALL "SCKT05"
003790       ELSE
003800         CALL "SCKT06".
003810     DISPLAY A-SNGP A-ENGP.
003820     MOVE 3 TO W-L1.
003830     MOVE 4 TO W-L2.
003840     IF JS-SIGN = 0
003850         DISPLAY A-HCD D-HNA A-STCD A-ETCD                        I.110108
003860*****    DISPLAY A-HCD D-HNA                                      D.110108
003870       ELSE
003880         DISPLAY A-TCD D-TNA A-SHCD A-EHCD.                       I.110108
003890*****    DISPLAY A-TCD D-TNA.                                     D.110108
003900     GO TO M-17.
003910 M-95.
003920     CLOSE T-M.
003930     CLOSE KH-M.
003940     DISPLAY C-CLEAR.
003950     STOP RUN.
003960 SEA-RTN.
003970     IF JS-SIGN = 1
003980         GO TO SEA-110.
003990 SEA-010.
004000     ACCEPT A-STCD.
004010     IF ESTAT = BTB
004020         GO TO SEA-EX.
004030     IF ESTAT NOT = HTB AND SKP
004040         GO TO SEA-010.
004050 SEA-020.
004060     ACCEPT A-ETCD.
004070     IF ESTAT = BTB
004080         GO TO SEA-010.
004090     IF ESTAT NOT = HTB AND SKP
004100         GO TO SEA-020.
004110     IF W-STCD > W-ETCD
004120         GO TO SEA-020.
004130     GO TO SEA-EX.
004140 SEA-110.
004150     ACCEPT A-SHCD.
004160     IF ESTAT = BTB
004170         GO TO SEA-EX.
004180     IF ESTAT NOT = HTB AND SKP
004190         GO TO SEA-110.
004200 SEA-120.
004210     ACCEPT A-EHCD.
004220     IF ESTAT = BTB
004230         GO TO SEA-110.
004240     IF ESTAT NOT = HTB AND SKP
004250         GO TO SEA-120.
004260     IF W-SHCD > W-EHCD
004270         GO TO SEA-120.
004280 SEA-EX.
004290     EXIT.
004300 MEI-RTN.
004310     ADD 2 TO W-L1 W-L2.
004320     IF W-L1 = 23
004330         GO TO MEI-100.
004340     MOVE SPACE TO W-DCN.
004350     IF URI-DC = 1
004360         MOVE NC"ï‘ïi" TO W-DCN
004370       ELSE
004380         IF URI-DC = 1
004390             MOVE NC"ïsï‘" TO W-DCN
004400           ELSE
004410             IF URI-DC = 3
004420                 MOVE NC"óaîÑ" TO W-DCN
004430               ELSE
004440                 IF URI-DC = 4
004450                     MOVE NC"óaèo" TO W-DCN
004460                   ELSE
004470                     IF URI-DC = 5
004480                         MOVE NC"è¡ê≈" TO W-DCN
004490                       ELSE
004500                         IF URI-DC = 8
004510                             MOVE NC"ílà¯" TO W-DCN
004520                           ELSE
004530                             IF URI-DC = 9
004540                                 MOVE NC"ílê≈" TO W-DCN.
004550     IF URI-DC = 8 OR 9
004560         COMPUTE URI-T = -1 * URI-T
004570         COMPUTE URI-KIN = -1 * URI-KIN.
004580     IF JS-SIGN = 1
004590         GO TO MEI-020.
004600     MOVE URI-TCD TO T-KEY.
004610     READ T-M WITH UNLOCK INVALID KEY
004620         MOVE SPACE TO T-NAME
004630         MOVE NC"ÅñÅñÅñÅ@ìæà”êÊÇ»ÇµÅ@ÅñÅñÅñ" TO T-NAME.
004640     DISPLAY D-MD1.
004650     GO TO MEI-050.
004660 MEI-020.
004670     MOVE URI-HCD TO KH-KEY.
004680     READ KH-M WITH UNLOCK INVALID KEY
004690         MOVE SPACE TO KH-NAME KH-KNA
004700         MOVE "***  À›“≤ ≈º  ***" TO KH-NAME.
004710     IF URI-HCD = ZERO
004720         MOVE SPACE TO KH-NAME KH-KNA
004730       ELSE
004740         DISPLAY D-HCD.
004750     MOVE SPACE TO W-HNA.
004760     IF KH-KNA NOT = SPACE
004770         MOVE KH-KNA TO W-HNA
004780       ELSE
004790         MOVE KH-NAME TO W-HNA.
004800     DISPLAY D-MD2.
004810 MEI-050.
004820     IF URI-JCD NOT = ZERO
004830         DISPLAY D-JCD.
004840     IF URI-NNO NOT = ZERO
004850         DISPLAY D-NNO.
004860     IF URI-SU NOT = ZERO
004870         DISPLAY D-SU.
004880     IF URI-T NOT = ZERO
004890         DISPLAY D-T.
004900     IF URI-DC NOT = 4
004910         DISPLAY D-KIN.
004920     GO TO MEI-EX.
004930 MEI-100.
004940     ACCEPT A-DMM.
004950     IF ESTAT = PF9
004960         GO TO MEI-EX.
004970     IF ESTAT NOT = HTB AND SKP
004980         GO TO MEI-100.
004990     IF W-DMM NOT = 1 AND 9
005000         GO TO MEI-100.
005010*
005020     DISPLAY C-CLEAR.
005030     IF JS-SIGN = 0
005040         CALL "SCKT05"
005050       ELSE
005060         CALL "SCKT06".
005070     DISPLAY A-SNGP A-ENGP.
005080     MOVE 3 TO W-L1.
005090     MOVE 4 TO W-L2.
005100     IF W-DMM = 9
005110         GO TO MEI-EX.
005120     IF JS-SIGN = 0
005130         DISPLAY A-HCD D-HNA A-STCD A-ETCD                        I.110108
005140*****    DISPLAY A-HCD D-HNA                                      D.110108
005150       ELSE
005160         DISPLAY A-TCD D-TNA A-SHCD A-EHCD.                       I.110108
005170*****    DISPLAY A-TCD D-TNA.                                     D.110108
005180     GO TO MEI-RTN.
005190 MEI-EX.
005200     EXIT.
