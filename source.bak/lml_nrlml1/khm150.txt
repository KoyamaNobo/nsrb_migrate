000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHM150.
000030*----------------------------------------------------------------*
000040*    PROGRAM       :  工品品名材料使用マスター　メンテナンス     *
000050*    SCREEN USED   :  SCKM15                                     *
000060*    PRINTER TYPE  :  JIPS                                       *
000070*    DATA WRITTEN  :  94/05/11                                   *
000080*    COMPILE TYPE  :  COBOL                                      *
000090*----------------------------------------------------------------*
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM7200.
000130 OBJECT-COMPUTER. SYSTEM7200.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     COPY LIBCSE.
000170     SELECT KHJ-M ASSIGN TO KHJ-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS DYNAMIC
000200         RECORD KEY KHJ-KEY
000210         FILE STATUS ERR-STAT.
000220     SELECT KH-M ASSIGN TO KH-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS RANDOM
000250         RECORD KEY KH-KEY
000260         FILE STATUS ERR-STAT.
000270     SELECT KJ-M ASSIGN TO KJ-MSD
000280         ORGANIZATION INDEXED
000290         ACCESS RANDOM
000300         RECORD KEY KJ-KEY
000310         FILE STATUS ERR-STAT.
000320     SELECT SP-F ASSIGN TO P-PRN999.
000330 I-O-CONTROL.
000340     APPLY SHARED-MODE ON M-DATE
000350     APPLY SHARED-MODE ON KHJ-M
000360     APPLY SHARED-MODE ON KH-M
000370     APPLY SHARED-MODE ON KJ-M
000380     APPLY SHIFT-CODE ON SP-F.
000390 DATA DIVISION.
000400 FILE SECTION.
000410     COPY LIBFDD.
000420     COPY LIKHJM.
000430     COPY LIKHM.
000440     COPY LIKJM.
000450     COPY LSPF.
000460 WORKING-STORAGE SECTION.
000470 01  ERR-STAT           PIC  X(002).
000480 01  HEAD1.
000490     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000500     02  F              PIC  X(020) VALUE SPACE.
000510     02  F              PIC  N(025) VALUE
000520         NC"＊＊＊　　工品防振材料使用マスター　プルーフリスト".  I.021008
000530*****    NC"＊＊＊　　工品品名材料使用マスター　プルーフリスト".  D.021008
000540     02                 PIC  N(005) VALUE NC"　　＊＊＊".
000550     02  F              PIC  X(020) VALUE SPACE.
000560     02  F              PIC  X(005) VALUE "DATE ".
000570     02  H-DATE         PIC 99B99B99.
000580     02  F              PIC  X(007) VALUE "     P.".
000590     02  H-PAGE         PIC Z9.
000600 01  HEAD2.
000610     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000620     02  F              PIC  X(006) VALUE " ｺｰﾄﾞ ".
000630     02  F              PIC  N(006) VALUE NC"品　　　名　".
000640     02  F              PIC  X(013) VALUE SPACE.
000650     02  F              PIC  X(011) VALUE ":    ｺｰﾄﾞ  ".
000660     02  F              PIC  N(008) VALUE NC"材　　料　　名　".
000670     02  F              PIC  X(008) VALUE SPACE.
000680     02  F              PIC  N(002) VALUE NC"個数".
000690     02  F              PIC  X(001) VALUE SPACE.
000700     02  F              PIC  N(002) VALUE NC"使用".
000710     02  F              PIC  X(001) VALUE SPACE.
000720     02  F              PIC  N(004) VALUE NC"使用重量".
000730     02  F              PIC  X(014) VALUE "G  ･    ｺｰﾄﾞ  ".
000740     02  F              PIC  N(008) VALUE NC"材　　料　　名　".
000750     02  F              PIC  X(008) VALUE SPACE.
000760     02  F              PIC  N(002) VALUE NC"個数".
000770     02  F              PIC  X(001) VALUE SPACE.
000780     02  F              PIC  N(002) VALUE NC"使用".
000790     02  F              PIC  X(001) VALUE SPACE.
000800     02  F              PIC  N(004) VALUE NC"使用重量".
000810     02  F              PIC  X(001) VALUE "G".
000820 01  W-P.
000830     02  P-HCD          PIC  X(005).
000840     02  F              PIC  X(001).
000850     02  P-HNA          PIC  X(020).
000860     02  F              PIC  X(002).
000870     02  P-X1           PIC  X(001).
000880     02  F              PIC  X(002).
000890     02  P-JCD1         PIC  X(007).
000900     02  F              PIC  X(001).
000910     02  P-JNA1         PIC  X(020).
000920     02  F              PIC  X(002).
000930     02  P-SU1          PIC  9(001).
000940     02  F              PIC  X(003).
000950     02  P-KSC1         PIC  9(001).
000960     02  P-SGR1         PIC ZZ,ZZ9.9.
000970     02  F              PIC  X(002).
000980     02  P-X2           PIC  X(001).
000990     02  F              PIC  X(002).
001000     02  P-JCD2         PIC  X(007).
001010     02  F              PIC  X(001).
001020     02  P-JNA2         PIC  X(020).
001030     02  F              PIC  X(002).
001040     02  P-SU2          PIC  9(001).
001050     02  F              PIC  X(003).
001060     02  P-KSC2         PIC  9(001).
001070     02  P-SGR2         PIC ZZ,ZZ9.9.
001080*
001090 01  W-DATA.
001100     02  W-DMM          PIC  9(001).
001110     02  W-ACT          PIC  9(001).
001120     02  W-PAGE         PIC  9(002).
001130     02  W-HCD          PIC  X(005).
001140     02  W-DM.
001150       03  W-D     OCCURS 18.
001160         04  W-JCD      PIC  X(007).
001170         04  W-SGR      PIC  9(004)V9(01).
001180         04  W-SU       PIC  9(001).
001190         04  W-KSC      PIC  9(001).
001200     02  W-L            PIC  9(002).
001210     02  W-LI           PIC  9(002).
001220     02  CNT            PIC  9(002).
001230     02  CNTI           PIC  9(002).
001240     02  CNTD           PIC  9(002).
001250     02  W-JCDD         PIC  X(007).
001260     02  W-C            PIC  9(001).
001270     02  CHK            PIC  9(001).
001280     02  W-PC           PIC  9(001).
001290     02  W-FT.
001300       03  W-FHCD       PIC  X(005).
001310       03  W-THCD       PIC  X(005).
001320     02  W-FILE         PIC  X(013).                              I.940606
001330     COPY LSTAT.
001340 SCREEN SECTION.
001350 SD  C-CRT
001360     END STATUS IS ESTAT.
001370 01  C-CLEAR.
001380     02  LINE   1  CLEAR SCREEN.
001390 01  C-ACP.
001400     02  A-HCD   LINE   4  COLUMN   5  PIC  X(005)
001410            USING W-HCD   CHECK OVERFLOW NO IFC.
001420     02  LINE W-L.
001430       03  A-JCD   COLUMN  32  PIC  X(007)
001440            USING W-JCD(CNT) CHECK OVERFLOW NO IFC.
001450       03  A-SU    COLUMN  63  PIC  9(001)
001460            USING W-SU(CNT)  CHECK OVERFLOW NO IFC.
001470       03  A-KSC   COLUMN  68  PIC  9(001)
001480            USING W-KSC(CNT) CHECK OVERFLOW NO IFC.
001490       03  A-SGR   COLUMN  71  PIC  9(004)V9(01)
001500            USING W-SGR(CNT) CHECK OVERFLOW NO IFC.
001510     02  LINE  22.
001520       03  A-FHCD  COLUMN  16  PIC  X(005)
001530            USING W-FHCD  CHECK OVERFLOW NO IFC.                  FROM2
001540       03  A-THCD  COLUMN  25  PIC  X(005)
001550            USING W-THCD  CHECK OVERFLOW NO IFC.                  TO2
001560     02  A-DMM   LINE  23  COLUMN  64  PIC  9(001)
001570          USING W-DMM   CHECK OVERFLOW NO IFC.                    OKC
001580 01  C-DSP.
001590     02  D-HNA   LINE   4  COLUMN  11  PIC  X(020) FROM  KH-NAME.
001600     02  LINE W-L.
001610       03  D-JNA   COLUMN  40  PIC  X(020) FROM  KJ-NAME.
001620       03  D-SGR   COLUMN  71  PIC ZZZ9.9  FROM  W-SGR(CNT).
001630       03  D-CL.
001640         04  D-CJCD  COLUMN  32  PIC  X(028) VALUE
001650              "                            ".
001660         04  D-CK    COLUMN  63  PIC  X(006) VALUE "      ".
001670         04  D-CG    COLUMN  71  PIC  X(006) VALUE "      ".
001680     02  LINE  22.
001690       03  D-PM    COLUMN   5  PIC  X(027) VALUE
001700            "( 品名ｺｰﾄﾞ       〜 99999 )".
001710       03  D-PMC   COLUMN   5  PIC  X(027) VALUE
001720            "                           ".
001730 01  C-ERR   LINE  24.
001740*****02  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.          D.940606
001750     02  E-ME1   COLUMN  15  PIC  X(016) VALUE
001760          "***  KHM ﾅｼ  ***".
001770     02  E-ME2   COLUMN  15  PIC  X(016) VALUE
001780          "***  KJM ﾅｼ  ***".
001790     02  E-ME3   COLUMN  15  PIC  X(018) VALUE
001800          "***  ｿｳﾆｭｳ ﾌｶ  ***".
001810     02  E-ME4   COLUMN  15  PIC  X(016) VALUE
001820          "***  ｼﾞｭｳﾌｸ  ***".
001830     02  E-ME5   COLUMN  15  PIC  X(018) VALUE
001840          "***  ｹﾝｽｳ ｴﾗｰ  ***".
001850     02  E-ME6   COLUMN  15  PIC  X(017) VALUE
001860          "***  DATA ﾅｼ  ***".
001870     02  E-ME11  COLUMN  15  PIC  X(019) VALUE
001880          "***  WRITE ｴﾗｰ  ***".
001890     02  E-ME12  COLUMN  15  PIC  X(021) VALUE
001900          "***  REWRITE ｴﾗｰ  ***".
001910     02  E-ME13  COLUMN  15  PIC  X(020) VALUE
001920          "***  DELETE ｴﾗｰ  ***".
001930*****02  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".       D.940606
001940*****02  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".       D.940606
001950*****02  E-CL.                                                    D.940606
001960*****  03  COLUMN   1  PIC  X(040) VALUE                          D.940606
001970*****        "                                        ".          D.940606
001980*****  03  COLUMN  41  PIC  X(040) VALUE                          D.940606
001990*****        "                                        ".          D.940606
002000     COPY LSSEM.                                                  I.940606
002010     COPY LIBSCR.
002020 PROCEDURE DIVISION.
002030 M-020.
002040     DISPLAY  C-CLEAR.
002050     INITIALIZE W-DATA.
002060     MOVE 99999 TO W-THCD.                                        I.151106
002070     ACCEPT H-DATE FROM DATE.
002080     OPEN I-O KHJ-M.
002090     OPEN INPUT KH-M KJ-M.
002100 M-060.
002110     CALL "SCKM15".
002120     MOVE SPACE TO W-HCD.
002130     INITIALIZE W-DM.
002140 M-100.
002150     ACCEPT A-HCD.
002160     DISPLAY E-CL.
002170     IF ESTAT = "P9"
002180         GO TO M-980.
002190     IF ESTAT = "PE"
002200         DISPLAY D-PM
002210         MOVE 1 TO W-PC
002220         GO TO M-400.
002230     IF ESTAT NOT = HTB AND SKP
002240         GO TO M-100.
002250     MOVE W-HCD TO KH-KEY.
002260     READ KH-M WITH UNLOCK INVALID KEY
002270         DISPLAY E-ME1 E-ME98
002280         GO TO M-100.
002290     DISPLAY D-HNA.
002300*****IF KH-YC NOT = 10 AND 11                                     D.021217
002310     IF KH-YC NOT = 10 AND 11 AND 30                              I.021217
002320         GO TO M-100.
002330*
002340     INITIALIZE W-DM.
002350     MOVE SPACE TO KHJ-KEY.
002360     MOVE W-HCD TO KHJ-HCD.
002370     START KHJ-M KEY NOT < KHJ-KEY INVALID KEY
002380         GO TO M-180.
002390     MOVE ZERO TO CNT.
002400 M-160.
002410     READ KHJ-M NEXT RECORD WITH UNLOCK AT END
002420         GO TO M-180.
002430     IF KHJ-HCD NOT = W-HCD
002440         GO TO M-180.
002450     ADD 1 TO CNT.
002460     IF CNT > 18
002470         DISPLAY E-ME5 E-ME99
002480         GO TO M-180.
002490     MOVE KHJ-JCD TO W-JCD(CNT).
002500     MOVE KHJ-SGR TO W-SGR(CNT).
002510     MOVE KHJ-SU TO W-SU(CNT).
002520     MOVE KHJ-KSC TO W-KSC(CNT).
002530     GO TO M-160.
002540 M-180.
002550     MOVE 0 TO CHK.
002560     PERFORM S-20 THRU S-35.
002570*
002580     MOVE ZERO TO CNT.
002590     MOVE 3 TO W-L.
002600 M-200.
002610     ADD 1 TO CNT W-L.
002620     IF CNT = 19
002630         GO TO M-500.
002640 M-220.
002650     ACCEPT A-JCD.
002660     DISPLAY  E-CL.
002670     IF ESTAT = BTB
002680         GO TO M-320.
002690     IF ESTAT = C2
002700         PERFORM S-40 THRU S-50
002710         GO TO M-220.
002720     IF ESTAT = C1
002730         PERFORM S-55 THRU S-60
002740         GO TO M-500.
002750     IF ESTAT NOT = HTB AND SKP
002760         GO TO M-220.
002770     IF W-JCD(CNT) = SPACE
002780         GO TO M-220.
002790     MOVE W-JCD(CNT) TO KJ-KEY.
002800     READ KJ-M WITH UNLOCK INVALID KEY
002810         DISPLAY E-ME2 E-ME98
002820         GO TO M-220.
002830     DISPLAY D-JNA.
002840     PERFORM S-75 THRU S-85.
002850     IF W-C = 5
002860         DISPLAY E-ME4 E-ME98
002870         GO TO M-220.
002880     IF KJ-SC NOT = 2 AND 3
002890         DISPLAY D-CK
002900         GO TO M-280.
002910     DISPLAY D-CG.
002920 M-240.
002930     ACCEPT A-SU.
002940     IF ESTAT =  BTB
002950         GO TO M-220.
002960     IF ESTAT NOT = HTB AND SKP
002970         GO TO M-240.
002980     IF W-SU(CNT) = ZERO
002990         GO TO M-240.
003000 M-260.
003010     ACCEPT A-KSC.
003020     IF ESTAT =  BTB
003030         GO TO M-240.
003040     IF ESTAT NOT = HTB AND SKP
003050         GO TO M-260.
003060     IF W-KSC(CNT) NOT = 1 AND 2
003070         GO TO M-260.
003080     GO TO M-200.
003090 M-280.
003100     ACCEPT A-SGR.
003110     IF ESTAT =  BTB
003120         GO TO M-220.
003130     IF ESTAT NOT = HTB AND SKP
003140         GO TO M-280.
003150     DISPLAY D-SGR.
003160     IF W-SGR(CNT) = ZERO
003170         GO TO M-280.
003180     GO TO M-200.
003190 M-320.
003200     SUBTRACT 1 FROM CNT W-L.
003210     IF CNT = ZERO
003220         GO TO M-100.
003230     MOVE W-JCD(CNT) TO KJ-KEY.
003240     READ KJ-M WITH UNLOCK INVALID KEY
003250         GO TO M-220.
003260     IF KJ-SC NOT = 2 AND 3
003270         GO TO M-280.
003280     GO TO M-260.
003290 M-400.
003300     ACCEPT A-FHCD.
003310     IF ESTAT = BTB
003320         GO TO M-060.
003330     IF ESTAT NOT = HTB AND SKP
003340         GO TO M-400.
003350 M-420.
003360     ACCEPT A-THCD.
003370     IF ESTAT = BTB
003380         GO TO M-400.
003390     IF ESTAT NOT = HTB AND SKP
003400         GO TO M-420.
003410     IF W-FHCD >  W-THCD
003420         GO TO M-420.
003430 M-500.
003440     ACCEPT A-DMM.
003450     IF ESTAT = BTB
003460         IF W-PC = 0
003470             GO TO M-520
003480           ELSE
003490             GO TO M-420.
003500     IF ESTAT NOT = HTB AND SKP
003510         GO TO M-500.
003520     IF W-DMM = 9
003530         GO TO M-060.
003540     IF W-DMM NOT = 1
003550         GO TO M-500.
003560     IF W-PC = 0
003570         GO TO M-600.
003580     GO TO M-700.
003590 M-520.
003600     MOVE 19 TO CNT.
003610     MOVE 22 TO W-L.
003620 M-540.
003630     SUBTRACT 1 FROM CNT W-L.
003640     IF CNT = ZERO
003650         GO TO M-100.
003660     IF W-JCD(CNT) = SPACE
003670         GO TO M-540.
003680     MOVE W-JCD(CNT) TO KJ-KEY.
003690     READ KJ-M WITH UNLOCK INVALID KEY
003700         GO TO M-220.
003710     IF KJ-SC NOT = 2 AND 3
003720         GO TO M-280.
003730     GO TO M-260.
003740 M-600.
003750     MOVE SPACE TO KHJ-KEY.
003760     MOVE W-HCD TO KHJ-HCD.
003770     START KHJ-M KEY NOT < KHJ-KEY INVALID KEY
003780         GO TO M-640.
003790 M-620.
003800     READ KHJ-M NEXT RECORD AT END
003810         GO TO M-640.
003820     IF KHJ-HCD NOT = W-HCD
003830         GO TO M-640.
003840     DELETE KHJ-M INVALID KEY
003850         DISPLAY E-STAT E-ME13 E-ME99
003860         GO TO M-980.
003870     CALL "CBLTCLS" USING KHJ-M.
003880     GO TO M-620.
003890 M-640.
003900     MOVE ZERO TO CNT.
003910 M-660.
003920     ADD 1 TO CNT.
003930     IF CNT = 19
003940         GO TO M-060.
003950     IF W-JCD(CNT) = SPACE
003960         GO TO M-660.
003970     INITIALIZE KHJ-R.
003980     MOVE W-HCD TO KHJ-HCD.
003990     MOVE W-JCD(CNT) TO KHJ-JCD.
004000     MOVE W-SGR(CNT) TO KHJ-SGR.
004010     MOVE W-SU(CNT) TO KHJ-SU.
004020     MOVE W-KSC(CNT) TO KHJ-KSC.
004030     WRITE KHJ-R INVALID KEY
004040         DISPLAY E-STAT E-ME11 E-ME99
004050         GO TO M-980.
004060     CALL "CBLTCLS" USING KHJ-M.
004070     GO TO M-660.
004080*
004090 M-700.
004100     MOVE SPACE TO KHJ-KEY.
004110     MOVE W-FHCD TO KHJ-HCD.
004120     START KHJ-M KEY NOT < KHJ-KEY INVALID KEY
004130         DISPLAY E-ME6 E-ME99
004140         MOVE 0 TO W-PC
004150         GO TO M-060.
004160     READ KHJ-M NEXT RECORD WITH UNLOCK AT END
004170         DISPLAY E-ME6 E-ME99
004180         MOVE 0 TO W-PC
004190         GO TO M-060.
004200     IF KHJ-HCD > W-THCD
004210         DISPLAY E-ME6 E-ME99
004220         MOVE 0 TO W-PC
004230         GO TO M-060.
004240     COPY LIBCPR.
004250     MOVE DATE-03R TO H-DATE.
004260     MOVE ZERO TO W-PAGE.
004270     OPEN OUTPUT SP-F.
004280     PERFORM S-10 THRU S-15.
004290 M-720.
004300     MOVE KHJ-HCD TO W-HCD.
004310     MOVE W-HCD TO KH-KEY.
004320     READ KH-M WITH UNLOCK INVALID KEY
004330         MOVE " * ﾏｽﾀｰ ﾅｼ *        " TO KH-NAME.
004340     MOVE ZERO TO CHK CNT.
004350 M-740.
004360     MOVE KHJ-JCD TO KJ-KEY.
004370     READ KJ-M WITH UNLOCK INVALID KEY
004380         MOVE " * ﾏｽﾀｰ ﾅｼ *        " TO KJ-NAME
004390         MOVE 9 TO KJ-SC.
004400     IF CNT = ZERO
004410         MOVE SPACE TO W-P
004420         MOVE ":" TO P-X1
004430         MOVE "･" TO P-X2.
004440     IF CHK = 0
004450         MOVE 1 TO CHK
004460         MOVE W-HCD TO P-HCD
004470         MOVE KH-NAME TO P-HNA.
004480     IF CNT NOT = ZERO
004490         GO TO M-760.
004500     ADD 1 TO CNT.
004510     MOVE KHJ-JCD TO P-JCD1.
004520     MOVE KJ-NAME TO P-JNA1.
004530     IF KJ-SC = 9
004540         MOVE KHJ-SGR TO P-SGR1
004550         MOVE KHJ-SU TO P-SU1
004560         MOVE KHJ-KSC TO P-KSC1
004570         GO TO M-800.
004580     IF KJ-SC = 2 OR 3
004590         MOVE KHJ-SU TO P-SU1
004600         MOVE KHJ-KSC TO P-KSC1
004610       ELSE
004620         MOVE KHJ-SGR TO P-SGR1.
004630     GO TO M-800.
004640 M-760.
004650     MOVE KHJ-JCD TO P-JCD2.
004660     MOVE KJ-NAME TO P-JNA2.
004670     IF KJ-SC = 9
004680         MOVE KHJ-SGR TO P-SGR2
004690         MOVE KHJ-SU TO P-SU2
004700         MOVE KHJ-KSC TO P-KSC2
004710         GO TO M-780.
004720     IF KJ-SC = 2 OR 3
004730         MOVE KHJ-SU TO P-SU2
004740         MOVE KHJ-KSC TO P-KSC2
004750       ELSE
004760         MOVE KHJ-SGR TO P-SGR2.
004770 M-780.
004780     PERFORM S-65 THRU S-70.
004790 M-800.
004800     READ KHJ-M NEXT RECORD WITH UNLOCK AT END
004810         GO TO M-820.
004820     IF KHJ-HCD > W-THCD
004830         GO TO M-820.
004840     IF KHJ-HCD = W-HCD
004850         GO TO M-740.
004860     IF CNT NOT = ZERO
004870         PERFORM S-65 THRU S-70.
004880     GO TO M-720.
004890 M-820.
004900     IF CNT NOT = ZERO                                            I.970702
004910         PERFORM S-65 THRU S-70.                                  I.970702
004920     CLOSE SP-F.
004930     MOVE 0 TO W-PC.
004940     GO TO M-060.
004950 M-980.
004960     CLOSE KHJ-M.
004970     CLOSE KH-M KJ-M.
004980     DISPLAY C-CLEAR.
004990     STOP RUN.
005000 S-05.
005010     MOVE SPACE TO SP-R.
005020     WRITE SP-R AFTER PAGE.
005030 S-10.
005040     ADD 1 TO W-PAGE
005050     MOVE W-PAGE TO H-PAGE.
005060     MOVE SPACE TO SP-R.
005070     MOVE HEAD1 TO SP-R.
005080     WRITE SP-R.
005090     MOVE SPACE TO SP-R.
005100     MOVE HEAD2 TO SP-R.
005110     WRITE SP-R AFTER 2.
005120     MOVE SPACE TO SP-R.
005130 S-15.
005140     EXIT.
005150 S-20.
005160     IF CHK NOT = 0
005170         MOVE CNT TO CNTI
005180         MOVE W-L TO W-LI.
005190     MOVE ZERO TO CNT.
005200     MOVE 3 TO W-L.
005210 S-25.
005220     ADD 1 TO CNT W-L.
005230     IF CNT = 19
005240         GO TO S-30.
005250     IF W-JCD(CNT) = SPACE
005260         DISPLAY D-CL
005270         GO TO S-25.
005280     MOVE W-JCD(CNT) TO KJ-KEY.
005290     READ KJ-M WITH UNLOCK INVALID KEY
005300         MOVE " * KJM ﾅｼ *         " TO KJ-NAME.
005310     DISPLAY A-JCD D-JNA.
005320     IF KJ-SC = 2 OR 3
005330         DISPLAY A-SU A-KSC D-CG
005340       ELSE
005350         DISPLAY D-SGR D-CK.
005360     GO TO S-25.
005370 S-30.
005380     IF CHK NOT = 0
005390         MOVE CNTI TO CNT
005400         MOVE W-LI TO W-L.
005410 S-35.
005420     EXIT.
005430 S-40.
005440     MOVE CNT TO CNTI CNTD.
005450     ADD 1 TO CNTI.
005460 S-45.
005470     IF CNTI NOT = 19
005480         MOVE W-JCD(CNTI) TO W-JCD(CNTD)
005490         MOVE W-SGR(CNTI) TO W-SGR(CNTD)
005500         MOVE W-SU(CNTI) TO W-SU(CNTD)
005510         MOVE W-KSC(CNTI) TO W-KSC(CNTD)
005520         ADD 1 TO CNTI CNTD
005530         GO TO S-45.
005540     MOVE SPACE TO W-JCD(CNTD).
005550     MOVE ZERO TO W-SGR(CNTD) W-SU(CNTD) W-KSC(CNTD).
005560     MOVE 9 TO CHK.
005570     PERFORM S-20 THRU S-35.
005580 S-50.
005590     EXIT.
005600 S-55.
005610     MOVE SPACE TO W-JCD(CNT).
005620     MOVE ZERO TO W-SGR(CNT) W-SU(CNT) W-KSC(CNT).
005630     ADD 1 TO CNT.
005640     IF CNT NOT = 19
005650         GO TO S-55.
005660     MOVE 0 TO CHK.
005670     PERFORM S-20 THRU S-35.
005680 S-60.
005690     EXIT.
005700 S-65.
005710     IF LINAGE-COUNTER > 60
005720         MOVE W-HCD TO P-HCD
005730         MOVE KH-NAME TO P-HNA
005740         PERFORM S-05 THRU S-15.
005750     MOVE SPACE TO SP-R.
005760     MOVE W-P TO SP-R.
005770     WRITE SP-R.
005780     MOVE SPACE TO SP-R.
005790     MOVE ZERO TO CNT.
005800 S-70.
005810     EXIT.
005820 S-75.
005830     MOVE W-JCD(CNT) TO W-JCDD.
005840     MOVE ZERO TO CNTI W-C.
005850 S-80.
005860     ADD 1 TO CNTI.
005870     IF CNTI = 19
005880         GO TO S-85.
005890     IF W-JCD(CNTI) = SPACE
005900         GO TO S-85.
005910     IF CNT = CNTI
005920         GO TO S-80.
005930     IF W-JCD(CNTI) NOT = W-JCDD
005940         GO TO S-80.
005950     MOVE 5 TO W-C.
005960 S-85.
005970     EXIT.
