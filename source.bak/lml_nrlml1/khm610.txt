000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHM610.
000030*********************************************************
000040*    PROGRAM         :  H•io‰×Žè”z“ü—Í                *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCKM61                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT KH-M ASSIGN TO KH-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY KH-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT KHT-M ASSIGN TO KHT1-MSD KHT2-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE DYNAMIC
000240         RECORD KEY KHT-KEY
000250         ALTERNATE RECORD KEY KHT-KEYD
000260         FILE STATUS IS ERR-STAT.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON M-DATE
000290     APPLY SHARED-MODE ON KH-M
000300     APPLY SHARED-MODE ON KHT-M.
000310 DATA DIVISION.
000320 FILE SECTION.
000330     COPY LIBFDD.
000340     COPY LIKHM.
000350     COPY LIKHTM.
000360 WORKING-STORAGE     SECTION.
000370 77  ERR-STAT           PIC  X(002).
000380 77  W-FILE             PIC  X(013).
000390 01  W-DATA.
000400     02  W-FNG.
000410       03  W-FNEN       PIC  9(002).
000420       03  W-FGET       PIC  9(002).
000430*****02  W-RNG.                                                   D.021128
000440*****  03  W-RNEN       PIC  9(002).                              D.021128
000450*****  03  W-RGET       PIC  9(002).                              D.021128
000460     02  W-HCD          PIC  X(005).
000470     02  W-DMM          PIC  9(001).
000480     02  W-L            PIC  9(002).
000490     COPY LSTAT.
000500 SCREEN SECTION.
000510 SD  C-CRT
000520     END STATUS IS ESTAT.
000530 01  C-CLEAR.
000540     02  C-CL    LINE   1  CLEAR SCREEN.
000550 01  C-ACP.
000560     02  LINE W-L.
000570       03  A-HCD   COLUMN   8  PIC  X(005)
000580            USING W-HCD    CHECK OVERFLOW NO IFC.
000590       03  A-TTG   COLUMN  35  PIC  9(006)
000600            USING KHT-TTG  CHECK OVERFLOW NO IFC.
000610       03  A-TYG   COLUMN  43  PIC  9(006)
000620            USING KHT-TYG  CHECK OVERFLOW NO IFC.
000630*****  03  A-YTG   COLUMN  51  PIC  9(006)                        D.021128
000640*****       USING KHT-YTG  CHECK OVERFLOW NO IFC.                 D.021128
000650*****  03  A-YYG   COLUMN  59  PIC  9(006)                        D.021128
000660*****       USING KHT-YYG  CHECK OVERFLOW NO IFC.                 D.021128
000670*****  03  A-DMM   COLUMN  69  PIC  9(001)                        D.021128
000680       03  A-DMM   COLUMN  53  PIC  9(001)                        I.021128
000690            USING W-DMM    CHECK OVERFLOW NO IFC.
000700 01  C-DSP.
000710     02  D-NG    LINE   3.
000720       03  COLUMN  39  PIC  9(002) FROM  W-FNEN.
000730       03  COLUMN  43  PIC Z9      FROM  W-FGET.
000740*****  03  COLUMN  55  PIC  9(002) FROM  W-RNEN.                  D.021128
000750*****  03  COLUMN  59  PIC Z9      FROM  W-RGET.                  D.021128
000760     02  LINE W-L.
000770       03  D-NAME    COLUMN  14  PIC  X(020) FROM  KH-NAME.
000780       03  D-DATA.
000790         04  D-TTG   COLUMN  35  PIC  Z(006) FROM  KHT-TTG.
000800         04  D-TYG   COLUMN  43  PIC  Z(006) FROM  KHT-TYG.
000810*****    04  D-YTG   COLUMN  51  PIC  Z(006) FROM  KHT-YTG.       D.021128
000820*****    04  D-YYG   COLUMN  59  PIC  Z(006) FROM  KHT-YYG.       D.021128
000830 01  C-ERR.
000840     02  LINE  24.
000850       03  E-ME1   COLUMN  15  PIC  X(016) VALUE
000860            "***  KHM Å¼  ***".
000870       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
000880            "***  KHTM Å¼  ***".
000890       03  E-ME3   COLUMN  15  PIC  X(026) VALUE
000900            "***  KHTM REWRITE ´×°  ***".
000910     COPY LSSEM.
000920     COPY LIBSCR.
000930 PROCEDURE DIVISION.
000940 M-05.
000950     MOVE ZERO TO W-DATA.
000960     COPY LIBCPR.
000970     MOVE D-NKNG TO W-FNG.                                        I.021128
000980*****MOVE D-NKNG TO W-FNG W-RNG.                                  D.021128
000990*****ADD 1 TO W-RGET.                                             D.021128
001000*****IF W-RGET > 12                                               D.021128
001010*****    ADD 1 TO W-RNEN                                          D.021128
001020*****    MOVE 1 TO W-RGET.                                        D.021128
001030     OPEN INPUT KH-M.
001040     OPEN I-O KHT-M.
001050     MOVE 22 TO W-L.
001060 M-10.
001070     ADD 1 TO W-L.
001080     IF W-L = 23
001090         DISPLAY C-CLEAR
001100         CALL "SCKM61"
001110         DISPLAY D-NG
001120         MOVE 5 TO W-L.
001130 M-20.
001140     ACCEPT A-HCD.
001150     IF ESTAT = PF9
001160         GO TO M-95.
001170     IF ESTAT = ADV
001180         GO TO M-70.
001190     IF ESTAT NOT = HTB AND SKP
001200         GO TO M-20.
001210*
001220     MOVE W-HCD TO KH-HCD.
001230     READ KH-M WITH UNLOCK INVALID KEY
001240         DISPLAY E-ME1 E-ME98
001250         DISPLAY E-CL
001260         GO TO M-20.
001270     DISPLAY D-NAME.
001280     IF KH-YC NOT = 10 AND 11
001290         GO TO M-20.
001300*
001310     MOVE W-HCD TO KHT-KEY.
001320     READ KHT-M INVALID KEY
001330         DISPLAY E-ME2 E-ME98
001340         DISPLAY E-CL
001350         GO TO M-20.
001360     DISPLAY D-DATA.
001370 M-25.
001380     ACCEPT A-TTG.
001390     IF ESTAT = BTB
001400         GO TO M-20.
001410     IF ESTAT NOT = HTB AND SKP
001420         GO TO M-25.
001430     DISPLAY D-TTG.
001440 M-30.
001450     ACCEPT A-TYG.
001460     IF ESTAT = BTB
001470         GO TO M-25.
001480     IF ESTAT NOT = HTB AND SKP
001490         GO TO M-30.
001500     DISPLAY D-TYG.
001510*M-35.                                                            D.021128
001520*****ACCEPT A-YTG.                                                D.021128
001530*****IF ESTAT = BTB                                               D.021128
001540*****    GO TO M-30.                                              D.021128
001550*****IF ESTAT NOT = HTB AND SKP                                   D.021128
001560*****    GO TO M-35.                                              D.021128
001570*****DISPLAY D-YTG.                                               D.021128
001580*M-40.                                                            D.021128
001590*****ACCEPT A-YYG.                                                D.021128
001600*****IF ESTAT = BTB                                               D.021128
001610*****    GO TO M-35.                                              D.021128
001620*****IF ESTAT NOT = HTB AND SKP                                   D.021128
001630*****    GO TO M-40.                                              D.021128
001640*****DISPLAY D-YYG.                                               D.021128
001650 M-50.
001660     ACCEPT A-DMM.
001670     IF ESTAT = BTB
001680         GO TO M-30.                                              I.021128
001690*****    GO TO M-40.                                              D.021128
001700     IF ESTAT NOT = HTB AND SKP
001710         GO TO M-50.
001720     IF W-DMM = 9
001730         GO TO M-20.
001740     IF W-DMM NOT = 1
001750         GO TO M-50.
001760*
001770     REWRITE KHT-R INVALID KEY
001780         DISPLAY E-STAT E-ME3 E-ME99
001790         GO TO M-95.
001800     GO TO M-10.
001810 M-70.
001820     CLOSE KHT-M.
001830     DISPLAY C-CLEAR.
001840     CALL "SCKM61".
001850     DISPLAY D-NG.
001860     OPEN INPUT KHT-M.
001870     MOVE 4 TO W-L.
001880 M-75.
001890     READ KHT-M NEXT RECORD WITH UNLOCK AT END
001900         GO TO M-80.
001910     IF KHT-YC NOT = 10 AND 11
001920         GO TO M-75.
001930*****IF ZERO = KHT-TTG AND KHT-TYG AND KHT-YTG AND KHT-YYG        D.021128
001940     IF ZERO = KHT-TTG AND KHT-TYG                                I.021128
001950         GO TO M-75.
001960*
001970     MOVE KHT-KEY TO KH-HCD W-HCD.
001980     READ KH-M WITH UNLOCK INVALID KEY
001990         MOVE "***  KHM Å¼  ***    " TO KH-NAME.
002000*
002010     ADD 1 TO W-L.
002020     IF W-L = 23
002030         DISPLAY C-CLEAR
002040         CALL "SCKM61"
002050         DISPLAY D-NG
002060         MOVE 5 TO W-L.
002070     DISPLAY A-HCD D-NAME D-DATA.
002080     GO TO M-75.
002090 M-80.
002100     CLOSE KHT-M.
002110     ACCEPT A-DMM.
002120     OPEN I-O KHT-M.
002130     MOVE 22 TO W-L.
002140     GO TO M-10.
002150 M-95.
002160     CLOSE KH-M.
002170     CLOSE KHT-M.
002180     DISPLAY C-CLEAR.
002190     STOP RUN.
