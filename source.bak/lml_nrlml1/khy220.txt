000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHY220.
000030*********************************************************
000040*    PROGRAM         :  工品仕掛品棚卸　入力    　　　  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCKY22                          *
000070*        変更　　　  :  62/04/10                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     SELECT KH-M ASSIGN TO KH-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE IS RANDOM
000190         RECORD KEY KH-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT KHTN-F ASSIGN TO KHTN-MSD
000220         FILE STATUS IS ERR-STAT.
000230     SELECT SP-F ASSIGN TO P-PRN999.
000240 I-O-CONTROL.
000250     APPLY SHARED-MODE ON KH-M
000260     APPLY SHIFT-CODE  ON SP-F.                                   A 62/04
000270 DATA DIVISION.
000280 FILE SECTION.
000290     COPY LIKHM.
000300     COPY LSPF.
000310 FD  KHTN-F
000320*****BLOCK 15 RECORDS                                             D.021010
000330     BLOCK 12 RECORDS                                             I.021010
000340     LABEL RECORD IS STANDARD
000350     VALUE OF IDENTIFICATION "KHTNF".
000360 01  KHTN-R.
000370     02  KHTN-KC        PIC  9(001).
000380     02  KHTN-HCD       PIC  X(005).
000390     02  KHTN-SU        PIC S9(006)V9(02).
000400     02  KHTN-YC        PIC  9(002).                              ﾖｳﾄｸﾌﾞﾝ
000410     02  KHTN-NC        PIC  9(001).                              I.021010
000420     02  F              PIC  X(003).                              I.021010
000430     02  KHTN-PC        PIC  9(001).
000440 WORKING-STORAGE SECTION.
000450 77  W-FILE             PIC  X(013).                              I.940603
000460 01  ERR-STAT           PIC  X(002).
000470 01  HEAD1.
000480     02  F              PIC  X(005) VALUE ""3FE04FE080"".         A 62/04
000490     02  F              PIC  X(037) VALUE SPACE.
000500     02  F              PIC  N(023) VALUE
000510          NC"＊＊＊　　工品仕掛品棚卸　入力リスト　　＊＊＊".
000520     02  F              PIC  X(028) VALUE SPACE.
000530     02  F              PIC  X(005) VALUE "DATE ".
000540     02  H-DATE         PIC 99B99B99.
000550     02  F              PIC  X(007) VALUE "     P.".
000560     02  H-PAGE         PIC Z9.
000570 01  HEAD2.
000580     02  F              PIC  X(005) VALUE ""3FE04F40A0"".         A 62/04
000590     02  F              PIC  N(002) VALUE NC"場所".
000600     02  F              PIC  X(007) VALUE "  ｺｰﾄﾞ ".
000610     02  F              PIC  N(006) VALUE NC"品　　　名　".
000620     02  F              PIC  X(016) VALUE SPACE.
000630     02  F              PIC  N(004) VALUE NC"数　　量".
000640     02  F              PIC  X(005) VALUE "  :  ".
000650     02  F              PIC  N(002) VALUE NC"場所".
000660     02  F              PIC  X(007) VALUE "  ｺｰﾄﾞ ".
000670     02  F              PIC  N(006) VALUE NC"品　　　名　".
000680     02  F              PIC  X(016) VALUE SPACE.
000690     02  F              PIC  N(004) VALUE NC"数　　量".
000700     02  F              PIC  X(005) VALUE "  :  ".
000710     02  F              PIC  N(002) VALUE NC"場所".
000720     02  F              PIC  X(007) VALUE "  ｺｰﾄﾞ ".
000730     02  F              PIC  N(006) VALUE NC"品　　　名　".
000740     02  F              PIC  X(016) VALUE SPACE.
000750     02  F              PIC  N(004) VALUE NC"数　　量".
000760     02  F              PIC  X(005) VALUE ""3FE04FE080"".         A 62/04
000770 01  W-P.
000780     02  W-PD    OCCURS  58.
000790       03  F            PIC  X(001).
000800       03  P-KC1        PIC  9(001).
000810       03  F            PIC  X(002).
000820       03  P-HCD1       PIC  X(005).
000830       03  F            PIC  X(001).
000840       03  P-NAME1      PIC  X(020).
000850       03  P-SU1        PIC ----,--9.99.
000860       03  F            PIC  X(002).
000870       03  P-X1         PIC  X(001).
000880       03  F            PIC  X(003).
000890       03  P-KC2        PIC  9(001).
000900       03  F            PIC  X(002).
000910       03  P-HCD2       PIC  X(005).
000920       03  F            PIC  X(001).
000930       03  P-NAME2      PIC  X(020).
000940       03  P-SU2        PIC ----,--9.99.
000950       03  F            PIC  X(002).
000960       03  P-X2         PIC  X(001).
000970       03  F            PIC  X(003).
000980       03  P-KC3        PIC  9(001).
000990       03  F            PIC  X(002).
001000       03  P-HCD3       PIC  X(005).
001010       03  F            PIC  X(001).
001020       03  P-NAME3      PIC  X(020).
001030       03  P-SU3        PIC ----,--9.99.
001040 01  W-DATA.
001050     02  W-KC           PIC  9(001).
001060     02  W-L            PIC  9(002).
001070     02  CHK            PIC  9(001).
001080     02  W-DMM          PIC  9(001).
001090     02  W-PAGE         PIC  9(002).
001100     02  W-LD           PIC  9(002).
001110     02  W-CD           PIC  9(001).
001120     02  W-PC           PIC  9(001).
001130     02  W-POC          PIC  9(001).
001140     COPY LSTAT.
001150 SCREEN SECTION.
001160 SD  C-CRT
001170     END STATUS IS ESTAT.
001180 01  C-CLEAR.
001190     02  LINE   1  CLEAR SCREEN.
001200 01  C-MID.
001210     02  LINE   1  COLUMN  17  PIC  N(023) VALUE
001220          NC"＊＊＊　　工品仕掛品　棚卸入力リスト　　＊＊＊".
001230     02  LINE   8  COLUMN  14  PIC  X(050) VALUE
001240          "[   追加分作表=1  全件作表=5  作表しない=9       ]".
001250     02  LINE  20  COLUMN  29  PIC  X(022) VALUE
001260          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001270 01  C-ACP.
001280     02  LINE W-L.
001290       03  A-KC    COLUMN  18  PIC  9(001)
001300            USING W-KC       CHECK OVERFLOW NO IFC.
001310       03  A-HCD   COLUMN  21  PIC  X(005)
001320            USING KHTN-HCD   CHECK OVERFLOW NO IFC.
001330       03  A-SU    COLUMN  48  PIC S9(006)V9(02)
001340            USING KHTN-SU    CHECK OVERFLOW NO IFC.
001350       03  A-DMM   COLUMN  61  PIC  9(001)
001360            USING W-DMM   CHECK OVERFLOW NO IFC.
001370     02  A-PC    LINE   8  COLUMN  59  PIC  9(001)
001380            USING W-PC    CHECK OVERFLOW NO IFC.
001390     02  A-DMMD  LINE  20  COLUMN  46  PIC  9(001)
001400            USING W-DMM   CHECK OVERFLOW NO IFC.
001410 01  C-DSP.
001420     02  LINE W-L.
001430       03  D-NAME  COLUMN  27  PIC  X(020)     FROM  KH-NAME.
001440       03  D-SU    COLUMN  48  PIC ZZZZZ9.99-  FROM  KHTN-SU.
001450 01  C-ERR.
001460     02  LINE  24.
001470*****  03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.        D.940603
001480       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001490            "***  KH-M ﾅｼ  ***".
001500       03  E-ME2   COLUMN  15  PIC  X(025) VALUE
001510            "***  KHTNF WRITE ｴﾗｰ  ***".
001520       03  E-ME3   COLUMN  15  PIC  X(027) VALUE
001530            "***  KHTNF REWRITE ｴﾗｰ  ***".
001540       03  E-REC   COLUMN  50  PIC  X(017) FROM  KHTN-R.
001550*****  03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".     D.940603
001560*****  03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".     D.940603
001570*****  03  E-CL    COLUMN  10  PIC  X(050) VALUE                  D.940603
001580*****       "                                                  ". D.940603
001590     COPY LSSEM.                                                  I.940603
001600     COPY LIBSCR.
001610 PROCEDURE DIVISION.
001620 M-05.
001630     DISPLAY C-CLEAR.
001640     OPEN INPUT KH-M.
001650     OPEN EXTEND KHTN-F.
001660     MOVE ZERO TO W-DATA.
001670     CALL "SCKY22".
001680     MOVE 3 TO W-L.
001690 M-10.
001700     ADD 1 TO W-L.
001710     IF W-L = 22
001720         CALL "SCKY22"
001730         MOVE 4 TO W-L.
001740     IF W-KC NOT = 0
001750         DISPLAY A-KC
001760         GO TO M-20.
001770 M-15.
001780     ACCEPT A-KC.
001790     IF ESTAT = PF9
001800         GO TO M-50.
001810     IF ESTAT NOT = HTB AND SKP
001820         GO TO M-15.
001830     IF W-KC = 0
001840         GO TO M-15.
001850 M-20.
001860     INITIALIZE KHTN-R.
001870     MOVE W-KC TO KHTN-KC.
001880 M-25.
001890     ACCEPT A-HCD.
001900     DISPLAY E-CL.
001910     IF ESTAT = PF9
001920         GO TO M-50.
001930     IF ESTAT = BTB
001940         GO TO M-15.
001950     IF ESTAT NOT = HTB AND SKP
001960         GO TO M-25.
001970     MOVE KHTN-HCD TO KH-HCD.
001980     READ KH-M WITH UNLOCK INVALID KEY
001990         DISPLAY E-ME1 E-ME98
002000         GO TO M-25.
002010     MOVE KH-YC TO KHTN-YC.
002020     MOVE KH-NC TO KHTN-NC.                                       I.021010
002030     DISPLAY D-NAME.
002040 M-30.
002050     ACCEPT A-SU.
002060     IF ESTAT = BTB
002070         GO TO M-25.
002080     IF ESTAT NOT = HTB AND SKP
002090         GO TO M-30.
002100     DISPLAY D-SU.
002110     IF KHTN-SU = ZERO
002120         GO TO M-30.
002130 M-35.
002140     ACCEPT A-DMM.
002150     IF ESTAT = BTB
002160         GO TO M-30.
002170     IF ESTAT NOT = HTB AND SKP
002180         GO TO M-35.
002190     IF W-DMM = 9
002200         GO TO M-20.
002210     IF W-DMM NOT = 1
002220         GO TO M-35.
002230*
002240     WRITE KHTN-R.
002250     IF ERR-STAT NOT = "00"
002260         DISPLAY E-STAT E-ME2 E-ME99
002270         GO TO M-20.
002280     GO TO M-10.
002290 M-50.
002300     CLOSE KHTN-F.
002310     DISPLAY C-CLEAR.
002320     DISPLAY C-MID.
002330 M-55.
002340     ACCEPT A-PC.
002350     IF ESTAT NOT = HTB AND SKP
002360         GO TO M-55.
002370     IF W-PC NOT = 1 AND 5 AND 9
002380         GO TO M-55.
002390 M-60.
002400     ACCEPT A-DMMD.
002410     IF ESTAT = BTB
002420         GO TO M-55.
002430     IF ESTAT NOT = HTB AND SKP
002440         GO TO M-60.
002450     IF W-DMM = 9
002460         GO TO M-55.
002470     IF W-DMM NOT = 1
002480         GO TO M-60.
002490     IF W-PC = 9
002500         GO TO M-95.
002510*
002520     OPEN I-O KHTN-F.
002530 M-65.
002540     READ KHTN-F AT END
002550         CLOSE KHTN-F
002560         GO TO M-95.
002570     IF W-PC = 1
002580         IF KHTN-PC NOT = 0
002590             GO TO M-65.
002600     MOVE SPACE TO W-P.
002610 M-70.
002620     MOVE KHTN-KC TO W-KC.
002630     MOVE 0 TO CHK.
002640 M-75.
002650     PERFORM S-20 THRU S-25.
002660     PERFORM S-30 THRU S-35.
002670     IF KHTN-PC = 9
002680         GO TO M-80.
002690     MOVE 9 TO KHTN-PC.
002700     REWRITE KHTN-R.
002710     IF ERR-STAT NOT = "00"
002720         DISPLAY E-STAT E-ME3 E-REC E-ME99.
002730     DISPLAY E-CL.
002740 M-80.
002750     READ KHTN-F AT END
002760         GO TO M-90.
002770     IF W-PC = 1
002780         IF KHTN-PC NOT = 0
002790             GO TO M-80.
002800     IF KHTN-KC NOT = W-KC
002810         GO TO M-70.
002820     GO TO M-75.
002830 M-90.
002840     CLOSE KHTN-F.
002850     PERFORM S-40 THRU S-50.
002860     CLOSE SP-F.
002870 M-95.
002880     CLOSE KH-M.
002890     DISPLAY C-CLEAR.
002900     STOP RUN.
002910 S-05.
002920     MOVE SPACE TO SP-R.
002930     WRITE SP-R AFTER PAGE.
002940 S-10.
002950     ADD 1 TO W-PAGE.
002960     MOVE W-PAGE TO H-PAGE.
002970     MOVE SPACE TO SP-R.
002980     MOVE HEAD1 TO SP-R.
002990     WRITE SP-R.
003000     MOVE SPACE TO SP-R.
003010     MOVE HEAD2 TO SP-R.
003020     WRITE SP-R AFTER 2.
003030     MOVE SPACE TO SP-R.
003040 S-15.
003050     EXIT.
003060 S-20.
003070     ADD 1 TO W-LD.
003080     IF W-LD NOT = 59
003090         GO TO S-25.
003100     ADD 1 TO W-CD.
003110     IF W-CD NOT = 3
003120         MOVE ZERO TO W-LD CHK
003130         GO TO S-20.
003140     PERFORM S-40 THRU S-50.
003150     MOVE ZERO TO W-LD W-CD CHK.
003160     MOVE SPACE TO W-P.
003170     GO TO S-20.
003180 S-25.
003190     EXIT.
003200 S-30.
003210     MOVE KHTN-HCD TO KH-HCD.
003220     READ KH-M WITH UNLOCK INVALID KEY
003230         MOVE "ﾏｽﾀｰ ﾐﾄｳﾛｸ          " TO KH-NAME.
003240     IF W-CD = 0
003250         MOVE KHTN-HCD TO P-HCD1(W-LD)
003260         MOVE KH-NAME TO P-NAME1(W-LD)
003270         MOVE KHTN-SU TO P-SU1(W-LD)
003280         MOVE ":" TO P-X1(W-LD)
003290         IF CHK = 0
003300             MOVE 5 TO CHK
003310             MOVE KHTN-KC TO P-KC1(W-LD).
003320     IF W-CD = 1
003330         MOVE KHTN-HCD TO P-HCD2(W-LD)
003340         MOVE KH-NAME TO P-NAME2(W-LD)
003350         MOVE KHTN-SU TO P-SU2(W-LD)
003360         MOVE ":" TO P-X2(W-LD)
003370         IF CHK = 0
003380             MOVE 5 TO CHK
003390             MOVE KHTN-KC TO P-KC2(W-LD).
003400     IF W-CD = 2
003410         MOVE KHTN-HCD TO P-HCD3(W-LD)
003420         MOVE KH-NAME TO P-NAME3(W-LD)
003430         MOVE KHTN-SU TO P-SU3(W-LD)
003440         IF CHK = 0
003450             MOVE 5 TO CHK
003460             MOVE KHTN-KC TO P-KC3(W-LD).
003470 S-35.
003480     EXIT.
003490 S-40.
003500     IF W-POC = 0
003510         MOVE 9 TO W-POC
003520         OPEN OUTPUT SP-F
003530         ACCEPT H-DATE FROM DATE
003540         PERFORM S-10 THRU S-15
003550       ELSE
003560         PERFORM S-05 THRU S-15.
003570     MOVE ZERO TO W-LD.
003580 S-45.
003590     ADD 1 TO W-LD.
003600     IF W-LD NOT = 59
003610         IF P-X1(W-LD) NOT = SPACE
003620             MOVE SPACE TO SP-R
003630             MOVE W-PD(W-LD) TO SP-R
003640             WRITE SP-R
003650             MOVE SPACE TO SP-R
003660             GO TO S-45.
003670 S-50.
003680     EXIT.
