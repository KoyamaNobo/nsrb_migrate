000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHY350.
000030*********************************************************
000040*    PROGRAM         :  工品材料マスター棚卸セット      *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*        変更　　　  :  62/04/10                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*********************************************************
000100 ENVIRONMENT DIVISION.
000110 CONFIGURATION SECTION.
000120 SOURCE-COMPUTER. SYSTEM3100.
000130 OBJECT-COMPUTER. SYSTEM3100.
000140 INPUT-OUTPUT SECTION.
000150 FILE-CONTROL.
000160     SELECT KJ-M ASSIGN TO KJ-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE IS DYNAMIC
000190         RECORD KEY KJ-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT KJTN-F ASSIGN TO KJTN-MSD.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON KJ-M.
000240 DATA DIVISION.
000250 FILE SECTION.
000260     COPY LIKJM.
000270 FD  KJTN-F
000280     BLOCK 15 RECORDS
000290     LABEL RECORD IS STANDARD
000300     VALUE OF IDENTIFICATION "KJTNF".
000310 01  KJTN-R.
000320     02  KJTN-KC          PIC  9(001).
000330     02  KJTN-HCD         PIC  X(007).                            I.940520
000340     02  KJTN-SU          PIC S9(007).
000350     02  KJTN-SC          PIC  9(001).
000360     02  KJTN-PC          PIC  9(001).
000370 WORKING-STORAGE SECTION.
000380 01  W-FILE               PIC  X(013).
000390 01  ERR-STAT             PIC  X(002).
000400 01  W-DATA.
000410     02  CHK              PIC  9(001).
000420     02  W-DMM            PIC  9(001).
000430     COPY LSTAT.
000440 SCREEN SECTION.
000450 SD  C-CRT
000460     END STATUS IS ESTAT.
000470 01  C-CLEAR.
000480     02  LINE   1  CLEAR SCREEN.
000490 01  C-MID.
000500     02  LINE   1  COLUMN  15  PIC  N(024) VALUE
000510          NC"＊＊＊　　工品材料マスター　棚卸セット　　＊＊＊".
000520     02  LINE  20  COLUMN  29  PIC  X(022) VALUE
000530          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000540 01  C-ACP.
000550     02  A-DMM   LINE  20  COLUMN  46  PIC  9(001)
000560          USING W-DMM   CHECK OVERFLOW NO IFC.
000570 01  C-DSP.
000580     02  D-FCM   LINE  10  COLUMN  32  PIC  N(009) VALUE
000590          NC"ＺＥＲＯ　セット中" REVERSE.
000600     02  D-FSM   LINE  10  COLUMN  32  PIC  N(009) VALUE
000610          NC"　棚卸　セット中　" REVERSE.
000620 01  C-ERR.
000630     02  LINE  24.
000640       03  E-ME1   COLUMN  15  PIC  X(025) VALUE
000650            "***  KJM REWRITE ｴﾗｰ  ***".
000660       03  E-ME2   COLUMN  15  PIC  X(016) VALUE
000670            "***  KJM ﾅｼ  ***".
000680       03  E-HCD   COLUMN  50  PIC  X(007) FROM  KJ-KEY.
000690     COPY LSSEM.
000700     COPY LIBSCR.
000710 PROCEDURE DIVISION.
000720 M-05.
000730     DISPLAY C-CLEAR.
000740     DISPLAY C-MID.
000750 M-10.
000760     ACCEPT A-DMM.
000770     IF ESTAT = PF9
000780         GO TO M-95.
000790     IF ESTAT NOT = HTB AND SKP
000800         GO TO M-10.
000810     IF W-DMM = 9
000820         GO TO M-95.
000830     IF W-DMM NOT = 1
000840         GO TO M-10.
000850*
000860     DISPLAY D-FCM.
000870     OPEN I-O KJ-M.
000880 M-15.
000890     READ KJ-M NEXT RECORD AT END
000900         GO TO M-20.
000910     MOVE ZERO TO KJ-JTS.
000920     REWRITE KJ-R INVALID KEY
000930         DISPLAY E-ME78 E-STAT E-ME1 E-HCD E-ME99
000940         CLOSE KJ-M
000950         GO TO M-95.
000960     GO TO M-15.
000970 M-20.
000980     DISPLAY D-FSM.
000990     OPEN INPUT KJTN-F.
001000 M-25.
001010     READ KJTN-F AT END
001020         GO TO M-90.
001030     IF KJTN-SU = ZERO
001040         GO TO M-25.
001050     MOVE KJTN-HCD TO KJ-KEY.
001060     READ KJ-M INVALID KEY
001070         DISPLAY E-ME2 E-HCD E-ME99
001080         GO TO M-90.
001090     ADD KJTN-SU TO KJ-JTS.
001100     REWRITE KJ-R INVALID KEY
001110         DISPLAY E-ME78 E-STAT E-ME1 E-HCD E-ME99
001120         GO TO M-90.
001130     GO TO M-25.
001140 M-90.
001150     CLOSE KJ-M.
001160     CLOSE KJTN-F.
001170 M-95.
001180     DISPLAY C-CLEAR.
001190     STOP RUN.
