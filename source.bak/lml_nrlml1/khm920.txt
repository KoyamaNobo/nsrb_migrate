000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         KHM920.
000030************************************
000040******    用途区分　問合せ    ******
000050************************************
000060 ENVIRONMENT         DIVISION.
000070 CONFIGURATION       SECTION.
000080 SOURCE-COMPUTER.    SYSTEM3100.
000090 OBJECT-COMPUTER.    SYSTEM3100.
000100 INPUT-OUTPUT        SECTION.
000110 FILE-CONTROL.
000120     SELECT KKB-M ASSIGN  TO KKB-MSD
000130             ORGANIZATION   INDEXED
000140             ACCESS  MODE   DYNAMIC
000150             RECORD  KEY  KKB-KEY
000160             FILE   STATUS  IS  ERR-STAT.
000170 I-O-CONTROL.
000180     APPLY  SHARED-MODE  ON  KKB-M.
000190 DATA                DIVISION.
000200 FILE                SECTION.
000210     COPY LIKKBM.
000220 WORKING-STORAGE      SECTION.
000230 01  ERR-STAT                PIC  X(002).
000240 01  W-DATA.
000250     02  W-ACT               PIC  9(001).
000260     02  W-KEYD.
000270       03  F                 PIC  X(002) VALUE "01".
000280       03  W-KEY             PIC  9(002).
000290       03  F                 PIC  X(003) VALUE SPACE.
000300     02  W-L                 PIC  9(002).
000310     02  W-C1                PIC  9(002).
000320     02  W-C2                PIC  9(002).
000330     COPY LSTAT.
000340 SCREEN              SECTION.
000350 SD  C-CRT
000360     END  STATUS  IS  ESTAT.
000370 01  C-CLEAR.
000380     02  C-CL    LINE   1    CLEAR  SCREEN.
000390 01  C-MID.
000400     02  LINE   1    COLUMN  22    PIC  N(018)    VALUE
000410          NC"＊＊＊　　用途区分　問合せ　　＊＊＊" REVERSE.
000420     02  LINE   3.
000430       03  COLUMN  21  PIC  N(002) VALUE NC"区分" REVERSE.
000440       03  COLUMN  27  PIC  N(016) VALUE
000450            NC"用　　途　　名　　　　　　　　　" REVERSE.
000460     02  LINE  23    COLUMN  30    PIC  X(034)    VALUE
000470          "NEXT=ﾘﾀｰﾝ , 入力=ｆ･10 , 終了=ｆ･9".
000480 01  C-ACP.
000490     02  A-KEY   LINE   4  COLUMN  22  PIC  9(002)
000500          USING W-KEY   CHECK OVERFLOW NO IFC.
000510     02  A-ACT   LINE  23  COLUMN  67  PIC  9(001)
000520          USING W-ACT   CHECK OVERFLOW NO IFC.
000530 01  C-DSP.
000540     02  LINE  W-L.
000550         03  D-KEY    COLUMN  22  PIC 9(002) FROM  KKB-YC.
000560         03  D-NAME   COLUMN  27  PIC N(016) FROM  KKB-YCN.
000570 01  C-ERR.
000580     02  LINE  24.
000590         03  E-STAT   COLUMN 10   PIC X(010)   FROM  ERR-STAT.
000600         03  E-ME98   COLUMN 75   PIC X(005)   VALUE ""27"J"05"".
000610         03  E-ME99   COLUMN 75   PIC X(005)   VALUE ""27"B"05"".
000620 PROCEDURE           DIVISION.
000630 M-05.
000640     DISPLAY  C-CLEAR.
000650     DISPLAY  C-MID.
000660     OPEN  INPUT KKB-M.
000670 M-10.
000680     ACCEPT  A-ACT.
000690     IF  ESTAT = PF9
000700         CLOSE  KKB-M
000710         GO  TO  M-99.
000720     IF  ESTAT = HTB
000730         DISPLAY  C-CLEAR
000740         DISPLAY  C-MID
000750         GO  TO  M-20.
000760     IF  ESTAT NOT = ADV AND SKP
000770         GO  TO  M-10.
000780 M-15.
000790     ACCEPT  A-KEY.
000800     IF  ESTAT = BTB
000810         GO  TO  M-10.
000820     IF  ESTAT = PF9
000830         GO  TO  M-99.
000840     IF  ESTAT NOT = HTB AND SKP
000850         GO  TO  M-15.
000860     DISPLAY  C-CLEAR.                                            I.030107
000870     DISPLAY  C-MID.                                              I.030107
000880     MOVE  W-KEYD  TO KKB-KEY.
000890 M-20.
000900     MOVE  3      TO  W-L.
000910 M-25.
000920     START KKB-M KEY NOT < KKB-KEY  INVALID  KEY
000930         CLOSE  KKB-M
000940         GO  TO  M-15.
000950 M-27.
000960     READ KKB-M NEXT  RECORD  WITH  UNLOCK  AT  END
000970         CLOSE  KKB-M
000980         GO  TO  M-15.
000990     IF KKB-NO NOT = "01"
001000         GO TO M-15.
001010 M-30.
001020     ADD  1  TO  W-L.
001030     IF  W-L = 23
001040         GO  TO  M-10.
001050     DISPLAY  D-KEY  D-NAME.
001060 M-35.
001070     READ KKB-M NEXT  RECORD  WITH  UNLOCK  AT  END
001080*****    CLOSE  KKB-M                                             D.030107
001090*****    OPEN  INPUT  KKB-M                                       D.030107
001100*****    MOVE  ZERO  TO KKB-KEY                                   D.030107
001110         GO  TO  M-25.
001120     IF KKB-NO NOT = "01"
001130         GO TO M-35.
001140     GO  TO  M-30.
001150 M-99.
001160     DISPLAY  C-CLEAR.
001170     STOP  RUN.
