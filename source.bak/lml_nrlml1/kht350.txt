000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHT350.
000030*********************************************************
000040*    PROGRAM         :  工品他買掛金台帳　　　　　　    *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCKT35                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT KKB-M ASSIGN TO KKB-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY KKB-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT ST-M ASSIGN TO ST-MSD
000220         ORGANIZATION INDEXED
000230         RECORD KEY ST-KEY
000240         ACCESS MODE DYNAMIC
000250         FILE STATUS IS ERR-STAT.
000260     SELECT KJ-M ASSIGN TO KJ-MSD
000270         ORGANIZATION INDEXED
000280         RECORD KEY KJ-KEY
000290         ACCESS MODE RANDOM
000300         FILE STATUS IS ERR-STAT.
000310     SELECT KSR-F ASSIGN TO KSR-MSD.
000320 I-O-CONTROL.
000330     APPLY SHARED-MODE ON M-DATE
000340     APPLY SHARED-MODE ON KKB-M
000350     APPLY SHARED-MODE ON ST-M
000360     APPLY SHARED-MODE ON KJ-M.
000370 DATA DIVISION.
000380 FILE SECTION.
000390     COPY LIBFDD.
000400     COPY LIKKBM.
000410     COPY LISTM.
000420     COPY LIKJM.
000430 FD  KSR-F
000440     BLOCK  4 RECORDS
000450     LABEL RECORD IS STANDARD
000460     VALUE OF IDENTIFICATION WK0064ID.
000470 01  KSR-R.
000480     02  KS-DATE        PIC  9(008).
000490     02  KS-NGP   REDEFINES KS-DATE.
000500       03  KS-NG.
000510         04  KS-NEN     PIC  9(004).
000520         04  KS-NENL  REDEFINES KS-NEN.
000530           05  KS-NEN1  PIC  9(002).
000540           05  KS-NEN2  PIC  9(002).
000550         04  KS-GET     PIC  9(002).
000560       03  KS-PEY       PIC  9(002).
000570     02  KS-NGPD   REDEFINES KS-DATE.
000580       03  KS-NEND      PIC  9(004).
000590       03  KS-GP        PIC  9(004).
000600       03  KS-GPD  REDEFINES KS-GP.
000610         04  KS-GETD    PIC  9(002).
000620         04  KS-PEYD    PIC  9(002).
000630     02  KS-NGPL  REDEFINES KS-DATE.
000640       03  F            PIC  9(002).
000650       03  KS-NGPS      PIC  9(006).
000660     02  KS-JCD         PIC  X(007).
000670     02  KS-DC          PIC  9(001).
000680     02  KS-SC          PIC  9(001).
000690     02  KS-SU          PIC S9(006)V9(02).
000700     02  KS-T           PIC  9(005)V9(02).
000710     02  KS-KIN         PIC S9(009).
000720     02  KS-SGP.
000730       03  KS-SGET      PIC  9(002).
000740       03  KS-SPEY      PIC  9(002).
000750     02  KS-DNO         PIC  9(005).
000760     02  F              PIC  X(012).
000770     02  KS-SHC         PIC  9(001).
000780     02  KS-SSC         PIC  9(001).
000790 WORKING-STORAGE SECTION.
000800 77  WK0064ID           PIC  X(009) VALUE SPACE.
000810 01  STN-NO.
000820     02  STN-NO1        PIC  X(003).
000830     02  STN-NO2        PIC  X(003).
000840 01  W-FID.
000850     02  W-FID1         PIC  X(006) VALUE "WK0064".
000860     02  W-FID2         PIC  X(003).
000870 01  W-D.
000880     02  W-DATA.
000890       03  W-ZKK        PIC S9(008).
000900       03  W-SZZ        PIC S9(007).
000910       03  W-KZT        PIC S9(008).
000920     02  W-NGP.
000930       03  W-NEN        PIC  9(004).
000940       03  W-NENL  REDEFINES W-NEN.
000950         04  W-NEN1     PIC  9(002).
000960         04  W-NEN2     PIC  9(002).
000970       03  W-GP.
000980         04  W-GET      PIC  9(002).
000990         04  W-PEY      PIC  9(002).
001000     02  W-NGPD  REDEFINES W-NGP.
001010       03  F            PIC  9(002).
001020       03  W-NGS        PIC  9(004).
001030       03  F            PIC  9(002).
001040     02  W-SCD          PIC  9(004).
001050     02  W-NEC          PIC  9(001).
001060     02  W-KIN          PIC S9(008).
001070     02  W-SHZ          PIC S9(007).
001080     02  W-OL           PIC  9(002).
001090     02  W-UL           PIC  9(002).
001100     02  W-JNA          PIC  X(020).
001110 01  ERR-STAT           PIC  X(002).
001120     COPY LSTAT.
001130 SCREEN SECTION.
001140 SD  C-CRT
001150     END STATUS IS ESTAT.
001160 01  C-CLEAR.
001170     02  C-CL    LINE  1  CLEAR SCREEN.
001180 01  C-ACP.
001190     02  A-PEY   LINE   5  COLUMN   1  PIC  9(002)
001200          USING W-PEY   CHECK OVERFLOW NO IFC.
001210     02  A-NEC   LINE  23  COLUMN  44  PIC  9(001)
001220          USING W-NEC   CHECK OVERFLOW NO IFC.
001230 01  C-DSP.
001240     02  LINE   2.
001250       03  D-NG.
001260         04  COLUMN  58  PIC 99   FROM  W-NEN2.
001270         04  COLUMN  62  PIC Z9   FROM  W-GET.
001280     02  D-PEY   LINE   5  COLUMN   1  PIC  Z(002) FROM  W-PEY.
001290     02  LINE W-OL.
001300       03  D-P     COLUMN   1  PIC Z9          FROM  KS-PEY.
001310       03  D-JCD   COLUMN   4  PIC  X(007)     FROM  KS-JCD.
001320       03  D-JNA   COLUMN  12  PIC  X(020)     FROM  W-JNA.
001330       03  D-TSD.
001340         04  COLUMN  34  PIC  X(001)     VALUE "(".
001350         04  COLUMN  35  PIC Z9          FROM  KS-SGET.
001360         04  COLUMN  37  PIC  X(001)     VALUE "/".
001370         04  COLUMN  38  PIC Z9          FROM  KS-SPEY.
001380         04  COLUMN  40  PIC  X(001)     VALUE ")".
001390     02  LINE W-UL.
001400       03  D-SU    COLUMN   7  PIC ----,--9.99 FROM  KS-SU.
001410       03  D-T     COLUMN  18  PIC ---,--9.99  FROM  KS-T.
001420       03  D-KIN   COLUMN  28  PIC ---,---,--9 FROM  W-KIN.
001430       03  D-SHZ   COLUMN  39  PIC --,---,--9  FROM  W-SHZ.
001440       03  D-ZKK   COLUMN  49  PIC ---,---,--9 FROM  W-ZKK.
001450       03  D-SZZ   COLUMN  60  PIC --,---,--9  FROM  W-SZZ.
001460       03  D-KZT   COLUMN  70  PIC ---,---,--9 FROM  W-KZT.
001470     02  LINE  23.
001480       03  D-NM    COLUMN  30  PIC  X(022) VALUE
001490            "[  NEXT PAGE   ﾘﾀｰﾝ  ]".
001500       03  D-EM    COLUMN  30  PIC  X(022) VALUE
001510            " [  END DATA   ﾘﾀｰﾝ  ]".
001520 01  C-ERR.
001530     02  LINE  24.
001540       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001550            "***  DATA ﾅｼ  ***".
001560       03  E-ME2   COLUMN  15  PIC  X(016) VALUE
001570            "***  STM ﾅｼ  ***".
001580       03  E-ME3   COLUMN  15  PIC  X(025) VALUE
001590            "***  ｺｳﾊﾞｲ ｶﾞ ｼﾏｯﾃﾅｲ  ***".
001600       03  E-ME9   COLUMN  15  PIC  X(017) VALUE
001610            "***  KKBM ﾅｼ  ***".
001620       03  E-KKB   COLUMN  50  PIC  X(007) FROM  KKB-KEY.
001630       03  E-ME98  COLUMN  75  PIC  X(075) VALUE ""27"J"05"".
001640       03  E-ME99  COLUMN  75  PIC  X(075) VALUE ""27"B"05"".
001650     COPY LIBSCR.
001660 PROCEDURE DIVISION.
001670 M-05.
001680     DISPLAY C-CLEAR.
001690     CALL "SCKT35".
001700     COPY LIBCPR.
001710     IF D-NHNG NOT = D-NBNG
001720         DISPLAY E-ME3 E-ME99
001730         GO TO M-95.
001740     MOVE ZERO TO W-NGP.
001750     MOVE D-NHNG TO W-NGS.
001760     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001770         ADD DATE-NC1 TO W-NEN.
001780     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001790         ADD DATE-NC2 TO W-NEN.
001800     DISPLAY D-NG.
001810*
001820     OPEN INPUT KKB-M.
001830     MOVE SPACE TO KKB-KEY.
001840     MOVE 07 TO KKB-NO.
001850     MOVE 0 TO KKB-JSC.
001860     READ KKB-M WITH UNLOCK INVALID KEY
001870         CLOSE KKB-M
001880         DISPLAY E-ME9 E-KKB E-ME99
001890         GO TO M-95.
001900     MOVE KKB-SCO TO W-SCD.
001910     CLOSE KKB-M.
001920*
001930     MOVE ZERO TO W-DATA.
001940     OPEN INPUT ST-M.
001950     MOVE W-SCD TO ST-KEY.
001960     READ ST-M WITH UNLOCK INVALID KEY
001970         MOVE ZERO TO ST-ZKZ ST-ZKZZ.
001980     MOVE ST-ZKZ TO W-ZKK.
001990     MOVE ST-ZKZZ TO W-SZZ.
002000     COMPUTE W-KZT = W-ZKK + W-SZZ.
002010     CLOSE ST-M.
002020*
002030     CALL "CBLSTNNO" USING STN-NO.
002040     MOVE STN-NO2 TO W-FID2.
002050     MOVE W-FID TO WK0064ID.
002060     OPEN INPUT KSR-F.
002070     OPEN INPUT KJ-M.
002080 M-10.
002090     ACCEPT A-PEY.
002100     IF ESTAT = PF9
002110         GO TO M-90.
002120     IF ESTAT NOT = HTB AND SKP
002130         GO TO M-10.
002140     DISPLAY D-PEY.
002150     IF W-PEY > 31
002160         GO TO M-10.
002170     MOVE 3 TO W-OL.
002180     MOVE 4 TO W-UL.
002190*
002200     READ KSR-F AT END
002210         MOVE 99999999 TO KS-DATE.
002220     IF KS-DATE >= W-NGP
002230         ADD 2 TO W-OL W-UL
002240         MOVE SPACE TO W-JNA
002250         MOVE "＜前月繰越＞" TO W-JNA
002260         DISPLAY D-JNA D-ZKK D-SZZ D-KZT.
002270     CLOSE KSR-F.
002280     OPEN INPUT KSR-F.
002290 M-15.
002300     READ KSR-F AT END
002310         GO TO M-30.
002320*
002330     MOVE ZERO TO W-KIN W-SHZ.
002340     IF KS-DC = 0 OR 2
002350         MOVE KS-KIN TO W-KIN
002360       ELSE
002370         IF KS-DC = 5
002380             MOVE KS-KIN TO W-SHZ
002390           ELSE
002400             IF KS-DC = 1
002410                 COMPUTE W-KIN = -1 * KS-KIN
002420               ELSE
002430                 IF KS-DC = 6
002440                     COMPUTE W-SHZ = -1 * KS-KIN.
002450     ADD W-KIN TO W-ZKK.
002460     ADD W-SHZ TO W-SZZ.
002470     COMPUTE W-KZT = W-ZKK + W-SZZ.
002480*
002490     IF KS-DATE < W-NGP
002500         GO TO M-15.
002510     IF KS-DC = 1 OR 6
002520         MOVE "［  支  払  ］      " TO W-JNA
002530         GO TO M-20.
002540     IF KS-DC = 5
002550         MOVE "（  消費税  ）      " TO W-JNA
002560         GO TO M-20.
002570     MOVE KS-JCD TO KJ-KEY.
002580     READ KJ-M WITH UNLOCK INVALID KEY
002590         MOVE "ﾏｽﾀｰ ﾅｼ             " TO KJ-NAME.
002600     MOVE KJ-NAME TO W-JNA.
002610 M-20.
002620     ADD 2 TO W-OL W-UL.
002630     IF W-OL > 21
002640         DISPLAY D-NM
002650         GO TO M-25.
002660     DISPLAY D-P D-JNA D-ZKK D-SZZ D-KZT.
002670     IF KS-DC = 0
002680         DISPLAY D-JCD D-SU D-T D-KIN.
002690     IF KS-DC = 1
002700         DISPLAY D-KIN.
002710     IF KS-DC = 2
002720         DISPLAY D-JCD D-KIN.
002730     IF KS-DC = 5 OR 6
002740         DISPLAY D-SHZ.
002750     IF KS-SGP NOT = ZERO
002760         DISPLAY D-TSD.
002770     GO TO M-15.
002780 M-25.
002790     ACCEPT A-NEC.
002800     IF ESTAT = PF9
002810         GO TO M-90.
002820     IF ESTAT NOT = HTB AND SKP
002830         GO TO M-25.
002840*
002850     DISPLAY C-CLEAR.
002860     CALL "SCKT35".
002870     DISPLAY D-NG.
002880     MOVE 3 TO W-OL.
002890     MOVE 4 TO W-UL.
002900     GO TO M-20.
002910 M-30.
002920     DISPLAY D-EM.
002930     ACCEPT A-NEC.
002940 M-90.
002950     CLOSE KSR-F.
002960     CLOSE KJ-M.
002970 M-95.
002980     DISPLAY C-CLEAR.
002990     STOP RUN.
