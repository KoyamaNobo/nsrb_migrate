000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KHT310.
000030*********************************************************
000040*    PROGRAM         :  çHïiâ¡ó∞ÅEîpãpì`ï[Å@ñ‚çáÇπ    Å@*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCKT31                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT KNH-F ASSIGN TO KNH-MSD.
000170     SELECT KH-M ASSIGN TO KH-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS MODE RANDOM
000200         RECORD KEY KH-KEY
000210         FILE STATUS IS ERR-STAT.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON M-DATE
000240     APPLY SHARED-MODE ON KH-M
000250     APPLY EXCLUSIVE-MODE ON KNH-F.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LIBFDD.
000290     COPY LIKHM.
000300 FD  KNH-F
000310     BLOCK  4 RECORDS
000320     LABEL RECORD STANDARD
000330     VALUE OF IDENTIFICATION WK0064ID.
000340 01  KNH-R.
000350     02  KNH-NHC        PIC  9(002).
000360     02  KNH-NGP        PIC  9(008).
000370     02  KNH-NGPD  REDEFINES KNH-NGP.
000380       03  F            PIC  9(002).
000390       03  KNH-NGPS     PIC  9(006).
000400     02  KNH-HCD        PIC  X(005).
000410     02  F              PIC  X(007).
000420     02  KNH-SU         PIC S9(006)V9(02).
000430     02  KNH-T          PIC S9(006)V9(02).
000440     02  KNH-KIN        PIC S9(008).
000450     02  F              PIC  X(016).
000460     02  KNH-NRC        PIC  9(001).
000470     02  F              PIC  X(001).
000480 WORKING-STORAGE SECTION.
000490 77  W-MSG              PIC  X(040).
000500 77  WK0064ID           PIC  X(009) VALUE SPACE.
000510 01  STN-NO.
000520     02  STN-NO1        PIC  X(003).
000530     02  STN-NO2        PIC  X(003).
000540 01  W-FID.
000550     02  W-FID1         PIC  X(006) VALUE "WK0064".
000560     02  W-FID2         PIC  X(003).
000570 01  W-DATA.
000580     02  W-DATE         PIC  9(006).
000590     02  W-SDATE        PIC  9(006).
000600     02  W-EDATE        PIC  9(006).
000610     02  W-SNGP.
000620       03  W-SNEN       PIC  9(002).
000630       03  W-SGET       PIC  9(002).
000640       03  W-SPEY       PIC  9(002).
000650     02  W-SNGPD REDEFINES W-SNGP.
000660       03  W-SNG        PIC  9(004).
000670       03  F            PIC  9(002).
000680     02  W-ENGP.
000690       03  W-ENEN       PIC  9(002).
000700       03  W-EGET       PIC  9(002).
000710       03  W-EPEY       PIC  9(002).
000720     02  W-ENGPD REDEFINES W-ENGP.
000730       03  W-ENG        PIC  9(004).
000740       03  F            PIC  9(002).
000750     02  W-NG.
000760       03  W-NEN        PIC  9(002).
000770       03  W-GET        PIC  9(002).
000780     02  W-HCD          PIC  X(005).
000790     02  W-L            PIC  9(002).
000800     02  CNT            PIC  9(002).
000810     02  W-DMM          PIC  9(001).
000820     02  W-INV          PIC  9(001).
000830     02  W-DCN          PIC  N(002).
000840     02  W-NRN          PIC  N(002).
000850     02  W-HNA          PIC  N(024).
000860 01  ERR-STAT           PIC  X(002).
000870     COPY LSTAT.
000880 SCREEN SECTION.
000890 SD  C-CRT
000900     END STATUS IS ESTAT.
000910 01  C-CLEAR.
000920     02  LINE   1  CLEAR SCREEN.
000930 01  C-ACP.
000940     02  LINE   1.
000950       03  A-SNGP  COLUMN  57  PIC  9(006)
000960            USING W-SNGP  CHECK OVERFLOW NO IFC.
000970       03  A-ENGP  COLUMN  65  PIC  9(006)
000980            USING W-ENGP  CHECK OVERFLOW NO IFC.
000990     02  LINE   2.
001000       03  A-HCD   COLUMN  17  PIC  X(005)
001010            USING W-HCD   CHECK OVERFLOW NO IFC.
001020     02  A-DMM   LINE  23  COLUMN  70  PIC  9(001)
001030          USING W-DMM   CHECK OVERFLOW NO IFC.
001040 01  C-DSP.
001050     02  D-HNA   LINE   2  COLUMN  23  PIC  N(024) FROM  W-HNA.
001060     02  D-MD    LINE W-L.
001070       03  D-NGPS  COLUMN  11  PIC  9(006) FROM  KNH-NGPS.
001080       03  D-DCN   COLUMN  18  PIC  N(002) FROM  W-DCN.
001090       03  D-SU    COLUMN  23  PIC ----,--9.99  FROM  KNH-SU.
001100       03  D-T     COLUMN  35  PIC ----,--9.99  FROM  KNH-T.
001110       03  D-KIN   COLUMN  48  PIC ---,---,--9  FROM  KNH-KIN.
001120       03  D-NRM   COLUMN  60  PIC  N(002) FROM  W-NRN.
001130 01  C-ERR.
001140     02  LINE  24.
001150       03  E-ME    COLUMN  15  PIC  X(040) FROM  W-MSG.
001160       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001170       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001180       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001190            "                                                  ".
001200     COPY LIBSCR.
001210 PROCEDURE DIVISION.
001220 M-05.
001230     DISPLAY C-CLEAR.
001240     CALL "SCKT31".
001250     MOVE ZERO TO W-DATA.
001260     COPY LIBCPR.
001270     MOVE D-NKNG TO W-SNG W-ENG.
001280     MOVE 31 TO W-EPEY.
001290     MOVE 1 TO W-SPEY.
001300     ADD 1 TO W-SGET.
001310     IF W-SGET = 13
001320         MOVE 1 TO W-SGET
001330       ELSE
001340         SUBTRACT 1 FROM W-SNEN.
001350     MOVE W-SNGP TO W-SDATE.
001360     MOVE W-ENGP TO W-EDATE.
001370*
001380     CALL "CBLSTNNO" USING STN-NO.
001390     MOVE STN-NO2 TO W-FID2.
001400     MOVE W-FID TO WK0064ID.
001410     OPEN INPUT KH-M.
001420 M-10.
001430     ACCEPT A-SNGP.
001440     IF ESTAT = PF9
001450         GO TO M-95.
001460     IF ESTAT NOT = HTB AND SKP
001470         GO TO M-10.
001480     IF W-SNGP = ZERO
001490         MOVE W-SDATE TO W-SNGP
001500         GO TO M-15.
001510     IF W-SGET < 1 OR > 12
001520         GO TO M-10.
001530     IF W-SPEY < 1 OR > 31
001540         GO TO M-10.
001550 M-15.
001560     ACCEPT A-ENGP.
001570     IF ESTAT = BTB
001580         GO TO M-10.
001590     IF ESTAT NOT = HTB AND SKP
001600         GO TO M-15.
001610     IF W-ENGP = 999999
001620         MOVE W-EDATE TO W-ENGP
001630         GO TO M-17.
001640     IF W-EGET < 1 OR > 12
001650         GO TO M-15.
001660     IF W-EPEY < 1 OR > 31
001670         GO TO M-15.
001680 M-17.
001690     IF W-SNGP > W-ENGP
001700         GO TO M-15.
001710 M-20.
001720     ACCEPT A-HCD.
001730     DISPLAY E-CL.
001740     IF ESTAT = PF9
001750         GO TO M-95.
001760     IF ESTAT = BTB
001770         GO TO M-15.
001780     IF ESTAT NOT = HTB AND SKP
001790         GO TO M-20.
001800*
001810     MOVE W-HCD TO KH-KEY.
001820     READ KH-M WITH UNLOCK INVALID KEY
001830         MOVE SPACE TO W-MSG
001840         MOVE "***  À›“≤ ≈º  ***" TO W-MSG
001850         DISPLAY E-ME
001860         GO TO M-20.
001870     MOVE SPACE TO W-HNA.
001880     IF KH-KNA NOT = SPACE
001890         MOVE KH-KNA TO W-HNA
001900       ELSE
001910         MOVE KH-NAME TO W-HNA.
001920     DISPLAY D-HNA.
001930 M-30.
001940     MOVE 0 TO W-DMM.
001950     MOVE 3 TO W-L.
001960     OPEN INPUT KNH-F.
001970 M-35.
001980     READ KNH-F AT END
001990         CLOSE KNH-F
002000         MOVE SPACE TO W-MSG
002010         MOVE "***  DATA ≈º  ***" TO W-MSG
002020         DISPLAY E-ME
002030         GO TO M-70.
002040     IF KNH-NGPS < W-SNGP OR > W-ENGP
002050         GO TO M-35.
002060     IF KNH-HCD < W-HCD
002070         GO TO M-35.
002080     IF KNH-HCD > W-HCD
002090         CLOSE KNH-F
002100         MOVE SPACE TO W-MSG
002110         MOVE "***  DATA ≈º  ***" TO W-MSG
002120         DISPLAY E-ME
002130         GO TO M-70.
002140 M-40.
002150     PERFORM MEI-RTN THRU MEI-EX.
002160     IF ESTAT = PF9
002170         CLOSE KNH-F
002180         GO TO M-95.
002190     IF W-DMM = 9
002200         CLOSE KNH-F
002210         GO TO M-17.
002220 M-50.
002230     READ KNH-F AT END
002240         CLOSE KNH-F
002250         MOVE SPACE TO W-MSG
002260         MOVE "***  END DATA  ***" TO W-MSG
002270         DISPLAY E-ME
002280         GO TO M-70.
002290     IF KNH-NGPS < W-SNGP OR > W-ENGP
002300         GO TO M-50.
002310     IF KNH-HCD > W-HCD
002320         CLOSE KNH-F
002330         MOVE SPACE TO W-MSG
002340         MOVE "***  END DATA  ***" TO W-MSG
002350         DISPLAY E-ME
002360         GO TO M-70.
002370     GO TO M-40.
002380 M-70.
002390     ACCEPT A-DMM.
002400     IF ESTAT = PF9
002410         GO TO M-95.
002420     IF ESTAT NOT = HTB AND SKP
002430         GO TO M-70.
002440*
002450     DISPLAY C-CLEAR.
002460     CALL "SCKT31".
002470     DISPLAY A-SNGP A-ENGP.
002480     MOVE 3 TO W-L.
002490     DISPLAY A-HCD D-HNA.
002500     GO TO M-17.
002510 M-95.
002520     CLOSE KH-M.
002530     DISPLAY C-CLEAR.
002540     STOP RUN.
002550 MEI-RTN.
002560     ADD 1 TO W-L.
002570     IF W-L = 23
002580         GO TO MEI-100.
002590     MOVE SPACE TO W-DCN.
002600     IF KNH-NHC NOT = ZERO
002610         MOVE NC"îpãp" TO W-DCN.
002620     MOVE SPACE TO W-NRN.
002630     IF KNH-NRC = 1
002640         MOVE NC"édì¸" TO W-NRN.
002650     DISPLAY D-NGPS D-DCN D-NRM.
002660     IF KNH-SU NOT = ZERO
002670         DISPLAY D-SU.
002680     IF KNH-T NOT = ZERO
002690         DISPLAY D-T.
002700     DISPLAY D-KIN.
002710     GO TO MEI-EX.
002720 MEI-100.
002730     ACCEPT A-DMM.
002740     IF ESTAT = PF9
002750         GO TO MEI-EX.
002760     IF ESTAT NOT = HTB AND SKP
002770         GO TO MEI-100.
002780     IF W-DMM NOT = 1 AND 9
002790         GO TO MEI-100.
002800*
002810     DISPLAY C-CLEAR.
002820     CALL "SCKT31".
002830     DISPLAY A-SNGP A-ENGP.
002840     MOVE 3 TO W-L.
002850     IF W-DMM = 9
002860         GO TO MEI-EX.
002870     DISPLAY A-HCD D-HNA.
002880     GO TO MEI-RTN.
002890 MEI-EX.
002900     EXIT.
