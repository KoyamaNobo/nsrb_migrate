000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID.      JTN91U.
000030*********************************************************
000040*    受注入出荷累積Ｆ　生成  （親コード変更時）         *
000050*********************************************************
000060 ENVIRONMENT      DIVISION.
000070 CONFIGURATION    SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT     SECTION.
000110 FILE-CONTROL.
000120     SELECT JNSR ASSIGN TO JNSR-MSD
000130         ORGANIZATION IS INDEXED
000140         ACCESS MODE IS DYNAMIC
000150         RECORD KEY IS JNSR-KEY3
000160         FILE STATUS IS ERR-STAT.
000170     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000180         ORGANIZATION IS INDEXED
000190         ACCESS MODE IS DYNAMIC
000200         RECORD KEY IS HI-KEY
000210         ALTERNATE RECORD KEY IS HI-KEY2
000220         FILE STATUS IS ERR-STAT.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON JNSR
000250     APPLY SHARED-MODE ON HI-M.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LIHIM.
000290 FD  JNSR
000300     BLOCK    3     RECORDS
000310     LABEL    RECORD   STANDARD
000320     VALUE OF IDENTIFICATION "JNSR3".
000330 01  JNSR-R.
000340     02  JNSR-KEY1.
000350       03  JNSR-01              PIC  9(06)  COMP-3.
000360       03  JNSR-02              PIC  9(08)  COMP-3.
000370       03  JNSR-03              PIC  9(02).
000380       03  JNSR-04              PIC  9(06)  COMP-3.
000390       03  JNSR-05              PIC  9(01).
000400     02  JNSR-06                PIC  9(01).
000410     02  JNSR-07                PIC  9(01).
000420     02  JNSR-08.
000430       03  JNSR-081             PIC S9(04)  COMP-3    OCCURS  10.
000440     02  JNSR-09                PIC  9(01).
000450     02  JNSR-10                PIC  9(01).
000460     02  JNSR-11.
000470       03  JNSR-111             PIC  9(04).
000480       03  JNSR-112             PIC  9(03).
000490     02  JNSR-12                PIC  9(06)  COMP-3.
000500     02  JNSR-13                PIC  9(01).
000510     02  JNSR-14                PIC  9(01).
000520     02  JNSR-KEY2.
000530       03  JNSR-15.
000540         04  JNSR-151           PIC  9(06)  COMP-3.
000550         04  JNSR-152           PIC  9(01).
000560       03  JNSR-16              PIC  9(08)  COMP-3.
000570       03  JNSR-17              PIC  9(01).
000580       03  JNSR-18.
000590         04  JNSR-181           PIC  9(06)  COMP-3.
000600         04  JNSR-182           PIC  9(01).
000610     02  JNSR-KEY3.
000620       03  JNSR-19              PIC  9(04).
000630       03  JNSR-20              PIC  9(08)  COMP-3.
000640       03  JNSR-21              PIC  9(01).
000650       03  JNSR-22.
000660         04  JNSR-221           PIC  9(06)  COMP-3.
000670         04  JNSR-222           PIC  9(01).
000680     02  JNSR-23                PIC  N(09).
000690     02  JNSR-24                PIC  N(23).
000700     02  FILLER                 PIC  X(08).
000710     02  JNSR-90                PIC  9(01).
000720     02  JNSR-91                PIC  9(01).
000730     02  JNSR-92                PIC  9(02).
000740 WORKING-STORAGE  SECTION.
000750 77  ERR-STAT           PIC  X(002).
000760 77  W-FILE             PIC  X(013).
000770 77  W-MSG              PIC  X(030).
000780 77  W-KEY              PIC  9(006).
000790 01  W-DATA.
000800     02  W-END          PIC  9(001) VALUE ZERO.
000810     02  CNT            PIC  9(002).
000820     02  CHK            PIC  9(001).
000830     02  W-DMM          PIC  9(001).
000840     COPY LSTAT.
000850 SCREEN      SECTION.
000860 SD  C-CRT
000870     END  STATUS IS  ESTAT.
000880 01  C-CLEAR.
000890     02  C-CL    LINE   1  CLEAR SCREEN.
000900 01  C-MID.
000910     02  LINE   1  COLUMN  12  PIC  N(021) VALUE
000920          NC"＊＊＊　　受注入出荷累積Ｆ　変換　　＊＊＊".
000930     02  LINE  20  COLUMN  42  PIC  X(022) VALUE
000940          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000950 01  C-ACP.
000960     02  A-DMM   LINE  20  COLUMN  59  PIC  9(001)
000970          USING W-DMM   CHECK OVERFLOW NO IFC.
000980 01  C-ERR.
000990     02  LINE  24.
001000       03  E-ME    COLUMN  15  PIC  X(030) FROM  W-MSG.
001010       03  E-FILE  COLUMN  46  PIC  X(013) FROM  W-FILE.
001020     COPY LSSEM.
001030 PROCEDURE DIVISION.
001040 M-05.
001050     DISPLAY C-CLEAR.
001060     DISPLAY C-MID.
001070 M-10.
001080     ACCEPT A-DMM.
001090     IF ESTAT NOT = HTB AND SKP
001100         GO TO M-10.
001110     IF W-DMM = 9
001120         GO TO M-95.
001130     IF W-DMM NOT = 1
001140         GO TO M-10.
001150*
001160     OPEN INPUT HI-M.
001170     OPEN I-O JNSR.
001180 M-15.
001190     READ JNSR NEXT RECORD AT END
001200         GO TO M-90.
001210     MOVE JNSR-01 TO W-KEY.
001220     MOVE W-KEY TO HI-KEY.
001230     READ HI-M WITH UNLOCK INVALID KEY
001240         MOVE ZERO TO HI-MHCD HI-HCD
001250         MOVE SPACE TO W-MSG W-FILE
001260         MOVE "***  HIM ﾅｼ  ***" TO W-MSG
001270         MOVE JNSR-01 TO W-FILE
001280         DISPLAY E-ME E-FILE E-ME99
001290         CLOSE JNSR
001300         GO TO M-90.
001310     IF HI-MHCD NOT = HI-HCD
001320         MOVE HI-MHCD TO JNSR-01.
001330     REWRITE JNSR-R INVALID KEY
001340         MOVE SPACE TO W-MSG W-FILE
001350         MOVE "***  REWRITE ｴﾗｰ  ***" TO W-MSG
001360         MOVE "JNSR" TO W-FILE
001370         DISPLAY E-ME E-FILE E-ME99
001380         CLOSE JNSR
001390         GO TO M-90.
001400     GO TO M-15.
001410 M-90.
001420     CLOSE JNSR.
001430     CLOSE HI-M.
001440 M-95.
001450     DISPLAY C-CLEAR.
001460     STOP RUN.
