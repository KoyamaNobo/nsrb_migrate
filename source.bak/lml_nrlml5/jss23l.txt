000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JSS23L.
000030*********************************************************
000040*    PROGRAM         :  納品書発行（コープ九州）        *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SK-HAT ASSIGN TO HAT-RDB
000160         ORGANIZATION INDEXED
000170         ACCESS MODE  DYNAMIC
000180         RECORD KEY   HAT-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT STENM ASSIGN TO STENM-RDB
000210         ORGANIZATION INDEXED
000220         ACCESS MODE  RANDOM
000230         RECORD KEY   STE-KEY1
000240         FILE STATUS IS ERR-STAT.
000250     SELECT SNOWK ASSIGN TO SNOWK-MSD
000260         ORGANIZATION SEQUENTIAL
000270         ACCESS MODE  SEQUENTIAL
000280         FILE STATUS IS ERR-STAT.
000290     SELECT HI2-M ASSIGN TO HI2-MSD
000300         ORGANIZATION INDEXED
000310         ACCESS MODE  RANDOM
000320         RECORD KEY   HI-KEY2
000330         FILE STATUS IS ERR-STAT.
000340     SELECT SP-F ASSIGN TO P-PRN999.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON SK-HAT STENM HI2-M
000370     APPLY SHIFT-CODE  ON SP-F.
000380*
000390 DATA DIVISION.
000400 FILE SECTION.
000410 FD  SP-F
000420     LABEL RECORD IS OMITTED
000430     LINAGE IS 30 LINES.
000440 01  SP-R               PIC  X(206).
000450     COPY    LSKHAT.
000460     COPY    LSTENM.
000470     COPY    LSNOWK.
000480     COPY    LIHIM2.
000490*
000500 WORKING-STORAGE SECTION.
000510 77  SNOWK-ID           PIC  X(06)  VALUE  "SNOWK3".
000520 77  W-FILE             PIC  X(13).
000530 01  ERR-STAT           PIC  X(02).
000540 01  HEAD1.
000550     02  F              PIC  X(05)  VALUE  ""3FE04F40A0"".
000560     02  W-HEAD1.
000570*****  03  F            PIC  X(07)  VALUE  SPACE.                 D.041015
000580       03  F            PIC  X(06)  VALUE  SPACE.                 I.041015
000590       03  H-STE03      PIC  N(14).
000600     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
000610 01  HEAD2.
000620     02  F              PIC  X(05)  VALUE  ""3FE04F40A0"".
000630     02  W-HEAD2.
000640*****  03  F            PIC  X(07)  VALUE  SPACE.                 D.041015
000650       03  F            PIC  X(06)  VALUE  SPACE.                 I.041015
000660       03  H-STE04      PIC  N(14).
000670       03  H-SNO08.                                               I.040419
000680           04  H-SNO081 PIC  9(04).                               I.040419
000690           04  F        PIC  X(01)  VALUE  "-".                   I.040419
000700           04  H-SNO082 PIC  9(05).                               I.040419
000710*****  03  H-SNO081     PIC  9(04).                               D.040419
000720*****  03  F            PIC  X(01)  VALUE  "-".                   D.040419
000730*****  03  H-SNO082     PIC  9(05).                               D.040419
000740       03  F            PIC  X(11)  VALUE  SPACE.
000750       03  H-SNO051     PIC  ZZZZ999999.
000760       03  F            PIC  X(02)  VALUE  SPACE.
000770       03  H-STE05      PIC  X(06).
000780       03  F            PIC  X(08)  VALUE  SPACE.
000790       03  H-NSN        PIC  N(08).
000800       03  F            PIC  X(05)  VALUE  SPACE.
000810       03  H-SNO06.
000820         04  H-SNO061   PIC  Z9.
000830         04  H-SNO062   PIC  Z9.
000840         04  H-SNO063   PIC  Z9.
000850       03  F            PIC  X(01)  VALUE  SPACE.
000860       03  H-SNO07.
000870         04  H-SNO071   PIC  Z9.
000880         04  H-SNO072   PIC  Z9.
000890         04  H-SNO073   PIC  Z9.
000900     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
000910 01  MEI.
000920     02  F              PIC  X(05)  VALUE  ""3FE04F40A0"".
000930     02  W-MEI.
000940*****  03  F            PIC  X(05)  VALUE  SPACE.                 D.041015
000950       03  F            PIC  X(04)  VALUE  SPACE.                 I.041015
000960       03  M-SNO09      PIC  N(16).
000970       03  F            PIC  X(01)  VALUE  SPACE.
000980       03  M-SNO11      PIC  X(13).
000990       03  F            PIC  X(15)  VALUE  SPACE.
001000       03  M-SNO12      PIC  -----.
001010       03  F            PIC  X(14)  VALUE  SPACE.
001020       03  M-SNO13      PIC  Z(06).
001030       03  F            PIC  X(02)  VALUE  SPACE.
001040       03  M-SNO14      PIC  ---------.
001050       03  M-SNO15      PIC  Z(06).
001060       03  M-SNO16      PIC  ---------.
001070     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
001080 01  FOOT.
001090     02  F              PIC  X(05)  VALUE  ""3FE04F40A0"".
001100     02  W-FOOT.
001110*****  03  F            PIC  X(06)  VALUE  SPACE.                 D.041015
001120       03  F            PIC  X(05)  VALUE  SPACE.                 I.041015
001130       03  F-SNO06.
001140         04  F-SNO061   PIC  Z9.
001150         04  F-S1       PIC  X(01).
001160         04  F-SNO062   PIC  Z9.
001170         04  F-S2       PIC  X(01).
001180         04  F-SNO063   PIC  Z9.
001190         04  F          PIC  X(03).
001200         04  F-SNO191   PIC  X(03).
001210       03  F            PIC  X(38)  VALUE  SPACE.
001220       03  F-SURYO      PIC  -----.
001230       03  F            PIC  X(22)  VALUE  SPACE.
001240       03  F-GENKA      PIC  ---------.
001250       03  F            PIC  X(06)  VALUE  SPACE.
001260       03  F-BIKO       PIC  ---------.
001270     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
001280 01  FOOT1.
001290     02  F              PIC  X(05)  VALUE  ""3FE04F40A0"".
001300     02  W-FOOT1.
001310*****  03  F            PIC  X(06)  VALUE  SPACE.                 D.041015
001320       03  F            PIC  X(05)  VALUE  SPACE.                 I.041015
001330       03  F-SNO17      PIC  N(10).
001340       03  F            PIC  X(15)  VALUE  SPACE.
001350       03  F-SNO051D.
001360         04  F-SNO051   PIC  ZZZZ999999.
001370     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
001380 01  W-SCR.
001390     02  W-YMD.
001400       03  W-YEAR       PIC  9(04).
001410       03  W-MONTH      PIC  9(02).
001420       03  W-DAY        PIC  9(02).
001430     02  W-PRNT         PIC  9(01).
001440     02  W-TEST         PIC  9(01).
001450     02  W-DDM          PIC  9(01).
001460     02  W-FROM         PIC  9(06).
001470     02  W-TO           PIC  9(06).
001480 01  W-SYSDATE.
001490     02  W-SYSYMD       PIC  9(08).
001500     02  F              REDEFINES    W-SYSYMD.
001510       03  W-SYSY       PIC  9(04).
001520       03  W-SYSM       PIC  9(02).
001530       03  W-SYSD       PIC  9(02).
001540 01  W-DATA.
001550     02  W-FLG          PIC  9(01).
001560     02  CNT            PIC  9(02).
001570     02  W-GNO          PIC  9(01).
001580     02  W-NNO          PIC  9(10).
001590     02  W-KIKAKU       PIC  N(23).
001600     02  W-HCB.
001610       03  F            PIC  9(02).
001620       03  W-HYY        PIC  9(02).
001630       03  W-HMM        PIC  9(02).
001640       03  W-HDD        PIC  9(02).
001650     02  W-CRGD.
001660       03  W-CRG        PIC  X(03).
001670       03  F            PIC  X(10).
001680     02  W-SURYO        PIC S9(04).
001690     02  W-GENKA        PIC S9(09).
001700     02  W-BIKO         PIC S9(09).
001710 01  W-OLD.
001720     02  O-TYCD         PIC  9(07).
001730     02  O-KICD         PIC  9(07).
001740     02  O-HATNO        PIC  9(06).
001750     COPY    LWSIZC.
001760     COPY    LSTAT.
001770     COPY    LWMSG.
001780*
001790 SCREEN SECTION.
001800 SD  C-CRT
001810     END STATUS ESTAT.
001820 01  C-CLEAR.
001830     02  LINE   1  CLEAR SCREEN.
001840 01  ACP-AREA.
001850     02  LINE  06.
001860       03  A-YEAR      COLUMN  31    PIC  9(02)
001870           USING  W-YEAR     NO IFC.
001880       03  A-MONTH     COLUMN  35    PIC  9(02)
001890           USING  W-MONTH    NO IFC.
001900       03  A-DAY       COLUMN  39    PIC  9(02)
001910           USING  W-DAY      CHECK  OVERFLOW  NO IFC.
001920     02  A-PRNT     LINE  09    COLUMN  42  PIC  9(01)
001930         USING  W-PRNT     CHECK  OVERFLOW  NO IFC.
001940     02  A-TEST     LINE  12    COLUMN  42  PIC  9(01)
001950         USING  W-TEST     CHECK  OVERFLOW  NO IFC.
001960     02  A-DDM      LINE  23    COLUMN  66  PIC  9(01)
001970         USING  W-DDM      CHECK  OVERFLOW  NO IFC.
001980     02  A-FROM     LINE  15    COLUMN  31  PIC  9(06)
001990         USING  W-FROM     CHECK  OVERFLOW  NO IFC.
002000     02  A-TO       LINE  16    COLUMN  31  PIC  9(06)
002010         USING  W-TO       CHECK  OVERFLOW  NO IFC.
002020 01  CLR-AREA.
002030     02  C-FROM  LINE 15  COLUMN 31  PIC Z(06)  FROM W-FROM.
002040     02  C-TO    LINE 16  COLUMN 31  PIC Z(06)  FROM W-TO.
002050 01  DSP-AREA.
002060     02  LINE  01.
002070       03  D-TITLE     COLUMN  16    PIC  N(19)  VALUE
002080           NC"＊＊＊　　生協　納品書　発行　　＊＊＊".
002090       03  D-SYSYMD    COLUMN  63    PIC  N(05)  VALUE
002100           NC"年　月　日".
002110       03  D-SYSY      COLUMN  61    PIC  9(02)
002120           FROM   W-SYSY.
002130       03  D-SYSM      COLUMN  65    PIC  9(02)
002140           FROM   W-SYSM.
002150       03  D-SYSD      COLUMN  69    PIC  9(02)
002160           FROM   W-SYSD.
002170     02  D-COPE     LINE  03    COLUMN  19  PIC  N(14)  VALUE
002180       NC"【コープ九州　　　　　　　】".
002190     02  LINE  06.
002200       03  D-YMD       COLUMN  21    PIC  X(22)  VALUE
002210         "納  期 ：   年  月  日".
002220     02  D-PRNT     LINE  08    COLUMN  21  PIC  N(05)  VALUE
002230       NC"１　発　行".
002240     02  LINE  09.
002250       03  D-REPRNT    COLUMN  21    PIC  N(05)  VALUE
002260         NC"２　再発行".
002270       03  D-SEL       COLUMN  36    PIC  X(08)  VALUE
002280           "選択 [ ]".
002290     02  D-TEST     LINE  11    COLUMN  21  PIC  N(05)  VALUE
002300       NC"テスト印字".
002310     02  D-YN       LINE  12    COLUMN  26  PIC  X(18)  VALUE
002320         "(YES=1,NO=2)   [ ]".
002330     02  D-FT.
002340         03  LINE 14 COLUMN 31 VALUE "発注№".
002350         03  LINE 15 COLUMN 21 VALUE "ＦＲＯＭ".
002360         03  LINE 16 COLUMN 21 VALUE "ＴＯ".
002370     02  D-DDM      LINE  23    COLUMN  50  PIC  X(21)  VALUE
002380           "確認 OK=1 NO=9   ﾘﾀｰﾝ".
002390 01  MSG-AREA.
002400     02  M-ERR01    LINE  24    COLUMN  15  PIC  N(09)  VALUE
002410         NC"印字対象データなし".
002420     02  M-ERR11    LINE  24    COLUMN  15  PIC  X(28)  VALUE     I.041225
002430         "社店マスタなし    継続 : ESC".                          I.041225
002440     COPY    LSSEM.
002450     COPY    LSMSG.
002460*
002470 PROCEDURE DIVISION.
002480 MAIN-01.
002490     PERFORM    INIT-RTN  THRU  INIT-EX.
002500 MAIN-02.
002510     PERFORM    ACP-RTN  THRU  ACP-EX.
002520     IF  W-FLG = 9
002530         MOVE     255  TO  COMPLETION-CODE
002540     ELSE
002550         PERFORM    LST-RTN  THRU  LST-EX
002560         IF  W-FLG = 5
002570             MOVE     0  TO  W-FLG
002580             GO TO    MAIN-02.
002590 MAIN-05.
002600     PERFORM    END-RTN  THRU  END-EX.
002610     STOP RUN.
002620*
002630*-----初期処理-----*
002640 INIT-RTN.
002650     DISPLAY    C-CLEAR.
002660     ACCEPT     W-SYSYMD  FROM  DATE.
002670     ADD     2000  TO  W-SYSY.
002680     DISPLAY    DSP-AREA.
002690     INITIALIZE    W-DATA  W-SCR.
002700     MOVE    1   TO  W-PRNT  W-TEST.
002710 INIT-EX.
002720     EXIT.
002730*
002740*-----終了処理-----*
002750 END-RTN.
002760     IF  W-FLG NOT = 9
002770         CLOSE    SK-HAT  STENM  SNOWK  HI2-M.
002780     DISPLAY    C-CLEAR.
002790 END-EX.
002800     EXIT.
002810*
002820*-----画面処理-----*
002830 ACP-RTN.
002840 ACP-01.
002850     INITIALIZE    W-YEAR.
002860     ACCEPT     A-YEAR.
002870     DISPLAY    E-CL.
002880     IF  ESTAT = PF9
002890         MOVE     9  TO  W-FLG
002900         GO TO    ACP-EX.
002910     IF  ESTAT NOT = HTB AND SKP AND NOC
002920         GO TO    ACP-01.
002930     ADD    2000  TO  W-YEAR.
002940 ACP-02.
002950     ACCEPT    A-MONTH.
002960     IF  ESTAT = BTB
002970         GO TO    ACP-01.
002980     IF  ESTAT NOT = HTB AND SKP AND NOC
002990         GO TO    ACP-02.
003000     IF  W-MONTH > 12
003010         GO TO    ACP-02.
003020 ACP-03.
003030     ACCEPT    A-DAY.
003040     IF  ESTAT = BTB
003050         GO TO    ACP-02.
003060     IF  ESTAT NOT = HTB AND SKP
003070         GO TO    ACP-03.
003080     IF  W-YMD = "20000000"
003090         MOVE    W-SYSYMD  TO  W-YMD
003100         DISPLAY    A-YEAR A-MONTH A-DAY.
003110     IF  W-DAY = 00
003120         GO TO    ACP-03.
003130     IF  W-MONTH = 02
003140         IF  W-DAY > 29
003150             GO TO    ACP-03
003160         ELSE
003170             GO TO    ACP-04.
003180     IF  W-MONTH = 04 OR 06 OR 09 OR 11
003190         IF  W-DAY > 30
003200             GO TO    ACP-03
003210         ELSE
003220             GO TO    ACP-04.
003230     IF  W-MONTH = 01 OR 03 OR 05 OR 07 OR 08 OR 10 OR 12
003240         IF  W-DAY > 31
003250             GO TO    ACP-03
003260         END-IF
003270     ELSE
003280         GO TO    ACP-02.
003290 ACP-04.
003300     DISPLAY    A-PRNT.
003310     ACCEPT     A-PRNT.
003320     IF  ESTAT = BTB
003330         GO TO    ACP-03.
003340     IF  ESTAT NOT = HTB AND SKP
003350         GO TO    ACP-04.
003360     IF  W-PRNT NOT = 1 AND 2
003370         GO TO    ACP-04.
003380 ACP-05.
003390     DISPLAY    A-TEST.
003400     ACCEPT     A-TEST.
003410     IF  ESTAT = BTB
003420         GO TO    ACP-04.
003430     IF  ESTAT NOT = HTB AND SKP
003440         GO TO    ACP-05.
003450     IF  W-TEST NOT = 1 AND 2
003460         GO TO    ACP-05.
003470     IF  W-TEST = 1                                               I.040322
003480         PERFORM    TEST-RTN  THRU  TEST-EX                       I.040322
003490         GO TO    ACP-05.                                         I.040322
003500 ACP-06.
003510     IF  W-PRNT NOT = 2
003520         MOVE  ZERO     TO W-FROM W-TO
003530         DISPLAY C-FROM C-TO
003540         GO  TO  ACP-99.
003550*
003560     ACCEPT     A-FROM.
003570     IF  ESTAT = BTB
003580         GO TO    ACP-05.
003590     IF  ESTAT NOT = HTB AND SKP
003600         GO TO    ACP-06.
003610 ACP-07.
003620     ACCEPT     A-TO.
003630     IF  ESTAT = BTB
003640         GO TO    ACP-06.
003650     IF  ESTAT NOT = HTB AND SKP
003660         GO TO    ACP-07.
003670     IF  W-FROM > W-TO
003680         GO TO    ACP-07.
003690 ACP-99.
003700     ACCEPT    A-DDM.
003710     IF  ESTAT = BTB
003720         IF  W-PRNT NOT = 2
003730             GO TO    ACP-05
003740         ELSE
003750             GO TO    ACP-07.
003760     IF  ESTAT = PF9
003770         MOVE     9  TO  W-FLG
003780         GO TO    ACP-EX.
003790     IF  ESTAT NOT = HTB AND SKP
003800         GO TO    ACP-99.
003810     IF  W-DDM = 9
003820         MOVE     9  TO  W-FLG
003830     ELSE
003840         IF  W-DDM NOT = 1
003850             GO TO    ACP-99.                                     I.040322
003860 ACP-EX.
003870     EXIT.
003880*
003890*----出力処理-----*
003900 LST-RTN.
003910     OPEN I-O       SK-HAT.
003920     OPEN INPUT     STENM  HI2-M.
003930     OPEN OUTPUT    SNOWK.
003940     MOVE    0  TO  W-NNO  W-GNO.
003950     IF  W-PRNT = 1
003960         MOVE    0         TO  W-FLG
003970         MOVE    ZERO      TO  W-FROM
003980         MOVE    999999    TO  W-TO
003990     ELSE
004000         MOVE    1  TO  W-FLG.
004010     SELECT    SK-HAT
004020         WHERE    HAT-041 = 3240 AND HAT-03 = W-YMD
004030              AND HAT-99  = 0    AND HAT-97 = W-FLG
004040              AND HAT-01  NOT <  W-FROM
004050              AND HAT-01  NOT >  W-TO
004060         ORDER BY    HAT-04 HAT-18 HAT-01 HAT-02.
004070     MOVE    5  TO  W-FLG.
004080 LST-01.
004090     READ    SK-HAT    NEXT RECORD  WITH UNLOCK
004100         AT END    SCRATCH    SK-HAT
004110                   GO TO    LST-02.
004120     IF  HAT-11 = 0
004130         GO TO    LST-01.
004140     MOVE    HAT-07  TO  SIZE-WK-HIN.
004150     MOVE    HAT-08  TO  SIZE-WK-CD.
004160     PERFORM    SIZE-RTN  THRU  SIZE-EX.
004170     IF  SIZE-WK-SW NOT = 0
004180         GO TO    LST-01.
004190     MOVE    0  TO  W-FLG.
004200     PERFORM    WSNOWK-RTN  THRU  WSNOWK-EX.
004210     GO TO    LST-01.
004220 LST-02.
004230     CLOSE    SNOWK.
004240     IF  W-FLG = 5
004250         DISPLAY    M-ERR01  DISP-BUZ-B
004260         CLOSE    SK-HAT  STENM  HI2-M
004270         GO TO    LST-EX.
004280     OPEN INPUT     SNOWK.
004290     OPEN OUTPUT    SP-F.
004300     READ    SNOWK    NEXT RECORD  WITH UNLOCK
004310         AT END    GO TO    LST-99.
004320     MOVE    99  TO  CNT.
004330     MOVE    SNO-03  TO  O-HATNO.
004340     MOVE    SNO-04  TO  W-GNO.
004350     PERFORM    HEAD-RTN  THRU  HEAD-EX.
004360 LST-03.
004370     INITIALIZE    W-MEI.
004380     MOVE     SNO-091  TO  M-SNO09.
004390     MOVE     SNO-11   TO  M-SNO11.
004400     MOVE     SPACE    TO  SP-R.
004410     MOVE     MEI      TO  SP-R.
004420     WRITE    SP-R.
004430     INITIALIZE     W-MEI.
004440     MOVE     SNO-092  TO  M-SNO09.
004450     MOVE     SNO-10   TO  M-SNO09(11:04).
004460     MOVE     SNO-19   TO  M-SNO11.
004470     MOVE     SNO-12   TO  M-SNO12.
004480     MOVE     SNO-13   TO  M-SNO13.
004490     MOVE     SNO-14   TO  M-SNO14.
004500     MOVE     SNO-15   TO  M-SNO15.
004510     MOVE     SNO-16   TO  M-SNO16.
004520     MOVE     SPACE    TO  SP-R.
004530     MOVE     MEI      TO  SP-R.
004540     WRITE    SP-R.
004550     ADD    2  TO  CNT.
004560     ADD    SNO-12  TO  W-SURYO.
004570     ADD    SNO-14  TO  W-GENKA.
004580     ADD    SNO-16  TO  W-BIKO.
004590     READ    SNOWK  NEXT RECORD  WITH UNLOCK
004600         AT END    PERFORM    RHAT-RTN  THRU  RHAT-EX
004610                   PERFORM    FOOT-RTN  THRU  FOOT-EX
004620                   GO TO    LST-99.
004630     IF  W-PRNT = 1
004640         IF  NOT(SNO-03 = O-HATNO AND SNO-04 = W-GNO)
004650             PERFORM    RHAT-RTN  THRU  RHAT-EX.                  I.040419
004660*****        PERFORM    RHAT-RTN  THRU  RHAT-EX                   D.040419
004670*****        MOVE    SNO-03  TO  O-HATNO                          D.040419
004680*****        MOVE    SNO-04  TO  W-GNO.                           D.040419
004690*****IF  W-NNO = SNO-051                                          D.040419
004700     IF  O-HATNO  =  SNO-03                                       I.040419
004710         MOVE    SNO-04  TO  W-GNO                                I.040419
004720         GO TO    LST-03
004730     ELSE
004740         PERFORM    FOOT-RTN  THRU  FOOT-EX
004750         PERFORM    HEAD-RTN  THRU  HEAD-EX
004760         MOVE    SNO-03  TO  O-HATNO                              I.040419
004770         MOVE    SNO-04  TO  W-GNO                                I.040419
004780         GO TO    LST-03.
004790 LST-99.
004800     CLOSE    SP-F.
004810 LST-EX.
004820     EXIT.
004830*
004840*-----ヘッダー印字処理-----*
004850 HEAD-RTN.
004860     IF  CNT NOT = 99
004870         MOVE     SPACE  TO  SP-R
004880         WRITE    SP-R   AFTER  PAGE.
004890     MOVE    ZERO     TO  W-HCB.
004900     MOVE    SPACE    TO  W-CRGD.
004910     MOVE    SNO-051  TO  W-NNO.
004920     MOVE    SNO-17   TO  W-KIKAKU.
004930     MOVE    SNO-06   TO  W-HCB.
004940     MOVE    SNO-11   TO  W-CRGD.
004950     MOVE    SNO-08   TO  STE-02.
004960     READ    STENM    WITH UNLOCK
004970         INVALID KEY                                              I.041225
004980         DISPLAY  M-ERR11  E-ME99                                 I.041225
004990         INITIALIZE    STE-R.                                     I.041225
005000*****    INVALID KEY    INITIALIZE    STE-R.                      D.041225
005010     INITIALIZE    W-HEAD1.
005020     MOVE     STE-03(01:13)   TO  H-STE03.
005030     MOVE     SPACE    TO  SP-R.
005040     MOVE     HEAD1    TO  SP-R.
005050     WRITE    SP-R    AFTER  5.
005060     MOVE     SPACE    TO  SP-R.
005070     MOVE     STE-04(01:13)   TO  H-STE04.
005080     IF  SNO-08    NOT =  "999999999"                             I.040419
005090         MOVE     SNO-081  TO  H-SNO081                           I.040419
005100         MOVE     SNO-082  TO  H-SNO082                           I.040419
005110       ELSE                                                       I.040419
005120         MOVE     SPACE    TO  H-SNO08.                           I.040419
005130*****MOVE     SNO-081  TO  H-SNO081.                              D.040419
005140*****MOVE     SNO-082  TO  H-SNO082.                              D.040419
005150     MOVE     SNO-051  TO  H-SNO051.
005160     MOVE     STE-05   TO  H-STE05.
005170     MOVE     NC"日進ゴム株式会社"  TO  H-NSN.
005180     MOVE     SNO-061(03:02)   TO  H-SNO061.
005190     MOVE     SNO-062  TO  H-SNO062.
005200     MOVE     SNO-063  TO  H-SNO063.
005210     MOVE     SNO-071(03:02)   TO  H-SNO071.
005220     MOVE     SNO-072  TO  H-SNO072.
005230     MOVE     SNO-073  TO  H-SNO073.
005240     MOVE     SPACE    TO  SP-R.
005250     MOVE     HEAD2    TO  SP-R.
005260     WRITE    SP-R     AFTER  2.
005270     MOVE     SPACE    TO  SP-R.
005280     WRITE    SP-R     AFTER  3.
005290     MOVE     ZERO     TO  W-SURYO  W-GENKA  W-BIKO  CNT.
005300 HEAD-EX.
005310     EXIT.
005320*
005330*-----フッター印字処理-----*
005340 FOOT-RTN.
005350     MOVE     SPACE  TO  SP-R.
005360     COMPUTE    CNT = 13 - CNT.
005370     WRITE    SP-R   AFTER  CNT.
005380     INITIALIZE    W-FOOT.
005390     MOVE     SPACE  TO  F-SNO06.
005400     MOVE     W-SURYO  TO  F-SURYO.
005410     MOVE     W-GENKA  TO  F-GENKA.
005420     MOVE     W-BIKO   TO  F-BIKO.
005430     MOVE     SPACE    TO  SP-R.
005440     MOVE     FOOT     TO  SP-R.
005450     WRITE    SP-R.
005460     MOVE     SPACE    TO  SP-R.
005470*
005480     INITIALIZE    W-FOOT.
005490     MOVE     SPACE  TO  F-SNO06.
005500     IF  W-HCB     NOT =  ZERO
005510         MOVE  "/"        TO  F-S1  F-S2
005520         MOVE  W-HYY      TO  F-SNO061
005530         MOVE  W-HMM      TO  F-SNO062
005540         MOVE  W-HDD      TO  F-SNO063.
005550     MOVE     W-CRG  TO  F-SNO191.
005560     MOVE     SPACE  TO  SP-R.
005570     MOVE     FOOT   TO  SP-R.
005580     WRITE    SP-R   AFTER  2.
005590     INITIALIZE    W-FOOT1.
005600     MOVE     W-KIKAKU(01:10)  TO  F-SNO17.
005610     MOVE     SPACE  TO  F-SNO051D.
005620     MOVE     SPACE  TO  SP-R.
005630     MOVE     FOOT1  TO  SP-R.
005640     WRITE    SP-R.
005650     INITIALIZE    W-FOOT1.
005660     MOVE     W-KIKAKU(11:10)  TO  F-SNO17.
005670     MOVE     W-NNO  TO  F-SNO051.
005680     MOVE     SPACE  TO  SP-R.
005690     MOVE     FOOT1  TO  SP-R.
005700     WRITE    SP-R.
005710     MOVE     SPACE  TO  SP-R.
005720 FOOT-EX.
005730     EXIT.
005740*
005750*-----テスト印字処理-----*
005760 TEST-RTN.
005770     OPEN OUTPUT    SP-F.
005780     INITIALIZE     W-HEAD1.
005790     MOVE     ALL "X"  TO  H-STE03(01:13).
005800     MOVE     SPACE  TO  SP-R.
005810     MOVE     HEAD1  TO  SP-R.
005820     WRITE    SP-R   AFTER  5.
005830     MOVE     SPACE  TO  SP-R.
005840     MOVE     ALL "X"  TO  H-STE04(01:13)  H-NSN.
005850     MOVE     ALL "9"  TO  H-SNO081  H-SNO082
005860                           H-STE05   H-SNO06   H-SNO07.
005870     MOVE     999999 TO  H-SNO051.
005880     MOVE     SPACE  TO  SP-R.
005890     MOVE     HEAD2  TO  SP-R.
005900     WRITE    SP-R   AFTER  2.
005910     MOVE     SPACE  TO  SP-R.
005920     WRITE    SP-R   AFTER  3.
005930     MOVE     1  TO  CNT.
005940 TEST-01.
005950     INITIALIZE    W-MEI.
005960     MOVE     ALL "X"  TO  M-SNO09  M-SNO11.
005970     MOVE     SPACE  TO  SP-R.
005980     MOVE     MEI    TO  SP-R.
005990     WRITE    SP-R.
006000     INITIALIZE    W-MEI.
006010     MOVE     ALL "X"  TO  M-SNO09  M-SNO11.
006020     MOVE     ALL "9"  TO  M-SNO12  M-SNO13  M-SNO14
006030                           M-SNO15  M-SNO16.
006040     MOVE     SPACE    TO  SP-R.
006050     MOVE     MEI      TO  SP-R.
006060     WRITE    SP-R.
006070     IF  CNT < 6
006080         ADD    1  TO  CNT
006090         GO TO     TEST-01.
006100     INITIALIZE    W-FOOT.
006110     MOVE     SPACE  TO  F-SNO06.
006120     MOVE     ALL "9"  TO  F-SURYO  F-GENKA  F-BIKO.
006130     MOVE     SPACE  TO  SP-R.
006140     MOVE     FOOT   TO  SP-R.
006150     WRITE    SP-R   AFTER  2.
006160     MOVE     SPACE  TO  SP-R.
006170     WRITE    SP-R.
006180     MOVE     SPACE  TO  SP-R.
006190     INITIALIZE    W-FOOT  W-FOOT1.
006200     MOVE       "/"  TO  F-S1  F-S2.
006210     MOVE   ALL "9"   TO  F-SNO061 F-SNO062 F-SNO063 F-SNO191.
006220     MOVE     ALL "X"  TO  F-SNO17.
006230     MOVE     1  TO  CNT.
006240 TEST-02.
006250     IF  CNT = 3
006260         MOVE 999999 TO  F-SNO051
006270       ELSE
006280         MOVE  SPACE TO  F-SNO051D.
006290     MOVE     SPACE  TO  SP-R.
006300     IF  CNT = 1
006310         MOVE     FOOT   TO  SP-R
006320       ELSE
006330         MOVE     FOOT1  TO  SP-R.
006340     WRITE    SP-R.
006350     MOVE     SPACE  TO  SP-R.
006360     IF  CNT < 3
006370         ADD    1  TO  CNT
006380         GO TO    TEST-02.
006390     MOVE     SPACE  TO  SP-R.
006400     CLOSE    SP-F.
006410 TEST-EX.
006420     EXIT.
006430*
006440*-----生協納品書ワーク３追加処理-----*
006450 WSNOWK-RTN.
006460     MOVE    HAT-04  TO  SNO-01.
006470     MOVE    HAT-18  TO  SNO-02.
006480     MOVE    HAT-01  TO  SNO-03.
006490     MOVE    HAT-02  TO  SNO-04  SNO-052.
006500     MOVE    HAT-23  TO  SNO-051.
006510     MOVE    HAT-10  TO  SNO-06.
006520     MOVE    HAT-03  TO  SNO-07.
006530     MOVE    HAT-06  TO  SNO-08.
006540     MOVE    HAT-09  TO  SNO-09.
006550     MOVE    SIZE-WK-NM  TO  SNO-10.
006560     MOVE    HAT-15  TO  SNO-11.
006570     MOVE    HAT-13  TO  SNO-13.
006580     MOVE    HAT-14  TO  SNO-15.
006590     MOVE    HAT-19  TO  SNO-17.
006600     MOVE    HAT-15  TO  SNO-11.
006610     MOVE    HAT-24  TO  SNO-18.
006620     MOVE    HAT-26  TO  SNO-19.
006630     IF  HAT-24 = 0
006640         MOVE    HAT-11  TO  SNO-12
006650     ELSE
006660         COMPUTE    SNO-12 = HAT-11 * (-1).
006670     COMPUTE    SNO-14 = SNO-13 * SNO-12.
006680     COMPUTE    SNO-16 = SNO-15 * SNO-12.
006690     WRITE    SNO-R.
006700     IF  ERR-STAT NOT = "00"
006710         MOVE    "W"       TO  ERR-M
006720         MOVE    "SNOWK"   TO  ERR-F
006730         MOVE    SNO-R     TO  ERR-K
006740         PERFORM    ERR-RTN  THRU  ERR-EX.
006750 WSNOWK-EX.
006760     EXIT.
006770*
006780*-----生協　発注データ修正処理-----*
006790 RHAT-RTN.
006800     MOVE    O-HATNO  TO  HAT-01.
006810     MOVE    W-GNO    TO  HAT-02.
006820     READ    SK-HAT
006830         INVALID KEY    GO TO    RHAT-EX.
006840     MOVE    1  TO  HAT-97.
006850     REWRITE    HAT-R
006860         INVALID KEY    MOVE    "R"        TO  ERR-M
006870                        MOVE    "SK-HAT"   TO  ERR-F
006880                        MOVE    HAT-KEY    TO  ERR-K
006890                        PERFORM    ERR-RTN  THRU  ERR-EX.
006900 RHAT-EX.
006910     EXIT.
006920*
006930***
006940     COPY    LPSIZC.
006950     COPY    LPMSG.
