000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JHS11U.
000030********************************************************
000040*****    受注受信データＥＤＩ累積・更新（ワークマン）***
000050********************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT WMJCF ASSIGN TO WMJC-MSD
000130         FILE STATUS IS ERR-STAT.
000140     SELECT WMJCRF ASSIGN TO WMJCR-MSD
000150         FILE STATUS IS ERR-STAT.
000160     SELECT TDNWF ASSIGN TO TDNW-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY TDNW1-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT TDNWRF ASSIGN TO TDNWR-MSD.
000220 DATA DIVISION.
000230 FILE SECTION.
000240     COPY LSWMJC.
000250     COPY LITDNW.
000260 FD  WMJCRF
000270     BLOCK  3 RECORDS
000280     LABEL RECORD IS STANDARD
000290     VALUE OF IDENTIFICATION "WMJCRF".
000300 01  WMJCR-R.
000310     02  WMJCR-R1     PIC  X(1301).
000320     02  WMJCR-NGP    PIC  9(006).
000330 FD  TDNWRF
000340     BLOCK  1 RECORDS
000350     LABEL RECORD IS STANDARD
000360     VALUE OF IDENTIFICATION "TDNWRF".
000370 01  TDNWR-R.
000380     02  TDNWR-KEY    PIC  X(020).
000390     02  F            PIC  X(227).
000400     02  TDNWR-DATE   PIC  9(008).
000410     02  F            PIC  X(001).
000420 WORKING-STORAGE SECTION.
000430 77  ERR-STAT         PIC  X(002).
000440 77  W-FILE           PIC  X(013).
000450 01  W-DATA.
000460     02  W-DMM        PIC  9(001).
000470     02  W-KEY.
000480       03  W-STC.
000490         04  W-STC1   PIC  9(004).
000500         04  W-STC2   PIC  9(005).
000510       03  W-DNO.
000520         04  F        PIC  9(002).
000530         04  W-DNOD   PIC  9(007).
000540       03  W-DGN      PIC  9(002).
000550     02  CNT1         PIC  9(002).
000560     02  CNT2         PIC  9(002).
000570     02  CNT3         PIC  9(002).
000580     02  W-NGPL.
000590       03  W-NEN1     PIC  9(002).
000600       03  W-DATE.
000610         04  W-NEN2   PIC  9(002).
000620         04  W-GETD   PIC  9(002).
000630         04  F        PIC  9(002).
000640     02  W-SNGP       PIC  9(006).
000650     02  W-NGP.
000660       03  F          PIC  9(002).
000670       03  W-NGPS     PIC  9(006).
000680       03  W-NGPD  REDEFINES W-NGPS.
000690         04  W-NEN    PIC  9(002).
000700         04  W-GET    PIC  9(002).
000710         04  W-PEY    PIC  9(002).
000720     02  W-DDDD  REDEFINES W-NGP.
000730       03  W-DDD   OCCURS   8.
000740         04  W-DD     PIC  X(001).
000750     02  W-MDDD.
000760       03  W-MDD   OCCURS  10.
000770         04  W-MD     PIC  X(001).
000780     COPY LSTAT.
000790 SCREEN SECTION.
000800 SD  C-CRT
000810     END STATUS IS ESTAT.
000820 01  C-CLEAR.
000830     02  LINE   1  CLEAR SCREEN.
000840 01  C-MID.
000850     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
000860          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000870     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
000880          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000890     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
000900          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
000910     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
000920          NC"＊＊＊　　受注受信データ累積・更新　　＊＊＊".
000930     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
000940          NC"＊＊＊　　（ワークマンＥＤＩ）　　　　＊＊＊".
000950     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
000960          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000970     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
000980          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000990 01  C-ERR.
001000     02  LINE  24.
001010       03  E-ME1   COLUMN  15  PIC  N(006) VALUE
001020            NC"データ　なし".
001030       03  E-ME2   COLUMN  15  PIC  N(007) VALUE
001040            NC"日付エラー　１".
001050       03  E-ME3   COLUMN  15  PIC  N(007) VALUE
001060            NC"日付エラー　２".
001070       03  E-ME4   COLUMN  15  PIC  N(005) VALUE
001080            NC"行　エラー".
001090       03  E-ME5   COLUMN  15  PIC  X(025) VALUE
001100            "***  TDNWF WRITE ｴﾗｰ  ***".
001110       03  E-ME6   COLUMN  15  PIC  X(026) VALUE
001120            "***  WMJCRF WRITE ｴﾗｰ  ***".
001130       03  E-ME7   COLUMN  15  PIC  N(005) VALUE
001140            NC"重複エラー".
001150       03  E-KEYW  COLUMN  45  PIC  X(020) FROM  W-KEY.
001160       03  E-KEY   COLUMN  45  PIC  X(020) FROM  TDNW1-KEY.
001170       03  E-MD    COLUMN  33  PIC  X(010) FROM  W-MDDD.
001180     COPY LSSEM.
001190 PROCEDURE DIVISION.
001200 M-05.
001210     DISPLAY C-CLEAR.
001220     DISPLAY C-MID.
001230*
001240     ACCEPT W-SNGP FROM DATE.
001250     PERFORM CHK-RTN THRU CHK-EX.
001260     IF COMPLETION-CODE = 255
001270         GO TO M-95.
001280     OPEN INPUT WMJCF.
001290 M-15.
001300     READ WMJCF AT END
001310         MOVE 255 TO COMPLETION-CODE
001320         CLOSE WMJCF
001330         DISPLAY E-ME1 E-ME99
001340         GO TO M-95.
001350*
001360     OPEN EXTEND WMJCRF.
001370 M-25.
001380     INITIALIZE WMJCR-R.
001390     MOVE WMJC-R TO WMJCR-R1.
001400     MOVE W-SNGP TO WMJCR-NGP.
001410     WRITE WMJCR-R.
001420     IF ERR-STAT = "00"
001430         GO TO M-30.
001440     DISPLAY E-STAT E-ME6 E-ME99.
001450     IF ERR-STAT NOT = "34"
001460         MOVE 255 TO COMPLETION-CODE
001470         CLOSE WMJCF
001480         CLOSE WMJCRF
001490         DISPLAY E-ME78 E-ME99
001500         GO TO M-95.
001510     DISPLAY E-CL.
001520     CLOSE WMJCRF.
001530     MOVE "WMJCRF       " TO W-FILE.
001540     DISPLAY E-ME71 E-ME98 STOP " ".
001550     DISPLAY E-CL.
001560     OPEN EXTEND WMJCRF.
001570     GO TO M-25.
001580 M-30.
001590     READ WMJCF AT END
001600         GO TO M-35.
001610     GO TO M-25.
001620 M-35.
001630     CLOSE WMJCF.
001640     CLOSE WMJCRF.
001650*
001660     OPEN INPUT WMJCF.
001670     OPEN I-O TDNWF.
001680 M-40.
001690     READ WMJCF AT END
001700         GO TO M-90.
001710     IF WMJC-107 NOT = 1
001720         GO TO M-55.
001730*
001740     INITIALIZE TDNW-R1.
001750     MOVE ZERO TO TDNW1-KEY.
001760     MOVE WMJC-029 TO TDNW1-STC1.
001770     MOVE WMJC-043 TO TDNW1-STC2.
001780     MOVE WMJC-037 TO TDNW1-DNO.
001790     MOVE 0 TO TDNW1-DGN.
001800     MOVE WMJC-077 TO TDNW1-BC.
001810     MOVE WMJC-086 TO TDNW1-SHC.
001820     MOVE WMJC-092 TO TDNW1-DPC.
001830*
001840     MOVE SPACE TO W-MDDD.
001850     MOVE ZERO TO W-NGP.
001860     MOVE WMJC-079 TO W-MDDD.
001870     PERFORM SET-RTN THRU SET-EX.
001880     IF COMPLETION-CODE = 255
001890         GO TO M-90.
001900     MOVE W-NGPS TO TDNW1-HNGP.
001910*
001920     MOVE SPACE TO W-MDDD.
001930     MOVE ZERO TO W-NGP.
001940     MOVE WMJC-081 TO W-MDDD.
001950     PERFORM SET-RTN THRU SET-EX.
001960     IF COMPLETION-CODE = 255
001970         GO TO M-90.
001980     MOVE W-NGPS TO TDNW1-NNGP.
001990*
002000     MOVE WMJC-054 TO TDNW1-THC.
002010     MOVE WMJC-038 TO TDNW1-MHC.
002020     MOVE WMJC-036 TO TDNW1-SNA.
002030     MOVE WMJC-046 TO TDNW1-TNA.
002040     MOVE WMJC-087 TO TDNW1-HCC.
002050     MOVE WMJC-066 TO TDNW1-HSP.
002060     MOVE WMJC-093 TO TDNW1-DHC.
002070     MOVE WMJC-065 TO TDNW1-KHC.
002080     MOVE WMJC-100 TO TDNW1-KCC.
002090     MOVE WMJC-078 TO TDNW1-UBC.
002100     MOVE WMJC-039 TO TDNW1-NCC.
002110     MOVE WMJC-088 TO TDNW1-EDI.
002120     MOVE WMJC-068 TO TDNW1-NKC.
002130     MOVE WMJC-097 TO TDNW1-ZAC.
002140 M-45.
002150     WRITE TDNW-R1 INVALID KEY
002160         DISPLAY E-STAT E-ME5 E-KEY E-ME99
002170         GO TO M-50.
002180     GO TO M-55.
002190 M-50.
002200     IF ERR-STAT NOT = "24"
002210         MOVE 255 TO COMPLETION-CODE
002220         DISPLAY E-ME78 E-ME99
002230         GO TO M-90.
002240     DISPLAY E-CL.
002250     CLOSE TDNWF.
002260     MOVE "TDNWF        " TO W-FILE.
002270     DISPLAY E-ME71 E-ME98 STOP " ".
002280     DISPLAY E-CL.
002290     OPEN INPUT TDNWF.
002300     GO TO M-45.
002310 M-55.
002320     INITIALIZE TDNW-R2.
002330     MOVE ZERO TO TDNW2-KEY.
002340     MOVE WMJC-029 TO TDNW2-STC1.
002350     MOVE WMJC-043 TO TDNW2-STC2.
002360     MOVE WMJC-037 TO TDNW2-DNO.
002370     MOVE WMJC-107 TO TDNW2-DGN.
002380     MOVE WMJC-118 TO TDNW2-HCD.
002390     MOVE WMJC-155 TO TDNW2-ISU.
002400     MOVE WMJC-159 TO TDNW2-KSU.
002410     MOVE WMJC-157 TO TDNW2-HTC.
002420     MOVE WMJC-158 TO TDNW2-SU.
002430     MOVE WMJC-151 TO TDNW2-GTN.
002440     MOVE WMJC-153 TO TDNW2-UTN.
002450     MOVE WMJC-150 TO TDNW2-GKIN.
002460     MOVE WMJC-152 TO TDNW2-UKIN.
002470     MOVE WMJC-112 TO TDNW2-GCN.
002480     MOVE WMJC-111 TO TDNW2-CCD.
002490     MOVE WMJC-122 TO TDNW2-SHN.
002500*****MOVE WMJC-117 TO TDNW2-JAN.                                  D.150318
002510     MOVE WMJC-120 TO TDNW2-TSH.
002520     MOVE WMJC-108 TO TDNW2-TKC.
002530 M-60.
002540     WRITE TDNW-R2 INVALID KEY
002550         DISPLAY E-STAT E-ME5 E-KEY E-ME99
002560         GO TO M-65.
002570     GO TO M-40.
002580 M-65.
002590     IF ERR-STAT NOT = "24"
002600         MOVE 255 TO COMPLETION-CODE
002610         DISPLAY E-ME78 E-ME99
002620         GO TO M-90.
002630     DISPLAY E-CL.
002640     CLOSE TDNWF.
002650     MOVE "TDNWF        " TO W-FILE.
002660     DISPLAY E-ME71 E-ME98 STOP " ".
002670     DISPLAY E-CL.
002680     OPEN INPUT TDNWF.
002690     GO TO M-60.
002700 M-90.
002710     CLOSE WMJCF.
002720     CLOSE TDNWF.
002730 M-95.
002740     DISPLAY C-CLEAR.
002750     STOP RUN.
002760 SET-RTN.
002770     IF W-MDDD = SPACE OR ZERO
002780         GO TO SET-EX.
002790     MOVE 11 TO CNT1.
002800     MOVE  9 TO CNT2.
002810 SET-10.
002820     SUBTRACT 1 FROM CNT1.
002830     IF CNT1 = 0
002840         GO TO SET-90.
002850     IF W-MD(CNT1) = SPACE
002860         GO TO SET-10.
002870     IF W-MD(CNT1) = "/"
002880         GO TO SET-20.
002890     SUBTRACT 1 FROM CNT2.
002900     IF CNT2 = 0
002910         MOVE 255 TO COMPLETION-CODE
002920         DISPLAY E-ME3 E-MD E-ME99
002930         GO TO SET-EX.
002940     MOVE W-MD(CNT1) TO W-DD(CNT2).
002950     GO TO SET-10.
002960 SET-20.
002970     COMPUTE CNT3 = CNT1 + 2.
002980     IF W-MD(CNT3) = 0 OR 1 OR 2 OR 3 OR 4 OR 5
002990                       OR 6 OR 7 OR 8 OR 9
003000         GO TO SET-10.
003010     SUBTRACT 1 FROM CNT2.
003020     IF CNT2 = 0
003030         MOVE 255 TO COMPLETION-CODE
003040         DISPLAY E-ME3 E-MD E-ME99
003050         GO TO SET-EX.
003060     GO TO SET-10.
003070 SET-90.
003080     IF W-NGP = ZERO
003090         GO TO SET-EX.
003100     IF (W-NEN < 15) OR (W-GET < 1 OR > 12) OR (W-PEY < 1 OR > 31)
003110         MOVE 255 TO COMPLETION-CODE
003120         DISPLAY E-ME2 E-MD E-ME99.
003130 SET-EX.
003140     EXIT.
003150 CHK-RTN.
003160     MOVE ZERO TO W-NGPL.
003170     MOVE W-SNGP TO W-DATE.
003180     MOVE 20 TO W-NEN1.
003190     SUBTRACT 1 FROM W-GETD.
003200     IF W-GETD = ZERO
003210         MOVE 12 TO W-GETD
003220         SUBTRACT 1 FROM W-NEN2.
003230     OPEN INPUT TDNWRF.
003240     OPEN INPUT WMJCF.
003250 CHK-010.
003260     READ WMJCF AT END
003270         MOVE 255 TO COMPLETION-CODE
003280         DISPLAY E-ME1 E-ME99
003290         GO TO CHK-090.
003300     MOVE ZERO TO W-KEY.
003310     MOVE WMJC-029 TO W-STC1.
003320     MOVE WMJC-043 TO W-STC2.
003330     MOVE WMJC-037 TO W-DNO.
003340     MOVE 0 TO W-DGN.
003350 CHK-020.
003360     READ TDNWRF AT END
003370         GO TO CHK-090.
003380     IF TDNWR-DATE < W-NGPL
003390         GO TO CHK-020.
003400     IF TDNWR-KEY NOT = W-KEY
003410         GO TO CHK-020.
003420     MOVE 255 TO COMPLETION-CODE.
003430     DISPLAY E-ME7 E-KEYW E-ME99.
003440 CHK-090.
003450     CLOSE TDNWRF.
003460     CLOSE WMJCF.
003470 CHK-EX.
003480     EXIT.
