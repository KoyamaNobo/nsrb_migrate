000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JT450U.
000030**************************************************
000040*****     倉庫品名別出荷明細　選択           *****
000050**************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     COPY   LIBCSE.
000130     SELECT JSTRRF ASSIGN TO JSSTRR-MSD
000140         FILE STATUS ERR-STAT.
000150     SELECT  JT-WK03   ASSIGN  TO  WK03-MSD.
000160 I-O-CONTROL.
000170     APPLY SHARED-MODE ON M-DATE
000180     APPLY SHARED-MODE ON JSTRRF.
000190 DATA DIVISION.
000200 FILE SECTION.
000210     COPY LIBFDD.
000220     COPY LJSTRR.
000230     COPY LTWK03.
000240 WORKING-STORAGE  SECTION.
000250 77  WK0256ID               PIC  X(009) VALUE SPACE.
000260 01  STN-NO.
000270     02  STN-NO1            PIC  X(003).
000280     02  STN-NO2            PIC  X(003).
000290 01  W-FID.
000300     02  W-FID1             PIC  X(006) VALUE "WK0256".
000310     02  W-FID2             PIC  X(003).
000320 01  W-DATA.
000330     02  W-SEN          PIC  9(001).
000340     02  W-SSOK         PIC  9(001).
000350     02  W-ESOK         PIC  9(001).
000360     02  W-SHCD         PIC  9(004).
000370     02  W-EHCD         PIC  9(004).
000380     02  W-SDAT         PIC  9(008).
000390     02  W-EDAT         PIC  9(008).
000400     02  W-NGP          PIC  9(008).
000410     02  W-NGPD  REDEFINES W-NGP.
000420       03  W-NEN        PIC  9(004).
000430       03  W-NENL  REDEFINES W-NEN.
000440         04  W-NEN1     PIC  9(002).
000450         04  W-NEN2     PIC  9(002).
000460       03  W-GET        PIC  9(002).
000470       03  W-PEY        PIC  9(002).
000480     02  W-NGPL  REDEFINES W-NGP.
000490       03  F            PIC  9(002).
000500       03  W-NGPS       PIC  9(006).
000510     02  W-SNGP         PIC  9(008).
000520     02  W-SNGPD REDEFINES W-SNGP.
000530       03  W-SNEN       PIC  9(004).
000540       03  W-SNENL REDEFINES W-SNEN.
000550         04  W-SNEN1    PIC  9(002).
000560         04  W-SNEN2    PIC  9(002).
000570       03  W-SGET       PIC  9(002).
000580       03  W-SPEY       PIC  9(002).
000590     02  W-ENGP         PIC  9(008).
000600     02  W-ENGPD REDEFINES W-ENGP.
000610       03  W-ENEN       PIC  9(004).
000620       03  W-ENENL REDEFINES W-ENEN.
000630         04  W-ENEN1    PIC  9(002).
000640         04  W-ENEN2    PIC  9(002).
000650       03  W-EGET       PIC  9(002).
000660       03  W-EPEY       PIC  9(002).
000670     02  W-DMM          PIC  9(001).
000680     02  W-HCD.
000690       03  W-HCDD       PIC  9(004).
000700       03  F            PIC  9(002).
000710     02  W-DC           PIC  9(001).
000720     02  W-16           PIC  9(001).                              I.070419
000730 01  ERR-STAT           PIC  X(002).
000740 SCREEN SECTION.
000750 SD  C-CRT
000760     END STATUS IS ESTAT.
000770 01  C-CLEAR.
000780     02  LINE   1  CLEAR SCREEN.
000790 01  C-MID.
000800     02  LINE   1  COLUMN  19  PIC  N(021) VALUE
000810          NC"＊＊＊　　倉庫品名別　出荷明細表　　＊＊＊" REVERSE.
000820     02  LINE   5  COLUMN  20  PIC  X(028) VALUE
000830          "データは '  年   月   日より".
000840     02  LINE   7  COLUMN  20  PIC  X(034) VALUE
000850          "'  年   月   日 〜 '  年   月   日".
000860     02  LINE  10.
000870       03  COLUMN  14  PIC  X(022) VALUE "教　育=0 , 一　般=1 , ".I.070419
000880       03  COLUMN  36  PIC  X(015) VALUE "全  体=9  ...  ".       I.070419
000890*****  03  COLUMN  14  PIC  X(022) VALUE "教　育=0 , ワーク=1 , ".D.070419
000900*****  03  COLUMN  36  PIC  N(005) VALUE NC"カジュアル".          D.070419
000910*****  03  COLUMN  46  PIC  X(020) VALUE "=2 , 全  体=9  ...  ".  D.070419
000920     02  LINE  12  COLUMN  20  PIC  X(019) VALUE
000930          "倉庫ｺｰﾄﾞ     0 〜 9".
000940     02  LINE  14  COLUMN  20  PIC  X(022) VALUE
000950          "品種ｺｰﾄﾞ  0000 〜 9999".
000960     02  LINE  20  COLUMN  40  PIC  X(022) VALUE
000970          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000980 01  C-ACP.
000990     02  LINE   7.
001000       03  A-SNEN  COLUMN  21  PIC  9(002)
001010            USING W-SNEN2 NO IFC.
001020       03  A-SGET  COLUMN  26  PIC  9(002)
001030            USING W-SGET  NO IFC.
001040       03  A-SPEY  COLUMN  31  PIC  9(002)
001050            USING W-SPEY  CHECK OVERFLOW NO IFC.
001060       03  A-ENEN  COLUMN  40  PIC  9(002)
001070            USING W-ENEN2 NO IFC.
001080       03  A-EGET  COLUMN  45  PIC  9(002)
001090            USING W-EGET  NO IFC.
001100       03  A-EPEY  COLUMN  50  PIC  9(002)
001110            USING W-EPEY  CHECK OVERFLOW NO IFC.
001120*****02  A-SEN   LINE  10  COLUMN  65  PIC  9(001)                D.070419
001130     02  A-SEN   LINE  10  COLUMN  50  PIC  9(001)                I.070419
001140          USING W-SEN   CHECK OVERFLOW NO IFC.
001150     02  LINE  12.
001160       03  A-SSOK  COLUMN  33  PIC  9(001)
001170            USING W-SSOK  CHECK OVERFLOW NO IFC.
001180       03  A-ESOK  COLUMN  38  PIC  9(001)
001190            USING W-ESOK  CHECK OVERFLOW NO IFC.
001200     02  LINE  14.
001210       03  A-SHCD  COLUMN  30  PIC  9(004)
001220            USING W-SHCD  CHECK OVERFLOW NO IFC.
001230       03  A-EHCD  COLUMN  38  PIC  9(004)
001240            USING W-EHCD  CHECK OVERFLOW NO IFC.
001250     02  A-DMM   LINE  20  COLUMN  57  PIC  9(001)
001260          USING W-DMM   CHECK OVERFLOW NO IFC.
001270 01  C-DSP.
001280     02  D-SNGP  LINE   5.
001290       03  COLUMN  30  PIC  9(002) FROM  W-NEN2.
001300       03  COLUMN  35  PIC  9(002) FROM  W-GET.
001310       03  COLUMN  40  PIC  9(002) FROM  W-PEY.
001320 01  C-ERR.
001330     02  LINE  24.
001340       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001350            "***  DATA ﾅｼ  ***".
001360       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001370       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001380       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001390            "                                                  ".
001400     COPY LIBSCR.
001410 PROCEDURE DIVISION.
001420 M-05.
001430     DISPLAY C-CLEAR.
001440     DISPLAY C-MID.
001450     MOVE ZERO TO W-DATA.
001460     MOVE 9 TO W-ESOK.                                            I.151106
001470     MOVE 9999 TO W-EHCD.                                         I.151106
001480     OPEN INPUT JSTRRF.
001490     READ JSTRRF AT END
001500         CLOSE JSTRRF
001510         MOVE 255 TO COMPLETION-CODE
001520         DISPLAY E-ME1 E-ME99
001530         DISPLAY C-CLEAR
001540         STOP RUN.
001550     MOVE JSTRR-90 TO W-SDAT.
001560     CLOSE JSTRRF.
001570*
001580     COPY LIBCPR.
001590     ACCEPT W-NGPS FROM DATE.
001600     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001610         ADD DATE-NC1 TO W-NEN.
001620     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001630         ADD DATE-NC2 TO W-NEN.
001640     MOVE W-NGP TO W-EDAT.
001650     MOVE W-SDAT TO W-NGP.
001660     DISPLAY D-SNGP.
001670 M-10.
001680     ACCEPT A-SNEN.
001690     IF ESTAT = "P9"
001700         MOVE 255 TO COMPLETION-CODE
001710         GO TO M-95.
001720     IF ESTAT NOT = "00" AND "01" AND "06"
001730         GO TO M-10.
001740 M-15.
001750     ACCEPT A-SGET.
001760     IF ESTAT = "09"
001770         GO TO M-10.
001780     IF ESTAT NOT = "00" AND "01" AND "06"
001790         GO TO M-15.
001800     IF W-SGET < 1 OR > 12
001810         GO TO M-15.
001820 M-20.
001830     ACCEPT A-SPEY.
001840     IF ESTAT = "09"
001850         GO TO M-15.
001860     IF ESTAT NOT = "00" AND "01" AND "06"
001870         GO TO M-20.
001880     IF W-SPEY < 1 OR > 31
001890         GO TO M-20.
001900*
001910     MOVE ZERO TO W-SNEN1.
001920     IF W-SNEN2 >= DATE-NF1 AND <= DATE-NT1
001930         ADD DATE-NC1 TO W-SNEN.
001940     IF W-SNEN2 >= DATE-NF2 AND <= DATE-NT2
001950         ADD DATE-NC2 TO W-SNEN.
001960     IF W-SNGP < W-SDAT OR > W-EDAT
001970         GO TO M-10.
001980 M-25.
001990     ACCEPT A-ENEN.
002000     IF ESTAT = "09"
002010         GO TO M-20.
002020     IF ESTAT NOT = "00" AND "01" AND "06"
002030         GO TO M-25.
002040 M-30.
002050     ACCEPT A-EGET.
002060     IF ESTAT = "09"
002070         GO TO M-25.
002080     IF ESTAT NOT = "00" AND "01" AND "06"
002090         GO TO M-30.
002100     IF W-EGET < 1 OR > 12
002110         GO TO M-30.
002120 M-35.
002130     ACCEPT A-EPEY.
002140     IF ESTAT = "09"
002150         GO TO M-30.
002160     IF ESTAT NOT = "00" AND "01" AND "06"
002170         GO TO M-35.
002180     IF W-EPEY < 1 OR > 31
002190         GO TO M-35.
002200*
002210     MOVE ZERO TO W-ENEN1.
002220     IF W-ENEN2 >= DATE-NF1 AND <= DATE-NT1
002230         ADD DATE-NC1 TO W-ENEN.
002240     IF W-ENEN2 >= DATE-NF2 AND <= DATE-NT2
002250         ADD DATE-NC2 TO W-ENEN.
002260     IF W-ENGP < W-SNGP OR > W-EDAT
002270         GO TO M-25.
002280 M-40.
002290     ACCEPT A-SEN.
002300     IF ESTAT = "09"
002310         GO TO M-35.
002320     IF ESTAT NOT = "01" AND "06"
002330         GO TO M-40.
002340*****IF W-SEN NOT = 0 AND 1 AND 2 AND 9                           D.070419
002350     IF W-SEN NOT = 0 AND 1 AND 9                                 I.070419
002360         GO TO M-40.
002370 M-45.
002380     ACCEPT A-SSOK.
002390     IF ESTAT = "09"
002400         GO TO M-40.
002410     IF ESTAT NOT = "01" AND "06"
002420         GO TO M-45.
002430 M-50.
002440     ACCEPT A-ESOK.
002450     IF ESTAT = "09"
002460         GO TO M-45.
002470     IF ESTAT NOT = "01" AND "06"
002480         GO TO M-50.
002490     IF W-SSOK > W-ESOK
002500         GO TO M-50.
002510 M-55.
002520     ACCEPT A-SHCD.
002530     IF ESTAT = "09"
002540         GO TO M-50.
002550     IF ESTAT NOT = "01" AND "06"
002560         GO TO M-55.
002570 M-60.
002580     ACCEPT A-EHCD.
002590     IF ESTAT = "09"
002600         GO TO M-55.
002610     IF ESTAT NOT = "01" AND "06"
002620         GO TO M-60.
002630     IF W-SHCD > W-EHCD
002640         GO TO M-60.
002650 M-65.
002660     ACCEPT A-DMM.
002670     IF ESTAT = "09"
002680         GO TO M-60.
002690     IF ESTAT NOT = "01" AND "06"
002700         GO TO M-65.
002710     IF W-DMM = 9
002720         GO TO M-10.
002730     IF W-DMM NOT = 1
002740         GO TO M-65.
002750*
002760     CALL "CBLSTNNO" USING STN-NO.
002770     MOVE STN-NO2 TO W-FID2.
002780     MOVE W-FID TO WK0256ID.
002790     OPEN  OUTPUT  JT-WK03.
002800     OPEN INPUT JSTRRF.
002810 M-70.
002820     READ  JSTRRF      AT END           GO  TO  M-90.
002830     IF    JSTRR-03  NOT  =   0  AND  3  AND 7
002840                                        GO  TO  M-70.
002850     IF    JSTRR-17  NOT  =   1         GO  TO  M-70.
002860     IF   (JSTRR-1211(01) =  0)  AND  (JSTRR-1211(02) =  0)  AND
002870          (JSTRR-1211(03) =  0)  AND  (JSTRR-1211(04) =  0)  AND
002880          (JSTRR-1211(05) =  0)  AND  (JSTRR-1211(06) =  0)  AND
002890          (JSTRR-1211(07) =  0)  AND  (JSTRR-1211(08) =  0)  AND
002900          (JSTRR-1211(09) =  0)  AND  (JSTRR-1211(10) =  0)
002910                                        GO  TO  M-70.
002920     MOVE  JSTRR-16  TO  W-16.                                    I.070419
002930     IF    W-16         =  2                                      I.070419
002940           MOVE  1         TO  W-16.                              I.070419
002950     IF    W-SEN    NOT =  9
002960         IF   W-16      NOT  =  W-SEN   GO  TO  M-70.             I.070419
002970*****    IF   JSTRR-16  NOT  =  W-SEN   GO  TO  M-70.             D.070419
002980     IF    JSTRR-07      <  W-SSOK  OR  >  W-ESOK
002990                                        GO  TO  M-70.
003000     MOVE JSTRR-09 TO W-HCD.
003010     IF    W-HCDD        <  W-SHCD  OR  >  W-EHCD
003020                                        GO  TO  M-70.
003030     IF    JSTRR-05      <  W-SNGP  OR  >  W-ENGP
003040                                        GO  TO  M-70.
003050     MOVE  SPACE     TO  W03-R.
003060     INITIALIZE          W03-R.
003070     MOVE  JSTRR-R   TO  W03-R.
003080     WRITE    W03-R.
003090     IF W-DC = 0
003100         MOVE 1 TO W-DC.
003110     GO  TO  M-70.
003120 M-90.
003130     CLOSE   JT-WK03  JSTRRF.
003140     IF W-DC = 0
003150         MOVE 255 TO COMPLETION-CODE
003160         DISPLAY E-ME1 E-ME99
003170         DISPLAY C-CLEAR
003180         STOP RUN.
003190 M-95.
003200     DISPLAY C-CLEAR.
003210     STOP RUN.
