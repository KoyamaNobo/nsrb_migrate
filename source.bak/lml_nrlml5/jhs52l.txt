000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JHS52L.
000030*********************************************************
000040*    PROGRAM         :  統一伝票発行（ナフコ）          *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT TDNNF ASSIGN TO TDNN-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY TDNN1-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT TDNNRF ASSIGN TO TDNNR-MSD.                           I.070228
000210     SELECT SP-F ASSIGN TO P-PRN999.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON TDNNF
000240     APPLY SHIFT-CODE  ON SP-F.
000250 DATA DIVISION.
000260 FILE SECTION.
000270     COPY LITDNN.
000280 FD  TDNNRF                                                       I.070228
000290     BLOCK  3 RECORDS                                             I.070228
000300     LABEL RECORD IS STANDARD                                     I.070228
000310     VALUE OF IDENTIFICATION "TDNNRF".                            I.070228
000320 01  TDNNR-R1.                                                    I.070228
000330     02  TDNNR1-KEY.                                              I.070228
000340       03  TDNNR1-STC.                                            I.070228
000350         04  TDNNR1-SCD PIC  9(002).                              I.070228
000360         04  TDNNR1-TCD PIC  9(003).                              I.070228
000370         04  F          PIC  X(004).                              I.070228
000380       03  TDNNR1-DNO.                                            I.070228
000390         04  F          PIC  X(002).                              I.070228
000400         04  TDNNR1-DNOD PIC  9(007).                             I.070228
000410       03  TDNNR1-DGN   PIC  9(002).                              I.070228
000420     02  F              PIC  X(002).                              I.070228
000430     02  TDNNR1-BCD     PIC  9(002).                              I.070228
000440     02  TDNNR1-DPC     PIC  9(002).                              I.070228
000450     02  TDNNR1-HNGP    PIC  9(006).                              I.070228
000460     02  TDNNR1-HNGPD REDEFINES TDNNR1-HNGP.                      I.070228
000470       03  TDNNR1-HNEN  PIC  9(002).                              I.070228
000480       03  TDNNR1-HGET  PIC  9(002).                              I.070228
000490       03  TDNNR1-HPEY  PIC  9(002).                              I.070228
000500     02  TDNNR1-NNGP    PIC  9(006).                              I.070228
000510     02  TDNNR1-NNGPD REDEFINES TDNNR1-NNGP.                      I.070228
000520       03  TDNNR1-NNEN  PIC  9(002).                              I.070228
000530       03  TDNNR1-NGET  PIC  9(002).                              I.070228
000540       03  TDNNR1-NPEY  PIC  9(002).                              I.070228
000550     02  TDNNR1-THC     PIC  9(006).                              I.070228
000560     02  TDNNR1-STA     PIC  X(002).                              I.070228
000570     02  TDNNR1-SNA     PIC  X(015).                              I.070228
000580     02  TDNNR1-TNA     PIC  X(015).                              I.070228
000590     02  TDNNR1-TSN     PIC  X(015).                              I.070228
000600     02  TDNNR1-TST     PIC  X(012).                              I.070228
000610     02  TDNNR1-HCC     PIC  9(001).                              I.070228
000620     02  F              PIC  X(024).                              I.070228
000630     02  TDNNR1-AR      PIC  X(007).                              I.070228
000640     02  TDNNR1-DUR     PIC  X(026).                              I.070228
000650     02  TDNNR1-DSHR    PIC  X(014).                              I.070228
000660     02  TDNNR1-DSMR    PIC  X(007).                              I.070228
000670     02  TDNNR1-ER      PIC  X(005).                              I.070228
000680     02  TDNNR1-FSR     PIC  X(015).                              I.070228
000690     02  TDNNR1-FUR     PIC  X(007).                              I.070228
000700     02  TDNNR1-LCR     PIC  X(016).                              I.070228
000710     02  TDNNR1-LUR     PIC  X(020).                              I.070228
000720     02  TDNNR1-LSR     PIC  X(007).                              I.070228
000730     02  F              PIC  X(003).                              I.070228
000740     02  TDNNR1-PC      PIC  9(001).                              I.070228
000750     02  F              PIC  X(085).                              I.070228
000760 01  TDNNR-R2.                                                    I.070228
000770     02  TDNNR2-KEY.                                              I.070228
000780       03  TDNNR2-STC.                                            I.070228
000790         04  TDNNR2-SCD PIC  9(002).                              I.070228
000800         04  TDNNR2-TCD PIC  9(003).                              I.070228
000810         04  F          PIC  X(004).                              I.070228
000820       03  TDNNR2-DNO.                                            I.070228
000830         04  F          PIC  X(002).                              I.070228
000840         04  TDNNR2-DNOD PIC  9(007).                             I.070228
000850       03  TDNNR2-DGN   PIC  9(002).                              I.070228
000860     02  TDNNR2-JAN     PIC  X(013).                              I.070228
000870     02  TDNNR2-GAR     PIC  X(006).                              I.070228
000880     02  F              PIC  X(001).                              I.070228
000890     02  TDNNR2-TNI     PIC  X(003).                              I.070228
000900     02  TDNNR2-SU      PIC  9(005).                              I.070228
000910     02  F              PIC  X(001).                              I.070228
000920     02  TDNNR2-GTN     PIC  9(007).                              I.070228
000930     02  TDNNR2-GTND  REDEFINES TDNNR2-GTN.                       I.070228
000940       03  TDNNR2-GTN1  PIC  9(001).                              I.070228
000950       03  TDNNR2-GTN2  PIC  9(006).                              I.070228
000960     02  F              PIC  X(002).                              I.070228
000970     02  TDNNR2-UTN     PIC  9(007).                              I.070228
000980     02  TDNNR2-UTND  REDEFINES TDNNR2-UTN.                       I.070228
000990       03  TDNNR2-UTN1  PIC  9(001).                              I.070228
001000       03  TDNNR2-UTN2  PIC  9(006).                              I.070228
001010     02  TDNNR2-GKIN    PIC  9(010).                              I.070228
001020     02  TDNNR2-UKIN    PIC  9(010).                              I.070228
001030     02  F              PIC  X(009).                              I.070228
001040     02  TDNNR2-SHN     PIC  X(025).                              I.070228
001050     02  TDNNR2-HSC     PIC  X(008).                              I.070228
001060     02  TDNNR2-COR     PIC  X(006).                              I.070228
001070     02  TDNNR2-SIZ     PIC  X(005).                              I.070228
001080     02  F              PIC  X(004).                              I.070228
001090     02  TDNNR2-KKK     PIC  X(025).                              I.070228
001100     02  TDNNR2-PCH     PIC  X(001).                              I.070228
001110     02  TDNNR2-PSI     PIC  X(001).                              I.070228
001120     02  TDNNR2-PBM     PIC  9(002).                              I.070228
001130     02  TDNNR2-PJAN    PIC  X(013).                              I.070228
001140     02  TDNNR2-PSHN    PIC  X(020).                              I.070228
001150     02  TDNNR2-PKKK    PIC  X(020).                              I.070228
001160     02  TDNNR2-PUTN    PIC  9(007).                              I.070228
001170     02  TDNNR2-PMS     PIC  9(005).                              I.070228
001180     02  F              PIC  X(019).                              I.070228
001190     02  TDNNR2-PC      PIC  9(001).                              I.070228
001200     02  F              PIC  X(085).                              I.070228
001210 FD  SP-F
001220     LABEL RECORD OMITTED
001230     LINAGE IS 30 LINES.
001240 01  SP-R               PIC  X(170).
001250 WORKING-STORAGE  SECTION.
001260 77  ERR-STAT           PIC  X(002).
001270 77  W-FILE             PIC  X(013).
001280 77  W-20K              PIC  X(005) VALUE ""3FE04FE080"".
001290 01  W-P01.
001300     02  P-20K          PIC  X(005).
001310*****02  F              PIC  X(005).                              D.091211
001320     02  F              PIC  X(006).                              I.091211
001330     02  P-AR           PIC  X(007).
001340     02  F              PIC  X(005).
001350     02  P-DUR          PIC  X(026).
001360     02  F              PIC  X(049).
001370     02  P-ER           PIC  X(005).
001380     02  F              PIC  X(011).
001390 01  W-P02.
001400*****02  F              PIC  X(017).                              D.091211
001410     02  F              PIC  X(018).                              I.091211
001420     02  P-DSHR         PIC  X(014).
001430     02  F              PIC  X(007).
001440     02  P-DSMR         PIC  X(007).
001450     02  F              PIC  X(028).
001460     02  P-TSN          PIC  X(015).
001470     02  F              PIC  X(020).
001480 01  W-P03.
001490*****02  F              PIC  X(008).                              D.091211
001500     02  F              PIC  X(009).                              I.091211
001510     02  P-SNA          PIC  X(015).
001520     02  F              PIC  X(085).
001530 01  W-P04.
001540*****02  F              PIC  X(008).                              D.091211
001550     02  F              PIC  X(009).                              I.091211
001560     02  P-TNA          PIC  X(015).
001570     02  F              PIC  X(009).
001580     02  P-SCD          PIC  9(002).
001590     02  P-TCD          PIC  9(003).
001600     02  F              PIC  X(005).
001610     02  P-BCD          PIC  9(002).
001620     02  F              PIC  X(002).
001630     02  P-DPC          PIC  9(002).
001640     02  F              PIC  X(005).
001650     02  P-DNOD         PIC  9(007).
001660     02  F              PIC  X(001).
001670     02  P-THC          PIC  9(006).
001680     02  F              PIC  X(006).
001690     02  P-TST          PIC  X(012).
001700     02  F              PIC  X(008).
001710     02  P-HNEN         PIC  9(002).
001720     02  P-HGET         PIC Z9.
001730     02  P-HPEY         PIC Z9.
001740     02  P-NNEN         PIC  9(002).
001750     02  P-NGET         PIC Z9.
001760     02  P-NPEY         PIC Z9.
001770     02  F              PIC  X(003).
001780 01  W-P05.
001790*****02  F              PIC  X(004).                              D.091211
001800     02  F              PIC  X(005).                              I.091211
001810     02  P-SHN          PIC  X(025).
001820     02  P-JAN          PIC  X(013).
001830     02  F              PIC  X(001).
001840     02  P-COR          PIC  X(006).
001850     02  P-SIZ          PIC  X(005).
001860     02  F              PIC  X(027).                              I.050317
001870     02  P-GTN1         PIC  Z(001).                              I.050317
001880     02  F              PIC  X(016).                              I.050317
001890     02  P-UTN1         PIC  Z(001).                              I.050317
001900     02  F              PIC  X(009).                              I.050317
001910*****02  F              PIC  X(054).                              D.050317
001920 01  W-P06.
001930*****02  F              PIC  X(004).                              D.091211
001940     02  F              PIC  X(005).                              I.091211
001950     02  P-KKK          PIC  X(025).
001960     02  P-HSC          PIC  X(008).
001970     02  F              PIC  X(006).
001980     02  P-GAR          PIC  X(006).
001990     02  F              PIC  X(005).
002000     02  P-TNI          PIC  X(003).
002010     02  P-SU           PIC  Z(005).
002020     02  F              PIC  X(014).
002030     02  P-GTN2         PIC  Z(006).
002040     02  F              PIC  X(002).
002050     02  P-GKIN         PIC  Z(009).
002060     02  P-UTN2         PIC  Z(006).
002070     02  P-UKIN         PIC  Z(009).
002080 01  W-P07.
002090*****02  F              PIC  X(005).                              D.091211
002100     02  F              PIC  X(006).                              I.091211
002110     02  P-FUR          PIC  X(007).
002120     02  F              PIC  X(096).
002130 01  W-P08.
002140*****02  F              PIC  X(005).                              D.091211
002150     02  F              PIC  X(006).                              I.091211
002160     02  P-FSR          PIC  X(015).
002170     02  F              PIC  X(014).
002180     02  P-LUR          PIC  X(020).
002190     02  F              PIC  X(003).
002200     02  P-SUT          PIC  Z(005).
002210     02  F              PIC  X(022).
002220     02  P-GKINT        PIC  Z(009).
002230     02  F              PIC  X(006).
002240     02  P-UKINT        PIC  Z(009).
002250 01  W-P09.
002260*****02  F              PIC  X(034).                              D.091211
002270     02  F              PIC  X(035).                              I.091211
002280     02  P-LCR          PIC  X(016).
002290     02  F              PIC  X(058).
002300 01  W-P10.
002310*****02  F              PIC  X(036).                              D.091211
002320     02  F              PIC  X(037).                              I.091211
002330     02  P-LSR          PIC  X(007).
002340     02  F              PIC  X(065).
002350 01  W-DATA.
002360     02  WT-D.
002370       03  WT-SU        PIC  9(006).
002380       03  WT-GKIN      PIC  9(009).
002390       03  WT-UKIN      PIC  9(009).
002400     02  W-D.
002410       03  W-POC        PIC  9(001).
002420       03  W-FOC        PIC  9(001).
002430       03  W-TPC        PIC  9(001).
002440       03  W-HKC        PIC  9(001).
002450       03  W-SED.
002460         04  W-SSTC.
002470           05  W-SSCD   PIC  9(002).
002480           05  W-STCD   PIC  9(003).
002490         04  W-ESTC.
002500           05  W-ESCD   PIC  9(002).
002510           05  W-ETCD   PIC  9(003).
002520         04  W-SDNO     PIC  9(007).
002530         04  W-EDNO     PIC  9(007).
002540       03  W-DMM        PIC  9(001).
002550       03  W-RSTC.
002560         04  W-RSCD     PIC  9(002).
002570         04  W-RTCD     PIC  9(003).
002580       03  W-STC        PIC  9(009).
002590       03  W-DNO        PIC  9(009).
002600       03  W-LC         PIC  9(002).
002610     COPY LSTAT.
002620 SCREEN SECTION.
002630 SD  C-CRT
002640     END STATUS IS ESTAT.
002650 01  C-CLEAR.
002660     02  C-CL    LINE   1  CLEAR SCREEN.
002670 01  C-MID.
002680     02  LINE   1  COLUMN  20  PIC  N(014) VALUE
002690          NC"チェーンストア統一伝票　発行".
002700     02  LINE   2  COLUMN  20  PIC  N(013) VALUE
002710          NC"（ターンアラウンド用２型）".
002720     02  LINE   4  COLUMN  10  PIC  N(007) VALUE
002730          NC"［ナ　フ　コ］".
002740     02  LINE   7  COLUMN  22  PIC  X(035) VALUE
002750          "テストプリント印字 (YES=1,NO=2) [ ]".
002760     02  LINE  10  COLUMN  22  PIC  X(010) VALUE
002770          "１．発　行".
002780     02  LINE  11  COLUMN  22  PIC  X(018) VALUE                  I.070228
002790          "２．再発行（当日）".                                   I.070228
002800     02  LINE  12  COLUMN  22  PIC  X(026) VALUE                  I.070228
002810          "３．　〃　（以前）     [ ]".                           I.070228
002820*****02  LINE  11  COLUMN  22  PIC  X(018) VALUE                  D.070228
002830*****     "２．再発行     [ ]".                                   D.070228
002840     02  LINE  23  COLUMN  40  PIC  X(028) VALUE
002850          "確認 (OK=1,NO=9) --->   ﾘﾀｰﾝ".
002860 01  C-DSP.
002870     02  D-SHM.
002880       03  LINE  14  COLUMN  33  PIC  X(018) VALUE
002890            "社店ｺｰﾄﾞ  伝票番号".
002900       03  LINE  15  COLUMN  22  PIC  N(004) VALUE
002910            NC"ＦＲＯＭ".
002920       03  LINE  16  COLUMN  22  PIC  N(002) VALUE
002930            NC"ＴＯ".
002940     02  D-SHMC.
002950       03  LINE  14  COLUMN  33  PIC  X(018) VALUE
002960            "                  ".
002970       03  LINE  15  COLUMN  22  PIC  X(028) VALUE
002980            "                            ".
002990       03  LINE  16  COLUMN  22  PIC  X(028) VALUE
003000            "                            ".
003010 01  C-ACP.
003020     02  A-TPC   LINE   7  COLUMN  55  PIC  9(001)
003030          USING W-TPC   CHECK OVERFLOW NO IFC.
003040*****02  A-HKC   LINE  11  COLUMN  38  PIC  9(001)                D.070228
003050     02  A-HKC   LINE  12  COLUMN  46  PIC  9(001)                I.070228
003060          USING W-HKC   CHECK OVERFLOW NO IFC.
003070     02  A-DMM   LINE  23  COLUMN  62  PIC  9(001)
003080          USING W-DMM   CHECK OVERFLOW NO IFC.
003090     02  LINE  15.
003100       03  A-SSTC  COLUMN  34  PIC  9(005)
003110            USING W-SSTC  CHECK OVERFLOW NO IFC.
003120       03  A-SDNO  COLUMN  44  PIC  9(007)
003130            USING W-SDNO  CHECK OVERFLOW NO IFC.
003140     02  LINE  16.
003150       03  A-ESTC  COLUMN  34  PIC  9(005)
003160            USING W-ESTC  CHECK OVERFLOW NO IFC.
003170       03  A-EDNO  COLUMN  44  PIC  9(007)
003180            USING W-EDNO  CHECK OVERFLOW NO IFC.
003190 01  C-ERR.
003200     02  LINE  24.
003210       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
003220            "***  DATA ﾅｼ  ***".
003230       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
003240            "***  DATA ｴﾗｰ  ***".
003250       03  E-ME10  COLUMN  15  PIC  X(027) VALUE
003260            "***  TDNNF DATA ｴﾗｰ  ***".
003270       03  E-ME11  COLUMN  15  PIC  X(027) VALUE
003280            "***  TDNNF REWRITE ｴﾗｰ  ***".
003290     COPY LSSEM.
003300 PROCEDURE DIVISION.
003310 M-05.
003320     DISPLAY C-CLEAR.
003330     DISPLAY C-MID.
003340     MOVE 000 TO COMPLETION-CODE.
003350     MOVE ZERO TO W-D.
003360 M-10.
003370     ACCEPT A-TPC.
003380     IF ESTAT = PF9
003390         GO TO M-90.
003400     IF ESTAT NOT = HTB AND SKP
003410         GO TO M-10.
003420     IF W-TPC = 2
003430         GO TO M-15.
003440     IF W-TPC NOT = 1
003450         GO TO M-10.
003460     PERFORM TST-RTN THRU TST-EX.
003470     GO TO M-10.
003480 M-15.
003490     ACCEPT A-HKC.
003500     IF ESTAT = BTB
003510         GO TO M-10.
003520     IF ESTAT NOT = HTB AND SKP
003530         GO TO M-15.
003540     IF W-HKC = 1
003550         DISPLAY D-SHMC
003560         GO TO M-40.
003570*****IF W-HKC NOT = 2                                             D.070228
003580     IF W-HKC NOT = 2 AND 3                                       I.070228
003590         GO TO M-15.
003600     DISPLAY D-SHM.
003610 M-20.
003620     ACCEPT A-SSTC.
003630     IF ESTAT = BTB
003640         GO TO M-15.
003650     IF ESTAT NOT = HTB AND SKP
003660         GO TO M-20.
003670 M-25.
003680     ACCEPT A-ESTC.
003690     IF ESTAT = BTB
003700         GO TO M-20.
003710     IF ESTAT NOT = HTB AND SKP
003720         GO TO M-25.
003730     IF W-SSTC > W-ESTC
003740         GO TO M-25.
003750 M-30.
003760     ACCEPT A-SDNO.
003770     IF ESTAT = BTB
003780         GO TO M-25.
003790     IF ESTAT NOT = HTB AND SKP
003800         GO TO M-30.
003810 M-35.
003820     ACCEPT A-EDNO.
003830     IF ESTAT = BTB
003840         GO TO M-30.
003850     IF ESTAT NOT = HTB AND SKP
003860         GO TO M-35.
003870     IF W-SDNO > W-EDNO
003880         GO TO M-35.
003890 M-40.
003900     ACCEPT A-DMM.
003910     IF ESTAT = BTB
003920         IF W-HKC = 1
003930             GO TO M-15
003940           ELSE
003950             GO TO M-35.
003960     IF ESTAT NOT = HTB AND SKP
003970         GO TO M-40.
003980     IF W-DMM = 9
003990         GO TO M-15.
004000     IF W-DMM NOT = 1
004010         GO TO M-40.
004020*
004030     IF W-HKC = 1
004040         OPEN I-O TDNNF
004050       ELSE
004060         IF W-HKC = 2                                             I.070228
004070             OPEN INPUT TDNNF                                     I.070228
004080           ELSE                                                   I.070228
004090             OPEN INPUT TDNNRF.                                   I.070228
004100*****    OPEN INPUT TDNNF.                                        D.070228
004110     MOVE 1 TO W-FOC.
004120     IF W-HKC = 3                                                 I.070228
004130         GO TO M-46.                                              I.070228
004140 M-45.
004150     READ TDNNF NEXT RECORD WITH UNLOCK AT END
004160         DISPLAY E-ME1 E-ME99
004170         GO TO M-90.
004180     IF TDNN1-PC = 0
004190         GO TO M-45.
004200     IF W-HKC = 1
004210         IF TDNN1-PC = 9
004220             GO TO M-45.
004230     IF W-HKC = 2
004240         IF TDNN1-PC NOT = 9
004250             GO TO M-45.
004260     IF W-HKC = 2
004270         MOVE TDNN1-SCD TO W-RSCD
004280         MOVE TDNN1-TCD TO W-RTCD
004290         IF W-RSTC < W-SSTC OR > W-ESTC
004300             GO TO M-45.
004310     IF W-HKC = 2
004320         IF TDNN1-DNOD < W-SDNO OR > W-EDNO
004330             GO TO M-45.
004340     IF TDNN1-DGN NOT = 0
004350         DISPLAY E-ME78 E-ME2 E-ME99
004360         DISPLAY E-CL
004370         DISPLAY E-ME78
004380         GO TO M-45.
004390     GO TO M-50.                                                  I.070228
004400 M-46.                                                            I.070228
004410     READ TDNNRF AT END                                           I.070228
004420         DISPLAY E-ME1 E-ME99                                     I.070228
004430         GO TO M-90.                                              I.070228
004440     MOVE TDNNR1-SCD TO W-RSCD.                                   I.070228
004450     MOVE TDNNR1-TCD TO W-RTCD.                                   I.070228
004460     IF W-RSTC < W-SSTC OR > W-ESTC                               I.070228
004470         GO TO M-46.                                              I.070228
004480     IF TDNNR1-DNOD < W-SDNO OR > W-EDNO                          I.070228
004490         GO TO M-46.                                              I.070228
004500     IF TDNNR1-DGN NOT = 0                                        I.070228
004510         DISPLAY E-ME78 E-ME2 E-ME99                              I.070228
004520         DISPLAY E-CL                                             I.070228
004530         DISPLAY E-ME78                                           I.070228
004540         GO TO M-46.                                              I.070228
004550 M-50.
004560     IF W-HKC = 1 OR 2                                            I.070228
004570         MOVE TDNN1-STC TO W-STC                                  I.070228
004580         MOVE TDNN1-DNO TO W-DNO                                  I.070228
004590       ELSE                                                       I.070228
004600         MOVE TDNNR1-STC TO W-STC                                 I.070228
004610         MOVE TDNNR1-DNO TO W-DNO.                                I.070228
004620*****MOVE TDNN1-STC TO W-STC.                                     D.070228
004630*****MOVE TDNN1-DNO TO W-DNO.                                     D.070228
004640     MOVE ZERO TO WT-D.
004650     MOVE SPACE TO W-P01 W-P02 W-P03 W-P04
004660                   W-P07 W-P08 W-P09 W-P10.
004670*
004680     MOVE W-20K TO P-20K.
004690     IF W-HKC = 1 OR 2                                            I.070228
004700         PERFORM HED1-RTN THRU HED1-EX                            I.070228
004710       ELSE                                                       I.070228
004720         PERFORM HED2-RTN THRU HED2-EX.                           I.070228
004730*****MOVE TDNN1-AR TO P-AR.                                       D.070228
004740*****MOVE TDNN1-DUR TO P-DUR.                                     D.070228
004750*****MOVE TDNN1-ER TO P-ER.                                       D.070228
004760*****MOVE TDNN1-DSHR TO P-DSHR.                                   D.070228
004770*****MOVE TDNN1-DSMR TO P-DSMR.                                   D.070228
004780*****MOVE TDNN1-TSN TO P-TSN.                                     D.070228
004790*****MOVE TDNN1-SNA TO P-SNA.                                     D.070228
004800*****MOVE TDNN1-TNA TO P-TNA.                                     D.070228
004810*****MOVE TDNN1-SCD TO P-SCD.                                     D.070228
004820*****MOVE TDNN1-TCD TO P-TCD.                                     D.070228
004830*****MOVE TDNN1-BCD TO P-BCD.                                     D.070228
004840*****MOVE TDNN1-DPC TO P-DPC.                                     D.070228
004850*****MOVE TDNN1-DNOD TO P-DNOD.                                   D.070228
004860*****MOVE TDNN1-THC TO P-THC.                                     D.070228
004870*****MOVE TDNN1-TST TO P-TST.                                     D.070228
004880*****MOVE TDNN1-HNEN TO P-HNEN.                                   D.070228
004890*****MOVE TDNN1-HGET TO P-HGET.                                   D.070228
004900*****MOVE TDNN1-HPEY TO P-HPEY.                                   D.070228
004910*****MOVE TDNN1-NNEN TO P-NNEN.                                   D.070228
004920*****MOVE TDNN1-NGET TO P-NGET.                                   D.070228
004930*****MOVE TDNN1-NPEY TO P-NPEY.                                   D.070228
004940*****MOVE TDNN1-FUR TO P-FUR.                                     D.070228
004950*****MOVE TDNN1-FSR TO P-FSR.                                     D.070228
004960*****MOVE TDNN1-LUR TO P-LUR.                                     D.070228
004970*****MOVE TDNN1-LCR TO P-LCR.                                     D.070228
004980*****MOVE TDNN1-LSR TO P-LSR.                                     D.070228
004990*
005000     IF W-POC = 0
005010         OPEN OUTPUT SP-F
005020         MOVE 1 TO W-POC
005030       ELSE
005040         MOVE SPACE TO SP-R
005050         WRITE SP-R AFTER PAGE.
005060     MOVE SPACE TO SP-R.
005070     MOVE W-P01 TO SP-R.
005080     WRITE SP-R AFTER 2.
005090     MOVE SPACE TO SP-R.
005100     MOVE W-P02 TO SP-R.
005110     WRITE SP-R.
005120     MOVE SPACE TO SP-R.
005130     MOVE W-P03 TO SP-R.
005140     WRITE SP-R.
005150     MOVE SPACE TO SP-R.
005160     MOVE W-P04 TO SP-R.
005170     WRITE SP-R.
005180     MOVE SPACE TO SP-R.
005190     WRITE SP-R.
005200     MOVE 20 TO W-LC.
005210     IF W-HKC = 3                                                 I.070228
005220         GO TO M-56.                                              I.070228
005230 M-55.
005240     READ TDNNF NEXT RECORD WITH UNLOCK AT END
005250         GO TO M-85.
005260     IF TDNN1-PC = 0
005270         GO TO M-55.
005280     IF W-HKC = 1
005290         IF TDNN1-PC = 9
005300             GO TO M-55.
005310     IF W-HKC = 2
005320         IF TDNN1-PC NOT = 9
005330             GO TO M-55.
005340     IF W-HKC = 2
005350         MOVE TDNN1-SCD TO W-RSCD
005360         MOVE TDNN1-TCD TO W-RTCD
005370         IF W-RSTC < W-SSTC OR > W-ESTC
005380             GO TO M-55.
005390     IF W-HKC = 2
005400         IF TDNN1-DNOD < W-SDNO OR > W-EDNO
005410             GO TO M-55.
005420     IF (TDNN1-STC NOT = W-STC) OR (TDNN1-DNO NOT = W-DNO)
005430         GO TO M-60.
005440     IF TDNN1-DGN = ZERO
005450         DISPLAY E-ME78 E-ME2 E-ME99
005460         DISPLAY E-CL
005470         DISPLAY E-ME78
005480         GO TO M-50.
005490     GO TO M-57.                                                  I.070228
005500 M-56.                                                            I.070228
005510     READ TDNNRF AT END                                           I.070228
005520         GO TO M-85.                                              I.070228
005530     MOVE TDNNR1-SCD TO W-RSCD.                                   I.070228
005540     MOVE TDNNR1-TCD TO W-RTCD.                                   I.070228
005550     IF W-RSTC < W-SSTC OR > W-ESTC                               I.070228
005560         GO TO M-56.                                              I.070228
005570     IF TDNNR1-DNOD < W-SDNO OR > W-EDNO                          I.070228
005580         GO TO M-56.                                              I.070228
005590     IF (TDNNR1-STC NOT = W-STC) OR (TDNNR1-DNO NOT = W-DNO)      I.070228
005600         GO TO M-60.                                              I.070228
005610     IF TDNNR1-DGN = ZERO                                         I.070228
005620         DISPLAY E-ME78 E-ME2 E-ME99                              I.070228
005630         DISPLAY E-CL                                             I.070228
005640         DISPLAY E-ME78                                           I.070228
005650         GO TO M-50.                                              I.070228
005660 M-57.                                                            I.070228
005670     IF W-HKC = 1 OR 2                                            I.070228
005680         PERFORM MEI1-RTN THRU MEI1-EX                            I.070228
005690       ELSE                                                       I.070228
005700         PERFORM MEI2-RTN THRU MEI2-EX.                           I.070228
005710     IF W-HKC = 1 OR 2                                            I.070228
005720         GO TO M-55                                               I.070228
005730       ELSE                                                       I.070228
005740         GO TO M-56.                                              I.070228
005750*****MOVE SPACE TO W-P05 W-P06.                                   D.070228
005760*
005770*****MOVE TDNN2-SHN TO P-SHN.                                     D.070228
005780*****MOVE TDNN2-JAN TO P-JAN.                                     D.070228
005790*****MOVE TDNN2-COR TO P-COR.                                     D.070228
005800*****MOVE TDNN2-SIZ TO P-SIZ.                                     D.070228
005810*****MOVE TDNN2-GTN1 TO P-GTN1.                                   D.070228
005820*****MOVE TDNN2-UTN1 TO P-UTN1.                                   D.070228
005830*
005840*****MOVE TDNN2-KKK TO P-KKK.                                     D.070228
005850*****MOVE TDNN2-HSC TO P-HSC.                                     D.070228
005860*****MOVE TDNN2-GAR TO P-GAR.                                     D.070228
005870*****MOVE TDNN2-TNI TO P-TNI.                                     D.070228
005880*****MOVE TDNN2-SU TO P-SU.                                       D.070228
005890*****MOVE TDNN2-GTN2 TO P-GTN2.                                   D.070228
005900*****MOVE TDNN2-GKIN TO P-GKIN.                                   D.070228
005910*****MOVE TDNN2-UTN2 TO P-UTN2.                                   D.070228
005920*****MOVE TDNN2-UKIN TO P-UKIN.                                   D.070228
005930*
005940*****MOVE SPACE TO SP-R.                                          D.070228
005950*****MOVE W-P05 TO SP-R.                                          D.070228
005960*****WRITE SP-R.                                                  D.070228
005970*****MOVE SPACE TO SP-R.                                          D.070228
005980*****MOVE W-P06 TO SP-R.                                          D.070228
005990*****WRITE SP-R.                                                  D.070228
006000*****MOVE SPACE TO SP-R.                                          D.070228
006010*
006020*****SUBTRACT 2 FROM W-LC.                                        D.070228
006030*****ADD TDNN2-SU TO WT-SU.                                       D.070228
006040*****ADD TDNN2-GKIN TO WT-GKIN.                                   D.070228
006050*****ADD TDNN2-UKIN TO WT-UKIN.                                   D.070228
006060*****GO TO M-55.                                                  D.070228
006070 M-60.
006080     PERFORM KEI-RTN THRU KEI-EX.
006090     IF W-HKC = 1
006100         PERFORM REW-RTN THRU REW-EX.
006110     GO TO M-50.
006120 M-85.
006130     PERFORM KEI-RTN THRU KEI-EX.
006140     IF W-HKC = 1
006150         PERFORM REW-RTN THRU REW-EX.
006160 M-90.
006170     IF W-FOC NOT = 0
006180         IF W-HKC = 1 OR 2                                        I.070228
006190             CLOSE TDNNF                                          I.070228
006200           ELSE                                                   I.070228
006210             CLOSE TDNNRF.                                        I.070228
006220*****    CLOSE TDNNF.                                             D.070228
006230     IF W-POC NOT = 0
006240         CLOSE SP-F.
006250 M-95.
006260     DISPLAY C-CLEAR.
006270     STOP RUN.
006280 HED1-RTN.                                                        I.070228
006290     MOVE TDNN1-AR TO P-AR.                                       I.070228
006300     MOVE TDNN1-DUR TO P-DUR.                                     I.070228
006310     MOVE TDNN1-ER TO P-ER.                                       I.070228
006320*
006330     MOVE TDNN1-DSHR TO P-DSHR.                                   I.070228
006340     MOVE TDNN1-DSMR TO P-DSMR.                                   I.070228
006350     MOVE TDNN1-TSN TO P-TSN.                                     I.070228
006360*
006370     MOVE TDNN1-SNA TO P-SNA.                                     I.070228
006380*
006390     MOVE TDNN1-TNA TO P-TNA.                                     I.070228
006400     MOVE TDNN1-SCD TO P-SCD.                                     I.070228
006410     MOVE TDNN1-TCD TO P-TCD.                                     I.070228
006420     MOVE TDNN1-BCD TO P-BCD.                                     I.070228
006430     MOVE TDNN1-DPC TO P-DPC.                                     I.070228
006440     MOVE TDNN1-DNOD TO P-DNOD.                                   I.070228
006450     MOVE TDNN1-THC TO P-THC.                                     I.070228
006460     MOVE TDNN1-TST TO P-TST.                                     I.070228
006470     MOVE TDNN1-HNEN TO P-HNEN.                                   I.070228
006480     MOVE TDNN1-HGET TO P-HGET.                                   I.070228
006490     MOVE TDNN1-HPEY TO P-HPEY.                                   I.070228
006500     MOVE TDNN1-NNEN TO P-NNEN.                                   I.070228
006510     MOVE TDNN1-NGET TO P-NGET.                                   I.070228
006520     MOVE TDNN1-NPEY TO P-NPEY.                                   I.070228
006530*
006540     MOVE TDNN1-FUR TO P-FUR.                                     I.070228
006550*
006560     MOVE TDNN1-FSR TO P-FSR.                                     I.070228
006570     MOVE TDNN1-LUR TO P-LUR.                                     I.070228
006580*
006590     MOVE TDNN1-LCR TO P-LCR.                                     I.070228
006600*
006610     MOVE TDNN1-LSR TO P-LSR.                                     I.070228
006620 HED1-EX.                                                         I.070228
006630     EXIT.                                                        I.070228
006640 HED2-RTN.                                                        I.070228
006650     MOVE TDNNR1-AR TO P-AR.                                      I.070228
006660     MOVE TDNNR1-DUR TO P-DUR.                                    I.070228
006670     MOVE TDNNR1-ER TO P-ER.                                      I.070228
006680*
006690     MOVE TDNNR1-DSHR TO P-DSHR.                                  I.070228
006700     MOVE TDNNR1-DSMR TO P-DSMR.                                  I.070228
006710     MOVE TDNNR1-TSN TO P-TSN.                                    I.070228
006720*
006730     MOVE TDNNR1-SNA TO P-SNA.                                    I.070228
006740*
006750     MOVE TDNNR1-TNA TO P-TNA.                                    I.070228
006760     MOVE TDNNR1-SCD TO P-SCD.                                    I.070228
006770     MOVE TDNNR1-TCD TO P-TCD.                                    I.070228
006780     MOVE TDNNR1-BCD TO P-BCD.                                    I.070228
006790     MOVE TDNNR1-DPC TO P-DPC.                                    I.070228
006800     MOVE TDNNR1-DNOD TO P-DNOD.                                  I.070228
006810     MOVE TDNNR1-THC TO P-THC.                                    I.070228
006820     MOVE TDNNR1-TST TO P-TST.                                    I.070228
006830     MOVE TDNNR1-HNEN TO P-HNEN.                                  I.070228
006840     MOVE TDNNR1-HGET TO P-HGET.                                  I.070228
006850     MOVE TDNNR1-HPEY TO P-HPEY.                                  I.070228
006860     MOVE TDNNR1-NNEN TO P-NNEN.                                  I.070228
006870     MOVE TDNNR1-NGET TO P-NGET.                                  I.070228
006880     MOVE TDNNR1-NPEY TO P-NPEY.                                  I.070228
006890*
006900     MOVE TDNNR1-FUR TO P-FUR.                                    I.070228
006910*
006920     MOVE TDNNR1-FSR TO P-FSR.                                    I.070228
006930     MOVE TDNNR1-LUR TO P-LUR.                                    I.070228
006940*
006950     MOVE TDNNR1-LCR TO P-LCR.                                    I.070228
006960*
006970     MOVE TDNNR1-LSR TO P-LSR.                                    I.070228
006980 HED2-EX.                                                         I.070228
006990     EXIT.                                                        I.070228
007000 MEI1-RTN.                                                        I.070228
007010     MOVE SPACE TO W-P05 W-P06.                                   I.070228
007020*
007030     MOVE TDNN2-SHN TO P-SHN.                                     I.070228
007040     MOVE TDNN2-JAN TO P-JAN.                                     I.070228
007050     MOVE TDNN2-COR TO P-COR.                                     I.070228
007060     MOVE TDNN2-SIZ TO P-SIZ.                                     I.070228
007070     MOVE TDNN2-GTN1 TO P-GTN1.                                   I.070228
007080     MOVE TDNN2-UTN1 TO P-UTN1.                                   I.070228
007090*
007100     MOVE TDNN2-KKK TO P-KKK.                                     I.070228
007110     MOVE TDNN2-HSC TO P-HSC.                                     I.070228
007120     MOVE TDNN2-GAR TO P-GAR.                                     I.070228
007130     MOVE TDNN2-TNI TO P-TNI.                                     I.070228
007140     MOVE TDNN2-SU TO P-SU.                                       I.070228
007150     MOVE TDNN2-GTN2 TO P-GTN2.                                   I.070228
007160     MOVE TDNN2-GKIN TO P-GKIN.                                   I.070228
007170     MOVE TDNN2-UTN2 TO P-UTN2.                                   I.070228
007180     MOVE TDNN2-UKIN TO P-UKIN.                                   I.070228
007190*
007200     MOVE SPACE TO SP-R.                                          I.070228
007210     MOVE W-P05 TO SP-R.                                          I.070228
007220     WRITE SP-R.                                                  I.070228
007230     MOVE SPACE TO SP-R.                                          I.070228
007240     MOVE W-P06 TO SP-R.                                          I.070228
007250     WRITE SP-R.                                                  I.070228
007260     MOVE SPACE TO SP-R.                                          I.070228
007270*
007280     SUBTRACT 2 FROM W-LC.                                        I.070228
007290     ADD TDNN2-SU TO WT-SU.                                       I.070228
007300     ADD TDNN2-GKIN TO WT-GKIN.                                   I.070228
007310     ADD TDNN2-UKIN TO WT-UKIN.                                   I.070228
007320 MEI1-EX.                                                         I.070228
007330     EXIT.                                                        I.070228
007340 MEI2-RTN.                                                        I.070228
007350     MOVE SPACE TO W-P05 W-P06.                                   I.070228
007360*
007370     MOVE TDNNR2-SHN TO P-SHN.                                    I.070228
007380     MOVE TDNNR2-JAN TO P-JAN.                                    I.070228
007390     MOVE TDNNR2-COR TO P-COR.                                    I.070228
007400     MOVE TDNNR2-SIZ TO P-SIZ.                                    I.070228
007410     MOVE TDNNR2-GTN1 TO P-GTN1.                                  I.070228
007420     MOVE TDNNR2-UTN1 TO P-UTN1.                                  I.070228
007430*
007440     MOVE TDNNR2-KKK TO P-KKK.                                    I.070228
007450     MOVE TDNNR2-HSC TO P-HSC.                                    I.070228
007460     MOVE TDNNR2-GAR TO P-GAR.                                    I.070228
007470     MOVE TDNNR2-TNI TO P-TNI.                                    I.070228
007480     MOVE TDNNR2-SU TO P-SU.                                      I.070228
007490     MOVE TDNNR2-GTN2 TO P-GTN2.                                  I.070228
007500     MOVE TDNNR2-GKIN TO P-GKIN.                                  I.070228
007510     MOVE TDNNR2-UTN2 TO P-UTN2.                                  I.070228
007520     MOVE TDNNR2-UKIN TO P-UKIN.                                  I.070228
007530*
007540     MOVE SPACE TO SP-R.                                          I.070228
007550     MOVE W-P05 TO SP-R.                                          I.070228
007560     WRITE SP-R.                                                  I.070228
007570     MOVE SPACE TO SP-R.                                          I.070228
007580     MOVE W-P06 TO SP-R.                                          I.070228
007590     WRITE SP-R.                                                  I.070228
007600     MOVE SPACE TO SP-R.                                          I.070228
007610*
007620     SUBTRACT 2 FROM W-LC.                                        I.070228
007630     ADD TDNNR2-SU TO WT-SU.                                      I.070228
007640     ADD TDNNR2-GKIN TO WT-GKIN.                                  I.070228
007650     ADD TDNNR2-UKIN TO WT-UKIN.                                  I.070228
007660 MEI2-EX.                                                         I.070228
007670     EXIT.                                                        I.070228
007680 KEI-RTN.
007690     MOVE WT-SU TO P-SUT.
007700     MOVE WT-GKIN TO P-GKINT.
007710     MOVE WT-UKIN TO P-UKINT.
007720     SUBTRACT 1 FROM W-LC.
007730*
007740     MOVE SPACE TO SP-R.
007750     MOVE W-P07 TO SP-R.
007760     WRITE SP-R AFTER W-LC.
007770     MOVE SPACE TO SP-R.
007780     MOVE W-P08 TO SP-R.
007790     WRITE SP-R.
007800     MOVE SPACE TO SP-R.
007810     MOVE W-P09 TO SP-R.
007820     WRITE SP-R.
007830     MOVE SPACE TO SP-R.
007840     MOVE W-P10 TO SP-R.
007850     WRITE SP-R.
007860     MOVE SPACE TO SP-R.
007870 KEI-EX.
007880     EXIT.
007890 REW-RTN.
007900     MOVE SPACE TO TDNN1-KEY.
007910     MOVE W-STC TO TDNN1-STC.
007920     MOVE W-DNO TO TDNN1-DNO.
007930     START TDNNF KEY NOT < TDNN1-KEY INVALID KEY
007940         MOVE 255 TO COMPLETION-CODE
007950         DISPLAY E-ME78 E-ME10 E-ME99
007960         GO TO REW-EX.
007970 REW-05.
007980     READ TDNNF NEXT RECORD AT END
007990         GO TO REW-EX.
008000     IF TDNN1-PC = 0 OR 9                                         I.091215
008010         GO TO REW-05.                                            I.091215
008020     IF (TDNN1-STC NOT = W-STC) OR (TDNN1-DNO NOT = W-DNO)
008030         GO TO REW-EX.
008040     MOVE 9 TO TDNN1-PC.
008050     REWRITE TDNN-R1 INVALID KEY
008060         MOVE 255 TO COMPLETION-CODE
008070         DISPLAY E-ME78 E-STAT E-ME11 E-ME99
008080         GO TO REW-EX.
008090     GO TO REW-05.
008100 REW-EX.
008110     EXIT.
008120 TST-RTN.
008130     IF W-POC = 0
008140         OPEN OUTPUT SP-F
008150         MOVE 1 TO W-POC
008160         MOVE SPACE TO W-P01 W-P02 W-P03 W-P04 W-P05
008170                       W-P06 W-P07 W-P08 W-P09 W-P10
008180         MOVE W-20K TO P-20K
008190         MOVE ALL "X" TO P-AR P-DUR P-ER P-DSHR P-DSMR P-TSN
008200                         P-SNA P-TNA P-TST P-SHN P-JAN P-COR
008210                         P-SIZ P-KKK P-HSC P-GAR P-TNI P-FUR
008220                         P-FSR P-LUR P-LCR P-LSR
008230         MOVE 99 TO P-SCD P-BCD P-DPC P-HNEN P-HGET P-HPEY
008240                    P-NNEN P-NGET P-NPEY
008250         MOVE 999 TO P-TCD
008260         MOVE 99999 TO P-SU P-SUT
008270         MOVE 999999 TO P-THC P-GTN2 P-UTN2
008280         MOVE 9999999 TO P-DNOD
008290         MOVE 999999999 TO P-GKIN P-UKIN P-GKINT P-UKINT
008300       ELSE
008310         MOVE SPACE TO SP-R
008320         WRITE SP-R AFTER PAGE.
008330     MOVE SPACE TO SP-R.
008340     MOVE W-P01 TO SP-R.
008350     WRITE SP-R AFTER 2.
008360     MOVE SPACE TO SP-R.
008370     MOVE W-P02 TO SP-R.
008380     WRITE SP-R.
008390     MOVE SPACE TO SP-R.
008400     MOVE W-P03 TO SP-R.
008410     WRITE SP-R.
008420     MOVE SPACE TO SP-R.
008430     MOVE W-P04 TO SP-R.
008440     WRITE SP-R.
008450     MOVE SPACE TO SP-R.
008460     WRITE SP-R.
008470     MOVE ZERO TO W-LC.
008480 TST-05.
008490     MOVE SPACE TO SP-R.
008500     MOVE W-P05 TO SP-R.
008510     WRITE SP-R.
008520     MOVE SPACE TO SP-R.
008530     MOVE W-P06 TO SP-R.
008540     WRITE SP-R.
008550     MOVE SPACE TO SP-R.
008560     ADD 1 TO W-LC.
008570     IF W-LC < 9
008580         GO TO TST-05.
008590     MOVE SPACE TO SP-R.
008600     MOVE W-P07 TO SP-R.
008610     WRITE SP-R.
008620     MOVE SPACE TO SP-R.
008630     MOVE W-P08 TO SP-R.
008640     WRITE SP-R.
008650     MOVE SPACE TO SP-R.
008660     MOVE W-P09 TO SP-R.
008670     WRITE SP-R.
008680     MOVE SPACE TO SP-R.
008690     MOVE W-P10 TO SP-R.
008700     WRITE SP-R.
008710     MOVE SPACE TO SP-R.
008720 TST-EX.
008730     EXIT.
