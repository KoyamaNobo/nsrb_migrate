000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID.      JTN28U.
000030 AUTHOR.          ________.
000040*********************************************************
000050*    PROGRAM         :  有効在庫データ　作成 (生協)     *
000060*    PRINTER TYPE    :  JIPS                            *
000070*    DATA WRITTN     :  03/02/21                        *
000080*    COMPILE TYPE    :  CBL85 (74MODE)                  *
000090*********************************************************
000100 ENVIRONMENT      DIVISION.
000110 CONFIGURATION    SECTION.
000120 SOURCE-COMPUTER. NEAC-SYSTEM3100.
000130 OBJECT-COMPUTER. NEAC-SYSTEM3100.
000140 INPUT-OUTPUT     SECTION.
000150 FILE-CONTROL.
000160     SELECT JT-YZAI ASSIGN TO F1-MSD
000170         FILE STATUS ERR-STAT.
000180*****SELECT YZDF ASSIGN TO F2-FDU                                 D.031218
000190     SELECT YZDF ASSIGN TO F2-MSD                                 I.031218
000200         FILE STATUS ERR-STAT.
000210 DATA    DIVISION.
000220 FILE    SECTION.
000230 FD  JT-YZAI
000240     BLOCK  2 RECORDS
000250     LABEL RECORD STANDARD
000260     VALUE OF IDENTIFICATION WK0128ID.
000270 01  YZAI-R.
000280     02  YZAI-HCD            PIC  9(006).                         ﾋﾝﾒｲｺｰﾄﾞ
000290     02  YZAI-HNA            PIC  N(024).
000300     02  YZAI-KBN            PIC  N(003).
000310     02  YZAI-SIZ            PIC  9(001).                         ｻｲｽﾞｸﾌﾞﾝ
000320     02  YZAI-ASU.                                                ｻﾞｲｺｽｳ
000330       03  YZAI-SUD       OCCURS  10.                             ｻｲｽﾞﾍﾞﾂ
000340         04   YZAI-SU        PIC S9(006).
000350     02  YZAI-TSU            PIC S9(006).
000360     02  YZAI-KC             PIC  9(001).
000370 FD  YZDF
000380     BLOCK  2 RECORDS
000390     LABEL RECORD STANDARD
000400     VALUE OF IDENTIFICATION "SYZDF".                             I.031218
000410*****VALUE OF IDENTIFICATION "YZDF".                              D.031218
000420 01  YZD-R.
000430     02  YZD-HCD        PIC  X(006).
000440     02  YZD-HNA        PIC  N(024).
000450     02  YZD-KBN        PIC  N(003).
000460     02  YZD-SIZ        PIC  9(001).
000470     02  YZD-ASU.
000480       03  YZD-SUD   OCCURS  10.
000490         04  YZD-SU     PIC S9(006).
000500     02  YZD-TSU        PIC S9(006).
000510 WORKING-STORAGE  SECTION.
000520 77  ERR-STAT           PIC  X(002).
000530 77  W-ME               PIC  X(040).
000540 77  W-FILE             PIC  X(013).
000550 77  W-END              PIC  9(001) VALUE 0.
000560 77  WK0128ID           PIC  X(009) VALUE SPACE.
000570 01  STN-NO.
000580     02  STN-NO1        PIC  X(003).
000590     02  STN-NO2        PIC  X(003).
000600 01  W-FID.
000610     02  W-FID1         PIC  X(006) VALUE "WK0128".
000620     02  W-FID2         PIC  X(003).
000630 01  W-DATA.
000640     02  W-HCD          PIC  X(006).
000650     02  W-HNA          PIC  N(024).
000660     02  W-KBN          PIC  N(003).
000670     02  W-KC           PIC  9(001).
000680     02  W-ASUD.
000690       03  W-ASU   OCCURS   4.
000700         04  W-SUD   OCCURS  10.
000710           05  W-SU     PIC S9(006).
000720     02  W-SUT          PIC S9(006).
000730     02  W-S            PIC  9(001).
000740     02  CNT            PIC  9(002).
000750     02  W-TC           PIC  9(001).
000760     02  W-HCC          PIC  9(001).
000770     02  W-KBC          PIC  9(001).
000780     02  W-AZC.
000790       03  W-ZCD   OCCURS   4.
000800         04  W-ZC       PIC  9(001).
000810     02  W-AGSUD.
000820       03  W-AGSU   OCCURS   4.
000830         04  W-GSUD   OCCURS  10.
000840           05  W-GSU    PIC S9(006).
000850 SCREEN      SECTION.
000860 SD  C-CRT
000870     END  STATUS  IS  ESTAT.
000880 01  C-CLEAR.
000890     02  C-CL     LINE   1  CLEAR SCREEN.
000900 01  C-MID.
000910     02  DSP-MID.
000920       03  LINE  1  COLUMN 27  VALUE
000930            "                      " REVERSE.
000940       03  LINE  1  COLUMN 28  VALUE
000950           NC"有効在庫データ　作成".
000960*****  03  LINE 10  COLUMN 29  VALUE                              D.031218
000970*****      NC"フロッピー　セット" BLINK.                          D.031218
000980 01  C-ERR   LINE 24.
000990     02  E-ME    COLUMN  15  PIC  X(040)  FROM  W-ME.
001000     COPY LSSEM.
001010 PROCEDURE   DIVISION.
001020 M-05.
001030     DISPLAY C-CLEAR.
001040     DISPLAY C-MID.
001050     INITIALIZE W-DATA.
001060*
001070     CALL "CBLSTNNO" USING STN-NO.
001080     MOVE STN-NO2 TO W-FID2.
001090     MOVE W-FID TO WK0128ID.
001100     OPEN INPUT JT-YZAI.
001110     OPEN OUTPUT YZDF.
001120 M-10.
001130     READ JT-YZAI AT END
001140         MOVE 255 TO COMPLETION-CODE                              I.031218
001150         GO TO M-90.
001160     IF ZERO = YZAI-SU(01) AND YZAI-SU(02) AND YZAI-SU(03)
001170           AND YZAI-SU(04) AND YZAI-SU(05) AND YZAI-SU(06)
001180           AND YZAI-SU(07) AND YZAI-SU(08) AND YZAI-SU(09)
001190           AND YZAI-SU(10)
001200         GO TO M-10.
001210 M-15.
001220     MOVE YZAI-HCD TO W-HCD.
001230     MOVE YZAI-HNA TO W-HNA.
001240     MOVE ZERO TO W-AGSUD W-TC W-HCC.
001250 M-20.
001260     MOVE YZAI-KC TO W-KC.
001270     MOVE YZAI-KBN TO W-KBN.
001280     ADD 1 TO W-TC.
001290     MOVE ZERO TO W-ASUD W-SUT W-AZC.                             I.040716
001300*****MOVE ZERO TO W-ASUD W-SUT W-AZC CNT.                         D.040716
001310 M-25.                                                            I.040716
001320     MOVE ZERO TO CNT.                                            I.040716
001330 M-30.
001340     ADD 1 TO CNT.
001350     IF CNT > 10
001360         ADD YZAI-TSU TO W-SUT
001370         GO TO M-40.
001380     MOVE YZAI-SU(CNT) TO W-SU(YZAI-SIZ,CNT).
001390     IF YZAI-KC = 3
001400         SUBTRACT YZAI-SU(CNT) FROM W-GSU(YZAI-SIZ,CNT)
001410       ELSE
001420         ADD YZAI-SU(CNT) TO W-GSU(YZAI-SIZ,CNT).
001430     IF W-ZC(YZAI-SIZ) = 0
001440         IF YZAI-SU(CNT) NOT = ZERO
001450             MOVE 1 TO W-ZC(YZAI-SIZ).
001460     GO TO M-30.
001470 M-40.
001480     READ JT-YZAI AT END
001490         GO TO M-80.
001500     IF ZERO = YZAI-SU(01) AND YZAI-SU(02) AND YZAI-SU(03)
001510           AND YZAI-SU(04) AND YZAI-SU(05) AND YZAI-SU(06)
001520           AND YZAI-SU(07) AND YZAI-SU(08) AND YZAI-SU(09)
001530           AND YZAI-SU(10)
001540         GO TO M-40.
001550     IF YZAI-HCD NOT = W-HCD
001560         GO TO M-45.
001570     IF YZAI-KC = W-KC
001580         GO TO M-25.                                              I.040716
001590*****    GO TO M-30.                                              D.040716
001600     PERFORM S-05 THRU S-15.
001610     GO TO M-20.
001620 M-45.
001630     PERFORM S-05 THRU S-15.
001640     IF W-TC > 1
001650         PERFORM S-20 THRU S-45.
001660     GO TO M-15.
001670 M-80.
001680     PERFORM S-05 THRU S-15.
001690     IF W-TC > 1
001700         PERFORM S-20 THRU S-45.
001710 M-90.
001720     CLOSE JT-YZAI.
001730     CLOSE YZDF.
001740 M-95.
001750     DISPLAY C-CLEAR.
001760     STOP RUN.
001770 S-05.
001780     MOVE 0 TO W-S W-KBC.
001790 S-10.
001800     ADD 1 TO W-S.
001810     IF W-S = 5
001820         GO TO S-15.
001830     IF W-ZC(W-S) = 0
001840         GO TO S-10.
001850*
001860     MOVE SPACE TO YZD-R.
001870     INITIALIZE YZD-R.
001880     IF W-HCC = 0
001890         MOVE 1 TO W-HCC
001900         MOVE W-HCD TO YZD-HCD
001910         MOVE W-HNA TO YZD-HNA.
001920     IF W-KBC = 0
001930         MOVE 1 TO W-KBC
001940         MOVE W-KBN TO  YZD-KBN.
001950     MOVE W-S TO YZD-SIZ.
001960     MOVE W-ASU(W-S) TO YZD-ASU.
001970     IF W-S = 1
001980         IF 0 = W-ZC(2) AND W-ZC(3) AND W-ZC(4)
001990             MOVE W-SUT TO YZD-TSU.
002000     IF W-S = 2
002010         IF 0 = W-ZC(3) AND W-ZC(4)
002020             MOVE W-SUT TO YZD-TSU.
002030     IF W-S = 3
002040         IF 0 = W-ZC(4)
002050             MOVE W-SUT TO YZD-TSU.
002060     IF W-S = 4
002070         MOVE W-SUT TO YZD-TSU.
002080     WRITE YZD-R.
002090     IF ERR-STAT NOT = "00"
002100         MOVE 255 TO COMPLETION-CODE                              I.031218
002110         MOVE 9 TO W-END
002120         MOVE SPACE TO W-ME
002130         MOVE "***  WRITE ｴﾗｰ  ***" TO W-ME
002140         DISPLAY E-ME E-ME99
002150         GO TO S-15.
002160     GO TO S-10.
002170 S-15.
002180      EXIT.
002190 S-20.
002200     MOVE ZERO TO W-SUT W-AZC W-S.
002210 S-25.
002220     ADD 1 TO W-S.
002230     IF W-S = 5
002240         GO TO S-35.
002250     MOVE ZERO TO CNT.
002260 S-30.
002270     ADD 1 TO CNT.
002280     IF CNT > 10
002290         GO TO S-25.
002300     ADD W-GSU(W-S,CNT) TO W-SUT.
002310     IF W-ZC(W-S) = 0
002320         IF W-GSU(W-S,CNT) NOT = ZERO
002330             MOVE 1 TO W-ZC(W-S).
002340     GO TO S-30.
002350 S-35.
002360     MOVE 0 TO W-S W-KBC.
002370 S-40.
002380     ADD 1 TO W-S.
002390     IF W-S = 5
002400         GO TO S-45.
002410     IF W-ZC(W-S) = 0
002420         GO TO S-40.
002430*
002440     MOVE SPACE TO YZD-R.
002450     INITIALIZE YZD-R.
002460     IF W-KBC = 0
002470         MOVE 1 TO W-KBC
002480         MOVE NC"合　計" TO  YZD-KBN.
002490     MOVE W-S TO YZD-SIZ.
002500     MOVE W-AGSU(W-S) TO YZD-ASU.
002510     IF W-S = 1
002520         IF 0 = W-ZC(2) AND W-ZC(3) AND W-ZC(4)
002530             MOVE W-SUT TO YZD-TSU.
002540     IF W-S = 2
002550         IF 0 = W-ZC(3) AND W-ZC(4)
002560             MOVE W-SUT TO YZD-TSU.
002570     IF W-S = 3
002580         IF 0 = W-ZC(4)
002590             MOVE W-SUT TO YZD-TSU.
002600     IF W-S = 4
002610         MOVE W-SUT TO YZD-TSU.
002620     WRITE YZD-R.
002630     IF ERR-STAT NOT = "00"
002640         MOVE 255 TO COMPLETION-CODE                              I.031218
002650         MOVE 9 TO W-END
002660         MOVE SPACE TO W-ME
002670         MOVE "***  WRITE ｴﾗｰ  ***" TO W-ME
002680         DISPLAY E-ME E-ME99
002690         GO TO S-30.
002700     GO TO S-40.
002710 S-45.
002720      EXIT.
