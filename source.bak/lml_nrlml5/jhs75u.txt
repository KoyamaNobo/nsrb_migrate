000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JHS75U.
000030***********************************************************
000040*    PROGRAM         :  パーティハウス　請求データ抽出    *
000050*    PRINTER TYPE    :  JIPS                              *
000060*    SCREEN          :  ******                            *
000070*    COMPILE TYPE    :  COBOL                             *
000080***********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT TDIRF ASSIGN TO TDIR-MSD.
000160     SELECT PTSKF ASSIGN TO AKSK-MSD.
000170 DATA DIVISION.
000180 FILE SECTION.
000190 FD  TDIRF
000200     BLOCK  1 RECORDS
000210     LABEL RECORD IS STANDARD
000220     VALUE OF IDENTIFICATION "TDIRF".
000230 01  TDIR-R.
000240     02  TDIR-KEY.
000250       03  TDIR-DNO     PIC  9(006).
000260       03  TDIR-GNO     PIC  9(001).
000270     02  TDIR-DATE      PIC  9(006).
000280     02  TDIR-TCD       PIC  9(004).
000290     02  TDIR-CCD       PIC  9(003).
000300     02  TDIR-TPC       PIC  9(004).                              I.100906
000310     02  TDIR-HCD       PIC  9(006).
000320     02  TDIR-SIZ       PIC  X(003).
000330     02  TDIR-SKB       PIC  9(001).
000340     02  TDIR-SNO       PIC  9(002).
000350     02  TDIR-SU        PIC S9(005).
000360     02  TDIR-GT        PIC  9(007).
000370     02  TDIR-UT        PIC  9(007).
000380     02  TDIR-GKIN      PIC S9(008).
000390     02  TDIR-UKIN      PIC S9(008).
000400     02  TDIR-JNOD.
000410       03  TDIR-JNO     PIC  9(006).
000420       03  TDIR-JGN     PIC  9(001).
000430     02  TDIR-SOK       PIC  9(001).
000440     02  TDIR-UNS       PIC  9(001).
000450     02  TDIR-ISU       PIC  9(003).
000460     02  TDIR-HNO       PIC  X(010).
000470     02  TDIR-TEKI      PIC  N(028).
000480     02  TDIR-TRN       PIC  X(020).
000490     02  TDIR-JAN       PIC  X(013).
000500     02  F              PIC  X(052).
000510     02  TDIR-NNGP      PIC  9(006).
000520     02  TDIR-NHMS      PIC  9(006).
000530     02  TDIR-RNGP      PIC  X(008).
000540     02  TDIR-PRC       PIC  9(001).
000550     02  TDIR-UPC       PIC  9(001).
000560 FD  PTSKF
000570     BLOCK  4 RECORDS
000580     LABEL RECORD IS STANDARD
000590     VALUE OF IDENTIFICATION "WK0064000".
000600 01  PTSK-R.
000610     02  PTSK-DATE        PIC  9(006).
000620     02  PTSK-STC         PIC  9(003).
000630     02  PTSK-DNO         PIC  9(006).
000640     02  PTSK-KIN         PIC S9(010).
000650     02  F                PIC  X(039).
000660 WORKING-STORAGE  SECTION.
000670 77  ERR-STAT           PIC  X(002).
000680 77  W-FILE             PIC  X(013).
000690 77  W-END              PIC  9(001) VALUE 0.
000700 01  W-DATA.
000710     02  W-NGP          PIC  9(008).
000720     02  W-NGPD  REDEFINES W-NGP.
000730       03  W-NEN1       PIC  9(002).
000740       03  W-NGPS       PIC  9(006).
000750     02  W-D.
000760       03  W-DATE       PIC  9(006).
000770       03  W-STC        PIC  9(003).
000780       03  W-DNO        PIC  9(006).
000790       03  W-KIN        PIC S9(010).
000800     02  W-TKIN         PIC S9(010).
000810     02  W-SNGP.
000820       03  W-SNEN       PIC  9(004).
000830       03  W-SNENL REDEFINES W-SNEN.
000840         04  W-SNEN1    PIC  9(002).
000850         04  W-SNEN2    PIC  9(002).
000860       03  W-SGET       PIC  9(002).
000870       03  W-SPEY       PIC  9(002).
000880     02  W-SNGPD  REDEFINES W-SNGP.
000890       03  W-SNG        PIC  9(006).
000900       03  F            PIC  9(002).
000910     02  W-ENGP.                                                  I.100201
000920       03  W-ENEN       PIC  9(004).                              I.100201
000930       03  W-ENENL REDEFINES W-ENEN.                              I.100201
000940         04  W-ENEN1    PIC  9(002).                              I.100201
000950         04  W-ENEN2    PIC  9(002).                              I.100201
000960       03  W-EGET       PIC  9(002).                              I.100201
000970       03  W-EPEY       PIC  9(002).                              I.100201
000980     02  W-ENGPD  REDEFINES W-ENGP.                               I.100201
000990       03  W-ENG        PIC  9(006).                              I.100201
001000       03  F            PIC  9(002).                              I.100201
001010     02  W-ENGPL  REDEFINES W-ENGP.                               I.100201
001020       03  F            PIC  9(002).                              I.100201
001030       03  W-ENGPS      PIC  9(006).                              I.100201
001040     02  W-DMM          PIC  9(001).
001050     COPY LSTAT.
001060 SCREEN SECTION.
001070 SD  C-CRT
001080     END STATUS IS ESTAT.
001090 01  C-CLEAR.
001100     02  C-CL    LINE   1  CLEAR SCREEN.
001110 01  C-MID.
001120     02  LINE   1  COLUMN  15  PIC  N(025) VALUE
001130          NC"＊＊＊　　パーティハウス　請求データ抽出　　＊＊＊".
001140     02  LINE  10  COLUMN  16  PIC  X(046) VALUE
001150          "｛   '  年   月   日  〜  '  年   月   日   ｝".
001160     02  LINE  22  COLUMN  43  PIC  X(022) VALUE
001170          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001180 01  C-ACP.
001190     02  LINE  10.
001200       03  A-SNEN  COLUMN  22  PIC  9(002)
001210            USING W-SNEN2                NO IFC.
001220       03  A-SGET  COLUMN  27  PIC  9(002)
001230            USING W-SGET                 NO IFC.
001240       03  A-SPEY  COLUMN  32  PIC  9(002)
001250            USING W-SPEY  CHECK OVERFLOW NO IFC.
001260       03  A-ENEN  COLUMN  43  PIC  9(002)
001270            USING W-ENEN2                NO IFC.
001280       03  A-EGET  COLUMN  48  PIC  9(002)
001290            USING W-EGET                 NO IFC.
001300       03  A-EPEY  COLUMN  53  PIC  9(002)
001310            USING W-EPEY  CHECK OVERFLOW NO IFC.
001320     02  A-DMM   LINE  22  COLUMN  60  PIC  9(001)
001330          USING W-DMM   CHECK OVERFLOW NO IFC.
001340 01  C-ERR.
001350     02  LINE  24.
001360       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001370            "***  DATA ﾅｼ  ***".
001380     COPY LSSEM.
001390 PROCEDURE DIVISION.
001400 M-05.
001410     DISPLAY C-CLEAR.
001420     DISPLAY C-MID.
001430     MOVE ZERO TO W-DATA.
001440     ACCEPT W-ENGPS FROM DATE.
001450     DISPLAY A-ENEN A-EGET A-EPEY.
001460     MOVE 20 TO W-NEN1 W-SNEN1 W-ENEN1.
001470 M-10.
001480     ACCEPT A-SNEN.
001490     IF ESTAT = PF9
001500         MOVE 255 TO COMPLETION-CODE
001510         GO TO M-95.
001520     IF ESTAT NOT = HTB AND SKP AND NOC
001530         GO TO M-10.
001540 M-15.
001550     ACCEPT A-SGET.
001560     IF ESTAT = BTB
001570         GO TO M-10.
001580     IF ESTAT NOT = HTB AND SKP AND NOC
001590         GO TO M-15.
001600     IF W-SGET < 1 OR > 12
001610         GO TO M-15.
001620 M-20.
001630     ACCEPT A-SPEY.
001640     IF ESTAT = BTB
001650         GO TO M-15.
001660     IF ESTAT NOT = HTB AND SKP
001670         GO TO M-20.
001680     IF W-SPEY < 1 OR > 31
001690         GO TO M-20.
001700 M-25.
001710     ACCEPT A-ENEN.
001720     IF ESTAT = BTB
001730         GO TO M-20.
001740     IF ESTAT NOT = HTB AND SKP AND NOC
001750         GO TO M-25.
001760     IF W-SNEN2 > W-ENEN2
001770         GO TO M-25.
001780 M-30.
001790     ACCEPT A-EGET.
001800     IF ESTAT = BTB
001810         GO TO M-25.
001820     IF ESTAT NOT = HTB AND SKP AND NOC
001830         GO TO M-30.
001840     IF W-EGET < 1 OR > 12
001850         GO TO M-30.
001860     IF W-SNG > W-ENG
001870         GO TO M-30.
001880 M-35.
001890     ACCEPT A-EPEY.
001900     IF ESTAT = BTB
001910         GO TO M-30.
001920     IF ESTAT NOT = HTB AND SKP
001930         GO TO M-35.
001940     IF W-EPEY < 1 OR > 31
001950         GO TO M-35.
001960     IF W-SNGP > W-ENGP
001970         GO TO M-35.
001980 M-40.
001990     ACCEPT A-DMM.
002000     IF ESTAT = BTB
002010         GO TO M-35.
002020     IF ESTAT NOT = HTB AND SKP
002030         GO TO M-40.
002040     IF W-DMM = 9
002050         GO TO M-10.
002060     IF W-DMM NOT = 1
002070         GO TO M-40.
002080*
002090     OPEN INPUT TDIRF.
002100     OPEN OUTPUT PTSKF.
002110 M-50.
002120     READ TDIRF AT END
002130         MOVE 255 TO COMPLETION-CODE
002140         DISPLAY E-ME1 E-ME99
002150         GO TO M-90.
002160     IF TDIR-TCD NOT = 6010
002170         GO TO M-50.
002180     MOVE TDIR-DATE TO W-NGPS.
002190     IF W-NGP < W-SNGP OR > W-ENGP
002200         GO TO M-50.
002210 M-55.
002220     MOVE ZERO TO W-D.
002230     MOVE TDIR-DATE TO W-DATE.
002240     IF TDIR-CCD = 007
002250         MOVE 727 TO W-STC
002260       ELSE
002270         MOVE 702 TO W-STC.
002280     MOVE TDIR-DNO TO W-DNO.
002290 M-60.
002300     ADD TDIR-GKIN TO W-KIN.
002310 M-65.
002320     READ TDIRF AT END
002330         GO TO M-80.
002340     IF TDIR-TCD NOT = 6010
002350         GO TO M-65.
002360     MOVE TDIR-DATE TO W-NGPS.
002370     IF W-NGP < W-SNGP OR > W-ENGP
002380         GO TO M-65.
002390     IF TDIR-DATE = W-DATE
002400         IF TDIR-DNO = W-DNO
002410             GO TO M-60.
002420     PERFORM WRI-RTN THRU WRI-EX.
002430     GO TO M-55.
002440 M-80.
002450     PERFORM WRI-RTN THRU WRI-EX.
002460     INITIALIZE PTSK-R.
002470     MOVE W-TKIN TO PTSK-KIN.
002480     WRITE PTSK-R.
002490 M-90.
002500     CLOSE TDIRF.
002510     CLOSE PTSKF.
002520 M-95.
002530     DISPLAY C-CLEAR.
002540     STOP RUN.
002550 WRI-RTN.
002560     INITIALIZE PTSK-R.
002570     MOVE W-DATE TO PTSK-DATE.
002580     MOVE W-DNO TO PTSK-DNO.
002590     MOVE W-STC TO PTSK-STC.
002600     MOVE W-KIN TO PTSK-KIN.
002610     WRITE PTSK-R.
002620*
002630     ADD W-KIN TO W-TKIN.
002640 WRI-EX.
002650     EXIT.
