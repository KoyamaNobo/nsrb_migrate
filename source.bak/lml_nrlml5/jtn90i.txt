000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JTN90I.
000030*********************************************************
000040*    PROGRAM         :  受注サイズ無預り入力            *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCHM21                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE RANDOM
000180         RECORD KEY T-KEY
000190         ALTERNATE RECORD KEY T-KEY2
000200         FILE STATUS IS ERR-STAT.
000210     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE RANDOM
000240         RECORD KEY HI-KEY
000250         ALTERNATE RECORD KEY HI-KEY2
000260         FILE STATUS IS ERR-STAT.
000270     SELECT JAZF ASSIGN TO JAZ-MSD
000280         ORGANIZATION INDEXED
000290         ACCESS MODE DYNAMIC
000300         RECORD KEY JAZ-KEY
000310         FILE STATUS IS ERR-STAT.
000320     SELECT SP-F ASSIGN TO P-PRN999.
000330 I-O-CONTROL.
000340     APPLY SHARED-MODE ON T-M
000350     APPLY SHARED-MODE ON HI-M
000360     APPLY SHARED-MODE ON JAZF
000370     APPLY SHIFT-CODE  ON SP-F.
000380 DATA DIVISION.
000390 FILE SECTION.
000400     COPY LITM.
000410     COPY LIHIM.
000420 FD  JAZF
000430     BLOCK 12 RECORDS
000440     LABEL RECORD IS STANDARD
000450     VALUE OF IDENTIFICATION "JAZF".
000460 01  JAZ-R.
000470     02  JAZ-KEY.
000480       03  JAZ-TCD          PIC 9(04).
000490       03  JAZ-HCD          PIC 9(06).
000500     02  JAZ-DATE           PIC 9(06).
000510     02  F                  PIC X(05).
000520     COPY LSPF.
000530 WORKING-STORAGE SECTION.
000540 77  W-FILE             PIC  X(013).
000550 01  ERR-STAT           PIC  X(002).
000560 01  HEAD1.
000570     02  F              PIC  X(005) VALUE ""3FE04FE080"".
000580     02  F              PIC  X(022) VALUE SPACE.
000590     02  F              PIC  N(024) VALUE
000600          NC"＊＊＊　　サイズ未決定　預りありリスト　　＊＊＊".
000610     02  F              PIC  X(006) VALUE SPACE.
000620     02  F              PIC  X(005) VALUE "DATE ".
000630     02  H-DATE         PIC 99B99B99.
000640     02  F              PIC  X(007) VALUE "     P.".
000650     02  H-PAGE         PIC Z9.
000660 01  HEAD2.
000670     02  F              PIC  X(005) VALUE ""3FE04F40A0"".
000680     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
000690     02  F              PIC  N(010) VALUE
000700          NC"得　　意　　先　　名".
000710     02  F              PIC  X(026) VALUE SPACE.
000720     02  F              PIC  X(006) VALUE "ｺｰﾄﾞ  ".
000730     02  F              PIC  N(008) VALUE NC"品　　　　　名　".
000740     02  F              PIC  X(027) VALUE SPACE.
000750     02  F              PIC  N(004) VALUE NC"入力日付".
000760     02  F              PIC  X(001) VALUE SPACE.
000770 01  W-P.
000780     02  P-TCD          PIC  9(004).
000790     02  F              PIC  X(001).
000800     02  P-TNA          PIC  N(026).
000810     02  F              PIC  X(001).
000820     02  P-HCD          PIC  9(006).
000830     02  F              PIC  X(001).
000840     02  P-HNA          PIC  N(024).
000850     02  F              PIC  X(002).
000860     02  P-DATE         PIC  99/99/99.
000870 01  W-DATA.
000880     02  W-ACT          PIC  9(001).
000890     02  W-DMM          PIC  9(001).
000900     02  W-KEY.
000910       03  W-TCD        PIC  9(004).
000920       03  W-HCD        PIC  9(006).
000930     02  W-TCDF         PIC  9(004).
000940     02  W-TCDR         PIC  9(004).
000950     02  W-HCDF         PIC  9(006).
000960     02  W-HCDR         PIC  9(006).
000970     02  CHK            PIC  9(001).
000980     02  W-L            PIC  9(002).
000990     02  W-PAGE         PIC  9(002).
001000     02  W-DATE         PIC  9(006).
001010     02  W-END          PIC  9(001).
001020     COPY LSTAT.
001030 SCREEN SECTION.
001040 SD  C-CRT
001050     END STATUS ESTAT.
001060 01  C-CLEAR.
001070     02  LINE   1  CLEAR SCREEN.
001080 01  C-MID.
001090     02  LINE   1  COLUMN  19  PIC  N(021) VALUE
001100          NC"＊＊＊　　サイズ未決定預り　入力　　＊＊＊".
001110     02  LINE   3  COLUMN  19  PIC  X(043) VALUE
001120            "登録=1 削除=3 作表=4 問合せ=5 終了=9   ﾘﾀｰﾝ".
001130 01  C-MID1.
001140     02  LINE  05.
001150       03  COLUMN   4  PIC  X(004) VALUE "ｺｰﾄﾞ".
001160       03  COLUMN  16  PIC  N(006) VALUE NC"得意先名".
001170     02  LINE  07.
001180       03  COLUMN   4  PIC  X(004) VALUE "ｺｰﾄﾞ".
001190       03  COLUMN  16  PIC  N(004) VALUE NC"品　　名".
001200     02  LINE  22  COLUMN  39  PIC  X(022) VALUE
001210          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001220 01  C-MID4.
001230     02  LINE  09.
001240       03  COLUMN  25  PIC  N(003) VALUE NC"得意先".
001250       03  COLUMN  39  PIC  N(001) VALUE NC"〜".
001260     02  LINE  11.
001270       03  COLUMN  25  PIC  N(003) VALUE NC"品　名".
001280       03  COLUMN  39  PIC  N(001) VALUE NC"〜".
001290     02  LINE  22  COLUMN  39  PIC  X(022) VALUE
001300          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001310 01  C-MID5.
001320     02  LINE  05.
001330       03  COLUMN   4  PIC  X(004) VALUE "ｺｰﾄﾞ".
001340       03  COLUMN  16  PIC  N(006) VALUE NC"得意先名".
001350     02  LINE  07.
001360       03  COLUMN   5  PIC  X(004) VALUE "ｺｰﾄﾞ".
001370       03  COLUMN  11  PIC  N(004) VALUE NC"品　　名".
001380       03  COLUMN  61  PIC  N(004) VALUE NC"入力日".
001390     02  LINE  22  COLUMN  23  PIC  X(031) VALUE
001400          "NEXT=ENTER , ｺｰﾄﾞ入力=BACKSPACE".
001410 01  C-ACP.
001420     02  A-ACT   LINE   3  COLUMN  57  PIC  9(001)
001430          USING W-ACT   CHECK OVERFLOW NO IFC.
001440     02  C-ACP1.
001450       03  A-TCD   LINE   5  COLUMN  10  PIC  9(004)
001460            USING W-TCD   CHECK OVERFLOW NO IFC.
001470       03  A-HCD   LINE   7  COLUMN   9  PIC  9(006)
001480            USING W-HCD   CHECK OVERFLOW NO IFC.
001490     02  C-ACP4.
001500       03  LINE   9.
001510         04  A-TCDF  COLUMN  33  PIC  9(004)
001520            USING W-TCDF  CHECK OVERFLOW NO IFC.
001530         04  A-TCDR  COLUMN  43  PIC  9(004)
001540            USING W-TCDR  CHECK OVERFLOW NO IFC.
001550       03  LINE  11.
001560         04  A-HCDF  COLUMN  32  PIC  9(006)
001570            USING W-HCDF  CHECK OVERFLOW NO IFC.
001580         04  A-HCDR  COLUMN  42  PIC  9(006)
001590            USING W-HCDR  CHECK OVERFLOW NO IFC.
001600     02 A-DMM    LINE  22  COLUMN  56  PIC  9(001)
001610         USING W-DMM   CHECK OVERFLOW NO IFC.
001620 01  C-DSP.
001630     02  D-TNA   LINE   5  COLUMN  25  PIC  N(026) FROM  T-NAME.
001640     02  D-HNA   LINE   7  COLUMN  25  PIC  N(024) FROM  HI-NAME.
001650     02  D-MEI   LINE  W-L.
001660       03  COLUMN   4  PIC  9(006) FROM  JAZ-HCD.
001670       03  COLUMN  11  PIC  N(024) FROM  HI-NAME.
001680       03  COLUMN  60  PIC 99/99/99 FROM  JAZ-DATE.
001690 01  C-ERR.
001700     02  LINE  24.
001710       03  E-ME1   COLUMN  15  PIC  X(023) VALUE
001720            "***  ﾄｳﾛｸ ｽﾞﾐ  ***".
001730       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001740            "***  DATA ﾅｼ  ***".
001750       03  E-ME3   COLUMN  15  PIC  X(018) VALUE
001760            "***  END DATA  ***".
001770       03  E-ME5   COLUMN  15  PIC  X(024) VALUE
001780            "***  JAZF WRITE ｴﾗｰ  ***".
001790       03  E-ME6   COLUMN  15  PIC  X(025) VALUE
001800            "***  JAZF DELETE ｴﾗｰ  ***".
001810     COPY LSSEM.
001820 PROCEDURE DIVISION.
001830 M-05.
001840     DISPLAY C-CLEAR.
001850     DISPLAY C-MID.
001860     MOVE ZERO TO W-DATA.
001870     ACCEPT W-DATE FROM DATE.
001880     OPEN INPUT T-M HI-M.
001890 M-10.
001900     ACCEPT A-ACT.
001910     IF ESTAT = PF9
001920         GO TO M-95.
001930     IF ESTAT NOT = HTB AND SKP
001940         GO TO M-10.
001950     IF W-ACT = 9
001960         GO TO M-95.
001970     IF W-ACT = 4
001980         DISPLAY C-CLEAR
001990         DISPLAY C-MID A-ACT C-MID4
002000         GO TO M-45.
002010     IF W-ACT = 5
002020         DISPLAY C-CLEAR
002030         DISPLAY C-MID A-ACT C-MID5
002040         OPEN INPUT JAZF
002050         GO TO M-15.
002060     IF W-ACT NOT = 1 AND 3
002070         GO TO M-15.
002080     DISPLAY C-CLEAR.
002090     DISPLAY C-MID A-ACT C-MID1.
002100     OPEN I-O JAZF.
002110 M-15.
002120     ACCEPT A-TCD.
002130     DISPLAY E-CL.
002140     IF ESTAT = BTB
002150         CLOSE JAZF
002160         GO TO M-10.
002170     IF ESTAT NOT = HTB AND SKP
002180         GO TO M-15.
002190*
002200     MOVE W-TCD TO T-TCD.
002210     READ T-M WITH UNLOCK INVALID KEY
002220         GO TO M-15.
002230     DISPLAY D-TNA.
002240     IF W-ACT = 5
002250         GO TO M-40.
002260 M-20.
002270     ACCEPT A-HCD.
002280     DISPLAY E-CL.
002290     IF ESTAT = BTB
002300         GO TO M-15.
002310     IF ESTAT NOT = HTB AND SKP
002320         GO TO M-20.
002330*
002340     MOVE W-HCD TO HI-HCD.
002350     READ HI-M WITH UNLOCK INVALID KEY
002360         GO TO M-20.
002370     DISPLAY D-HNA.
002380*
002390     MOVE W-KEY TO JAZ-KEY.
002400     READ JAZF INVALID KEY
002410         GO TO M-25.
002420     IF W-ACT = 1
002430         DISPLAY E-ME1 E-ME98
002440         GO TO M-20.
002450     GO TO M-30.
002460 M-25.
002470     IF W-ACT NOT = 1
002480         DISPLAY E-ME2 E-ME98
002490         GO TO M-20.
002500 M-30.
002510     ACCEPT A-DMM.
002520     IF ESTAT = BTB
002530         GO TO M-20.
002540     IF ESTAT NOT = HTB AND SKP
002550         GO TO M-30.
002560     IF W-DMM = 9
002570         GO TO M-15.
002580     IF W-DMM NOT = 1
002590         GO TO M-30.
002600*
002610     IF W-ACT = 3
002620         GO TO M-35.
002630     INITIALIZE JAZ-R.
002640     MOVE W-KEY TO JAZ-KEY.
002650     MOVE W-DATE TO JAZ-DATE.
002660     WRITE JAZ-R INVALID KEY
002670         CLOSE JAZF
002680         DISPLAY E-STAT E-ME5 E-ME99
002690         GO TO M-10.
002700     GO TO M-20.
002710 M-35.
002720     DELETE JAZF INVALID KEY
002730         CLOSE JAZF
002740         DISPLAY E-ME6 E-ME99
002750         GO TO M-10.
002760     GO TO M-20.
002770 M-40.
002780     MOVE ZERO TO JAZ-KEY.
002790     MOVE W-TCD TO JAZ-TCD.
002800     START JAZF KEY NOT < JAZ-KEY INVALID KEY
002810         DISPLAY E-ME2 E-ME98
002820         GO TO M-15.
002830     READ JAZF NEXT RECORD WITH UNLOCK AT END
002840         DISPLAY E-ME2 E-ME98
002850         GO TO M-15.
002860     IF JAZ-TCD NOT = W-TCD
002870         DISPLAY E-ME2 E-ME98
002880         GO TO M-15.
002890     MOVE 0 TO W-END.
002900     MOVE 7 TO W-L.
002910     PERFORM DSP-RTN THRU DSP-EX.
002920     IF W-END = 1
002930         GO TO M-15.
002940 M-45.
002950     PERFORM PAC-RTN THRU PAC-EX.
002960     IF ESTAT = BTB
002970         GO TO M-10.
002980*
002990     OPEN INPUT JAZF.
003000     MOVE ZERO TO JAZ-KEY.
003010     MOVE W-TCDF TO JAZ-TCD.
003020     MOVE W-HCDF TO JAZ-HCD.
003030     START JAZF KEY NOT < JAZ-KEY INVALID KEY
003040         CLOSE JAZF
003050         DISPLAY E-ME2 E-ME98
003060         GO TO M-45.
003070 M-50.
003080     READ JAZF NEXT RECORD WITH UNLOCK AT END
003090         CLOSE JAZF
003100         DISPLAY E-ME2 E-ME98
003110         GO TO M-45.
003120     IF JAZ-TCD < W-TCDF OR > W-TCDR
003130         GO TO M-50.
003140     IF JAZ-HCD < W-HCDF OR > W-HCDR
003150         GO TO M-50.
003160*
003170     OPEN OUTPUT SP-F.
003180     PERFORM MID-020 THRU MID-EX.
003190 M-55.
003200     PERFORM LST-RTN THRU LST-EX.                                 I.960913
003210 M-60.
003220     READ JAZF NEXT RECORD WITH UNLOCK AT END
003230         CLOSE JAZF
003240         GO TO M-10.
003250     IF JAZ-TCD > W-TCDR
003260         CLOSE JAZF
003270         GO TO M-10.
003280     IF JAZ-HCD < W-HCDF OR > W-HCDR
003290         GO TO M-60.
003300     GO TO M-55.
003310 M-95.
003320     DISPLAY C-CLEAR.
003330     STOP RUN.
003340 DSP-RTN.
003350     MOVE JAZ-HCD TO HI-HCD.
003360     READ HI-M WITH UNLOCK INVALID KEY
003370         MOVE SPACE TO HI-NAME.
003380     ADD 1 TO W-L.
003390     IF W-L = 21
003400         GO TO DSP-020.
003410     DISPLAY D-MEI.
003420*
003430     READ JAZF NEXT RECORD WITH UNLOCK AT END
003440         MOVE 1 TO W-END
003450         DISPLAY E-ME3
003460         GO TO DSP-020.
003470     IF JAZ-TCD NOT = W-TCD
003480         MOVE 1 TO W-END
003490         DISPLAY E-ME3
003500         GO TO DSP-020.
003510     GO TO DSP-RTN.
003520 DSP-020.
003530     ACCEPT A-DMM.
003540     IF ESTAT NOT = HTB AND SKP AND BTB
003550         GO TO DSP-020.
003560     IF ESTAT = BTB
003570         MOVE 1 TO W-END.
003580     DISPLAY C-CLEAR.
003590     DISPLAY C-MID A-ACT C-MID5.
003600     IF W-END = 1
003610         GO TO DSP-EX.
003620     DISPLAY A-TCD D-TNA E-CL.
003630     MOVE 7 TO W-L.
003640     GO TO DSP-RTN.
003650 DSP-EX.
003660     EXIT.
003670 PAC-RTN.
003680     ACCEPT A-TCDF.
003690     DISPLAY E-CL.
003700     IF ESTAT = BTB
003710         GO TO PAC-EX.
003720     IF ESTAT NOT = HTB AND SKP
003730         GO TO PAC-RTN.
003740 PAC-020.
003750     ACCEPT A-TCDR.
003760     IF ESTAT = BTB
003770         GO TO PAC-RTN.
003780     IF ESTAT NOT = HTB AND SKP
003790         GO TO PAC-020.
003800     IF W-TCDF > W-TCDR
003810         GO TO PAC-020.
003820 PAC-040.
003830     ACCEPT A-HCDF.
003840     IF ESTAT = BTB
003850         GO TO PAC-020.
003860     IF ESTAT NOT = HTB AND SKP
003870         GO TO PAC-040.
003880 PAC-060.
003890     ACCEPT A-HCDR.
003900     IF ESTAT = BTB
003910         GO TO PAC-040.
003920     IF ESTAT NOT = HTB AND SKP
003930         GO TO PAC-060.
003940     IF W-HCDF > W-HCDR
003950         GO TO PAC-060.
003960 PAC-080.
003970     ACCEPT A-DMM.
003980     IF ESTAT = BTB
003990         GO TO PAC-060.
004000     IF ESTAT NOT = HTB AND SKP
004010         GO TO PAC-080.
004020     IF W-DMM = 9
004030         GO TO PAC-RTN.
004040     IF W-DMM NOT = 1
004050         GO TO PAC-080.
004060 PAC-EX.
004070     EXIT.
004080 LST-RTN.
004090     MOVE 0 TO CHK.
004100     MOVE JAZ-TCD TO W-TCD.
004110     MOVE W-TCD TO T-TCD.
004120     READ T-M WITH UNLOCK INVALID KEY
004130         MOVE SPACE TO T-NAME
004140         MOVE NC"　　＊＊　マスターなし　＊＊" TO T-NAME.
004150 LST-020.
004160     MOVE JAZ-HCD TO HI-HCD.
004170     READ HI-M WITH UNLOCK INVALID KEY
004180         MOVE SPACE TO HI-NAME
004190         MOVE NC"　　＊＊　マスターなし　＊＊" TO HI-NAME.
004200*
004210     MOVE SPACE TO W-P.
004220     MOVE SPACE TO P-TNA P-HNA.
004230     IF CHK = 0
004240         MOVE 5 TO CHK
004250         MOVE W-TCD TO P-TCD
004260         MOVE T-NAME TO P-TNA.
004270     MOVE JAZ-HCD TO P-HCD
004280     MOVE HI-NAME TO P-HNA.
004290     MOVE JAZ-DATE TO P-DATE.
004300     IF LINAGE-COUNTER > 61
004310         MOVE W-TCD TO P-TCD
004320         MOVE T-NAME TO P-TNA
004330         PERFORM MID-RTN THRU MID-EX.
004340     MOVE SPACE TO SP-R.
004350     MOVE W-P TO SP-R.
004360     WRITE SP-R.
004370     MOVE SPACE TO SP-R.
004380 LST-EX.
004390     EXIT.
004400 MID-RTN.
004410     MOVE SPACE TO SP-R.
004420     WRITE SP-R AFTER PAGE.
004430 MID-020.
004440     ADD 1 TO W-PAGE.
004450     MOVE W-PAGE TO H-PAGE.
004460     MOVE SPACE TO SP-R.
004470     MOVE HEAD1 TO SP-R.
004480     WRITE SP-R.
004490     MOVE SPACE TO SP-R.
004500     MOVE HEAD2 TO SP-R.
004510     WRITE SP-R AFTER 2.
004520     MOVE SPACE TO SP-R.
004530 MID-EX.
004540     EXIT.
