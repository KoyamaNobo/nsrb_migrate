000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JHS16U.
000030********************************************************
000040*****    受注受信データ生成（赤ちゃん本舗）        *****
000050********************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT TDNAF ASSIGN TO TDNA-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE DYNAMIC
000150         RECORD KEY TDNA-KEY
000160         FILE STATUS IS ERR-STAT.
000170     SELECT AHNHF ASSIGN TO AHNH-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS MODE DYNAMIC
000200         RECORD KEY AHNH-KEY
000210         FILE STATUS IS ERR-STAT.
000220*****SELECT CODEF ASSIGN TO CODE-MSD                              D.100720
000230     SELECT CODEF ASSIGN TO CODE-MSD CODE2-MSD                    I.100720
000240         ORGANIZATION INDEXED
000250         ACCESS MODE DYNAMIC
000260         RECORD KEY CODE-KEY
000270         ALTERNATE RECORD KEY CODE-KEY2                           I.100720
000280         FILE STATUS IS ERR-STAT.
000290     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000300         ORGANIZATION INDEXED
000310         ACCESS MODE RANDOM
000320         RECORD KEY HI-KEY
000330         ALTERNATE RECORD KEY HI-KEY2
000340         FILE STATUS IS ERR-STAT.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON TDNAF
000370     APPLY SHARED-MODE ON AHNHF
000380     APPLY SHARED-MODE ON CODEF
000390     APPLY SHARED-MODE ON HI-M.
000400 DATA DIVISION.
000410 FILE SECTION.
000420     COPY LITDNA.
000430     COPY LICODE.
000440     COPY LIAHNH.
000450     COPY LIHIM.
000460 WORKING-STORAGE SECTION.
000470 77  ERR-STAT           PIC  X(002).
000480 77  W-FILE             PIC  X(013).
000490 77  W-END              PIC  9(001) VALUE 0.
000500 77  W-INV              PIC  9(001) VALUE 0.
000510 01  W-DATA.
000520     02  W-DD.
000530*****  03  W-DNO        PIC  9(006).                              D.100901
000540       03  W-DNO        PIC  9(007).                              I.100901
000550       03  W-HNO        PIC  9(009).
000560       03  W-DPC        PIC  9(002).
000570       03  W-HNGP       PIC  9(006).
000580       03  W-NNGP       PIC  9(006).
000590       03  W-THC        PIC  9(006).
000600       03  W-STC        PIC  9(007).
000610       03  W-BI         PIC  X(010).
000620       03  W-SNGP       PIC  9(008).
000630       03  W-HNA        PIC  X(006).
000640       03  W-ZON        PIC  9(004).
000650     02  W-DGN          PIC  9(002).
000660     02  W-C            PIC  9(001).
000670     02  CHK            PIC  9(001).
000680     02  W-ASIZD.
000690       03  W-ASIZ  OCCURS   4.
000700         04  W-SIZD  OCCURS  10.
000710           05  W-SIZ    PIC  X(004).
000720     02  W-DSZ          PIC  X(004).
000730     02  W-DSZD  REDEFINES W-DSZ.
000740       03  F            PIC  X(003).
000750       03  W-DSZH       PIC  X(001).
000760     02  W-MSIZ.
000770*      03  F            PIC  X(040) VALUE
000780*           "----      SS   S   M   L  LL  XL XXL    ".
000790       03  F            PIC  X(040) VALUE
000800            "                            28.029.030.0".
000810       03  F            PIC  X(040) VALUE
000820            "12.513.013.514.015.016.017.018.019.020.0".
000830       03  F            PIC  X(040) VALUE
000840            "21.021.522.022.523.023.524.024.525.0    ".
000850       03  F            PIC  X(040) VALUE
000860            "24.024.525.025.526.026.527.027.5        ".
000870     02  W-AHN          PIC  N(024).
000880     02  W-AHND  REDEFINES W-AHN.
000890       03  W-HND   OCCURS  24.
000900         04  W-HN       PIC  N(001).
000910     02  W-COR          PIC  N(004).
000920     02  W-ANAD  REDEFINES W-COR.
000930       03  W-NAD  OCCURS   4.
000940         04  W-NA       PIC  N(001).
000950     02  CNT            PIC  9(002).
000960     02  CNTD           PIC  9(002).
000970 SCREEN SECTION.
000980 SD  C-CRT
000990     END STATUS IS ESTAT.
001000 01  C-CLEAR.
001010     02  LINE   1  CLEAR SCREEN.
001020 01  C-MID.
001030     02  LINE   3  COLUMN  10  PIC  N(020) VALUE
001040          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001050     02  LINE   4  COLUMN  10  PIC  N(020) VALUE
001060          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001070     02  LINE   5  COLUMN  10  PIC  N(020) VALUE
001080          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
001090     02  LINE   6  COLUMN  10  PIC  N(020) VALUE
001100          NC"＊＊＊　　受注受信データ　生成　　＊＊＊".
001110     02  LINE   7  COLUMN  10  PIC  N(020) VALUE
001120          NC"＊＊＊　　　（赤ちゃん本舗）　　　＊＊＊".
001130     02  LINE   8  COLUMN  10  PIC  N(020) VALUE
001140          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001150     02  LINE   9  COLUMN  10  PIC  N(020) VALUE
001160          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001170 01  C-ERR.
001180     02  LINE  24.
001190       03  E-ME1   COLUMN  15  PIC  N(006) VALUE
001200            NC"データ　なし".
001210       03  E-ME2   COLUMN  15  PIC  N(007) VALUE
001220            NC"データエラー１".
001230       03  E-ME3   COLUMN  15  PIC  N(007) VALUE
001240            NC"データエラー２".
001250       03  E-ME4   COLUMN  15  PIC  N(005) VALUE
001260            NC"行　エラー".
001270       03  E-ME6   COLUMN  15  PIC  X(027) VALUE
001280            "***  TDNAF REWRITE ｴﾗｰ  ***".
001290       03  E-ME9   COLUMN  15  PIC  X(020) VALUE
001300            "***  JANｺｰﾄﾞ ﾅｼ  ***".
001310       03  E-ME10  COLUMN  15  PIC  X(019) VALUE
001320            "***  ﾉｳﾋﾝｻｷ ﾅｼ  ***".
001330       03  E-ME11  COLUMN  15  PIC  X(025) VALUE
001340            "***  ﾉｳﾋﾝｻｷ ﾁｮｸｿｳ ﾅｼ  ***".
001350       03  E-ME13  COLUMN  15  PIC  X(016) VALUE
001360            "***  HIM ﾅｼ  ***".
001370*****  03  E-DNO   COLUMN  59  PIC  9(006) FROM  TDNA-DNO.        D.100901
001380       03  E-DNO   COLUMN  59  PIC  9(007) FROM  TDNA-DNO.        I.100901
001390       03  E-JAN   COLUMN  44  PIC  X(013) FROM  TDNA-JAN.
001400       03  E-STC   COLUMN  44  PIC  9(007) FROM  TDNA-STC.
001410     COPY LSSEM.
001420 PROCEDURE DIVISION.
001430 M-05.
001440     DISPLAY C-CLEAR.
001450     DISPLAY C-MID.
001460*
001470     OPEN INPUT AHNHF.
001480     OPEN INPUT CODEF.
001490     OPEN INPUT HI-M.
001500     OPEN I-O TDNAF.
001510     MOVE W-MSIZ TO W-ASIZD.
001520 M-10.
001530     READ TDNAF NEXT RECORD AT END
001540         GO TO M-90.
001550     IF TDNA-RC = 0
001560         GO TO M-10.
001570     IF (TDNA-TNA NOT = ALL NC"＊") AND (TDNA-CCD > 2) AND
001580        (TDNA-COR NOT = ALL NC"＊") AND (TDNA-HCD NOT = ZERO)
001590                                    AND (TDNA-SIZ NOT = "****")
001600         GO TO M-10.
001610     MOVE 0 TO CHK.
001620*
001630     IF (TDNA-TNA NOT = ALL NC"＊") AND (TDNA-CCD > 2)
001640         GO TO M-20.
001650     MOVE TDNA-STC TO AHNH-KEY.
001660     READ AHNHF WITH UNLOCK INVALID KEY
001670         DISPLAY E-ME10 E-STC E-DNO E-ME99
001680         DISPLAY E-CL
001690         GO TO M-20.
001700     IF AHNH-CCD < 2
001710         DISPLAY E-ME11 E-STC E-DNO E-ME99
001720         DISPLAY E-CL
001730         GO TO M-20.
001740     MOVE AHNH-NHSN TO TDNA-TNA.
001750     MOVE AHNH-CCD TO TDNA-CCD.
001760     MOVE 1 TO CHK.
001770 M-20.
001780     IF (TDNA-COR NOT = ALL NC"＊") AND (TDNA-HCD NOT = ZERO)
001790                                    AND (TDNA-SIZ NOT = "****")
001800         GO TO M-30.
001810     MOVE SPACE TO W-DSZ W-COR.
001820     MOVE ZERO TO CODE-KEY.
001830     MOVE TDNA-JAN TO CODE-JAN.
001840     START CODEF KEY NOT < CODE-KEY INVALID KEY
001850         DISPLAY E-ME9 E-JAN E-DNO E-ME99
001860         DISPLAY E-CL
001870         GO TO M-30.
001880     READ CODEF NEXT RECORD WITH UNLOCK AT END
001890         DISPLAY E-ME9 E-JAN E-DNO E-ME99
001900         DISPLAY E-CL
001910         GO TO M-30.
001920     IF (CODE-TCD NOT = ZERO) OR (CODE-JAN NOT = TDNA-JAN)
001930         DISPLAY E-ME9 E-JAN E-DNO E-ME99
001940         DISPLAY E-CL
001950         GO TO M-30.
001960     MOVE CODE-HCD TO HI-KEY.
001970     MOVE 1 TO CHK.
001980     READ HI-M WITH UNLOCK INVALID KEY
001990         DISPLAY E-ME13 E-JAN E-DNO E-ME99
002000         DISPLAY E-CL
002010         GO TO M-30.
002020     MOVE HI-HCD TO TDNA-HCD.
002030     PERFORM COR-RTN THRU COR-EX.
002040     MOVE W-COR TO TDNA-COR.
002050     IF (CODE-SIZ < 1 OR > 4) OR (CODE-SNO < 1 OR > 10)
002060         GO TO M-30.
002070     MOVE W-SIZ(CODE-SIZ,CODE-SNO) TO W-DSZ.
002080     IF W-DSZ = SPACE
002090         GO TO M-30.
002100     IF HI-HKB = 1
002110         MOVE 5 TO W-DSZH.
002120     MOVE W-DSZ TO TDNA-SIZ.
002130 M-30.
002140     REWRITE TDNA-R INVALID KEY
002150         DISPLAY E-STAT E-ME6 E-DNO E-STC E-ME99
002160         GO TO M-90.
002170     GO TO M-10.
002180 M-90.
002190     CLOSE AHNHF.
002200     CLOSE CODEF.
002210     CLOSE HI-M.
002220     CLOSE TDNAF.
002230 M-95.
002240     DISPLAY C-CLEAR.
002250     STOP RUN.
002260 COR-RTN.
002270     MOVE SPACE TO W-AHN W-COR.
002280     MOVE HI-NAME TO W-AHN.
002290     MOVE ZERO TO CNT.
002300 COR-010.
002310     ADD 1 TO CNT.
002320     IF CNT < 25
002330         IF W-HN(CNT) NOT = SPACE
002340             GO TO COR-010.
002350     ADD 1 TO CNT.
002360     IF CNT < 25
002370         IF W-HN(CNT) NOT = SPACE
002380             GO TO COR-010.
002390 COR-020.
002400     ADD 1 TO CNT.
002410     IF CNT > 24
002420         GO TO COR-EX.
002430     IF W-HN(CNT) = SPACE
002440         GO TO COR-020.
002450     MOVE ZERO TO CNTD.
002460 COR-030.
002470     ADD 1 TO CNTD.
002480     IF CNTD > 4
002490         GO TO COR-EX.
002500     MOVE W-HN(CNT) TO W-NA(CNTD).
002510     ADD 1 TO CNT.
002520     IF CNT < 25
002530         GO TO COR-030.
002540 COR-EX.
002550     EXIT.
