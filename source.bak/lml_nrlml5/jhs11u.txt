000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JHS11U.
000030********************************************************
000040*****    受注受信データ累積・更新（ワークマン）    *****
000050********************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT JCAWF ASSIGN TO JCAW-MSD
000130         FILE STATUS IS ERR-STAT.
000140     SELECT JCAWRF ASSIGN TO JCAWR-MSD
000150         FILE STATUS IS ERR-STAT.
000160     SELECT TDNWF ASSIGN TO TDNW-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE DYNAMIC
000190         RECORD KEY TDNW1-KEY
000200         FILE STATUS IS ERR-STAT.
000210 DATA DIVISION.
000220 FILE SECTION.
000230     COPY LSJCAW.
000240     COPY LITDNW.
000250 FD  JCAWRF
000260     BLOCK  3 RECORDS
000270     LABEL RECORD IS STANDARD
000280     VALUE OF IDENTIFICATION "JCAWRF".
000290 01  JCAWR-R.
000300     02  JCAWR-R1     PIC  X(256).
000310     02  F            PIC  X(079).
000320     02  JCAWR-NGP    PIC  9(006).
000330 WORKING-STORAGE SECTION.
000340 77  ERR-STAT         PIC  X(002).
000350 77  W-FILE           PIC  X(013).
000360 01  W-R.
000370     02  WR-RCC       PIC  9(001).
000380     02  WR-DTC       PIC  X(002).
000390     02  WR-D1.
000400       03  WR-DNO     PIC  9(009).
000410       03  WR-STC.
000420         04  WR-SCD   PIC  9(004).
000430         04  WR-TCD   PIC  9(005).
000440       03  WR-BC      PIC  9(003).
000450       03  WR-SHC     PIC  9(001).
000460       03  WR-DPC     PIC  X(002).
000470       03  WR-HNGP    PIC  9(006).
000480       03  WR-NNGP    PIC  9(006).
000490       03  WR-THC     PIC  9(006).
000500       03  WR-MHC     PIC  X(001).
000510       03  F          PIC  X(001).
000520       03  WR-SNA     PIC  X(020).
000530       03  WR-TNA     PIC  X(020).
000540       03  WR-HCC     PIC  9(001).
000550       03  WR-HSP     PIC  X(001).
000560       03  WR-DHC     PIC  X(001).
000570       03  WR-KHC     PIC  X(001).
000580       03  WR-KCC     PIC  X(001).
000590       03  WR-UBC     PIC  X(001).
000600       03  WR-NCC     PIC  9(001).
000610       03  WR-EDI     PIC  9(001).
000620       03  WR-NKC     PIC  9(001).
000630       03  WR-ZAC     PIC  9(001).
000640       03  F          PIC  X(031).
000650     02  WR-D2    REDEFINES WR-D1.
000660       03  WR-DGN     PIC  9(002).
000670       03  WR-HCD     PIC  X(013).
000680       03  WR-ISU     PIC  9(003)V9(01).
000690       03  WR-KSU     PIC  9(004).
000700       03  WR-HTC     PIC  X(002).
000710       03  WR-SU      PIC  9(005)V9(01).
000720       03  WR-GTN     PIC  9(007)V9(02).
000730       03  WR-UTN     PIC  9(007).
000740       03  WR-GKIN    PIC  9(010).
000750       03  WR-UKIN    PIC  9(010).
000760       03  WR-GCN     PIC  9(006).
000770       03  WR-CCD     PIC  X(003).
000780       03  WR-SHN     PIC  X(025).
000790       03  WR-JAN     PIC  X(013).
000800       03  F          PIC  X(004).
000810       03  WR-TSH     PIC  9(005).
000820       03  WR-TKC     PIC  X(001).
000830       03  F          PIC  X(001).
000840 01  W-DATA.
000850     02  W-STC        PIC  9(009).
000860     02  W-DNO        PIC  9(009).
000870     02  W-DGN        PIC  9(002).
000880     02  W-FR         PIC  9(001).
000890     02  W-C          PIC  9(001).
000900*****02  W-DMM        PIC  9(001).                                D.041122
000910     02  CHK          PIC  9(001).
000920     02  W-NGP        PIC  9(006).
000930     COPY LSTAT.
000940 SCREEN SECTION.
000950 SD  C-CRT
000960     END STATUS IS ESTAT.
000970 01  C-CLEAR.
000980     02  LINE   1  CLEAR SCREEN.
000990 01  C-MID.
001000     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
001010          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001020     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
001030          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001040     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
001050          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001060     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
001070          NC"＊＊＊　　受注受信データ累積・更新　　＊＊＊".
001080     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
001090          NC"＊＊＊　　　　（ワークマン）　　　　　＊＊＊".
001100     02  LINE   8  COLUMN  10  PIC  N(022) VALUE
001110          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001120     02  LINE   9  COLUMN  10  PIC  N(022) VALUE
001130          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001140*****02  LINE  20  COLUMN  32  PIC  X(022) VALUE                  D.041122
001150*****     "確認  OK=1 NO=9   ﾘﾀｰﾝ".                               D.041122
001160*01  C-ACP.                                                       D.041122
001170*****02  A-DMM   LINE  20  COLUMN  49  PIC  9(001)                D.041122
001180*****     USING W-DMM   CHECK OVERFLOW NO IFC.                    D.041122
001190 01  C-ERR.
001200     02  LINE  24.
001210       03  E-ME1   COLUMN  15  PIC  N(006) VALUE
001220            NC"データ　なし".
001230       03  E-ME2   COLUMN  15  PIC  N(007) VALUE
001240            NC"データエラー１".
001250       03  E-ME3   COLUMN  15  PIC  N(007) VALUE
001260            NC"データエラー２".
001270       03  E-ME4   COLUMN  15  PIC  N(005) VALUE
001280            NC"行　エラー".
001290       03  E-ME5   COLUMN  15  PIC  X(025) VALUE
001300            "***  TDNWF WRITE ｴﾗｰ  ***".
001310       03  E-ME6   COLUMN  15  PIC  X(026) VALUE
001320            "***  JCAWRF WRITE ｴﾗｰ  ***".
001330     COPY LSSEM.
001340 PROCEDURE DIVISION.
001350 M-05.
001360     DISPLAY C-CLEAR.
001370     DISPLAY C-MID.
001380*M-10.                                                            D.041122
001390*****ACCEPT A-DMM.                                                D.041122
001400*****IF ESTAT = PF9                                               D.041122
001410*****    MOVE 255 TO COMPLETION-CODE                              D.041122
001420*****    GO TO M-95.                                              D.041122
001430*****IF ESTAT NOT = HTB AND SKP                                   D.041122
001440*****    GO TO M-10.                                              D.041122
001450*****IF W-DMM = 9                                                 D.041122
001460*****    MOVE 255 TO COMPLETION-CODE                              D.041122
001470*****    GO TO M-95.                                              D.041122
001480*****IF W-DMM NOT = 1                                             D.041122
001490*****    GO TO M-10.                                              D.041122
001500*
001510     OPEN INPUT JCAWF.
001520 M-15.
001530     READ JCAWF AT END
001540         MOVE 255 TO COMPLETION-CODE
001550         CLOSE JCAWF
001560         DISPLAY E-ME1 E-ME99
001570         GO TO M-95.
001580     MOVE SPACE TO W-R.
001590     MOVE JCAW-R1 TO W-R.
001600     IF WR-RCC NOT = "A"
001610         MOVE 255 TO COMPLETION-CODE
001620         CLOSE JCAWF
001630         DISPLAY E-ME2 E-ME99
001640         GO TO M-95.
001650     ACCEPT W-NGP FROM DATE.
001660     MOVE 0 TO CHK.
001670     OPEN EXTEND JCAWRF.
001680 M-25.
001690     INITIALIZE JCAWR-R.
001700     MOVE JCAW-R TO JCAWR-R1.
001710     MOVE W-NGP TO JCAWR-NGP.
001720     WRITE JCAWR-R.
001730     IF ERR-STAT = "00"
001740         GO TO M-30.
001750     DISPLAY E-STAT E-ME6 E-ME99.
001760     IF ERR-STAT NOT = "34"
001770         MOVE 255 TO COMPLETION-CODE
001780         CLOSE JCAWF
001790         CLOSE JCAWRF
001800         DISPLAY E-ME78 E-ME99
001810         GO TO M-95.
001820     DISPLAY E-CL.
001830     CLOSE JCAWRF.
001840     MOVE "JCAWRF       " TO W-FILE.
001850     DISPLAY E-ME71 E-ME98 STOP " ".
001860     DISPLAY E-CL.
001870     OPEN EXTEND JCAWRF.
001880     GO TO M-25.
001890 M-30.
001900     READ JCAWF AT END
001910         GO TO M-35.
001920     IF CHK = 0
001930         MOVE 1 TO CHK
001940         MOVE SPACE TO W-R
001950         MOVE JCAW-R1 TO W-R
001960         IF WR-RCC NOT = "B"
001970             IF WR-RCC = "A"                                      I.041124
001980                 DISPLAY E-ME1 E-ME99                             I.041124
001990                 GO TO M-35                                       I.041124
002000               ELSE                                               I.041124
002010                 MOVE 255 TO COMPLETION-CODE
002020                 CLOSE JCAWF
002030                 DISPLAY E-ME2 E-ME99
002040                 GO TO M-95.
002050     GO TO M-25.
002060 M-35.
002070     CLOSE JCAWF.
002080     CLOSE JCAWRF.
002090*
002100     OPEN INPUT JCAWF.
002110     OPEN I-O TDNWF.
002120     MOVE 9 TO W-DGN.
002130 M-40.
002140     READ JCAWF AT END
002150         GO TO M-90.
002160     MOVE SPACE TO W-R.
002170     MOVE JCAW-R1 TO W-R.
002180     IF WR-RCC = "A"
002190         GO TO M-40.
002200     MOVE 0 TO W-FR.
002210 M-45.
002220     ADD 1 TO W-FR.
002230     IF W-FR > 2
002240         GO TO M-40.
002250     MOVE SPACE TO W-R.
002260     IF W-FR = 1
002270         MOVE JCAW-R1 TO W-R
002280       ELSE
002290         MOVE JCAW-R2 TO W-R.
002300*
002310     IF WR-RCC NOT = "B"
002320         GO TO M-60.
002330     IF W-DGN = ZERO
002340         MOVE 255 TO COMPLETION-CODE
002350         DISPLAY E-ME3 E-ME99
002360         GO TO M-95.
002370     MOVE WR-STC TO W-STC.
002380     MOVE WR-DNO TO W-DNO.
002390     MOVE ZERO TO W-DGN.
002400 M-50.
002410     PERFORM MOV1-RTN THRU MOV1-EX.
002420     WRITE TDNW-R1 INVALID KEY
002430         DISPLAY E-STAT E-ME5 E-ME99
002440         GO TO M-55.
002450     GO TO M-45.
002460 M-55.
002470     IF ERR-STAT NOT = "24"
002480         MOVE 255 TO COMPLETION-CODE
002490         DISPLAY E-ME78 E-ME99
002500         GO TO M-95.
002510     DISPLAY E-CL.
002520     CLOSE TDNWF.
002530     MOVE "TDNWF        " TO W-FILE.
002540     DISPLAY E-ME71 E-ME98 STOP " ".
002550     DISPLAY E-CL.
002560     OPEN INPUT TDNWF.
002570     GO TO M-50.
002580 M-60.
002590     IF WR-RCC NOT = "D"
002600         GO TO M-45.
002610     ADD 1 TO W-DGN.
002620     IF W-DGN > 9
002630         MOVE 255 TO COMPLETION-CODE
002640         DISPLAY E-ME4 E-ME99
002650         GO TO M-95.
002660     IF WR-DGN NOT = W-DGN
002670         MOVE 255 TO COMPLETION-CODE
002680         DISPLAY E-ME4 E-ME99
002690         GO TO M-95.
002700 M-65.
002710     PERFORM MOV2-RTN THRU MOV2-EX.
002720     WRITE TDNW-R2 INVALID KEY
002730         DISPLAY E-STAT E-ME5 E-ME99
002740         GO TO M-70.
002750     GO TO M-45.
002760 M-70.
002770     IF ERR-STAT NOT = "24"
002780         MOVE 255 TO COMPLETION-CODE
002790         DISPLAY E-ME78 E-ME99
002800         GO TO M-95.
002810     DISPLAY E-CL.
002820     CLOSE TDNWF.
002830     MOVE "TDNWF        " TO W-FILE.
002840     DISPLAY E-ME71 E-ME98 STOP " ".
002850     DISPLAY E-CL.
002860     OPEN INPUT TDNWF.
002870     GO TO M-65.
002880 M-90.
002890     CLOSE JCAWF.
002900     CLOSE TDNWF.
002910 M-95.
002920     DISPLAY C-CLEAR.
002930     STOP RUN.
002940 MOV1-RTN.
002950     INITIALIZE TDNW-R1.
002960     MOVE W-STC TO TDNW1-STC.
002970     MOVE W-DNO TO TDNW1-DNO.
002980     MOVE W-DGN TO TDNW1-DGN.
002990     MOVE WR-BC TO TDNW1-BC.
003000     MOVE WR-SHC TO TDNW1-SHC.
003010     MOVE WR-DPC TO TDNW1-DPC.
003020     MOVE WR-HNGP TO TDNW1-HNGP.
003030     MOVE WR-NNGP TO TDNW1-NNGP.
003040     MOVE WR-THC TO TDNW1-THC.
003050     MOVE WR-MHC TO TDNW1-MHC.
003060     MOVE WR-SNA TO TDNW1-SNA.
003070     MOVE WR-TNA TO TDNW1-TNA.
003080     MOVE WR-HCC TO TDNW1-HCC.
003090     MOVE WR-HSP TO TDNW1-HSP.
003100     MOVE WR-DHC TO TDNW1-DHC.
003110     MOVE WR-KHC TO TDNW1-KHC.
003120     MOVE WR-KCC TO TDNW1-KCC.
003130     MOVE WR-UBC TO TDNW1-UBC.
003140     MOVE WR-NCC TO TDNW1-NCC.
003150     MOVE WR-EDI TO TDNW1-EDI.
003160     MOVE WR-NKC TO TDNW1-NKC.
003170     MOVE WR-ZAC TO TDNW1-ZAC.
003180 MOV1-EX.
003190     EXIT.
003200 MOV2-RTN.
003210     INITIALIZE TDNW-R2.
003220     MOVE W-STC TO TDNW2-STC.
003230     MOVE W-DNO TO TDNW2-DNO.
003240     MOVE WR-DGN TO TDNW2-DGN.
003250     MOVE WR-HCD TO TDNW2-HCD.
003260     MOVE WR-ISU TO TDNW2-ISU.
003270     MOVE WR-KSU TO TDNW2-KSU.
003280     MOVE WR-HTC TO TDNW2-HTC.
003290     MOVE WR-SU TO TDNW2-SU.
003300     MOVE WR-GTN TO TDNW2-GTN.
003310     MOVE WR-UTN TO TDNW2-UTN.
003320     MOVE WR-GKIN TO TDNW2-GKIN.
003330     MOVE WR-UKIN TO TDNW2-UKIN.
003340     MOVE WR-GCN TO TDNW2-GCN.
003350     MOVE WR-CCD TO TDNW2-CCD.
003360     MOVE WR-SHN TO TDNW2-SHN.
003370     MOVE WR-JAN TO TDNW2-JAN.
003380     MOVE WR-TSH TO TDNW2-TSH.
003390     MOVE WR-TKC TO TDNW2-TKC.
003400 MOV2-EX.
003410     EXIT.
