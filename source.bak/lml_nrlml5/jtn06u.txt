000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JTN06U.
000030*********************************************************
000040*    PROGRAM         :  トラスコ他指図変換ワーク　作成  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    COMPILE TYPE    :  COBOL                           *
000070*********************************************************
000080 ENVIRONMENT DIVISION.
000090 CONFIGURATION SECTION.
000100 SOURCE-COMPUTER. SYSTEM3100.
000110 OBJECT-COMPUTER. SYSTEM3100.
000120 INPUT-OUTPUT SECTION.
000130 FILE-CONTROL.
000140     SELECT HI2-M ASSIGN TO HI2-MSD                               I.150521
000150         ORGANIZATION INDEXED                                     I.150521
000160         ACCESS MODE RANDOM                                       I.150521
000170         RECORD KEY HI-KEY2                                       I.150521
000180         FILE STATUS IS ERR-STAT.                                 I.150521
000190     SELECT TC-M ASSIGN TO TC-MSD
000200         ORGANIZATION INDEXED
000210         ACCESS MODE RANDOM
000220         RECORD KEY TC-KEY
000230         FILE STATUS IS ERR-STAT.
000240     SELECT TDIF ASSIGN TO TDI-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE DYNAMIC
000270         RECORD KEY TDI-KEY
000280         FILE STATUS IS ERR-STAT.
000290     SELECT TSHW ASSIGN TO TSHW-MSD.
000300 I-O-CONTROL.
000310     APPLY SHARED-MODE ON HI2-M                                   I.150521
000320     APPLY SHARED-MODE ON TC-M
000330     APPLY SHARED-MODE ON TDIF.
000340 DATA DIVISION.
000350 FILE SECTION.
000360     COPY LIHIM2.                                                 I.150521
000370     COPY LITCM.
000380     COPY L-TDIF.
000390 FD  TSHW
000400     BLOCK  1 RECORDS
000410     LABEL RECORD IS STANDARD
000420     VALUE OF IDENTIFICATION WK0256ID.
000430 01  TSHW-R.
000440     02  TSHW-DATE      PIC  9(006).
000450     02  TSHW-TCD       PIC  9(004).
000460     02  TSHW-CCD       PIC  9(003).
000470*****02  TSHW-TPC       PIC  9(003).                              D.100923
000480     02  TSHW-TPC       PIC  9(004).                              I.100923
000490     02  TSHW-SOK       PIC  9(001).
000500     02  TSHW-UNS       PIC  9(001).
000510     02  TSHW-HNO       PIC  X(010).
000520     02  TSHW-JNOD.
000530       03  TSHW-JNO     PIC  9(006).
000540       03  TSHW-JGN     PIC  9(001).
000550     02  TSHW-ISU       PIC  9(003).
000560     02  TSHW-HCD       PIC  9(006).
000570     02  TSHW-SIZ       PIC  9(001).
000580     02  TSHW-ASU.
000590       03  TSHW-SUD   OCCURS  10.
000600         04  TSHW-SU    PIC S9(004).
000610     02  TSHW-SUT       PIC S9(005).
000620     02  TSHW-TEKI      PIC  N(028).
000630     02  TSHW-TED   REDEFINES TSHW-TEKI.
000640       03  TSHW-THT     PIC  N(009).
000650       03  TSHW-TTE     PIC  N(019).
000660     02  TSHW-DC        PIC  9(001).
000670     02  F              PIC  X(108).                              I.100923
000680*****02  F              PIC  X(109).                              D.100923
000690 WORKING-STORAGE  SECTION.
000700 77  ERR-STAT           PIC  X(002).
000710 77  W-FILE             PIC  X(013).
000720 77  WK0256ID           PIC  X(009) VALUE SPACE.
000730 01  STN-NO.
000740     02  STN-NO1        PIC  X(003).
000750     02  STN-NO2        PIC  X(003).
000760 01  W-FID.
000770     02  W-FID1         PIC  X(006) VALUE "WK0256".
000780     02  W-FID2         PIC  X(003).
000790 01  W-DATA.
000800     02  W-TCD          PIC  9(004).
000810     02  W-NGP          PIC  9(006).
000820     02  W-NGPD  REDEFINES W-NGP.
000830       03  W-NEN        PIC  9(002).
000840       03  W-GET        PIC  9(002).
000850       03  W-PEY        PIC  9(002).
000860     02  W-DATE         PIC  9(006).
000870     02  W-SNGP         PIC  9(006).
000880     02  W-ENGP         PIC  9(006).
000890     02  W-DMM          PIC  9(001).
000900     02  W-CHK          PIC  9(001).                              I.150521
000910     COPY LSTAT.
000920 SCREEN SECTION.
000930 SD  C-CRT
000940     END STATUS IS ESTAT.
000950 01  C-CLEAR.
000960     02  C-CL    LINE   1  CLEAR SCREEN.
000970 01  C-MID.
000980     02  LINE   1  COLUMN  10  PIC  N(025) VALUE
000990          NC"＊＊＊　　トラスコ他指図変換ワーク　作成　　＊＊＊".
001000     02  LINE  10  COLUMN  10  PIC  X(012) VALUE
001010          "得意先      ".
001020     02  LINE  12  COLUMN  10  PIC  X(024) VALUE
001030          "指図日   '  年   月   日".
001040     02  LINE  23.
001050       03  COLUMN  43  PIC  N(002) VALUE NC"確認".
001060       03  COLUMN  47  PIC  X(023) VALUE
001070            "(OK=1,NO=9) --->   ﾘﾀｰﾝ".
001080 01  C-ACP.
001090     02  A-TCD   LINE  10  COLUMN  18  PIC  9(004)
001100          USING W-TCD   CHECK OVERFLOW NO IFC.
001110     02  LINE  12.
001120       03  A-NEN   COLUMN  20  PIC  9(002)
001130            USING W-NEN   CHECK OVERFLOW NO IFC.
001140       03  A-GET   COLUMN  25  PIC  9(002)
001150            USING W-GET   CHECK OVERFLOW NO IFC.
001160       03  A-PEY   COLUMN  30  PIC  9(002)
001170            USING W-PEY   CHECK OVERFLOW NO IFC.
001180     02  A-DMM   LINE  23  COLUMN  65  PIC  9(001)
001190          USING W-DMM   CHECK OVERFLOW NO IFC.
001200 01  C-DSP.
001210     02  D-NAME  LINE  10  COLUMN  23  PIC  N(026) FROM  TC-NAME.
001220 01  C-ERR.
001230     02  LINE  24.
001240       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001250            "***  DATA ﾅｼ  ***".
001260       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
001270            "***  TDIF REWRITE ｴﾗｰ  ***".
001280       03  E-ME3   COLUMN  15  PIC  X(018) VALUE
001290            "***  ﾄｸｲｻｷ ﾅｼ  ***".
001300       03  E-ME4.                                                 I.150521
001310         04  COLUMN  15  PIC  X(026) VALUE                        I.150521
001320              "***  ﾋﾝﾒｲ ﾅｼ (      )  ***".                       I.150521
001330         04  COLUMN  29  PIC  9(006) FROM  TDI-ISU.               I.150521
001340       03  E-KEY   COLUMN  45  PIC  X(007) FROM  TDI-KEY.
001350     COPY LSSEM.
001360 PROCEDURE DIVISION.
001370 M-05.
001380     DISPLAY C-CLEAR.
001390     DISPLAY C-MID.
001400     ACCEPT W-DATE FROM DATE.
001410     MOVE W-DATE TO W-NGP.
001420     SUBTRACT 1 FROM W-GET.
001430     IF W-GET = ZERO
001440         SUBTRACT 1 FROM W-NEN.
001450     MOVE W-NGP TO W-SNGP.
001460     MOVE W-DATE TO W-NGP.
001470     ADD 1 TO W-GET.
001480     IF W-GET = 13
001490         ADD 1 TO W-NEN.
001500     MOVE W-NGP TO W-ENGP.
001510     MOVE W-DATE TO W-NGP.
001520     DISPLAY A-NEN A-GET A-PEY.
001530     OPEN INPUT TC-M.
001540 M-10.
001550     ACCEPT A-TCD.
001560     DISPLAY E-CL.
001570     IF ESTAT = PF9
001580         CLOSE TC-M
001590*****    MOVE 255 TO COMPLETION-CODE                              D.100223
001600         MOVE 200 TO COMPLETION-CODE                              I.100223
001610         GO TO M-95.
001620     IF ESTAT NOT = HTB AND SKP
001630         GO TO M-10.
001640*
001650     MOVE W-TCD TO TC-TCD.
001660     MOVE 1 TO TC-CCD.
001670     READ TC-M WITH UNLOCK INVALID KEY
001680         DISPLAY E-ME3 E-ME98
001690         GO TO M-10.
001700     DISPLAY D-NAME.
001710*****IF W-TCD NOT = 4990 AND 9850                                 D.080618
001720*****IF W-TCD NOT = 4990 AND 5000 AND 9850                        D.120203
001730     IF W-TCD NOT = 4990 AND 5000 AND 9850 AND 6010               I.120203
001740         GO TO M-10.
001750 M-15.
001760     ACCEPT A-NEN.
001770     IF ESTAT = BTB
001780         GO TO M-10.
001790     IF ESTAT NOT = HTB AND SKP
001800         GO TO M-15.
001810 M-20.
001820     ACCEPT A-GET.
001830     IF ESTAT = BTB
001840         GO TO M-15.
001850     IF ESTAT NOT = HTB AND SKP
001860         GO TO M-20.
001870     IF W-GET < 1 OR > 12
001880         GO TO M-20.
001890 M-25.
001900     ACCEPT A-PEY.
001910     IF ESTAT = BTB
001920         GO TO M-20.
001930     IF ESTAT NOT = HTB AND SKP
001940         GO TO M-25.
001950     IF W-PEY < 1 OR > 31
001960         GO TO M-25.
001970     IF W-NGP < W-SNGP OR > W-ENGP
001980         GO TO M-15.
001990 M-30.
002000     ACCEPT A-DMM.
002010     IF ESTAT = PF9
002020         CLOSE TC-M
002030*****    MOVE 255 TO COMPLETION-CODE                              D.100223
002040         MOVE 200 TO COMPLETION-CODE                              I.100223
002050         GO TO M-95.
002060     IF ESTAT = BTB
002070         GO TO M-25.
002080     IF ESTAT NOT = HTB AND SKP
002090         GO TO M-30.
002100     IF W-DMM = 9
002110         GO TO M-10.
002120     IF W-DMM NOT = 1
002130         GO TO M-30.
002140*
002150     CLOSE TC-M.
002160     OPEN I-O TDIF.
002170 M-35.
002180     READ TDIF NEXT RECORD AT END
002190         CLOSE TDIF
002200*****    MOVE 255 TO COMPLETION-CODE                              D.100223
002210         MOVE 200 TO COMPLETION-CODE                              I.100223
002220         DISPLAY E-ME1 E-ME99
002230         GO TO M-95.
002240     IF TDI-UPC NOT = 0
002250         GO TO M-35.
002260     IF TDI-PRC = 0
002270         GO TO M-35.
002280     IF TDI-TCD NOT = W-TCD
002290         GO TO M-35.
002300     IF TDI-DATE NOT = W-NGP
002310         GO TO M-35.
002320*
002330     OPEN INPUT HI2-M.                                            I.150521
002340     CALL "CBLSTNNO" USING STN-NO.
002350     MOVE STN-NO2 TO W-FID2.
002360     MOVE W-FID TO WK0256ID.
002370     OPEN OUTPUT TSHW.
002380 M-40.
002390     MOVE 0 TO W-CHK.                                             I.150521
002400     MOVE TDI-HCD TO HI-MHCD HI-HCD.                              I.150521
002410     READ HI2-M WITH UNLOCK INVALID KEY                           I.150521
002420         MOVE 1 TO W-CHK                                          I.150521
002430         DISPLAY E-ME4 E-ME99                                     I.150521
002440         DISPLAY E-CL.                                            I.150521
002450*
002460     INITIALIZE TSHW-R.
002470     MOVE SPACE TO TSHW-HNO TSHW-TEKI.
002480     MOVE TDI-DATE TO TSHW-DATE.
002490     MOVE TDI-TCD TO TSHW-TCD.
002500     MOVE TDI-CCD TO TSHW-CCD.
002510     MOVE TDI-TPC TO TSHW-TPC.
002520     MOVE TDI-SOK TO TSHW-SOK.
002530     MOVE TDI-UNS TO TSHW-UNS.
002540     MOVE TDI-HNO TO TSHW-HNO.
002550     MOVE TDI-JNOD TO TSHW-JNOD.
002560     IF W-CHK = 0                                                 I.150521
002570         MOVE HI-ISU TO TSHW-ISU                                  I.150521
002580       ELSE                                                       I.150521
002590         MOVE TDI-ISU TO TSHW-ISU.
002600     MOVE TDI-HCD TO TSHW-HCD.
002610     MOVE TDI-SKB TO TSHW-SIZ.
002620     MOVE TDI-SU TO TSHW-SU(TDI-SNO) TSHW-SUT.
002630     MOVE TDI-TEKI TO TSHW-TEKI.
002640     IF TDI-SU < ZERO
002650         MOVE 1 TO TSHW-DC.
002660     WRITE TSHW-R.
002670*
002680     IF W-CHK = 0                                                 I.150521
002690         MOVE HI-ISU TO TDI-ISU.                                  I.150521
002700     MOVE 2 TO TDI-PRC.
002710     REWRITE TDI-R INVALID KEY
002720         MOVE 255 TO COMPLETION-CODE
002730         DISPLAY E-ME2 E-KEY E-ME99
002740         GO TO M-90.
002750 M-45.
002760     READ TDIF NEXT RECORD AT END
002770         GO TO M-90.
002780     IF TDI-UPC NOT = 0
002790         GO TO M-45.
002800     IF TDI-PRC = 0
002810         GO TO M-45.
002820     IF TDI-TCD NOT = W-TCD
002830         GO TO M-45.
002840     IF TDI-DATE NOT = W-NGP
002850         GO TO M-45.
002860     GO TO M-40.
002870 M-90.
002880     CLOSE HI2-M.                                                 I.150521
002890     CLOSE TDIF.
002900     CLOSE TSHW.
002910 M-95.
002920     DISPLAY C-CLEAR.
002930     STOP RUN.
