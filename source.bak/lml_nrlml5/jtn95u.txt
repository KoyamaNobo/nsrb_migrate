000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID.      JTN95U.
000030*********************************************************
000040*    倉別在庫Ｍ　変換  （親コード修正時）               *
000050*********************************************************
000060 ENVIRONMENT      DIVISION.
000070 CONFIGURATION    SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT     SECTION.
000110 FILE-CONTROL.
000120     SELECT HI-M ASSIGN TO HI1-MSD000 HI2-MSD000
000130         ORGANIZATION IS INDEXED
000140         ACCESS MODE IS RANDOM
000150         RECORD KEY IS HI-KEY
000160         ALTERNATE RECORD KEY IS HI-KEY2
000170         FILE STATUS IS ERR-STAT.
000180     SELECT JCON ASSIGN TO JCON-MSD
000190         ORGANIZATION INDEXED
000200         RECORD KEY JCON1-KEY
000210         ACCESS MODE DYNAMIC
000220         FILE STATUS IS ERR-STAT.
000230     SELECT NJZAI ASSIGN TO NJZAI-MSD
000240         ORGANIZATION IS INDEXED
000250         ACCESS MODE IS RANDOM
000260         RECORD KEY IS NJZAI-KEY
000270         FILE STATUS IS ERR-STAT.
000280 I-O-CONTROL.
000290     APPLY SHARED-MODE ON NJZAI
000300     APPLY SHARED-MODE ON JCON
000310     APPLY SHARED-MODE ON HI-M.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIHIM.
000350     COPY L-JCON.
000360     COPY LNJZAI.
000370 WORKING-STORAGE  SECTION.
000380 77  ERR-STAT           PIC  X(002).
000390 77  W-FILE             PIC  X(013).
000400 77  W-MSG              PIC  X(030).
000410 77  W-SPACE            PIC  X(065) VALUE SPACE.
000420 01  W-DATA.
000430     02  W-AHCD.
000440       03  W-HCDD  OCCURS  18.
000450         04  W-FHCD     PIC  9(006).
000460         04  W-RHCD     PIC  9(006).
000470     02  CNT            PIC  9(002).
000480     02  W-C            PIC  9(002).
000490     02  W-L            PIC  9(002).
000500     02  CHK            PIC  9(001).
000510     02  W-DE           PIC  9(001).
000520     02  W-S            PIC  9(001).
000530     02  W-DMM          PIC  9(001).
000540 01  W-RD.
000550     02  W-04.                                                    ｾﾞﾝｸﾘｺｼ
000560       03  W-041   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000570         04  W-0411     PIC S9(006).
000580     02  W-05.                                                    ﾄｳﾆｭｳｺ
000590       03  W-051   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000600         04  W-0511     PIC S9(006).
000610     02  W-06.                                                    ﾄｳｼｭｯｺ
000620       03  W-061   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000630         04  W-0611     PIC S9(006).
000640     02  W-07.
000650       03  W-071   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000660         04  W-0711     PIC S9(006).
000670     02  W-08.
000680       03  W-081   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000690         04  W-0811     PIC S9(006).
000700     02  W-09.                                                    ｻｼｽﾞﾐｶｸﾃ
000710       03  W-091   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000720         04  W-0911     PIC S9(006).
000730     02  W-10.                                                    ｻﾞｲｺﾁｮｳｾ
000740       03  W-101   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000750         04  W-1011     PIC S9(006).
000760     02  W-11.                                                    ｼﾒｺﾞﾆｭｳｺ
000770       03  W-111   OCCURS  10.                                    ｻｲｽﾞﾍﾞﾂ
000780         04  W-1111     PIC S9(006).
000790     COPY LSTAT.
000800 SCREEN      SECTION.
000810 SD  C-CRT
000820     END  STATUS IS  ESTAT.
000830 01  C-CLEAR.
000840     02  C-CL    LINE   1  CLEAR SCREEN.
000850 01  C-MID.
000860     02  LINE   1  COLUMN  15  PIC  N(028) VALUE
000870     NC"＊＊＊　　倉別在庫Ｍ　変換　（親コード修正時）　　＊＊＊".
000880     02  LINE   3  COLUMN   7  PIC  X(027) VALUE
000890          "元ｺｰﾄﾞ → 先ｺｰﾄﾞ 品　　　名".
000900     02  LINE  22  COLUMN   7  PIC  X(010) VALUE "確認=ｆ･10".
000910     02  LINE  23  COLUMN  42  PIC  X(022) VALUE
000920          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000930 01  C-ACP.
000940     02  A-FHCD  LINE W-L  COLUMN   7  PIC  9(006)
000950          USING W-FHCD(CNT) CHECK OVERFLOW NO IFC.
000960     02  A-DMM   LINE  23  COLUMN  59  PIC  9(001)
000970          USING W-DMM   CHECK OVERFLOW NO IFC.
000980 01  C-DSP.
000990     02  LINE W-L.
001000       03  D-SPACE COLUMN   7  PIC  X(065) FROM  W-SPACE.
001010       03  D-RHCD  COLUMN  17  PIC  9(006) FROM  W-RHCD(CNT).
001020       03  D-NAME  COLUMN  24  PIC  N(024) FROM  HI-NAME.
001030 01  C-ERR.
001040     02  LINE  24.
001050       03  E-ME    COLUMN  15  PIC  X(030) FROM  W-MSG.
001060       03  E-HCD   COLUMN  46  PIC  9(006) FROM  HI-KEY.
001070       03  E-KEY   COLUMN  53  PIC  X(008) FROM  NJZAI-KEY.
001080     COPY LSSEM.
001090 PROCEDURE DIVISION.
001100 M-05.
001110     DISPLAY C-CLEAR.
001120     DISPLAY C-MID.
001130     OPEN INPUT HI-M.
001140     MOVE ZERO TO W-AHCD CNT CHK.
001150     MOVE 3 TO W-L.
001160 M-10.
001170     ADD 1 TO CNT W-L.
001180     IF CNT = 19
001190         GO TO M-25.
001200     IF CHK = 1
001210         MOVE ZERO TO W-FHCD(CNT) W-RHCD(CNT)
001220         DISPLAY D-SPACE
001230         GO TO M-10.
001240 M-15.
001250     ACCEPT A-FHCD.
001260     DISPLAY E-CL.
001270     IF ESTAT = PF9
001280         IF CNT = 1
001290             GO TO M-95.
001300     IF ESTAT = ADV
001310         IF CNT NOT = 1
001320             MOVE 1 TO CHK
001330             MOVE ZERO TO W-FHCD(CNT) W-RHCD(CNT)
001340             DISPLAY D-SPACE
001350             GO TO M-10.
001360     IF ESTAT = BTB
001370         GO TO M-20.
001380     IF ESTAT NOT = HTB AND SKP
001390         GO TO M-15.
001400*
001410     MOVE W-FHCD(CNT) TO HI-KEY.
001420     READ HI-M WITH UNLOCK INVALID KEY
001430         GO TO M-15.
001440     IF HI-MHCD = HI-KEY
001450         GO TO M-15.
001460     MOVE HI-MHCD TO W-RHCD(CNT).
001470     MOVE W-RHCD(CNT) TO HI-KEY.
001480     READ HI-M WITH UNLOCK INVALID KEY
001490         MOVE SPACE TO W-MSG
001500         MOVE "***  親ｺｰﾄﾞ ﾅｼ  ***" TO W-MSG
001510         DISPLAY E-ME E-HCD E-ME99
001520         GO TO M-15.
001530     DISPLAY D-RHCD D-NAME.
001540     GO TO M-10.
001550 M-20.
001560     IF CNT NOT = 1
001570         SUBTRACT 1 FROM CNT W-L.
001580     IF W-RHCD(CNT) = ZERO
001590         GO TO M-20.
001600     GO TO M-15.
001610 M-25.
001620     ACCEPT A-DMM.
001630     IF ESTAT = BTB
001640         MOVE 0 TO CHK
001650         GO TO M-20.
001660     IF ESTAT NOT = HTB AND SKP
001670         GO TO M-25.
001680     IF W-DMM = 9
001690         MOVE 0 TO CHK
001700         GO TO M-20.
001710     IF W-DMM NOT = 1
001720         GO TO M-25.
001730*
001740     OPEN I-O NJZAI.
001750     OPEN INPUT JCON.
001760*
001770     MOVE SPACE TO JCON1-KEY.
001780     MOVE 3 TO JCON3-01.
001790     START JCON KEY NOT < JCON1-KEY INVALID KEY
001800         MOVE SPACE TO W-MSG
001810         MOVE "***  JCON ﾅｼ  ***" TO W-MSG
001820         DISPLAY E-ME E-ME99
001830         GO TO M-90.
001840     MOVE 0 TO W-DE.
001850 M-30.
001860     IF W-DE = 9
001870         GO TO M-90.
001880     READ JCON NEXT RECORD WITH UNLOCK AT END
001890         MOVE 9 TO JCON3-02 W-DE
001900         GO TO M-35.
001910     IF JCON3-01 NOT = 3
001920         MOVE 9 TO JCON3-02 W-DE.
001930 M-35.
001940     MOVE ZERO TO CNT.
001950 M-40.
001960     ADD 1 TO CNT.
001970     IF CNT = 19
001980         GO TO M-30.
001990     IF W-FHCD(CNT) = ZERO
002000         GO TO M-30.
002010     MOVE W-FHCD(CNT) TO HI-KEY.
002020     READ HI-M WITH UNLOCK INVALID KEY
002030         MOVE 1 TO HI-S(1,1) HI-S(2,1) HI-S(3,1) HI-S(4,1).
002040     MOVE 0 TO W-S.
002050 M-45.
002060     ADD 1 TO W-S.
002070     IF W-S = 5
002080         GO TO M-40.
002090     IF HI-SS(W-S) = ZERO
002100         GO TO M-45.
002110     MOVE JCON3-02 TO NJZAI-01.
002120     MOVE W-FHCD(CNT) TO NJZAI-02.
002130     MOVE W-S TO NJZAI-03.
002140     READ NJZAI INVALID KEY
002150         GO TO M-45.
002160     PERFORM S-05 THRU S-15.
002170*
002180     MOVE JCON3-02 TO NJZAI-01.
002190     MOVE W-RHCD(CNT) TO NJZAI-02.
002200     MOVE W-S TO NJZAI-03.
002210     READ NJZAI INVALID KEY
002220         GO TO M-50.
002230     PERFORM S-20 THRU S-30.
002240     REWRITE NJZAI-R INVALID KEY
002250         MOVE SPACE TO W-MSG
002260         MOVE "***  REWRITE ｴﾗｰ  ***" TO W-MSG
002270         DISPLAY E-ME E-KEY E-ME99
002280         GO TO M-95.
002290     GO TO M-55.
002300 M-50.
002310     INITIALIZE NJZAI-R.
002320     MOVE JCON3-02 TO NJZAI-01.
002330     MOVE W-RHCD(CNT) TO NJZAI-02.
002340     MOVE W-S TO NJZAI-03.
002350     PERFORM S-20 THRU S-30.
002360     WRITE NJZAI-R INVALID KEY
002370         MOVE SPACE TO W-MSG
002380         MOVE "***  WRITE ｴﾗｰ  ***" TO W-MSG
002390         DISPLAY E-ME E-KEY E-ME99
002400         GO TO M-95.
002410 M-55.
002420     MOVE JCON3-02 TO NJZAI-01.
002430     MOVE W-FHCD(CNT) TO NJZAI-02.
002440     MOVE W-S TO NJZAI-03.
002450     READ NJZAI INVALID KEY
002460         MOVE SPACE TO W-MSG
002470         MOVE "***  NJZAI ﾅｼ  ***" TO W-MSG
002480         DISPLAY E-ME E-KEY E-ME99
002490         GO TO M-95.
002500     DELETE NJZAI INVALID KEY
002510         MOVE SPACE TO W-MSG
002520         MOVE "***  DELETE ｴﾗｰ  ***" TO W-MSG
002530         DISPLAY E-ME E-KEY E-ME99
002540         GO TO M-95.
002550     GO TO M-45.
002560 M-90.
002570     CLOSE NJZAI.
002580     CLOSE JCON.
002590 M-95.
002600     CLOSE HI-M.
002610     DISPLAY C-CLEAR.
002620     STOP RUN.
002630 S-05.
002640     MOVE ZERO TO W-RD W-C.
002650 S-10.
002660     ADD 1 TO W-C.
002670     IF W-C < 11
002680         MOVE NJZAI-0411(W-C) TO W-0411(W-C)
002690         MOVE NJZAI-0511(W-C) TO W-0511(W-C)
002700         MOVE NJZAI-0611(W-C) TO W-0611(W-C)
002710         MOVE NJZAI-0711(W-C) TO W-0711(W-C)
002720         MOVE NJZAI-0811(W-C) TO W-0811(W-C)
002730         MOVE NJZAI-0911(W-C) TO W-0911(W-C)
002740         MOVE NJZAI-1011(W-C) TO W-1011(W-C)
002750         MOVE NJZAI-1111(W-C) TO W-1111(W-C)
002760         GO TO S-10.
002770 S-15.
002780     EXIT.
002790 S-20.
002800     MOVE ZERO TO W-C.
002810 S-25.
002820     ADD 1 TO W-C.
002830     IF W-C < 11
002840         ADD W-0411(W-C) TO NJZAI-0411(W-C)
002850         ADD W-0511(W-C) TO NJZAI-0511(W-C)
002860         ADD W-0611(W-C) TO NJZAI-0611(W-C)
002870         ADD W-0711(W-C) TO NJZAI-0711(W-C)
002880         ADD W-0811(W-C) TO NJZAI-0811(W-C)
002890         ADD W-0911(W-C) TO NJZAI-0911(W-C)
002900         ADD W-1011(W-C) TO NJZAI-1011(W-C)
002910         ADD W-1111(W-C) TO NJZAI-1111(W-C)
002920         GO TO S-25.
002930 S-30.
002940     EXIT.
