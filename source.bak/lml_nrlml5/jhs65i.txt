000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JHS65I.
000030*********************************************************
000040*    PROGRAM         :  “ˆê“`•[’ù³“ü—ÍiÔ‚¿‚á‚ñ–{•Üj*
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SJH65I                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT TDNAF ASSIGN TO TDNA-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY TDNA-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT AHNHF ASSIGN TO AHNH-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE RANDOM
000230         RECORD KEY AHNH-KEY
000240         FILE STATUS IS ERR-STAT.
000250*****SELECT CODEF ASSIGN TO CODE-MSD                              D.100901
000260     SELECT CODEF ASSIGN TO CODE1-MSD CODE2-MSD                   I.100901
000270         ORGANIZATION INDEXED
000280         ACCESS MODE DYNAMIC
000290         RECORD KEY CODE-KEY
000300         ALTERNATE RECORD KEY CODE-KEY2                           I.100901
000310         FILE STATUS IS ERR-STAT.
000320     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000330         ORGANIZATION INDEXED
000340         ACCESS MODE RANDOM
000350         RECORD KEY HI-KEY
000360         ALTERNATE RECORD KEY HI-KEY2
000370         FILE STATUS IS ERR-STAT.
000380 I-O-CONTROL.
000390     APPLY SHARED-MODE ON TDNAF
000400     APPLY SHARED-MODE ON AHNHF
000410     APPLY SHARED-MODE ON CODEF
000420     APPLY SHARED-MODE ON HI-M.
000430 DATA DIVISION.
000440 FILE SECTION.
000450     COPY LITDNA.
000460     COPY LIAHNH.
000470     COPY LICODE.
000480     COPY LIHIM.
000490 WORKING-STORAGE  SECTION.
000500 77  ERR-STAT           PIC  X(002).
000510 77  W-FILE             PIC  X(013).
000520 77  W-END              PIC  9(001) VALUE 0.
000530 77  W-INV              PIC  9(001) VALUE 0.                      I.090909
000540 01  W-CRT.
000550     02  W-STC          PIC  9(007).
000560*****02  W-DNO          PIC  9(006).                              D.100901
000570     02  W-DNO          PIC  9(007).                              I.100901
000580     02  W-MEI.
000590       03  W-MEID  OCCURS   9.
000600         04  W-SU       PIC  9(005).
000610         04  W-NSU      PIC  9(005).
000620         04  W-GTN      PIC  9(007).
000630         04  W-UTN      PIC  9(007).
000640         04  W-GKIN     PIC  9(009).
000650         04  W-UKIN     PIC  9(009).
000660     02  W-DNGP.
000670       03  W-DNEN1      PIC  9(002).
000680       03  W-DNGPS      PIC  9(006).
000690     02  W-DMM          PIC  9(001).
000700 01  W-DATA.
000710     02  W-SNGP         PIC  9(006).
000720     02  W-ENGP         PIC  9(006).
000730     02  W-NGP          PIC  9(006).
000740     02  W-NGPS  REDEFINES W-NGP.
000750       03  W-NEN        PIC  9(002).
000760       03  W-GET        PIC  9(002).
000770       03  W-PEY        PIC  9(002).
000780     02  WT-D.
000790       03  WT-SU        PIC  9(006).
000800       03  WT-NSU       PIC  9(006).
000810       03  WT-GKIN      PIC  9(009).
000820       03  WT-UKIN      PIC  9(009).
000830     02  W-L1           PIC  9(002).
000840     02  W-L2           PIC  9(002).
000850     02  CNT            PIC  9(002).
000860     02  W-ASIZD.
000870       03  W-ASIZ  OCCURS   4.
000880         04  W-SIZD  OCCURS  10.
000890           05  W-SIZ    PIC  X(004).
000900     02  W-SIZM         PIC  N(004).
000910     02  W-SZ           PIC  X(004).
000920     02  W-SZD   REDEFINES W-SZ.
000930       03  F            PIC  X(003).
000940       03  W-SZH        PIC  X(001).
000950     02  W-MSIZ.
000960*      03  F            PIC  X(040) VALUE
000970*           "----      SS   S   M   L  LL  XL XXL    ".
000980       03  F            PIC  X(040) VALUE
000990            "                            28.029.030.0".
001000       03  F            PIC  X(040) VALUE
001010            "12.513.013.514.015.016.017.018.019.020.0".
001020       03  F            PIC  X(040) VALUE
001030            "21.021.522.022.523.023.524.024.525.0    ".
001040       03  F            PIC  X(040) VALUE
001050            "24.024.525.025.526.026.527.027.5        ".
001060     COPY LSTAT.
001070 SCREEN SECTION.
001080 SD  C-CRT
001090     END STATUS IS ESTAT.
001100 01  C-CLEAR.
001110     02  C-CL    LINE   1  CLEAR SCREEN.
001120 01  C-ACP.
001130     02  LINE   2.
001140       03  A-STC   COLUMN  10  PIC  9(007)
001150            USING W-STC   CHECK OVERFLOW NO IFC.
001160*****  03  A-DNO   COLUMN  58  PIC  9(006)                        D.100901
001170       03  A-DNO   COLUMN  58  PIC  9(007)                        I.100901
001180            USING W-DNO   CHECK OVERFLOW NO IFC.
001190     02  LINE W-L2.
001200       03  A-NSU   COLUMN  31  PIC  9(005)
001210            USING W-NSU(CNT) CHECK OVERFLOW NO IFC.
001220     02  A-DNGP  LINE  22  COLUMN   8  PIC  9(006)
001230          USING W-DNGPS CHECK OVERFLOW NO IFC.
001240     02  A-DMM   LINE  23  COLUMN  65  PIC  9(001)
001250          USING W-DMM   CHECK OVERFLOW NO IFC.
001260 01  C-DSP.
001270     02  D-HED   LINE   2.
001280       03  D-NHSN  COLUMN  18  PIC  N(016)  FROM  AHNH-NHSN.
001290       03  D-NHPS  COLUMN  73  PIC 99/99/99 FROM  TDNA-NGPS.
001300     02  D-MEI.
001310       03  LINE W-L1.
001320         04  D-JAN   COLUMN   1  PIC  X(013)  FROM  TDNA-JAN.
001330         04  D-HNA   COLUMN  15  PIC  N(024)  FROM  HI-NAME.
001340         04  D-SIZM  COLUMN  64  PIC  N(004)  FROM  W-SIZM.
001350       03  LINE W-L2.
001360         04  D-NSU   COLUMN  31  PIC ZZZZ9      FROM  W-NSU(CNT).
001370         04  D-SU    COLUMN  37  PIC ZZ,ZZ9     FROM  TDNA-SU.
001380         04  D-GTN   COLUMN  43  PIC ZZZZ,ZZ9   FROM  W-GTN(CNT).
001390         04  D-GKIN  COLUMN  52  PIC ZZ,ZZZ,ZZ9 FROM  W-GKIN(CNT).
001400         04  D-UTN   COLUMN  62  PIC ZZZZ,ZZ9   FROM  W-UTN(CNT).
001410         04  D-UKIN  COLUMN  71  PIC ZZ,ZZZ,ZZ9 FROM  W-UKIN(CNT).
001420     02  D-TOT   LINE  22.
001430       03  COLUMN  31  PIC ZZZZ9      FROM  WT-NSU.
001440       03  COLUMN  37  PIC ZZ,ZZ9     FROM  WT-SU.
001450       03  COLUMN  52  PIC ZZ,ZZZ,ZZ9 FROM  WT-GKIN.
001460       03  COLUMN  71  PIC ZZ,ZZZ,ZZ9 FROM  WT-UKIN.
001470     02  D-MEIC.
001480       03  LINE W-L1.
001490         04  COLUMN   1  PIC  X(013) VALUE "             ".
001500         04  COLUMN  15  PIC  X(048) VALUE
001510              "                                                ".
001520         04  COLUMN  64  PIC  X(008) VALUE "        ".
001530       03  LINE W-L2.
001540         04  COLUMN  31  PIC  X(005) VALUE "     ".
001550         04  COLUMN  37  PIC  X(006) VALUE "      ".
001560         04  COLUMN  43  PIC  X(008) VALUE "        ".
001570         04  COLUMN  52  PIC  X(010) VALUE "          ".
001580         04  COLUMN  62  PIC  X(008) VALUE "        ".
001590         04  COLUMN  71  PIC  X(010) VALUE "          ".
001600 01  C-ERR.
001610     02  LINE  24.
001620       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001630            "***  DATA Å¼  ***".
001640       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001650            "***  ¼¬ÃÝ Å¼  ***".
001660       03  E-ME3   COLUMN  15  PIC  X(027) VALUE
001670            "***  TDNAF DATA ´×°  ***".
001680       03  E-ME4   COLUMN  15  PIC  X(021) VALUE
001690            "***  ÌßÛ¸Þ×Ñ ´×°  ***".
001700       03  E-ME5   COLUMN  15  PIC  X(024) VALUE
001710            "***  “`•[”­s@Ï‚Ý  ***".
001720       03  E-ME11  COLUMN  15  PIC  X(027) VALUE
001730            "***  TDNAF REWRITE ´×°  ***".
001740     COPY LSSEM.
001750 PROCEDURE DIVISION.
001760 M-05.
001770     DISPLAY C-CLEAR.
001780     CALL "SJH65I".
001790     OPEN INPUT AHNHF.
001800     OPEN INPUT CODEF.
001810     OPEN INPUT HI-M.
001820     OPEN I-O TDNAF.
001830     MOVE W-MSIZ TO W-ASIZD.
001840     ACCEPT W-NGP FROM DATE.
001850     SUBTRACT 1 FROM W-GET.
001860     IF W-GET = ZERO
001870         SUBTRACT 1 FROM W-NEN
001880         MOVE 12 TO W-GET.
001890     MOVE W-NGP TO W-SNGP.
001900     ACCEPT W-NGP FROM DATE.
001910     ADD 1 TO W-GET.
001920     IF W-GET > 12
001930         ADD 1 TO W-NEN
001940         MOVE 1 TO W-GET.
001950     MOVE W-NGP TO W-ENGP.
001960 M-10.
001970     ACCEPT A-STC.
001980     DISPLAY E-CL.
001990     IF ESTAT = PF9
002000         GO TO M-90.
002010     IF ESTAT NOT = HTB AND SKP
002020         GO TO M-10.
002030     MOVE W-STC TO AHNH-KEY.
002040     READ AHNHF WITH UNLOCK INVALID KEY
002050         DISPLAY E-ME2 E-ME98
002060         MOVE SPACE TO AHNH-NHSN.                                 I.090727
002070*****    GO TO M-10.                                              D.090727
002080     DISPLAY D-NHSN.
002090 M-15.
002100     ACCEPT A-DNO.
002110     DISPLAY E-CL.
002120     IF ESTAT = BTB
002130         GO TO M-10.
002140     IF ESTAT NOT = HTB AND SKP
002150         GO TO M-15.
002160     MOVE 0 TO W-INV.                                             I.090909
002170     MOVE SPACE TO TDNA-KEY.
002180     MOVE W-STC TO TDNA-STC.
002190     MOVE W-DNO TO TDNA-DNO.
002200     START TDNAF KEY NOT < TDNA-KEY INVALID KEY
002210         DISPLAY E-ME1 E-ME98
002220         GO TO M-15.
002230     READ TDNAF NEXT RECORD WITH UNLOCK AT END
002240         DISPLAY E-ME1 E-ME98
002250         GO TO M-15.
002260     IF (W-STC NOT = TDNA-STC) OR (W-DNO NOT = TDNA-DNO)
002270         DISPLAY E-ME1 E-ME98
002280         GO TO M-15.
002290     IF TDNA-PC = 9
002300         DISPLAY E-ME5 E-ME99.
002310     IF TDNA-RC = 1                                               I.090909
002320         IF W-INV = 0                                             I.090909
002330             MOVE 1 TO W-INV.                                     I.090909
002340*
002350     MOVE ZERO TO W-MEI WT-D.
002360     PERFORM DSP-RTN THRU DSP-EX.
002370     IF W-END = 1
002380         MOVE 255 TO COMPLETION-CODE
002390         GO TO M-90.
002400     IF W-INV = 1                                                 I.090909
002410         GO TO M-15.                                              I.090909
002420     MOVE ZERO TO CNT.
002430     MOVE 2 TO W-L1.
002440 M-20.
002450     ADD 1 TO CNT.
002460     ADD 2 TO W-L1.
002470     COMPUTE W-L2 = W-L1 + 1.
002480     IF CNT > 9
002490         GO TO M-35.
002500     IF W-L1 > 20
002510         MOVE 255 TO COMPLETION-CODE
002520         GO TO M-90.
002530     IF W-SU(CNT) = ZERO
002540         GO TO M-20.
002550 M-25.
002560     ACCEPT A-NSU.
002570     DISPLAY E-CL.
002580     IF ESTAT = BTB
002590         GO TO M-30.
002600     IF ESTAT NOT = HTB AND SKP
002610         GO TO M-25.
002620     COMPUTE W-GKIN(CNT) = W-NSU(CNT) * W-GTN(CNT).
002630     COMPUTE W-UKIN(CNT) = W-NSU(CNT) * W-UTN(CNT).
002640     DISPLAY D-NSU D-GKIN D-UKIN.
002650     GO TO M-20.
002660 M-30.
002670     SUBTRACT 1 FROM CNT.
002680     SUBTRACT 2 FROM W-L1.
002690     COMPUTE W-L2 = W-L1 + 1.
002700     IF CNT = 0
002710         GO TO M-15.
002720     IF W-L1 < 4
002730         DISPLAY E-ME4 E-ME99
002740         GO TO M-90.
002750     IF W-SU(CNT) = ZERO
002760         GO TO M-30.
002770     GO TO M-25.
002780 M-35.
002790     MOVE ZERO TO WT-NSU CNT.
002800 M-40.
002810     ADD 1 TO CNT.
002820     IF CNT < 10
002830         ADD W-NSU(CNT) TO WT-NSU
002840         ADD W-GKIN(CNT) TO WT-GKIN
002850         ADD W-UKIN(CNT) TO WT-UKIN
002860         GO TO M-40.
002870     DISPLAY D-TOT.
002880 M-45.
002890     ACCEPT A-DNGP.
002900     DISPLAY E-CL.
002910     IF ESTAT = BTB
002920         GO TO M-30.
002930     IF ESTAT NOT = HTB AND SKP
002940         GO TO M-45.
002950     IF W-DNGPS < W-SNGP OR > W-ENGP
002960         GO TO M-45.
002970     MOVE W-DNGPS TO W-NGP.
002980     IF W-NEN < 09
002990         GO TO M-45.
003000     IF W-GET < 1 OR > 12
003010         GO TO M-45.
003020     IF W-PEY < 1 OR > 31
003030         GO TO M-45.
003040     MOVE W-NGP TO W-DNGPS.
003050     MOVE 20 TO W-DNEN1.
003060 M-65.
003070     ACCEPT A-DMM.
003080     DISPLAY E-CL.
003090     IF ESTAT = BTB
003100         GO TO M-45.
003110     IF ESTAT NOT = HTB AND SKP
003120         GO TO M-65.
003130     IF W-DMM = 9
003140         GO TO M-10.
003150     IF W-DMM NOT = 1
003160         GO TO M-65.
003170*
003180     MOVE SPACE TO TDNA-KEY.
003190     MOVE W-STC TO TDNA-STC.
003200     MOVE W-DNO TO TDNA-DNO.
003210     START TDNAF KEY NOT < TDNA-KEY INVALID KEY
003220         MOVE 255 TO COMPLETION-CODE
003230         DISPLAY E-ME4 E-ME99
003240         GO TO M-90.
003250     READ TDNAF NEXT RECORD AT END
003260         MOVE 255 TO COMPLETION-CODE
003270         DISPLAY E-ME4 E-ME98
003280         GO TO M-90.
003290     IF (W-STC NOT = TDNA-STC) OR (W-DNO NOT = TDNA-DNO)
003300         MOVE 255 TO COMPLETION-CODE
003310         DISPLAY E-ME4 E-ME98
003320         GO TO M-90.
003330     MOVE ZERO TO CNT.
003340 M-70.
003350     ADD 1 TO CNT.
003360     IF CNT > 9
003370         MOVE 255 TO COMPLETION-CODE
003380         DISPLAY E-ME4 E-ME98
003390         GO TO M-90.
003400     IF W-NSU(CNT) = TDNA-SU
003410         MOVE ZERO TO TDNA-NSU TDNA-TSC
003420       ELSE
003430         MOVE W-NSU(CNT) TO TDNA-NSU
003440         MOVE 1 TO TDNA-TSC.
003450     MOVE W-DNGP TO TDNA-DNGP.
003460     MOVE 0 TO TDNA-PC.
003470     REWRITE TDNA-R INVALID KEY
003480         MOVE 255 TO COMPLETION-CODE
003490         DISPLAY E-ME11 E-ME99
003500         GO TO M-90.
003510*
003520     READ TDNAF NEXT RECORD AT END
003530         GO TO M-75.
003540     IF (W-STC NOT = TDNA-STC) OR (W-DNO NOT = TDNA-DNO)
003550         GO TO M-75.
003560     GO TO M-70.
003570 M-75.
003580     DISPLAY C-CLEAR.
003590     CALL "SJH65I".
003600     DISPLAY A-STC D-NHSN.
003610     GO TO M-15.
003620 M-90.
003630     CLOSE AHNHF.
003640     CLOSE CODEF.
003650     CLOSE HI-M.
003660     CLOSE TDNAF.
003670 M-95.
003680     DISPLAY C-CLEAR.
003690     STOP RUN.
003700 DSP-RTN.
003710     DISPLAY D-NHPS.
003720     MOVE TDNA-DNGP TO W-DNGP.
003730     MOVE ZERO TO CNT.
003740     MOVE 2 TO W-L1.
003750 DSP-010.
003760     ADD 1 TO CNT.
003770     IF CNT > 9
003780         MOVE 1 TO W-END
003790         DISPLAY E-ME3 E-ME99
003800         GO TO DSP-EX.
003810     ADD 2 TO W-L1.
003820     COMPUTE W-L2 = W-L1 + 1.
003830     IF W-L1 > 20
003840         MOVE 1 TO W-END
003850         DISPLAY E-ME4 E-ME99
003860         GO TO DSP-EX.
003870*
003880     MOVE ZERO TO CODE-HCD.
003890     MOVE SPACE TO CODE-KEY.
003900     MOVE ZERO TO CODE-TCD.
003910     MOVE TDNA-JAN TO CODE-JAN.
003920     START CODEF KEY NOT < CODE-KEY INVALID KEY
003930         MOVE SPACE TO HI-NAME W-SIZM
003940         MOVE NC"@‚i‚`‚m‚È‚µ@" TO HI-NAME
003950         GO TO DSP-020.
003960     READ CODEF NEXT RECORD WITH UNLOCK AT END
003970         MOVE SPACE TO HI-NAME W-SIZM
003980         MOVE NC"@‚i‚`‚m‚È‚µ@" TO HI-NAME
003990         GO TO DSP-020.
004000     IF (CODE-TCD NOT = ZERO) OR (CODE-JAN NOT = TDNA-JAN)
004010         MOVE SPACE TO HI-NAME W-SIZM
004020         MOVE NC"@‚i‚`‚m‚È‚µ@" TO HI-NAME
004030         GO TO DSP-020.
004040     MOVE CODE-HCD TO HI-KEY.
004050     READ HI-M WITH UNLOCK INVALID KEY
004060         MOVE 0 TO HI-HKB
004070         MOVE SPACE TO HI-NAME
004080         MOVE NC"@•i–¼‚È‚µ@" TO HI-NAME.
004090     MOVE W-SIZ(CODE-SIZ,CODE-SNO) TO W-SZ.
004100     IF HI-HKB = 1
004110         MOVE 5 TO W-SZH.
004120     MOVE W-SZ TO W-SIZM.
004130 DSP-020.
004140     MOVE TDNA-SU TO W-SU(CNT).
004150     MOVE TDNA-GTN TO W-GTN(CNT).
004160     MOVE TDNA-UTN TO W-UTN(CNT).
004170     IF TDNA-TSC = 1
004180         MOVE TDNA-NSU TO W-NSU(CNT)
004190         COMPUTE W-GKIN(CNT) = TDNA-NSU * TDNA-GTN
004200         COMPUTE W-UKIN(CNT) = TDNA-NSU * TDNA-UTN
004210       ELSE
004220         MOVE TDNA-SU TO W-NSU(CNT)
004230         MOVE TDNA-GKIN TO W-GKIN(CNT)
004240         MOVE TDNA-UKIN TO W-UKIN(CNT).
004250     ADD W-SU(CNT) TO WT-SU.
004260     ADD W-NSU(CNT) TO WT-NSU.
004270     ADD W-GKIN(CNT) TO WT-GKIN.
004280     ADD W-UKIN(CNT) TO WT-UKIN.
004290     DISPLAY D-MEI.
004300*
004310     READ TDNAF NEXT RECORD WITH UNLOCK AT END
004320         GO TO DSP-030.
004330     IF (W-STC NOT = TDNA-STC) OR (W-DNO NOT = TDNA-DNO)
004340         GO TO DSP-030.
004350     GO TO DSP-010.
004360 DSP-030.
004370     ADD 1 TO CNT.
004380     IF CNT < 10
004390         ADD 2 TO W-L1
004400         COMPUTE W-L2 = W-L1 + 1
004410         DISPLAY D-MEIC
004420         GO TO DSP-030.
004430     DISPLAY A-DNGP D-TOT.
004440 DSP-EX.
004450     EXIT.
