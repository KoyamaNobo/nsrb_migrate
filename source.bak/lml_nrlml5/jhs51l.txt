000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JHS51L.
000030*********************************************************
000040*    PROGRAM         :  統一伝票発行（ワークマン）      *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT TDNWF ASSIGN TO TDNW-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY TDNW1-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT TDNWRF ASSIGN TO TDNWR-MSD.                           I.080903
000210     SELECT SP-F ASSIGN TO P-PRN999.
000220 I-O-CONTROL.
000230     APPLY SHARED-MODE ON TDNWF
000240     APPLY SHIFT-CODE  ON SP-F.
000250 DATA DIVISION.
000260 FILE SECTION.
000270     COPY LITDNW.
000280 FD  TDNWRF                                                       I.080903
000290     BLOCK  1 RECORDS                                             I.080903
000300     LABEL RECORD IS STANDARD                                     I.080903
000310     VALUE OF IDENTIFICATION "TDNWRF".                            I.080903
000320 01  TDNWR-R1.                                                    I.080903
000330     02  TDNWR1-KEY.                                              I.080903
000340       03  TDNWR1-STC.                                            I.080903
000350         04  F           PIC  9(002).                             I.080903
000360         04  TDNWR1-SCD  PIC  9(002).                             I.080903
000370         04  F           PIC  9(001).                             I.101018
000380         04  TDNWR1-TCD  PIC  9(004).                             I.101018
000390*****    04  F           PIC  9(002).                             D.101018
000400*****    04  TDNWR1-TCD  PIC  9(003).                             D.101018
000410       03  TDNWR1-DNO.                                            I.080903
000420         04  F           PIC  9(002).                             I.080903
000430         04  TDNWR1-DNOD PIC  9(007).                             I.080903
000440       03  TDNWR1-DGN    PIC  9(002).                             I.080903
000450     02  TDNWR1-BC.                                               I.080903
000460       03  TDNWR1-BCD    PIC  9(002).                             I.080903
000470       03  F             PIC  9(001).                             I.080903
000480     02  TDNWR1-SHC      PIC  9(001).                             I.080903
000490     02  TDNWR1-DPC      PIC  X(002).                             I.080903
000500     02  TDNWR1-HNGP     PIC  9(006).                             I.080903
000510     02  TDNWR1-HNGPD REDEFINES TDNWR1-HNGP.                      I.080903
000520       03  TDNWR1-HNEN   PIC  9(002).                             I.080903
000530       03  TDNWR1-HGET   PIC  9(002).                             I.080903
000540       03  TDNWR1-HPEY   PIC  9(002).                             I.080903
000550     02  TDNWR1-NNGP     PIC  9(006).                             I.080903
000560     02  TDNWR1-NNGPD REDEFINES TDNWR1-NNGP.                      I.080903
000570       03  TDNWR1-NNEN   PIC  9(002).                             I.080903
000580       03  TDNWR1-NGET   PIC  9(002).                             I.080903
000590       03  TDNWR1-NPEY   PIC  9(002).                             I.080903
000600     02  TDNWR1-THC      PIC  9(006).                             I.080903
000610     02  TDNWR1-MHC      PIC  X(001).                             I.080903
000620     02  F               PIC  X(001).                             I.080903
000630     02  TDNWR1-SNA      PIC  X(020).                             I.080903
000640     02  TDNWR1-TNA      PIC  X(020).                             I.080903
000650     02  TDNWR1-HCC      PIC  9(001).                             I.080903
000660     02  TDNWR1-HSP      PIC  X(001).                             I.080903
000670     02  TDNWR1-DHC      PIC  X(001).                             I.080903
000680     02  TDNWR1-KHC      PIC  X(001).                             I.080903
000690     02  TDNWR1-KCC      PIC  X(001).                             I.080903
000700     02  TDNWR1-UBC      PIC  X(001).                             I.080903
000710     02  TDNWR1-NCC      PIC  9(001).                             I.080903
000720     02  TDNWR1-EDI      PIC  9(001).                             I.080903
000730     02  TDNWR1-NKC      PIC  9(001).                             I.080903
000740     02  TDNWR1-ZAC      PIC  9(001).                             I.080903
000750     02  F               PIC  X(150).                             I.080903
000760     02  TDNWR1-HC       PIC  9(001).                             I.080903
000770     02  F               PIC  X(008).                             I.080903
000780     02  TDNWR1-PC       PIC  9(001).                             I.080903
000790 01  TDNWR-R2.                                                    I.080903
000800     02  TDNWR2-KEY.                                              I.080903
000810       03  TDNWR2-STC.                                            I.080903
000820         04  F           PIC  9(002).                             I.080903
000830         04  TDNWR2-SCD  PIC  9(002).                             I.080903
000840         04  F           PIC  9(001).                             D.101018
000850         04  TDNWR2-TCD  PIC  9(004).                             I.101018
000860*****    04  F           PIC  9(002).                             D.101018
000870*****    04  TDNWR2-TCD  PIC  9(003).                             D.101018
000880       03  TDNWR2-DNO.                                            I.080903
000890         04  F           PIC  9(002).                             I.080903
000900         04  TDNWR2-DNOD PIC  9(007).                             I.080903
000910       03  TDNWR2-DGN    PIC  9(002).                             I.080903
000920     02  TDNWR2-HCD      PIC  X(013).                             I.080903
000930     02  TDNWR2-ISU      PIC  9(003)V9(01).                       I.080903
000940     02  TDNWR2-KSU      PIC  9(004).                             I.080903
000950     02  TDNWR2-HTC      PIC  X(002).                             I.080903
000960     02  TDNWR2-SU       PIC  9(005)V9(01).                       I.080903
000970     02  TDNWR2-GTN      PIC  9(007)V9(02).                       I.080903
000980     02  TDNWR2-UTN      PIC  9(007).                             I.080903
000990     02  TDNWR2-GKIN     PIC  9(010).                             I.080903
001000     02  TDNWR2-UKIN     PIC  9(010).                             I.080903
001010     02  TDNWR2-GCN      PIC  9(006).                             I.080903
001020     02  TDNWR2-CCD      PIC  X(003).                             I.080903
001030     02  TDNWR2-SHN      PIC  X(025).                             I.080903
001040     02  TDNWR2-JAN      PIC  X(013).                             I.080903
001050     02  F               PIC  X(004).                             I.080903
001060     02  TDNWR2-TSH      PIC  9(005).                             I.080903
001070     02  TDNWR2-TKC      PIC  X(001).                             I.080903
001080     02  F               PIC  X(001).                             I.080903
001090     02  F               PIC  X(103).                             I.080903
001100     02  TDNWR2-HC       PIC  9(001).                             I.080903
001110     02  F               PIC  X(008).                             I.080903
001120     02  TDNWR2-PC       PIC  9(001).                             I.080903
001130 FD  SP-F
001140     LABEL RECORD OMITTED
001150     LINAGE IS 30 LINES.
001160 01  SP-R               PIC  X(170).
001170 WORKING-STORAGE  SECTION.
001180 77  ERR-STAT           PIC  X(002).
001190 77  W-FILE             PIC  X(013).
001200 77  W-20K              PIC  X(005) VALUE ""3FE04FE080"".
001210 01  W-P01.
001220     02  P-20K          PIC  X(005).
001230*****02  F              PIC  X(016).                              D.091211
001240     02  F              PIC  X(017).                              I.091211
001250     02  P-UBCD         PIC  X(015).
001260     02  F              PIC  X(060).
001270     02  P-HCCD         PIC  X(010).
001280     02  F              PIC  X(007).
001290 01  W-P02.
001300*****02  F              PIC  X(006).                              D.091211
001310     02  F              PIC  X(007).                              I.091211
001320     02  P-SNA          PIC  X(020).
001330     02  F              PIC  X(045).
001340     02  P-NR           PIC  N(005).
001350     02  F              PIC  X(027).
001360 01  W-P03.
001370*****02  F              PIC  X(006).                              D.091211
001380     02  F              PIC  X(007).                              I.091211
001390     02  P-TNA          PIC  X(020).
001400     02  F              PIC  X(004).
001410     02  P-SCD          PIC  9(002).
001420     02  F              PIC  X(002).                              I.101018
001430     02  P-TCD          PIC  9(004).                              I.101018
001440*****02  F              PIC  X(003).                              D.101018
001450*****02  P-TCD          PIC  9(003).                              D.101018
001460     02  F              PIC  X(003).
001470     02  P-BCD          PIC  9(002).
001480     02  P-V            PIC  X(001).
001490     02  P-SHC          PIC  9(001).
001500     02  F              PIC  X(001).
001510     02  P-DPC          PIC  X(002).
001520     02  F              PIC  X(005).
001530     02  P-DNOD         PIC  9(007).
001540     02  F              PIC  X(001).
001550     02  P-THC          PIC  9(006).
001560     02  F              PIC  X(026).
001570     02  P-HNEN         PIC  9(002).
001580     02  P-HGET         PIC Z9.
001590     02  P-HPEY         PIC Z9.
001600     02  P-NNEN         PIC  9(002).
001610     02  P-NGET         PIC Z9.
001620     02  P-NPEY         PIC Z9.
001630     02  F              PIC  X(001).
001640     02  P-HSP          PIC  X(001).
001650     02  F              PIC  X(001).
001660 01  W-P04.
001670*****02  F              PIC  X(004).                              D.091211
001680     02  F              PIC  X(005).                              I.091211
001690     02  P-GCN          PIC  9(006).
001700     02  F              PIC  X(005).
001710     02  P-NON          PIC  X(003).
001720     02  P-TSH          PIC  9(005).
001730     02  F              PIC  X(001).
001740     02  P-TKCD         PIC  X(005).
001750     02  F              PIC  X(079).
001760 01  W-P05.
001770*****02  F              PIC  X(004).                              D.091211
001780     02  F              PIC  X(005).                              I.091211
001790     02  P-SHN          PIC  X(025).
001800     02  P-JAN          PIC  X(013).
001810     02  F              PIC  X(004).
001820     02  P-ISU          PIC  Z(003).
001830     02  F              PIC  X(001).
001840     02  P-KSU          PIC  Z(004).
001850     02  F              PIC  X(001).
001860     02  P-HTC          PIC  X(002).
001870     02  P-SU           PIC  Z(005).
001880     02  F              PIC  X(014).
001890     02  P-GTN          PIC  Z(006).
001900     02  F              PIC  X(002).
001910     02  P-GKIN         PIC  Z(009).
001920     02  P-UTN          PIC  Z(006).
001930     02  P-UKIN         PIC  Z(009).
001940 01  W-DATA.
001950     02  WT-D.
001960       03  WT-SU        PIC  9(006).
001970       03  WT-GKIN      PIC  9(009).
001980       03  WT-UKIN      PIC  9(009).
001990     02  W-D.
002000       03  W-POC        PIC  9(001).
002010       03  W-FOC        PIC  9(001).
002020       03  W-TPC        PIC  9(001).
002030       03  W-HKC        PIC  9(001).
002040       03  W-SED.
002050         04  W-SSTC.
002060           05  W-SSCD   PIC  9(002).
002070           05  W-STCD   PIC  9(004).                              I.101018
002080*****      05  W-STCD   PIC  9(003).                              D.101018
002090         04  W-ESTC.
002100           05  W-ESCD   PIC  9(002).
002110           05  W-ETCD   PIC  9(004).                              I.101018
002120*****      05  W-ETCD   PIC  9(003).                              D.101018
002130         04  W-SDNO     PIC  9(007).
002140         04  W-EDNO     PIC  9(007).
002150       03  W-DMM        PIC  9(001).
002160       03  W-RSTC.
002170         04  W-RSCD     PIC  9(002).
002180         04  W-RTCD     PIC  9(004).                              I.101018
002190*****    04  W-RTCD     PIC  9(003).                              D.101018
002200       03  W-STC        PIC  9(009).
002210       03  W-DNO        PIC  9(009).
002220       03  W-HCC        PIC  9(001).
002230       03  W-LC         PIC  9(002).
002240     COPY LSTAT.
002250 SCREEN SECTION.
002260 SD  C-CRT
002270     END STATUS IS ESTAT.
002280 01  C-CLEAR.
002290     02  C-CL    LINE   1  CLEAR SCREEN.
002300 01  C-MID.
002310     02  LINE   1  COLUMN  20  PIC  N(014) VALUE
002320          NC"チェーンストア統一伝票　発行".
002330     02  LINE   2  COLUMN  20  PIC  N(013) VALUE
002340          NC"（ターンアラウンド用２型）".
002350     02  LINE   4  COLUMN  10  PIC  N(007) VALUE
002360          NC"［ワークマン］".
002370     02  LINE   7  COLUMN  22  PIC  X(035) VALUE
002380          "テストプリント印字 (YES=1,NO=2) [ ]".
002390     02  LINE  10  COLUMN  22  PIC  X(010) VALUE
002400          "１．発　行".
002410     02  LINE  11  COLUMN  22  PIC  X(018) VALUE
002420          "２．再発行（当日）".                                   I.080903
002430     02  LINE  12  COLUMN  22  PIC  X(026) VALUE                  I.080903
002440          "３．再発行（以前）     [ ]".                           I.080903
002450*****     "２．再発行     [ ]".                                   D.080903
002460     02  LINE  23  COLUMN  40  PIC  X(028) VALUE
002470          "確認 (OK=1,NO=9) --->   ﾘﾀｰﾝ".
002480 01  C-DSP.
002490     02  D-SHM.
002500       03  LINE  14  COLUMN  33  PIC  X(018) VALUE
002510            "社店ｺｰﾄﾞ  伝票番号".
002520       03  LINE  15  COLUMN  22  PIC  N(004) VALUE
002530            NC"ＦＲＯＭ".
002540       03  LINE  16  COLUMN  22  PIC  N(002) VALUE
002550            NC"ＴＯ".
002560     02  D-SHMC.
002570       03  LINE  14  COLUMN  33  PIC  X(018) VALUE
002580            "                  ".
002590       03  LINE  15  COLUMN  22  PIC  X(028) VALUE
002600            "                            ".
002610       03  LINE  16  COLUMN  22  PIC  X(028) VALUE
002620            "                            ".
002630 01  C-ACP.
002640     02  A-TPC   LINE   7  COLUMN  55  PIC  9(001)
002650          USING W-TPC   CHECK OVERFLOW NO IFC.
002660*****02  A-HKC   LINE  11  COLUMN  38  PIC  9(001)                D.080903
002670     02  A-HKC   LINE  12  COLUMN  46  PIC  9(001)                I.080903
002680          USING W-HKC   CHECK OVERFLOW NO IFC.
002690     02  A-DMM   LINE  23  COLUMN  62  PIC  9(001)
002700          USING W-DMM   CHECK OVERFLOW NO IFC.
002710     02  LINE  15.
002720*****  03  A-SSTC  COLUMN  34  PIC  9(005)                        D.101018
002730       03  A-SSTC  COLUMN  34  PIC  9(006)                        I.101018
002740            USING W-SSTC  CHECK OVERFLOW NO IFC.
002750       03  A-SDNO  COLUMN  44  PIC  9(007)
002760            USING W-SDNO  CHECK OVERFLOW NO IFC.
002770     02  LINE  16.
002780*****  03  A-ESTC  COLUMN  34  PIC  9(005)                        D.101018
002790       03  A-ESTC  COLUMN  34  PIC  9(006)                        I.101018
002800            USING W-ESTC  CHECK OVERFLOW NO IFC.
002810       03  A-EDNO  COLUMN  44  PIC  9(007)
002820            USING W-EDNO  CHECK OVERFLOW NO IFC.
002830 01  C-ERR.
002840     02  LINE  24.
002850       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002860            "***  DATA ﾅｼ  ***".
002870       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
002880            "***  DATA ｴﾗｰ  ***".
002890       03  E-ME10  COLUMN  15  PIC  X(027) VALUE
002900            "***  TDNWF DATA ｴﾗｰ  ***".
002910       03  E-ME11  COLUMN  15  PIC  X(027) VALUE
002920            "***  TDNWF REWRITE ｴﾗｰ  ***".
002930     COPY LSSEM.
002940 PROCEDURE DIVISION.
002950 M-05.
002960     DISPLAY C-CLEAR.
002970     DISPLAY C-MID.
002980     MOVE 000 TO COMPLETION-CODE.
002990     MOVE ZERO TO W-D.
003000 M-10.
003010     ACCEPT A-TPC.
003020     IF ESTAT = PF9
003030         GO TO M-90.
003040     IF ESTAT NOT = HTB AND SKP
003050         GO TO M-10.
003060     IF W-TPC = 2
003070         GO TO M-15.
003080     IF W-TPC NOT = 1
003090         GO TO M-10.
003100     PERFORM TST-RTN THRU TST-EX.
003110     GO TO M-10.
003120 M-15.
003130     ACCEPT A-HKC.
003140     IF ESTAT = BTB
003150         GO TO M-10.
003160     IF ESTAT NOT = HTB AND SKP
003170         GO TO M-15.
003180     IF W-HKC = 1
003190         DISPLAY D-SHMC
003200         GO TO M-40.
003210*****IF W-HKC NOT = 2                                             D.080903
003220     IF W-HKC NOT = 2 AND 3                                       I.080903
003230         GO TO M-15.
003240     DISPLAY D-SHM.
003250 M-20.
003260     ACCEPT A-SSTC.
003270     IF ESTAT = BTB
003280         GO TO M-15.
003290     IF ESTAT NOT = HTB AND SKP
003300         GO TO M-20.
003310 M-25.
003320     ACCEPT A-ESTC.
003330     IF ESTAT = BTB
003340         GO TO M-20.
003350     IF ESTAT NOT = HTB AND SKP
003360         GO TO M-25.
003370     IF W-SSTC > W-ESTC
003380         GO TO M-25.
003390 M-30.
003400     ACCEPT A-SDNO.
003410     IF ESTAT = BTB
003420         GO TO M-25.
003430     IF ESTAT NOT = HTB AND SKP
003440         GO TO M-30.
003450 M-35.
003460     ACCEPT A-EDNO.
003470     IF ESTAT = BTB
003480         GO TO M-30.
003490     IF ESTAT NOT = HTB AND SKP
003500         GO TO M-35.
003510     IF W-SDNO > W-EDNO
003520         GO TO M-35.
003530 M-40.
003540     ACCEPT A-DMM.
003550     IF ESTAT = BTB
003560         IF W-HKC = 1
003570             GO TO M-15
003580           ELSE
003590             GO TO M-35.
003600     IF ESTAT NOT = HTB AND SKP
003610         GO TO M-40.
003620     IF W-DMM = 9
003630         GO TO M-15.
003640     IF W-DMM NOT = 1
003650         GO TO M-40.
003660*
003670     IF W-HKC = 1
003680         OPEN I-O TDNWF
003690       ELSE
003700         IF W-HKC = 2                                             I.080903
003710             OPEN INPUT TDNWF                                     I.080903
003720           ELSE                                                   I.080903
003730             OPEN INPUT TDNWRF.                                   I.080903
003740*****    OPEN INPUT TDNWF.                                        D.080903
003750     MOVE 1 TO W-FOC.
003760     IF W-HKC = 3                                                 I.080903
003770         GO TO M-46.                                              I.080903
003780 M-45.
003790     READ TDNWF NEXT RECORD WITH UNLOCK AT END
003800         DISPLAY E-ME1 E-ME99
003810         GO TO M-90.
003820     IF TDNW1-PC = 0
003830         GO TO M-45.
003840     IF W-HKC = 1
003850         IF TDNW1-PC = 9
003860             GO TO M-45.
003870     IF W-HKC = 2
003880         IF TDNW1-PC NOT = 9
003890             GO TO M-45.
003900     IF W-HKC = 2
003910         MOVE TDNW1-SCD TO W-RSCD
003920         MOVE TDNW1-TCD TO W-RTCD
003930         IF W-RSTC < W-SSTC OR > W-ESTC
003940             GO TO M-45.
003950     IF W-HKC = 2
003960         IF TDNW1-DNOD < W-SDNO OR > W-EDNO
003970             GO TO M-45.
003980     IF TDNW1-DGN NOT = 0
003990         DISPLAY E-ME78 E-ME2 E-ME99
004000         DISPLAY E-CL
004010         DISPLAY E-ME78
004020         GO TO M-45.
004030     GO TO M-50.                                                  I.080903
004040 M-46.                                                            I.080903
004050     READ TDNWRF AT END                                           I.080903
004060         DISPLAY E-ME1 E-ME99                                     I.080903
004070         GO TO M-90.                                              I.080903
004080     MOVE TDNWR1-SCD TO W-RSCD.                                   I.080903
004090     MOVE TDNWR1-TCD TO W-RTCD.                                   I.080903
004100     IF W-RSTC < W-SSTC OR > W-ESTC                               I.080903
004110         GO TO M-46.                                              I.080903
004120     IF TDNWR1-DNOD < W-SDNO OR > W-EDNO                          I.080903
004130         GO TO M-46.                                              I.080903
004140     IF TDNWR1-DGN NOT = 0                                        I.080903
004150         DISPLAY E-ME78 E-ME2 E-ME99                              I.080903
004160         DISPLAY E-CL                                             I.080903
004170         DISPLAY E-ME78                                           I.080903
004180         GO TO M-46.                                              I.080903
004190 M-50.
004200*****MOVE TDNW1-STC TO W-STC.                                     D.080903
004210*****MOVE TDNW1-DNO TO W-DNO.                                     D.080903
004220*****MOVE TDNW1-HCC TO W-HCC.                                     D.080903
004230     IF W-HKC = 1 OR 2                                            I.080903
004240         MOVE TDNW1-STC TO W-STC                                  I.080903
004250         MOVE TDNW1-DNO TO W-DNO                                  I.080903
004260         MOVE TDNW1-HCC TO W-HCC                                  I.080903
004270       ELSE                                                       I.080903
004280         MOVE TDNWR1-STC TO W-STC                                 I.080903
004290         MOVE TDNWR1-DNO TO W-DNO                                 I.080903
004300         MOVE TDNWR1-HCC TO W-HCC.                                I.080903
004310     MOVE ZERO TO WT-D.
004320     MOVE SPACE TO W-P01 W-P02 W-P03.
004330*
004340     MOVE W-20K TO P-20K.
004350     IF W-HKC = 1 OR 2                                            I.080903
004360         PERFORM HED1-RTN THRU HED1-EX                            I.080903
004370       ELSE                                                       I.080903
004380         PERFORM HED2-RTN THRU HED2-EX.                           I.080903
004390*****IF TDNW1-UBC = "1"                                           D.080903
004400*****    MOVE "ﾃｲﾊﾞﾝｺﾞﾝﾄﾞﾗ" TO P-UBCD.                            D.080903
004410*****IF TDNW1-UBC = "2"                                           D.080903
004420*****    MOVE "ｷﾝｲﾂ" TO P-UBCD.                                   D.080903
004430*****IF TDNW1-UBC = "3"                                           D.080903
004440*****    MOVE "ｱｸｼｮﾝｴﾝﾄﾞ" TO P-UBCD.                              D.080903
004450*****IF TDNW1-HCC = 1                                             D.080903
004460*****    MOVE "*ｶﾞｲﾁｭｳ*" TO P-HCCD.                               D.080903
004470*****IF TDNW1-HCC = 2                                             D.080903
004480*****    MOVE "*ﾅｲﾁｭｳ*" TO P-HCCD.                                D.080903
004490*
004500*****MOVE TDNW1-SNA TO P-SNA.                                     D.080903
004510*****MOVE NC"日進ゴム㈱" TO P-NR.                                 D.080903
004520*
004530*****MOVE TDNW1-TNA TO P-TNA.                                     D.080903
004540*****MOVE TDNW1-SCD TO P-SCD.                                     D.080903
004550*****MOVE TDNW1-TCD TO P-TCD.                                     D.080903
004560*****MOVE TDNW1-BCD TO P-BCD.                                     D.080903
004570*****MOVE "-" TO P-V.                                             D.080903
004580*****MOVE TDNW1-SHC TO P-SHC.                                     D.080903
004590*****MOVE TDNW1-DPC TO P-DPC.                                     D.080903
004600*****MOVE TDNW1-DNOD TO P-DNOD.                                   D.080903
004610*****MOVE TDNW1-THC TO P-THC.                                     D.080903
004620*****MOVE TDNW1-HNEN TO P-HNEN.                                   D.080903
004630*****MOVE TDNW1-HGET TO P-HGET.                                   D.080903
004640*****MOVE TDNW1-HPEY TO P-HPEY.                                   D.080903
004650*****MOVE TDNW1-NNEN TO P-NNEN.                                   D.080903
004660*****MOVE TDNW1-NGET TO P-NGET.                                   D.080903
004670*****MOVE TDNW1-NPEY TO P-NPEY.                                   D.080903
004680*****MOVE TDNW1-HSP TO P-HSP.                                     D.080903
004690*
004700     IF W-POC = 0
004710         OPEN OUTPUT SP-F
004720         MOVE 1 TO W-POC
004730       ELSE
004740         MOVE SPACE TO SP-R
004750         WRITE SP-R AFTER PAGE.
004760     MOVE SPACE TO SP-R.
004770     MOVE W-P01 TO SP-R.
004780*****WRITE SP-R AFTER 2.                                          D.091212
004790     WRITE SP-R AFTER 3.                                          I.091212
004800     MOVE SPACE TO SP-R.
004810     MOVE W-P02 TO SP-R.
004820     WRITE SP-R.
004830     MOVE SPACE TO SP-R.
004840     MOVE W-P03 TO SP-R.
004850     WRITE SP-R.
004860     MOVE SPACE TO SP-R.
004870     WRITE SP-R.
004880     MOVE 20 TO W-LC.
004890     IF W-HKC = 3                                                 I.080903
004900         GO TO M-56.                                              I.080903
004910 M-55.
004920     READ TDNWF NEXT RECORD WITH UNLOCK AT END
004930         GO TO M-85.
004940     IF TDNW1-PC = 0
004950         GO TO M-55.
004960     IF W-HKC = 1
004970         IF TDNW1-PC = 9
004980             GO TO M-55.
004990     IF W-HKC = 2
005000         IF TDNW1-PC NOT = 9
005010             GO TO M-55.
005020     IF W-HKC = 2
005030         MOVE TDNW1-SCD TO W-RSCD
005040         MOVE TDNW1-TCD TO W-RTCD
005050         IF W-RSTC < W-SSTC OR > W-ESTC
005060             GO TO M-55.
005070     IF W-HKC = 2
005080         IF TDNW1-DNOD < W-SDNO OR > W-EDNO
005090             GO TO M-55.
005100     IF (TDNW1-STC NOT = W-STC) OR (TDNW1-DNO NOT = W-DNO)
005110         GO TO M-60.
005120     IF TDNW1-DGN = ZERO
005130         DISPLAY E-ME78 E-ME2 E-ME99
005140         DISPLAY E-CL
005150         DISPLAY E-ME78
005160         GO TO M-50.
005170     GO TO M-57.                                                  I.080903
005180 M-56.                                                            I.080903
005190     READ TDNWRF AT END
005200         GO TO M-85.
005210     MOVE TDNWR1-SCD TO W-RSCD.
005220     MOVE TDNWR1-TCD TO W-RTCD.
005230     IF W-RSTC < W-SSTC OR > W-ESTC
005240         GO TO M-56.
005250     IF TDNWR1-DNOD < W-SDNO OR > W-EDNO
005260         GO TO M-56.
005270     IF (TDNWR1-STC NOT = W-STC) OR (TDNWR1-DNO NOT = W-DNO)
005280         GO TO M-60.
005290     IF TDNWR1-DGN = ZERO
005300         DISPLAY E-ME78 E-ME2 E-ME99
005310         DISPLAY E-CL
005320         DISPLAY E-ME78
005330         GO TO M-50.
005340 M-57.                                                            I.080903
005350     IF W-HKC = 1 OR 2                                            I.080903
005360         PERFORM MEI1-RTN THRU MEI1-EX                            I.080903
005370         GO TO M-55                                               I.080903
005380       ELSE                                                       I.080903
005390         PERFORM MEI2-RTN THRU MEI2-EX.                           I.080903
005400         GO TO M-56.                                              I.080903
005410*****MOVE SPACE TO W-P04 W-P05.                                   D.080903
005420*
005430*****IF W-HCC = 1                                                 D.080903
005440*****    IF TDNW2-GCN NOT = ZERO                                  D.080903
005450*****        MOVE TDNW2-GCN TO P-GCN.                             D.080903
005460*****IF TDNW2-TSH NOT = ZERO                                      D.080903
005470*****    MOVE "NO." TO P-NON                                      D.080903
005480*****    MOVE TDNW2-TSH TO P-TSH.                                 D.080903
005490*****IF TDNW2-TKC = ZERO                                          D.080903
005500*****    MOVE "ﾂｲｶﾌｶ" TO P-TKCD.                                  D.080903
005510*
005520*****MOVE TDNW2-SHN TO P-SHN.                                     D.080903
005530*****IF TDNW2-JAN NOT = SPACE AND ZERO                            D.080903
005540*****    MOVE TDNW2-JAN TO P-JAN                                  D.080903
005550*****  ELSE                                                       D.080903
005560*****    MOVE TDNW2-HCD TO P-JAN.                                 D.080903
005570*****MOVE TDNW2-ISU TO P-ISU.                                     D.080903
005580*****MOVE TDNW2-KSU TO P-KSU.                                     D.080903
005590*****MOVE TDNW2-HTC TO P-HTC.                                     D.080903
005600*****MOVE TDNW2-SU TO P-SU.                                       D.090903
005610*****MOVE TDNW2-GTN TO P-GTN.                                     D.080903
005620*****MOVE TDNW2-GKIN TO P-GKIN.                                   D.080903
005630*****MOVE TDNW2-UTN TO P-UTN.                                     D.080903
005640*****MOVE TDNW2-UKIN TO P-UKIN.                                   D.080903
005650*
005660*****MOVE SPACE TO SP-R.                                          D.080903
005670*****MOVE W-P04 TO SP-R.                                          D.080903
005680*****WRITE SP-R.                                                  D.080903
005690*****MOVE SPACE TO SP-R.                                          D.080903
005700*****MOVE W-P05 TO SP-R.                                          D.080903
005710*****WRITE SP-R.                                                  D.080903
005720*****MOVE SPACE TO SP-R.                                          D.080903
005730*
005740*****SUBTRACT 2 FROM W-LC.                                        D.080903
005750*****ADD TDNW2-SU TO WT-SU.                                       D.080903
005760*****ADD TDNW2-GKIN TO WT-GKIN.                                   D.080903
005770*****ADD TDNW2-UKIN TO WT-UKIN.                                   D.080903
005780*****GO TO M-55.                                                  D.080903
005790 M-60.
005800     PERFORM KEI-RTN THRU KEI-EX.
005810     IF W-HKC = 1
005820         PERFORM REW-RTN THRU REW-EX.
005830     GO TO M-50.
005840 M-85.
005850     PERFORM KEI-RTN THRU KEI-EX.
005860     IF W-HKC = 1
005870         PERFORM REW-RTN THRU REW-EX.
005880 M-90.
005890     IF W-FOC NOT = 0
005900         IF W-HKC = 1 OR 2                                        I.080903
005910             CLOSE TDNWF                                          I.080903
005920           ELSE                                                   I.080903
005930             CLOSE TDNWRF.                                        I.080903
005940*****    CLOSE TDNWF.                                             D.080903
005950     IF W-POC NOT = 0
005960         CLOSE SP-F.
005970 M-95.
005980     DISPLAY C-CLEAR.
005990     STOP RUN.
006000 HED1-RTN.
006010     IF TDNW1-UBC = "1"                                           I.080903
006020         MOVE "ﾃｲﾊﾞﾝｺﾞﾝﾄﾞﾗ" TO P-UBCD.                            I.080903
006030     IF TDNW1-UBC = "2"                                           I.080903
006040         MOVE "ｷﾝｲﾂ" TO P-UBCD.                                   I.080903
006050     IF TDNW1-UBC = "3"                                           I.080903
006060         MOVE "ｱｸｼｮﾝｴﾝﾄﾞ" TO P-UBCD.                              I.080903
006070     IF TDNW1-HCC = 1                                             I.080903
006080         MOVE "*ｶﾞｲﾁｭｳ*" TO P-HCCD.                               I.080903
006090     IF TDNW1-HCC = 2                                             I.080903
006100         MOVE "*ﾅｲﾁｭｳ*" TO P-HCCD.                                I.080903
006110*
006120     MOVE TDNW1-SNA TO P-SNA.                                     I.080903
006130     MOVE NC"日進ゴム㈱" TO P-NR.                                 I.080903
006140*
006150     MOVE TDNW1-TNA TO P-TNA.                                     I.080903
006160     MOVE TDNW1-SCD TO P-SCD.                                     I.080903
006170     MOVE TDNW1-TCD TO P-TCD.                                     I.080903
006180     MOVE TDNW1-BCD TO P-BCD.                                     I.080903
006190     MOVE "-" TO P-V.                                             I.080903
006200     MOVE TDNW1-SHC TO P-SHC.                                     I.080903
006210     MOVE TDNW1-DPC TO P-DPC.                                     I.080903
006220     MOVE TDNW1-DNOD TO P-DNOD.                                   I.080903
006230     MOVE TDNW1-THC TO P-THC.                                     I.080903
006240     MOVE TDNW1-HNEN TO P-HNEN.                                   I.080903
006250     MOVE TDNW1-HGET TO P-HGET.                                   I.080903
006260     MOVE TDNW1-HPEY TO P-HPEY.                                   I.080903
006270     MOVE TDNW1-NNEN TO P-NNEN.                                   I.080903
006280     MOVE TDNW1-NGET TO P-NGET.                                   I.080903
006290     MOVE TDNW1-NPEY TO P-NPEY.                                   I.080903
006300     MOVE TDNW1-HSP TO P-HSP.                                     I.080903
006310 HED1-EX.                                                         I.080903
006320     EXIT.                                                        I.080903
006330 HED2-RTN.
006340     IF TDNWR1-UBC = "1"                                          I.080903
006350         MOVE "ﾃｲﾊﾞﾝｺﾞﾝﾄﾞﾗ" TO P-UBCD.                            I.080903
006360     IF TDNWR1-UBC = "2"                                          I.080903
006370         MOVE "ｷﾝｲﾂ" TO P-UBCD.                                   I.080903
006380     IF TDNWR1-UBC = "3"                                          I.080903
006390         MOVE "ｱｸｼｮﾝｴﾝﾄﾞ" TO P-UBCD.                              I.080903
006400     IF TDNWR1-HCC = 1                                            I.080903
006410         MOVE "*ｶﾞｲﾁｭｳ*" TO P-HCCD.                               I.080903
006420     IF TDNWR1-HCC = 2                                            I.080903
006430         MOVE "*ﾅｲﾁｭｳ*" TO P-HCCD.                                I.080903
006440*
006450     MOVE TDNWR1-SNA TO P-SNA.                                    I.080903
006460     MOVE NC"日進ゴム㈱" TO P-NR.                                 I.080903
006470*
006480     MOVE TDNWR1-TNA TO P-TNA.                                    I.080903
006490     MOVE TDNWR1-SCD TO P-SCD.                                    I.080903
006500     MOVE TDNWR1-TCD TO P-TCD.                                    I.080903
006510     MOVE TDNWR1-BCD TO P-BCD.                                    I.080903
006520     MOVE "-" TO P-V.                                             I.080903
006530     MOVE TDNWR1-SHC TO P-SHC.                                    I.080903
006540     MOVE TDNWR1-DPC TO P-DPC.                                    I.080903
006550     MOVE TDNWR1-DNOD TO P-DNOD.                                  I.080903
006560     MOVE TDNWR1-THC TO P-THC.                                    I.080903
006570     MOVE TDNWR1-HNEN TO P-HNEN.                                  I.080903
006580     MOVE TDNWR1-HGET TO P-HGET.                                  I.080903
006590     MOVE TDNWR1-HPEY TO P-HPEY.                                  I.080903
006600     MOVE TDNWR1-NNEN TO P-NNEN.                                  I.080903
006610     MOVE TDNWR1-NGET TO P-NGET.                                  I.080903
006620     MOVE TDNWR1-NPEY TO P-NPEY.                                  I.080903
006630     MOVE TDNWR1-HSP TO P-HSP.                                    I.080903
006640 HED2-EX.                                                         I.080903
006650     EXIT.                                                        I.080903
006660 MEI1-RTN.                                                        I.080903
006670     MOVE SPACE TO W-P04 W-P05.                                   I.080903
006680*
006690     IF W-HCC = 1                                                 I.080903
006700         IF TDNW2-GCN NOT = ZERO                                  I.080903
006710             MOVE TDNW2-GCN TO P-GCN.                             I.080903
006720     IF TDNW2-TSH NOT = ZERO                                      I.080903
006730         MOVE "NO." TO P-NON                                      I.080903
006740         MOVE TDNW2-TSH TO P-TSH.                                 I.080903
006750     IF TDNW2-TKC = ZERO                                          I.080903
006760         MOVE "ﾂｲｶﾌｶ" TO P-TKCD.                                  I.080903
006770*
006780     MOVE TDNW2-SHN TO P-SHN.                                     I.080903
006790     IF TDNW2-JAN NOT = SPACE AND ZERO                            I.080903
006800         MOVE TDNW2-JAN TO P-JAN                                  I.080903
006810       ELSE                                                       I.080903
006820         MOVE TDNW2-HCD TO P-JAN.                                 I.080903
006830     MOVE TDNW2-ISU TO P-ISU.                                     I.080903
006840     MOVE TDNW2-KSU TO P-KSU.                                     I.080903
006850     MOVE TDNW2-HTC TO P-HTC.                                     I.080903
006860     MOVE TDNW2-SU TO P-SU.                                       I.090903
006870     MOVE TDNW2-GTN TO P-GTN.                                     I.080903
006880     MOVE TDNW2-GKIN TO P-GKIN.                                   I.080903
006890     MOVE TDNW2-UTN TO P-UTN.                                     I.080903
006900     MOVE TDNW2-UKIN TO P-UKIN.                                   I.080903
006910*
006920     MOVE SPACE TO SP-R.                                          I.080903
006930     MOVE W-P04 TO SP-R.                                          I.080903
006940     WRITE SP-R.                                                  I.080903
006950     MOVE SPACE TO SP-R.                                          I.080903
006960     MOVE W-P05 TO SP-R.                                          I.080903
006970     WRITE SP-R.                                                  I.080903
006980     MOVE SPACE TO SP-R.                                          I.080903
006990*
007000     SUBTRACT 2 FROM W-LC.                                        I.080903
007010     ADD TDNW2-SU TO WT-SU.                                       I.080903
007020     ADD TDNW2-GKIN TO WT-GKIN.                                   I.080903
007030     ADD TDNW2-UKIN TO WT-UKIN.                                   I.080903
007040 MEI1-EX.                                                         I.080903
007050     EXIT.                                                        I.080903
007060 MEI2-RTN.                                                        I.080903
007070     MOVE SPACE TO W-P04 W-P05.                                   I.080903
007080*
007090     IF W-HCC = 1                                                 I.080903
007100         IF TDNWR2-GCN NOT = ZERO                                 I.080903
007110             MOVE TDNWR2-GCN TO P-GCN.                            I.080903
007120     IF TDNWR2-TSH NOT = ZERO                                     I.080903
007130         MOVE "NO." TO P-NON                                      I.080903
007140         MOVE TDNWR2-TSH TO P-TSH.                                I.080903
007150     IF TDNWR2-TKC = ZERO                                         I.080903
007160         MOVE "ﾂｲｶﾌｶ" TO P-TKCD.                                  I.080903
007170*
007180     MOVE TDNWR2-SHN TO P-SHN.                                    I.080903
007190     IF TDNWR2-JAN NOT = SPACE AND ZERO                           I.080903
007200         MOVE TDNWR2-JAN TO P-JAN                                 I.080903
007210       ELSE                                                       I.080903
007220         MOVE TDNWR2-HCD TO P-JAN.                                I.080903
007230     MOVE TDNWR2-ISU TO P-ISU.                                    I.080903
007240     MOVE TDNWR2-KSU TO P-KSU.                                    I.080903
007250     MOVE TDNWR2-HTC TO P-HTC.                                    I.080903
007260     MOVE TDNWR2-SU TO P-SU.                                      I.090903
007270     MOVE TDNWR2-GTN TO P-GTN.                                    I.080903
007280     MOVE TDNWR2-GKIN TO P-GKIN.                                  I.080903
007290     MOVE TDNWR2-UTN TO P-UTN.                                    I.080903
007300     MOVE TDNWR2-UKIN TO P-UKIN.                                  I.080903
007310*
007320     MOVE SPACE TO SP-R.                                          I.080903
007330     MOVE W-P04 TO SP-R.                                          I.080903
007340     WRITE SP-R.                                                  I.080903
007350     MOVE SPACE TO SP-R.                                          I.080903
007360     MOVE W-P05 TO SP-R.                                          I.080903
007370     WRITE SP-R.                                                  I.080903
007380     MOVE SPACE TO SP-R.                                          I.080903
007390*
007400     SUBTRACT 2 FROM W-LC.                                        I.080903
007410     ADD TDNWR2-SU TO WT-SU.                                      I.080903
007420     ADD TDNWR2-GKIN TO WT-GKIN.                                  I.080903
007430     ADD TDNWR2-UKIN TO WT-UKIN.                                  I.080903
007440 MEI2-EX.                                                         I.080903
007450     EXIT.                                                        I.080903
007460 KEI-RTN.
007470     IF W-LC > 2
007480         MOVE SPACE TO W-P05
007490         MOVE "*ﾖﾊｸﾆ ﾊ ｷﾆｭｳ ｼﾅｲﾃﾞ ｸﾀﾞｻｲ*" TO P-SHN
007500         MOVE SPACE TO SP-R
007510         MOVE W-P05 TO SP-R
007520         WRITE SP-R AFTER 2
007530         MOVE SPACE TO SP-R
007540         SUBTRACT 2 FROM W-LC.
007550     MOVE SPACE TO W-P05.
007560     MOVE WT-SU TO P-SU.
007570     MOVE WT-GKIN TO P-GKIN.
007580     MOVE WT-UKIN TO P-UKIN.
007590     MOVE SPACE TO SP-R.
007600     MOVE W-P05 TO SP-R.
007610     WRITE SP-R AFTER W-LC.
007620     MOVE SPACE TO SP-R.
007630 KEI-EX.
007640     EXIT.
007650 REW-RTN.
007660     MOVE SPACE TO TDNW1-KEY.
007670     MOVE W-STC TO TDNW1-STC.
007680     MOVE W-DNO TO TDNW1-DNO.
007690     START TDNWF KEY NOT < TDNW1-KEY INVALID KEY
007700         MOVE 255 TO COMPLETION-CODE
007710         DISPLAY E-ME78 E-ME10 E-ME99
007720         GO TO REW-EX.
007730 REW-05.
007740     READ TDNWF NEXT RECORD AT END
007750         GO TO REW-EX.
007760     IF TDNW1-PC = 0 OR 9                                         I.091214
007770         GO TO REW-05.                                            I.091214
007780     IF (TDNW1-STC NOT = W-STC) OR (TDNW1-DNO NOT = W-DNO)
007790         GO TO REW-EX.
007800     MOVE 9 TO TDNW1-PC.
007810     REWRITE TDNW-R1 INVALID KEY
007820         MOVE 255 TO COMPLETION-CODE
007830         DISPLAY E-ME78 E-STAT E-ME11 E-ME99
007840         GO TO REW-EX.
007850     GO TO REW-05.
007860 REW-EX.
007870     EXIT.
007880 TST-RTN.
007890     IF W-POC = 0
007900         OPEN OUTPUT SP-F
007910         MOVE 1 TO W-POC
007920         MOVE SPACE TO W-P01 W-P02 W-P03 W-P04 W-P05
007930         MOVE W-20K TO P-20K
007940         MOVE NC"日進ゴム㈱" TO P-NR
007950         MOVE "-" TO P-V
007960         MOVE ALL "X" TO P-UBCD P-HCCD P-TNA P-DPC P-NON P-TKCD
007970                         P-SHN P-HTC
007980         MOVE 9 TO P-SHC
007990         MOVE 99 TO P-SCD P-BCD P-HNEN P-HGET P-HPEY
008000                    P-NNEN P-NGET P-NPEY
008010*****    MOVE 999 TO P-TCD P-ISU                                  D.101018
008020*****    MOVE 9999 TO P-KSU                                       D.101018
008030         MOVE 999 TO P-ISU                                        I.101018
008040         MOVE 9999 TO P-TCD P-KSU                                 I.101018
008050         MOVE 99999 TO P-TSH P-SU
008060         MOVE 999999 TO P-THC P-GCN P-GTN P-UTN
008070         MOVE 9999999 TO P-DNOD
008080         MOVE 999999999 TO P-GKIN P-UKIN
008090       ELSE
008100         MOVE SPACE TO SP-R
008110         WRITE SP-R AFTER PAGE.
008120     MOVE SPACE TO SP-R.
008130     MOVE W-P01 TO SP-R.
008140     WRITE SP-R AFTER 2.
008150     MOVE SPACE TO SP-R.
008160     MOVE W-P02 TO SP-R.
008170     WRITE SP-R.
008180     MOVE SPACE TO SP-R.
008190     MOVE W-P03 TO SP-R.
008200     WRITE SP-R.
008210     MOVE SPACE TO SP-R.
008220     WRITE SP-R.
008230     MOVE ZERO TO W-LC.
008240 TST-05.
008250     MOVE SPACE TO SP-R.
008260     MOVE W-P04 TO SP-R.
008270     WRITE SP-R.
008280     MOVE SPACE TO SP-R.
008290     MOVE W-P05 TO SP-R.
008300     WRITE SP-R.
008310     MOVE SPACE TO SP-R.
008320     ADD 1 TO W-LC.
008330     IF W-LC < 9
008340         GO TO TST-05.
008350 TST-EX.
008360     EXIT.
