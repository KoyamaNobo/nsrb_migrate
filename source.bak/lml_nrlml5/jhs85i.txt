000010 IDENTIFICATION   DIVISION.
000020 PROGRAM-ID. JHS85I.
000030*************************************************************
000040*    PROGRAM         :  赤ちゃん本舗納品先ファイル　メンテ  *
000050*    PRINTER TYPE    :  JIPS                                *
000060*    SCREEN          :  ******                              *
000070*    COMPILE TYPE    :  COBOL                               *
000080*************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT AHNHF ASSIGN TO AHNH-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY AHNH-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT TC-M ASSIGN TO TC-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE RANDOM
000230         RECORD KEY TC-KEY
000240         FILE STATUS IS ERR-STAT.
000250 I-O-CONTROL.
000260     APPLY SHARED-MODE ON TC-M
000270     APPLY SHARED-MODE ON AHNHF.
000280 DATA DIVISION.
000290 FILE SECTION.
000300     COPY LITCM.
000310     COPY LIAHNH.
000320 WORKING-STORAGE  SECTION.
000330 77  ERR-STAT           PIC  X(002).
000340 77  W-FILE             PIC  X(013).
000350 01  W-DATA.
000360     02  W-CRT.
000370       03  W-ACT       PIC  9(001).
000380*
000390       03  W-STC       PIC  9(007).
000400       03  W-CTC       PIC  9(007).
000410       03  W-HP        PIC  X(001).                               I.091026
000420       03  W-CSC       PIC  9(007).
000430       03  W-NHSN      PIC  N(016).
000440*
000450       03  W-STCD      PIC  9(007).
000460*
000470       03  W-DMM       PIC  9(001).
000480*
000490     02  W-L            PIC  9(002).
000500     02  W-C            PIC  9(002).
000510     02  W-CHK          PIC  X(001).
000520     02  W-END          PIC  9(001).
000530     COPY LSTAT.
000540 SCREEN SECTION.
000550 SD  C-CRT
000560     END STATUS IS ESTAT.
000570 01  C-CLEAR.
000580     02  C-CL    LINE   1  CLEAR SCREEN.
000590 01  C-MID.
000600     02  LINE   1  COLUMN  28  PIC  N(012) VALUE
000610          NC"赤ちゃん本舗納品先　入力".
000620     02  LINE   3  COLUMN  19  PIC  X(043) VALUE
000630          "登録=1 修正=2 削除=3 問合せ=5 終了=9   ﾘﾀｰﾝ".
000640 01  C-MID1.
000650     02  LINE   7.
000660       03  COLUMN   7  PIC  N(002) VALUE NC"社店".
000670       03  COLUMN  11  PIC  X(004) VALUE "ｺｰﾄﾞ".
000680       03  COLUMN  25  PIC  N(003) VALUE NC"納品先".
000690     02  LINE   9.
000700       03  COLUMN   7  PIC  X(008) VALUE "ｾﾝﾀｰｺｰﾄﾞ".
000710       03  COLUMN  25  PIC  X(004) VALUE "ｾﾝﾀｰ".
000720       03  COLUMN  29  PIC  N(001) VALUE NC"名".
000730       03  COLUMN  66  PIC  X(004) VALUE "ｾﾝﾀｰ".                  I.091026
000740       03  COLUMN  70  PIC  N(001) VALUE NC"は".                  I.091026
000750       03  COLUMN  72  PIC  X(004) VALUE "ZERO".                  I.091026
000760     02  LINE  11.
000770       03  COLUMN   7  PIC  N(002) VALUE NC"配送".                I.091026
000780       03  COLUMN  11  PIC  X(005) VALUE "ﾊﾟﾀｰﾝ".                 I.091026
000790     02  LINE  12.                                                I.091026
000800       03  COLUMN  16  PIC  X(004) VALUE "ｾﾝﾀｰ".                  I.091026
000810       03  COLUMN  20  PIC  N(002) VALUE NC"のみ".                I.091026
000820     02  LINE  13.                                                I.091026
000830       03  COLUMN   7  PIC  N(002) VALUE NC"直送".
000840       03  COLUMN  11  PIC  X(004) VALUE "ｺｰﾄﾞ".
000850       03  COLUMN  25  PIC  N(003) VALUE NC"直送先".
000860     02  LINE  14.                                                I.091026
000870       03  COLUMN  16  PIC  X(004) VALUE "ｾﾝﾀｰ".                  I.091026
000880       03  COLUMN  20  PIC  N(002) VALUE NC"のみ".                I.091026
000890     02  LINE  23  COLUMN  43  PIC  X(028) VALUE
000900          "確認（OK=1,NO=9）--->   ﾘﾀｰﾝ".
000910     02  LINE   7.
000920       03  COLUMN   7  UNDER    LINE TO 22.
000930       03  COLUMN  25  UNDER    LINE TO 63.
000940     02  LINE   9  COLUMN   7  UNDER    LINE TO 22.
000950     02  LINE  11  COLUMN   7  UNDER    LINE TO 22.
000960     02  LINE  13  COLUMN   7  UNDER    LINE TO 22.               I.091026
000970 01  C-MID2.
000980     02  LINE   5.
000990       03  COLUMN   3  PIC  X(004) VALUE "ｺｰﾄﾞ".
001000       03  COLUMN   9  PIC  N(005) VALUE NC"納　品　先".
001010       03  COLUMN  41  PIC  X(001) VALUE "P".                     I.091026
001020       03  COLUMN  45  PIC  X(004) VALUE "ｺｰﾄﾞ".                  I.091026
001030       03  COLUMN  51  PIC  N(005) VALUE NC"直　送　先".          I.091026
001040*****  03  COLUMN  44  PIC  X(004) VALUE "ｺｰﾄﾞ".                  D.091026
001050*****  03  COLUMN  50  PIC  N(005) VALUE NC"直　送　先".          D.091026
001060     02  LINE  23  COLUMN  25  PIC  X(041) VALUE
001070          "ＮＥＸＴ:ﾘﾀｰﾝ , ｺｰﾄﾞ入力:F10 , 終了:F9   ".
001080     02  LINE   5  COLUMN   1  OVER     LINE TO 80
001090                               UNDER    LINE TO 80
001100                               VERTICAL LINE AT  8  42.           I.091026
001110     02  LINE   6  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001120     02  LINE   7  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001130     02  LINE   8  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001140     02  LINE   9  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001150     02  LINE  10  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001160     02  LINE  11  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001170     02  LINE  12  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001180     02  LINE  13  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001190     02  LINE  14  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001200     02  LINE  15  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001210     02  LINE  16  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001220     02  LINE  17  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001230     02  LINE  18  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001240     02  LINE  19  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001250     02  LINE  20  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001260     02  LINE  21  COLUMN   1  VERTICAL LINE AT  8  42.           I.091026
001270*****                          VERTICAL LINE AT  8  41.           D.091026
001280*****02  LINE   6  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001290*****02  LINE   7  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001300*****02  LINE   8  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001310*****02  LINE   9  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001320*****02  LINE  10  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001330*****02  LINE  11  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001340*****02  LINE  12  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001350*****02  LINE  13  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001360*****02  LINE  14  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001370*****02  LINE  15  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001380*****02  LINE  16  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001390*****02  LINE  17  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001400*****02  LINE  18  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001410*****02  LINE  19  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001420*****02  LINE  20  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001430*****02  LINE  21  COLUMN   1  VERTICAL LINE AT  8  41.           D.091026
001440     02  LINE  22  COLUMN   1  UNDER    LINE TO 80
001450                               VERTICAL LINE AT  8  42.           I.091026
001460*****                          VERTICAL LINE AT  8  41.           D.091026
001470 01  C-ACP.
001480     02  A-ACT   LINE   3  COLUMN  57  PIC  9(001)
001490          USING W-ACT   CHECK OVERFLOW NO IFC.
001500*
001510     02  A-STCD  LINE   6  COLUMN   1  PIC  9(007)
001520          USING W-STCD  CHECK OVERFLOW NO IFC.
001530*
001540     02  LINE   7.
001550       03  A-STC   COLUMN  16  PIC  9(007)
001560            USING W-STC   CHECK OVERFLOW NO IFC.
001570       03  A-NHSN  COLUMN  32  PIC  N(016)
001580            USING W-NHSN  CHECK OVERFLOW NO IFC.
001590     02  A-CTC   LINE   9  COLUMN  16  PIC  9(007)
001600          USING W-CTC   CHECK OVERFLOW NO IFC.
001610     02  A-HP    LINE  11  COLUMN  22  PIC  X(001)                I.091026
001620          USING W-HP    CHECK OVERFLOW NO IFC.                    I.091026
001630*****02  A-CSC   LINE  11  COLUMN  16  PIC  9(007)                D.091026
001640     02  A-CSC   LINE  13  COLUMN  16  PIC  9(007)                I.091026
001650          USING W-CSC   CHECK OVERFLOW NO IFC.
001660*
001670     02  A-DMM   LINE  23  COLUMN  65  PIC  9(001)
001680          USING W-DMM   CHECK OVERFLOW NO IFC.
001690 01  C-DSP.
001700     02  D-NHSN.
001710       03  LINE   9  COLUMN  32  PIC  N(016) FROM  AHNH-NHSN.
001720     02  D-CSN.
001730       03  LINE  13  COLUMN  32  PIC  N(024) FROM  TC-NAME.       I.091026
001740*****  03  LINE  11  COLUMN  32  PIC  N(024) FROM  TC-NAME.       D.091026
001750*
001760     02  D-MEI   LINE W-L.
001770       03  COLUMN   1  PIC  9(007) FROM  AHNH-STC.
001780       03  COLUMN   9  PIC  N(016) FROM  AHNH-NHSN.
001790       03  COLUMN  41  PIC  X(001) FROM  AHNH-HP.                 I.091026
001800       03  COLUMN  43  PIC  9(007) FROM  AHNH-CSC.                I.091026
001810       03  COLUMN  51  PIC  N(015) FROM  TC-NAME.                 I.091026
001820*****  03  COLUMN  42  PIC  9(007) FROM  AHNH-CSC.                D.091026
001830*****  03  COLUMN  50  PIC  N(024) FROM  TC-NAME.                 D.091026
001840 01  C-ERR.
001850     02  LINE  24.
001860       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001870            "***  DATA ﾅｼ  ***".
001880       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
001890            "***  ﾄｳﾛｸ ｽﾞﾐ  ***".
001900       03  E-ME3   COLUMN  15  PIC  X(020) VALUE
001910            "***  ｾﾝﾀｰ ﾐﾄｳﾛｸ  ***".
001920       03  E-ME4   COLUMN  15  PIC  X(018) VALUE
001930            "***  ﾁｮｸｿｳ ﾅｼ  ***".
001940       03  E-ME8   COLUMN  15  PIC  X(018) VALUE
001950            "***  DATA ｴﾗｰ  ***".
001960       03  E-ME9   COLUMN  15  PIC  N(005) VALUE
001970            NC"キャンセル".
001980       03  E-ME11  COLUMN  15  PIC  X(026) VALUE
001990            "***  WRITE ｴﾗｰ  ***".
002000       03  E-ME12  COLUMN  15  PIC  X(027) VALUE
002010            "***  REWRITE ｴﾗｰ   ***".
002020       03  E-ME13  COLUMN  15  PIC  X(027) VALUE
002030            "***  DELETE ｴﾗｰ  ***".
002040       03  E-KEY   COLUMN  45  PIC  X(007) FROM  AHNH-KEY.
002050       03  E-CSC   COLUMN  53  PIC  X(007) FROM  TC-KEY.
002060     COPY LSSEM.
002070 PROCEDURE DIVISION.
002080 M-020.
002090     DISPLAY C-CLEAR.
002100     DISPLAY C-MID C-MID1.
002110     MOVE ZERO TO W-CRT.
002120*
002130     OPEN INPUT TC-M.
002140     OPEN I-O AHNHF.
002150 M-040.
002160     ACCEPT A-ACT.
002170     IF ESTAT = PF9
002180         GO TO M-900.
002190     IF ESTAT NOT = HTB AND SKP
002200         GO TO M-040.
002210     IF W-ACT = 9
002220         GO TO M-900.
002230     IF W-ACT NOT = 1 AND 2 AND 3 AND 5
002240         GO TO M-040.
002250     IF W-ACT = 5
002260         GO TO M-200.
002270 M-060.
002280     ACCEPT A-STC.
002290     DISPLAY E-CL.
002300     IF ESTAT = BTB
002310         GO TO M-040.
002320     IF ESTAT NOT = HTB AND SKP
002330         GO TO M-060.
002340     IF W-STC < 3700000 OR > 3799999
002350         GO TO M-060.
002360*
002370     MOVE W-STC TO AHNH-KEY.
002380     READ AHNHF WITH UNLOCK INVALID KEY
002390         GO TO M-080.
002400     MOVE AHNH-NHSN TO W-NHSN.
002410     MOVE AHNH-CTC TO W-CTC.
002420     MOVE AHNH-HP TO W-HP.                                        I.091026
002430     MOVE AHNH-CSC TO W-CSC.
002440     IF W-CTC = ZERO
002450         MOVE SPACE TO AHNH-NHSN
002460       ELSE
002470         MOVE W-CTC TO AHNH-KEY
002480         READ AHNHF WITH UNLOCK INVALID KEY
002490             MOVE SPACE TO AHNH-NHSN
002500             MOVE NC"センターなし" TO AHNH-NHSN.
002510     MOVE W-CSC TO TC-KEY.
002520     READ TC-M WITH UNLOCK INVALID KEY
002530         MOVE SPACE TO TC-NAME
002540         MOVE NC"直送なし" TO TC-NAME.
002550*****DISPLAY A-NHSN A-CTC D-NHSN A-CSC D-CSN.                     D.091026
002560     DISPLAY A-NHSN A-CTC D-NHSN A-HP A-CSC D-CSN.                I.091026
002570     IF W-ACT = 1
002580         DISPLAY E-ME2 E-ME99
002590         GO TO M-060.
002600     IF W-ACT = 3
002610         GO TO M-120.
002620     GO TO M-090.
002630 M-080.
002640     IF W-ACT NOT = 1
002650         DISPLAY E-ME1 E-ME99
002660         GO TO M-060.
002670 M-090.
002680     ACCEPT A-NHSN.
002690     DISPLAY E-CL.
002700     IF ESTAT = BTB
002710         GO TO M-060.
002720     IF ESTAT NOT = HTB AND SKP
002730         GO TO M-090.
002740 M-100.
002750     ACCEPT A-CTC.
002760     DISPLAY E-CL.
002770     IF ESTAT = BTB
002780         GO TO M-090.
002790     IF ESTAT NOT = HTB AND SKP
002800         GO TO M-100.
002810     IF W-CTC = ZERO
002820         MOVE SPACE TO AHNH-NHSN
002830         DISPLAY D-NHSN
002840         GO TO M-105.                                             I.091026
002850*****    GO TO M-110.                                             D.091026
002860     MOVE W-CTC TO AHNH-KEY.
002870     READ AHNHF WITH UNLOCK INVALID KEY
002880         DISPLAY E-ME3 E-KEY E-ME98
002890         GO TO M-100.
002900     MOVE AHNH-CSC TO W-CSC.
002910     MOVE W-CSC TO TC-KEY.
002920     READ TC-M WITH UNLOCK INVALID KEY
002930         DISPLAY E-ME4 E-CSC E-ME99
002940         GO TO M-100.
002950     IF W-CSC = ZERO                                              I.091026
002960         MOVE SPACE TO W-HP.                                      I.091026
002970     DISPLAY D-NHSN A-CSC D-CSN A-HP.                             I.091026
002980*****DISPLAY D-NHSN A-CSC D-CSN.                                  D.091026
002990     IF W-STC = W-CTC                                             I.091026
003000         GO TO M-100.                                             I.091026
003010     GO TO M-120.
003020 M-105.                                                           I.091026
003030     ACCEPT A-HP.                                                 I.091026
003040     DISPLAY E-CL.                                                I.091026
003050     IF ESTAT = BTB                                               I.091026
003060         GO TO M-100.                                             I.091026
003070     IF ESTAT NOT = HTB AND SKP                                   I.091026
003080         GO TO M-105.                                             I.091026
003090 M-110.
003100     ACCEPT A-CSC.
003110     DISPLAY E-CL.
003120     IF ESTAT = BTB
003130         GO TO M-105.                                             I.091026
003140*****    GO TO M-100.                                             D.091026
003150     IF ESTAT NOT = HTB AND SKP
003160         GO TO M-110.
003170     IF W-CSC < 0077000 OR > 0077999
003180         GO TO M-110.
003190     MOVE W-CSC TO TC-KEY.
003200     READ TC-M WITH UNLOCK INVALID KEY
003210         DISPLAY E-ME4 E-ME98
003220         GO TO M-110.
003230     DISPLAY D-CSN.
003240 M-120.
003250     ACCEPT A-DMM.
003260     DISPLAY E-CL.
003270     IF ESTAT = BTB
003280         IF W-ACT = 3
003290             GO TO M-060
003300           ELSE
003310             IF W-CTC = ZERO
003320                 GO TO M-110
003330               ELSE
003340                 GO TO M-100.
003350     IF ESTAT NOT = HTB AND SKP
003360         GO TO M-120.
003370     IF W-DMM = 9
003380         DISPLAY E-ME9 E-ME99
003390         GO TO M-060.
003400     IF W-DMM NOT = 1
003410         GO TO M-120.
003420*
003430     IF W-ACT NOT = 1
003440         GO TO M-140.
003450     INITIALIZE AHNH-R.
003460     MOVE W-STC TO AHNH-KEY.
003470     MOVE W-NHSN TO AHNH-NHSN.
003480     MOVE W-CTC TO AHNH-CTC.
003490     MOVE W-CSC TO AHNH-CSC.
003500     MOVE W-HP TO AHNH-HP.                                        I.091026
003510     WRITE AHNH-R INVALID KEY
003520         DISPLAY E-ME11 E-ME99
003530         GO TO M-900.
003540     GO TO M-180.
003550 M-140.
003560     MOVE W-STC TO AHNH-KEY.
003570     READ AHNHF INVALID KEY
003580         DISPLAY E-ME8 E-KEY E-ME99
003590         GO TO M-060.
003600     IF W-ACT NOT = 2
003610         GO TO M-160.
003620     MOVE W-NHSN TO AHNH-NHSN.
003630     MOVE W-CTC TO AHNH-CTC.
003640     MOVE W-CSC TO AHNH-CSC.
003650     MOVE W-HP TO AHNH-HP.                                        I.091026
003660     REWRITE AHNH-R INVALID KEY
003670         DISPLAY E-ME12 E-ME99
003680         GO TO M-900.
003690     GO TO M-180.
003700 M-160.
003710     DELETE AHNHF INVALID KEY
003720         DISPLAY E-ME13 E-ME99
003730         GO TO M-900.
003740 M-180.
003750     DISPLAY C-CLEAR.
003760     DISPLAY C-MID C-MID1.
003770     DISPLAY A-ACT.
003780     GO TO M-060.
003790 M-200.
003800     DISPLAY C-CLEAR.
003810     DISPLAY C-MID C-MID2.
003820     DISPLAY A-ACT.
003830     CLOSE AHNHF.
003840     OPEN INPUT AHNHF.
003850     MOVE 0 TO W-END.
003860     MOVE 5 TO W-L.
003870*
003880     READ AHNHF NEXT RECORD WITH UNLOCK AT END
003890         MOVE 1 TO W-END
003900         DISPLAY E-ME1 E-ME98
003910         GO TO M-240.
003920 M-220.
003930     MOVE AHNH-CSC TO TC-KEY.
003940     READ TC-M WITH UNLOCK INVALID KEY
003950         MOVE SPACE TO TC-NAME
003960         MOVE NC"直送なし" TO TC-NAME.
003970     ADD 1 TO W-L.
003980     IF W-L < 23
003990         DISPLAY D-MEI
004000         GO TO M-280.
004010 M-240.
004020     ACCEPT A-DMM.
004030     DISPLAY E-CL.
004040     IF ESTAT = PF9
004050         GO TO M-900.
004060     IF ESTAT NOT = HTB AND ADV
004070         GO TO M-240.
004080*
004090     DISPLAY C-CLEAR.
004100     DISPLAY C-MID C-MID2.
004110     DISPLAY A-ACT.
004120     MOVE 5 TO W-L.
004130     IF ESTAT = ADV
004140         GO TO M-250.
004150     IF W-END = 1
004160         GO TO M-260.
004170     GO TO M-220.
004180 M-250.
004190     ACCEPT A-STCD.
004200     DISPLAY E-CL.
004210     IF ESTAT = PF9
004220         GO TO M-900.
004230     MOVE W-STCD TO AHNH-KEY.
004240     START AHNHF KEY NOT < AHNH-KEY INVALID KEY
004250         DISPLAY E-ME1 E-ME98
004260         GO TO M-250.
004270     READ AHNHF NEXT RECORD WITH UNLOCK AT END
004280         DISPLAY E-ME1 E-ME98
004290         GO TO M-250.
004300     GO TO M-220.
004310 M-260.
004320     DISPLAY C-CLEAR.
004330     DISPLAY C-MID C-MID1.
004340     MOVE ZERO TO W-CRT.
004350*
004360     CLOSE AHNHF.
004370     OPEN I-O AHNHF.
004380     GO TO M-040.
004390 M-280.
004400     READ AHNHF NEXT RECORD WITH UNLOCK AT END
004410         MOVE 1 TO W-END
004420         GO TO M-240.
004430     GO TO M-220.
004440 M-900.
004450     CLOSE TC-M.
004460     CLOSE AHNHF.
004470 M-980.
004480     DISPLAY C-CLEAR.
004490     STOP RUN.
