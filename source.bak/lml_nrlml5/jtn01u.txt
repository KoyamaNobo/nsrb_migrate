000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JTN01U.
000030*****************************************************************
000040*    PROGRAM         :  受注マスタ変換 JMSTD → JMSTW           *
000050*    PRINTER TYPE    :  JIPS                                    *
000060*    SCREEN          :  ******                                  *
000070*    COMPILE TYPE    :  COBOL                                   *
000080*****************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT JMSTD ASSIGN TO JMST1-MSD JMST2-MSD JMST3-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE DYNAMIC
000180         RECORD KEY JMSTD-KEY1
000190         ALTERNATE RECORD KEY JMSTD-KEY2
000200         ALTERNATE RECORD KEY JMSTD-KEY3
000210         FILE STATUS IS ERR-STAT.
000220     SELECT JMSTW ASSIGN TO JMSTW-RDB
000230         FILE STATUS IS ERR-STAT.
000240     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE RANDOM
000270         RECORD KEY HI-KEY
000280         ALTERNATE RECORD KEY HI-KEY2
000290         FILE STATUS IS ERR-STAT.
000300     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000310         ORGANIZATION INDEXED
000320         ACCESS MODE RANDOM
000330         RECORD KEY T-KEY
000340         ALTERNATE RECORD KEY T-KEY2
000350         FILE STATUS IS ERR-STAT.
000360     SELECT TC-M ASSIGN TO TC-MSD
000370         ORGANIZATION INDEXED
000380         ACCESS MODE RANDOM
000390         RECORD KEY TC-KEY
000400         FILE STATUS IS ERR-STAT.
000410 I-O-CONTROL.
000420     APPLY SHARED-MODE ON HI-M
000430     APPLY SHARED-MODE ON T-M
000440     APPLY SHARED-MODE ON TC-M
000450     APPLY SHARED-MODE ON JMSTD.
000460 DATA DIVISION.
000470 FILE SECTION.
000480     COPY LJMSTD.
000490     COPY LIHIM.
000500     COPY LITM.
000510     COPY LITCM.
000520 FD  JMSTW                                                        ｼｭﾁｭｳ
000530     BLOCK  3 RECORDS                                             ﾏｽﾀｰ
000540     LABEL RECORD STANDARD
000550     VALUE OF IDENTIFICATION "JMSTW-RDB".
000560 01  JMSTW-R.
000570     02  JMSTW-KEY1.
000580       03  JMSTW-07     PIC 9(6).                                 ｼﾞｭﾁｭｳNO
000590       03  JMSTW-08     PIC 9(1).                                 ｷﾞｮｳ NO
000600     02  JMSTW-01       PIC 9(1).                                  ｱｽﾞｶﾘ
000610     02  JMSTW-02       PIC 9(8).                                  ｼﾞｭﾁｭｳﾋ
000620     02  JMSTW-04       PIC 9(4).                                  ﾄｸｲｺｰﾄﾞ
000630     02  JMSTW-10       PIC 9(3).                                  ﾁｮｸｿｳ N
000640     02  JMSTW-05       PIC 9(6).                                  ﾋﾝｺｰﾄﾞ
000650     02  JMSTW-09       PIC 9(1).                                  ｻｲｽﾞｸﾌﾞ
000660     02  JMSTW-11.                                                 ｼﾞｭﾁｭｳｽ
000670       03  JMSTW-111    OCCURS  10.                                ｻｲｽﾞﾍﾞﾂ
000680         04  JMSTW-1111 PIC S9(6).
000690       03  JMSTW-112    PIC S9(6).
000700     02  JMSTW-16       PIC S9(03).                                ｾｯﾄｽｳ
000710     02  JMSTW-06       PIC 9(8).                                  ﾉｳｷ
000720     02  JMSTW-17       PIC 9(05).                                 I.94122
000730     02  JMSTW-22       PIC X(10).                                 I.98060
000740     02  JMSTW-13       PIC N(32).                                 ﾃｷﾖｳ
000750     02  JMSTW-31       PIC N(26).
000760     02  JMSTW-32       PIC N(26).
000770     02  JMSTW-33       PIC N(24).
000780     02  F              PIC X(03).
000790 WORKING-STORAGE SECTION.
000800 01  W-DATA.
000810     02  W-DMM          PIC  9(001).
000820     02  W-FILE         PIC  X(013).                              I.940608
000830 01  ERR-STAT           PIC  X(002).
000840     COPY LSTAT.
000850 SCREEN SECTION.
000860 SD  C-CRT
000870     END STATUS IS ESTAT.
000880 01  C-CLEAR.
000890     02  LINE   1  CLEAR SCREEN.
000900 01  C-MID.
000910     02  LINE   3  COLUMN  10  PIC  N(018) VALUE
000920          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000930     02  LINE   4  COLUMN  10  PIC  N(018) VALUE
000940          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000950     02  LINE   5  COLUMN  10  PIC  N(018) VALUE
000960          NC"＊＊＊　　　　　　　　　　　　＊＊＊".
000970     02  LINE   6  COLUMN  10  PIC  N(018) VALUE
000980          NC"＊＊＊　　受注マスタ　変換　　＊＊＊".
000990     02  LINE   7  COLUMN  10  PIC  N(018) VALUE
001000          NC"＊＊＊　　　　　　　　　　　　＊＊＊".
001010     02  LINE   8  COLUMN  10  PIC  N(018) VALUE
001020          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001030     02  LINE   9  COLUMN  10  PIC  N(018) VALUE
001040          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001050     02  LINE  20  COLUMN  21  PIC  X(022) VALUE
001060          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001070 01  C-ACP.
001080     02  A-DMM   LINE  20  COLUMN  38  PIC  9(001)
001090          USING W-DMM   CHECK OVERFLOW NO IFC.
001100 01  C-ERR.
001110     02  LINE  24.
001120       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001130            "***  HUH-M ﾅｼ  ***".
001140     COPY LSSEM.                                                  I.940608
001150 PROCEDURE DIVISION.
001160 M-05.
001170     DISPLAY C-CLEAR.
001180     DISPLAY C-MID.
001190 M-10.
001200     ACCEPT A-DMM.
001210     IF ESTAT NOT = HTB AND SKP
001220         GO TO M-10.
001230     IF W-DMM = 9
001240         DISPLAY C-CLEAR
001250         STOP RUN.
001260     IF W-DMM NOT = 1
001270         GO TO M-10.
001280*
001290     OPEN INPUT JMSTD.
001300     OPEN INPUT HI-M T-M TC-M.
001310     OPEN OUTPUT JMSTW.
001320 M-15.
001330     READ JMSTD NEXT RECORD AT END
001340         GO TO M-90.
001350     IF JMSTD-07 > 200000
001360         GO TO M-15.
001370     MOVE JMSTD-03 TO HI-KEY.
001380     READ HI-M WITH UNLOCK INVALID KEY
001390         MOVE SPACE TO HI-NAME.
001400     MOVE JMSTD-04 TO T-KEY.
001410     READ T-M WITH UNLOCK INVALID KEY
001420         MOVE SPACE TO T-NAME.
001430     MOVE JMSTD-04 TO TC-TCD.
001440     MOVE JMSTD-10 TO TC-CCD.
001450     READ TC-M WITH UNLOCK INVALID KEY
001460         MOVE SPACE TO TC-NAME.
001470     INITIALIZE JMSTW-R.
001480     MOVE JMSTD-07       TO JMSTW-07.
001490     MOVE JMSTD-08       TO JMSTW-08.
001500     MOVE JMSTD-01       TO JMSTW-01.
001510     MOVE JMSTD-02       TO JMSTW-02.
001520     MOVE JMSTD-04       TO JMSTW-04.
001530     MOVE JMSTD-10       TO JMSTW-10.
001540     MOVE JMSTD-05       TO JMSTW-05.
001550     MOVE JMSTD-09       TO JMSTW-09.
001560     MOVE JMSTD-1111(01) TO JMSTW-1111(01).
001570     MOVE JMSTD-1111(02) TO JMSTW-1111(02).
001580     MOVE JMSTD-1111(03) TO JMSTW-1111(03).
001590     MOVE JMSTD-1111(04) TO JMSTW-1111(04).
001600     MOVE JMSTD-1111(05) TO JMSTW-1111(05).
001610     MOVE JMSTD-1111(06) TO JMSTW-1111(06).
001620     MOVE JMSTD-1111(07) TO JMSTW-1111(07).
001630     MOVE JMSTD-1111(08) TO JMSTW-1111(08).
001640     MOVE JMSTD-1111(09) TO JMSTW-1111(09).
001650     MOVE JMSTD-1111(10) TO JMSTW-1111(10).
001660     COMPUTE JMSTW-112 = JMSTD-1111(01) + JMSTD-1111(02)
001670                        + JMSTD-1111(03) + JMSTD-1111(04)
001680                        + JMSTD-1111(05) + JMSTD-1111(06)
001690                        + JMSTD-1111(07) + JMSTD-1111(08)
001700                        + JMSTD-1111(09) + JMSTD-1111(10).
001710     MOVE JMSTD-16       TO JMSTW-16.
001720     MOVE JMSTD-06       TO JMSTW-06.
001730     MOVE JMSTD-17       TO JMSTW-17.
001740     MOVE JMSTD-22       TO JMSTW-22.
001750     MOVE JMSTD-13       TO JMSTW-13.
001760     MOVE T-NAME         TO JMSTW-31.
001770     MOVE TC-NAME        TO JMSTW-32.
001780     MOVE HI-NAME        TO JMSTW-33.
001790     WRITE JMSTW-R.
001800     GO TO M-15.
001810 M-90.
001820     CLOSE JMSTD.
001830     CLOSE HI-M T-M TC-M.
001840     CLOSE JMSTW.
001850 M-95.
001860     DISPLAY C-CLEAR.
001870     STOP RUN.
