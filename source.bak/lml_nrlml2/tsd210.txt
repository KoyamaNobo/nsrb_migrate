000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSD210.
000030****************************************
000040*****     受手　異動入力リスト     *****
000050****************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     COPY LIBCSE.
000130*****SELECT T-M ASSIGN TO T-MSD                                   D.000224
000140     SELECT T-M ASSIGN TO T1-MSD T2-MSD                           I.000224
000150         ORGANIZATION INDEXED
000160         ACCESS MODE RANDOM
000170         RECORD KEY T-KEY                                         I.000224
000180         ALTERNATE RECORD KEY T-KEY2.                             I.000224
000190*****    RECORD KEY T-KEY.                                        D.000224
000200     SELECT BANK-M ASSIGN TO BANK-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE RANDOM
000230         RECORD KEY B-KEY.
000240     SELECT UKET-M ASSIGN TO UKET-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE RANDOM
000270         RECORD KEY UT-KEY.
000280     SELECT TIDM ASSIGN TO TID-MSD
000290         ORGANIZATION INDEXED
000300         ACCESS MODE RANDOM
000310         RECORD KEY TID-KEY
000320         FILE STATUS ERR-STAT.
000330     SELECT IDOU-F ASSIGN TO IDOU-MSD.
000340     SELECT SP-F ASSIGN TO P-PRN999.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON T-M
000370     APPLY SHARED-MODE ON BANK-M
000380     APPLY SHARED-MODE ON UKET-M
000390     APPLY SHARED-MODE ON M-DATE
000400     APPLY SHIFT-CODE ON SP-F.
000410 DATA DIVISION.
000420 FILE SECTION.
000430     COPY LIBFDD.
000440     COPY LITM.
000450     COPY LIBANK.
000460     COPY LIUKET.
000470     COPY LSPF.
000480 FD  IDOU-F
000490     BLOCK  4 RECORDS
000500     LABEL RECORD IS STANDARD
000510     VALUE OF IDENTIFICATION WK0064ID.
000520 01  IDOU-R.
000530     02  IW-KEY         PIC  X(004).
000540     02  IW-TSC         PIC  9(002).
000550     02  IW-IDO         PIC  9(006).
000560     02  IW-FDD         PIC  9(006).
000570     02  IW-HKD         PIC  9(006).
000580     02  IW-YBC         PIC  9(004).
000590     02  IW-SNI         PIC  9(004).
000600     02  F              PIC  X(009).
000610     02  IW-PC          PIC  9(001).
000620     02  F              PIC  X(022).
000630 FD  TIDM
000640     BLOCK  6 RECORDS
000650     LABEL RECORD IS STANDARD
000660     VALUE OF IDENTIFICATION "TIDM".
000670 01  TID-R.
000680     02  TID-KEY        PIC  X(004).
000690     02  TID-TSC        PIC  9(002).
000700     02  TID-IDO        PIC  9(006).
000710     02  TID-FDD        PIC  9(006).
000720     02  TID-HKD        PIC  9(006).
000730     02  TID-YBC        PIC  9(004).
000740     02  TID-SNI        PIC  9(004).
000750     02  F              PIC  X(009).
000760     02  TID-PC         PIC  9(001).
000770 WORKING-STORAGE SECTION.
000780 77  WK0064ID           PIC  X(009) VALUE SPACE.
000790 01  STN-NO.
000800     02  STN-NO1        PIC  X(003).
000810     02  STN-NO2        PIC  X(003).
000820 01  W-FID.
000830     02  W-FID1         PIC  X(006) VALUE "WK0064".
000840     02  W-FID2         PIC  X(003).
000850 01  W-15K              PIC  X(005) VALUE ""3FE04F40A0"".
000860 01  HEAD1.
000870     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000880*****02  F              PIC  X(024) VALUE SPACE.                  D.020423
000890     02  F              PIC  X(027) VALUE SPACE.                  I.020423
000900     02  F              PIC  N(025) VALUE
000910          NC"＊＊＊　　受取手形　異動データ入力　プルーフリスト".
000920     02  F              PIC  N(005) VALUE NC"　　＊＊＊".
000930     02  F              PIC  X(016) VALUE SPACE.
000940     02  F              PIC  X(005) VALUE "DATE ".
000950     02  H-DATE         PIC 99B99B99.
000960     02  F              PIC  X(007) VALUE "     P.".
000970     02  H-PAGE         PIC Z9.
000980 01  HEAD2.
000990     02  F              PIC  X(040) VALUE
001000          " 異動日  区分 ｺｰﾄﾞ 処理銀行名     振出日".
001010     02  F              PIC  X(035) VALUE
001020          "　　引受日　手形NO　 取  引  先　名".
001030     02  F              PIC  X(050) VALUE                         I.020423
001040          "                            満期日          金　額".   I.020423
001050*****02  F              PIC  X(047) VALUE                         D.020423
001060*****     "                         満期日          金　額".      D.020423
001070 01  W-P.
001080     02  P-K15          PIC  X(005).
001090     02  P-IDO          PIC 99/99/99.
001100     02  F              PIC  X(002).
001110     02  P-TSC          PIC  9(002).
001120     02  F              PIC  X(002).
001130     02  P-YBC          PIC  9(004).
001140     02  F              PIC  X(001).
001150     02  P-BNA          PIC  N(008).
001160     02  F              PIC  X(002).
001170     02  P-FDD          PIC 99/99/99.
001180     02  F              PIC  X(002).
001190     02  P-HKD          PIC 99/99/99.
001200     02  F              PIC  X(002).
001210     02  P-KEY          PIC  9(004).
001220     02  F              PIC  X(002).
001230     02  P-URC          PIC  X(001).
001240     02  F              PIC  X(001).
001250*****02  P-TNA          PIC  N(024).                              D.020423
001260     02  P-TNA          PIC  N(026).                              I.020423
001270     02  F              PIC  X(002).
001280     02  P-UTI.
001290       03  P-MND        PIC 99/99/99.
001300       03  P-KIN        PIC ---,---,---,--9.
001310     02  P-K20          PIC  X(005).
001320 01  W-DATA.
001330     02  W-CHK          PIC  9(001).
001340     02  W-DMM          PIC  9(001).
001350     02  W-PAGE         PIC  9(002).
001360     02  W-IDO          PIC  9(006).
001370     02  W-TSC          PIC  9(002).
001380     02  W-YBC          PIC  9(004).
001390     02  W-C.
001400       03  W-C1         PIC  9(001).
001410       03  W-C2         PIC  9(001).
001420       03  W-C3         PIC  9(001).
001430 01  ERR-STAT           PIC  X(002).
001440     COPY LSTAT.
001450 SCREEN SECTION.
001460 SD  C-CRT
001470     END STATUS IS ESTAT.
001480 01  C-CLEAR.
001490     02  LINE   1  CLEAR SCREEN.
001500 01  C-MID.
001510     02  LINE   3  COLUMN  15  PIC  N(025) VALUE
001520          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001530     02  LINE   4  COLUMN  15  PIC  N(025) VALUE
001540          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001550     02  LINE   5  COLUMN  15  PIC  N(025) VALUE
001560          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001570     02  LINE   6  COLUMN  15  PIC  N(025) VALUE
001580          NC"＊＊＊　　受取手形異動データ　入力リスト　　＊＊＊".
001590     02  LINE   7  COLUMN  15  PIC  N(025) VALUE
001600          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001610     02  LINE   8  COLUMN  15  PIC  N(025) VALUE
001620          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001630     02  LINE   9  COLUMN  15  PIC  N(025) VALUE
001640          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001650     02  LINE  15  COLUMN  16  PIC  X(048) VALUE
001660          "全件作表=1  追加･修正分作表=5  作表しない=9 ... ".
001670     02  LINE  20  COLUMN  30  PIC  X(022) VALUE
001680          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001690 01  C-ACP.
001700     02  A-CHK   LINE  15  COLUMN  63  PIC  9(001)
001710          USING W-CHK   CHECK OVERFLOW NO IFC.
001720     02  A-DMM   LINE  20  COLUMN  47  PIC  9(001)
001730          USING W-DMM   CHECK OVERFLOW NO IFC.
001740 01  C-ERR.
001750     02  LINE  24.
001760       03  E-ME1   COLUMN  10  PIC  X(015) VALUE
001770            "**  TIDM ﾅｼ  **".
001780       03  E-ME2   COLUMN  10  PIC  X(024) VALUE
001790            "**  TIDM REWRITE ｴﾗｰ  **".
001800       03  E-ME78  COLUMN   5  PIC  N(002) VALUE NC"連絡".
001810       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001820       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001830       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001840       03  E-CL.
001850         04  COLUMN   1  PIC  X(040) VALUE
001860              "                                        ".
001870         04  COLUMN  41  PIC  X(040) VALUE
001880              "                                        ".
001890     COPY LIBSCR.
001900 PROCEDURE DIVISION.
001910 M-05.
001920     MOVE ZERO TO W-DATA.
001930     DISPLAY C-CLEAR.
001940     DISPLAY C-MID.
001950 M-10.
001960     ACCEPT A-CHK.
001970     IF ESTAT = PF9
001980         GO TO M-95.
001990     IF ESTAT NOT = HTB AND SKP
002000         GO TO M-10.
002010     IF W-CHK NOT = 1 AND 5 AND 9
002020         GO TO M-10.
002030 M-15.
002040     ACCEPT A-DMM.
002050     IF ESTAT = BTB
002060         GO TO M-10.
002070     IF ESTAT NOT = HTB AND SKP
002080         GO TO M-15.
002090     IF W-DMM = 9
002100         GO TO M-10.
002110     IF W-DMM NOT = 1
002120         GO TO M-15.
002130     IF W-CHK = 9
002140         GO TO M-95.
002150*
002160     CALL "CBLSTNNO" USING STN-NO.
002170     MOVE STN-NO2 TO W-FID2.
002180     MOVE W-FID TO WK0064ID.
002190     OPEN INPUT IDOU-F.
002200 M-20.
002210     READ IDOU-F AT END
002220         CLOSE IDOU-F
002230         GO TO M-95.
002240     IF W-CHK = 5
002250         IF IW-PC NOT = 0
002260             GO TO M-20.
002270*
002280     OPEN INPUT T-M.
002290     OPEN INPUT BANK-M.
002300     OPEN INPUT UKET-M.
002310     OPEN I-O TIDM.
002320     OPEN OUTPUT SP-F.
002330     COPY LIBCPR.
002340     MOVE DATE-04R TO H-DATE.
002350     PERFORM S-10 THRU S-15.
002360 M-25.
002370     MOVE IW-IDO TO W-IDO.
002380     MOVE ZERO TO W-C.
002390 M-30.
002400     MOVE IW-TSC TO W-TSC.
002410     MOVE ZERO TO W-C2 W-C3.
002420 M-35.
002430     MOVE IW-YBC TO W-YBC.
002440     MOVE ZERO TO W-C3.
002450     IF W-YBC = ZERO
002460         GO TO M-40.
002470     MOVE W-YBC TO B-KEY.
002480     READ BANK-M WITH UNLOCK INVALID KEY
002490         MOVE NC"ＢＡＮＫＭ　無し" TO B-BNA.
002500 M-40.
002510     MOVE IW-KEY TO UT-KEY.
002520     READ UKET-M WITH UNLOCK INVALID KEY
002530         MOVE ZERO TO UKET-R.
002540     MOVE UT-TCD TO T-KEY.
002550     READ T-M WITH UNLOCK INVALID KEY
002560         MOVE SPACE TO T-NAME
002570         MOVE NC"　＊＊　　得意先　無し　　＊＊" TO T-NAME.
002580*
002590     MOVE SPACE TO W-P.
002600     MOVE W-15K TO P-K15.
002610     MOVE SPACE TO P-BNA P-TNA.
002620     MOVE W-20K TO P-K20.
002630     IF W-C1 = ZERO
002640         MOVE 1 TO W-C1
002650         MOVE W-IDO TO P-IDO.
002660     IF W-C2 = ZERO
002670         MOVE 1 TO W-C2
002680         MOVE W-TSC TO P-TSC.
002690     IF W-C3 = ZERO
002700         MOVE 1 TO W-C3
002710         IF W-YBC NOT = ZERO
002720             MOVE W-YBC TO P-YBC
002730             MOVE B-BNA TO P-BNA.
002740     MOVE IW-KEY TO P-KEY.
002750     IF IW-FDD NOT = ZERO
002760         MOVE IW-FDD TO P-FDD.
002770     IF IW-HKD NOT = ZERO
002780         MOVE IW-HKD TO P-HKD.
002790     IF UT-KIN NOT = ZERO
002800         IF UT-FDM NOT = SPACE
002810             MOVE "*" TO P-URC.
002820     MOVE T-NAME TO P-TNA.
002830     IF UT-KIN NOT = ZERO
002840         MOVE UT-MKD TO P-MND
002850         MOVE UT-KIN TO P-KIN
002860       ELSE
002870         MOVE " **  UKETM ﾅｼ  **      " TO P-UTI.
002880     IF LINAGE-COUNTER < 61
002890         GO TO M-45.
002900     PERFORM S-05 THRU S-15.
002910     MOVE W-IDO TO P-IDO.
002920     MOVE W-TSC TO P-TSC.
002930     IF W-YBC NOT = ZERO
002940         MOVE W-YBC TO P-YBC
002950         MOVE B-BNA TO P-BNA.
002960 M-45.
002970     MOVE SPACE TO SP-R.
002980     MOVE W-P TO SP-R.
002990     WRITE SP-R.
003000     MOVE SPACE TO SP-R.
003010*
003020     IF IW-PC = 1
003030         GO TO M-50.
003040     MOVE IW-KEY TO TID-KEY.
003050     READ TIDM INVALID KEY
003060         DISPLAY E-ME1 E-ME99
003070         GO TO M-95.
003080     MOVE 1 TO TID-PC.
003090     REWRITE TID-R INVALID KEY
003100         DISPLAY E-STAT E-ME2 E-ME99
003110         GO TO M-95.
003120 M-50.
003130     READ IDOU-F AT END
003140         GO TO M-90.
003150     IF W-CHK = 5
003160         IF IW-PC NOT = 0
003170             GO TO M-50.
003180     IF IW-IDO NOT = W-IDO
003190         GO TO M-25.
003200     IF IW-TSC NOT = W-TSC
003210         GO TO M-30.
003220     IF IW-YBC NOT = W-YBC
003230         GO TO M-35.
003240     GO TO M-40.
003250 M-90.
003260     CLOSE SP-F.
003270     CLOSE T-M.
003280     CLOSE BANK-M.
003290     CLOSE UKET-M.
003300     CLOSE TIDM.
003310     CLOSE IDOU-F.
003320 M-95.
003330     DISPLAY C-CLEAR.
003340     STOP RUN.
003350 S-05.
003360     MOVE SPACE TO SP-R.
003370     WRITE SP-R AFTER PAGE.
003380 S-10.
003390     ADD 1 TO W-PAGE.
003400     MOVE W-PAGE TO H-PAGE.
003410     MOVE SPACE TO SP-R.
003420     MOVE HEAD1 TO SP-R.
003430     WRITE SP-R.
003440     MOVE SPACE TO SP-R.
003450     MOVE HEAD2 TO SP-R.
003460     WRITE SP-R AFTER 2.
003470     MOVE SPACE TO SP-R.
003480     WRITE SP-R.
003490 S-15.
003500     EXIT.
