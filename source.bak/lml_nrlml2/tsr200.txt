000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSR200.
000030********************************************************
000040*****     領収書（控）・領収書ファイル　クリア     *****
000050********************************************************
000060 AUTHOR. S-NAKAO.
000070 DATE-WRITTEN. '78-03-29.
000080 ENVIRONMENT DIVISION.
000090 CONFIGURATION SECTION.
000100 SOURCE-COMPUTER. SYSTEM3100.
000110 OBJECT-COMPUTER. SYSTEM3100.
000120 INPUT-OUTPUT SECTION.
000130 FILE-CONTROL.
000140*****SELECT T-M ASSIGN TO T-MSD                                   D.000225
000150     SELECT T-M ASSIGN TO T1-MSD T2-MSD                           I.000225
000160         ORGANIZATION INDEXED
000170         ACCESS MODE RANDOM
000180         RECORD KEY T-KEY                                         I.000225
000190         ALTERNATE RECORD KEY T-KEY2.                             I.000225
000200*****    RECORD KEY T-KEY.                                        D.000225
000210     SELECT RS-F ASSIGN TO RS-MSD.
000220     SELECT SP-F ASSIGN TO P-PRN999-FTR200.
000230 I-O-CONTROL.
000240     APPLY SHARED-MODE ON T-M
000250     APPLY SHIFT-CODE  ON SP-F.
000260 DATA DIVISION.
000270 FILE SECTION.
000280     COPY LITM.
000290     COPY LSPF.
000300 FD  RS-F
000310     BLOCK  4 RECORDS
000320     LABEL RECORD IS STANDARD
000330     VALUE OF IDENTIFICATION "RSRF".
000340 01  RS-R.
000350     02  RS-RNO       PIC  9(006).
000360     02  RS-HNGP.
000370       03  RS-HNEN    PIC  9(002).
000380       03  RS-HGET    PIC  9(002).
000390       03  RS-HPEY    PIC  9(002).
000400     02  RS-KEY.
000410       03  RS-DATE.
000420         04  RS-NEN   PIC  9(002).
000430         04  RS-GET   PIC  9(002).
000440         04  RS-PEY   PIC  9(002).
000450       03  RS-TCD     PIC  9(004).
000460     02  RS-KIN       PIC S9(009).
000470     02  RS-INS       PIC  9(005).
000480     02  RS-SOC       PIC  9(001).
000490     02  RS-SHC       PIC  9(001).
000500     02  F            PIC  X(023).
000510     02  RS-SEQ       PIC  9(003).
000520 WORKING-STORAGE SECTION.
000530 01  HEAD1.
000540     02  W-15K        PIC  X(005) VALUE ""3FE04F40A0"".
000550     02  F            PIC  X(008) VALUE ""3F504F40677F4F9B"".
000560*****02  F            PIC  X(022) VALUE SPACE.                    D.020424
000570     02  F            PIC  X(025) VALUE SPACE.                    I.020424
000580     02  F            PIC  N(009) VALUE NC"領　収　書　（控）".
000590     02  F            PIC  X(014) VALUE SPACE.
000600     02  F            PIC  X(005) VALUE "DATE ".
000610     02  H-DATE       PIC 99B99B99.
000620     02  F            PIC  X(007) VALUE "     P.".
000630     02  H-PAGE       PIC Z9.
000640     02  F            PIC  X(008) VALUE ""3F504F40674F40A0"".
000650     02  W-20K        PIC  X(005) VALUE ""3FE04FE080"".
000660 01  HEAD2.
000670     02  F            PIC  X(001) VALUE SPACE.
000680     02  F            PIC  N(007) VALUE NC"領収書№受取日".
000690     02  F            PIC  X(007) VALUE " ｺｰﾄﾞ  ".
000700     02  F            PIC  N(007) VALUE NC"取　引　先　名".
000710     02  F            PIC  X(016) VALUE SPACE.
000720     02  F            PIC  N(003) VALUE NC"金　額".
000730     02  F            PIC  X(001) VALUE SPACE.
000740     02  F            PIC  N(003) VALUE NC"発行日".
000750     02  F            PIC  X(023) VALUE SPACE.                    I.020424
000760*****02  F            PIC  X(020) VALUE SPACE.                    D.020424
000770 01  W-P.
000780     02  P-15K        PIC  X(005).
000790     02  F            PIC  X(002).
000800     02  P-RNO        PIC  9(006).
000810     02  F            PIC  X(001).
000820     02  P-DATE.
000830       03  P-NEN      PIC Z9.
000840       03  P-GET      PIC Z9.
000850       03  P-PEY      PIC Z9.
000860     02  F            PIC  X(001).
000870     02  P-TCD        PIC  9(004).
000880     02  F            PIC  X(002).
000890     02  P-TNA        PIC  N(016).
000900     02  P-KIN        PIC ----,---,--9.
000910     02  F            PIC  X(001).
000920     02  P-HNGP.
000930       03  P-HNEN     PIC Z9.
000940       03  P-HGET     PIC Z9.
000950       03  P-HPEY     PIC Z9.
000960     02  F            PIC  X(001).
000970     02  P-SHM        PIC  N(004).
000980     02  F            PIC  X(016).                                I.020424
000990*****02  F            PIC  X(013).                                D.020424
001000 01  W-DATA.
001010     02  W-KEY.
001020       03  W-DATE     PIC  9(006).
001030       03  W-TCD      PIC  9(004).
001040     02  W-HNGP       PIC  9(006).
001050     02  CHK          PIC  9(001).
001060     02  W-DMM        PIC  9(001).
001070     02  W-PAGE       PIC  9(002) VALUE ZERO.
001080     02  W-NAME       PIC  N(016).                                I.960203
001090 01  ERR-STAT         PIC  X(002).
001100     COPY LSTAT.
001110 SCREEN            SECTION.
001120 SD  C-CRT
001130     END STATUS IS ESTAT.
001140 01  C-CLEAR.
001150     02  LINE   1  CLEAR SCREEN.
001160 01  C-MID.
001170     02  LINE   3  COLUMN  10  PIC  N(019) VALUE
001180          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001190     02  LINE   4  COLUMN  10  PIC  N(019) VALUE
001200          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001210     02  LINE   5  COLUMN  10  PIC  N(019) VALUE
001220          NC"＊＊＊　　　　　　　　　　　　　＊＊＊".
001230     02  LINE   6  COLUMN  10  PIC  N(019) VALUE
001240          NC"＊＊＊　　領　収　書　（控）　　＊＊＊".
001250     02  LINE   7  COLUMN  10  PIC  N(019) VALUE
001260          NC"＊＊＊　　　　　　　　　　　　　＊＊＊".
001270     02  LINE   8  COLUMN  10  PIC  N(019) VALUE
001280          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001290     02  LINE   9  COLUMN  10  PIC  N(019) VALUE
001300          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001310 01  D-CM.
001320     02  LINE  12  COLUMN  16  PIC  N(013) VALUE
001330          NC"領収書累積ファイル　クリア".
001340     02  LINE  13  COLUMN  21  PIC  X(017) VALUE
001350          "ｽﾙ=1 ｼﾅｲ=9   ﾘﾀｰﾝ".
001360 01  C-ACP.
001370     02  A-DMM   LINE  13  COLUMN  33  PIC  9(001)
001380          USING W-DMM   CHECK OVERFLOW NO IFC.
001390 01  C-ERR.
001400     02  LINE  24.
001410       03  E-ME1   COLUMN  15  PIC  X(021) VALUE
001420            "***  PROGRAM ｴﾗｰ  ***".
001430       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001440       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001450       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001460 PROCEDURE DIVISION.
001470 M-05.
001480     DISPLAY C-CLEAR.
001490     DISPLAY C-MID.
001500     OPEN INPUT RS-F.
001510 M-10.
001520     READ RS-F AT END
001530         CLOSE RS-F
001540         DISPLAY C-CLEAR
001550         STOP RUN.
001560     OPEN INPUT T-M.
001570     OPEN OUTPUT SP-F.
001580     ACCEPT H-DATE FROM DATE.
001590     PERFORM S-10 THRU S-15.
001600     MOVE ZERO TO W-KEY W-HNGP.
001610 M-15.
001620     MOVE SPACE TO W-P.
001630     MOVE W-15K TO P-15K.
001640     MOVE SPACE TO P-TNA P-SHM.
001650     MOVE RS-RNO TO P-RNO.
001660     IF W-KEY = RS-KEY
001670         GO TO M-20.
001680     MOVE RS-NEN TO P-NEN.
001690     MOVE RS-GET TO P-GET.
001700     MOVE RS-PEY TO P-PEY.
001710     MOVE RS-TCD TO P-TCD.
001720     MOVE RS-TCD TO T-KEY.
001730     READ T-M WITH UNLOCK INVALID KEY
001740         MOVE NC"　＊＊＊　ＴＭ　なし　＊＊＊　　" TO T-TNA.
001750     MOVE SPACE TO W-NAME.                                        I.960203
001760     IF T-TNA = SPACE
001770*****    MOVE T-NAME TO P-TNA                                     D.960203
001780         MOVE T-NAME TO W-NAME                                    I.960203
001790       ELSE
001800*****    MOVE T-TNA TO P-TNA.                                     D.960203
001810         MOVE T-TNA TO W-NAME.                                    I.960203
001820     MOVE W-NAME TO P-TNA.                                        I.960203
001830 M-20.
001840     MOVE RS-KIN TO P-KIN.
001850     IF RS-SHC = 5
001860         MOVE NC"再発行　" TO P-SHM.
001870     IF W-HNGP NOT = RS-HNGP
001880         MOVE RS-HNEN TO P-HNEN
001890         MOVE RS-HGET TO P-HGET
001900         MOVE RS-HPEY TO P-HPEY.
001910     IF LINAGE-COUNTER > 63
001920         MOVE RS-NEN TO P-NEN
001930         MOVE RS-GET TO P-GET
001940         MOVE RS-PEY TO P-PEY
001950         MOVE RS-TCD TO P-TCD
001960*****    MOVE T-TNA TO P-TNA                                      D.960203
001970         MOVE W-NAME TO P-TNA                                     I.960203
001980         MOVE RS-HNEN TO P-HNEN
001990         MOVE RS-HGET TO P-HGET
002000         MOVE RS-HPEY TO P-HPEY
002010         PERFORM S-05 THRU S-15.
002020     MOVE SPACE TO SP-R.
002030     MOVE W-P TO SP-R.
002040     WRITE SP-R.
002050     MOVE SPACE TO SP-R.
002060     MOVE RS-KEY TO W-KEY.
002070     MOVE RS-HNGP TO W-HNGP.
002080 M-25.
002090     READ RS-F AT END
002100         GO TO M-30.
002110     GO TO M-15.
002120 M-30.
002130     CLOSE SP-F.
002140     DISPLAY D-CM.
002150 M-35.
002160     ACCEPT A-DMM.
002170     IF ESTAT NOT = HTB AND SKP
002180         GO TO M-30.
002190     IF W-DMM = 9
002200         GO TO M-95.
002210     IF W-DMM NOT = 1
002220         GO TO M-35.
002230     CLOSE RS-F.
002240     OPEN OUTPUT RS-F.
002250 M-95.
002260     CLOSE RS-F.
002270     DISPLAY C-CLEAR.
002280     STOP RUN.
002290 S-05.
002300     MOVE SPACE TO SP-R.
002310     WRITE SP-R AFTER PAGE.
002320 S-10.
002330     ADD 1 TO W-PAGE.
002340     MOVE W-PAGE TO H-PAGE.
002350     MOVE SPACE TO SP-R.
002360     MOVE HEAD1 TO SP-R.
002370     WRITE SP-R AFTER 2.
002380     MOVE SPACE TO SP-R.
002390     MOVE HEAD2 TO SP-R.
002400     WRITE SP-R AFTER 2.
002410     MOVE SPACE TO SP-R.
002420 S-15.
002430     EXIT.
