000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSG990.
000030********************************************************
000040*****     手形・領収書・買掛支払ファイル　更新     *****
000050*****        ( JS-SIGN : 0=手形 , 1=購買 )         *****
000060********************************************************
000070 ENVIRONMENT DIVISION.
000080 CONFIGURATION SECTION.
000090 SOURCE-COMPUTER. SYSTEM3100.
000100 OBJECT-COMPUTER. SYSTEM3100.
000110 INPUT-OUTPUT SECTION.
000120 FILE-CONTROL.
000130     COPY LIBCSE.
000140     SELECT TDT-M ASSIGN TO TDTM-MSD
000150         ORGANIZATION INDEXED
000160         ACCESS MODE DYNAMIC
000170         RECORD KEY TD-KEY
000180         FILE STATUS ERR-STAT.
000190 I-O-CONTROL.
000200     APPLY SHARED-MODE ON M-DATE.
000210 DATA DIVISION.
000220 FILE SECTION.
000230     COPY LIBFDD.
000240 FD  TDT-M
000250     BLOCK  3 RECORDS
000260     LABEL RECORD IS STANDARD
000270     VALUE OF IDENTIFICATION "TDTM".
000280 01  TDT-R.
000290     02  TD-KEY.
000300       03  TD-KBN       PIC  X(002).
000310       03  TD-NO        PIC  X(004).
000320     02  TD-TCD         PIC  9(004).
000330     02  TD-DAT         PIC  9(006).
000340     02  TD-NGP   REDEFINES TD-DAT.
000350       03  TD-NEN       PIC  9(002).
000360       03  TD-GET       PIC  9(002).
000370       03  TD-PEY       PIC  9(002).
000380     02  TD-MAN         PIC  9(006).
000390     02  TD-KIN         PIC S9(010).
000400     02  TD-BK          PIC  9(004).
000410     02  TD-HAC         PIC  N(024).
000420     02  TD-ZR          PIC S9(008).
000430     02  TD-SS          PIC S9(008).
000440     02  TD-SB          PIC  9(008).
000450     02  TD-GC          PIC  9(008).
000460     02  TD-SZ          PIC  9(008).
000470     02  TD-EG          PIC  9(008).
000480     02  TD-ST          PIC  9(008).
000490     02  TD-ZSHZ        PIC S9(007).
000500     02  TD-SSHZ        PIC S9(007).
000510     02  F              PIC  X(006).
000520     02  TD-SNEN        PIC  9(004).
000530     02  TD-HCR         PIC  9(001).
000540     02  TD-HCT         PIC  9(001).
000550     02  TD-HCK         PIC  9(001).
000560     02  TD-HCZ         PIC  9(001).
000570     02  TD-PCHK        PIC  9(001).
000580     02  TD-RSC         PIC  9(001).
000590 WORKING-STORAGE SECTION.
000600 77  JS-SIGN            PIC  9(001).
000610 01  W-DATA.
000620     02  W-NG.
000630       03  W-NEN        PIC  9(004).
000640       03  W-GET        PIC  9(002).
000650     02  W-NGN          PIC  9(006).
000660     02  W-NGD.
000670       03  W-NEND       PIC  9(004).
000680       03  W-NENL  REDEFINES W-NEND.
000690         04  W-NEN1     PIC  9(002).
000700         04  W-NEN2     PIC  9(002).
000710       03  W-GETD       PIC  9(002).
000720     02  W-NGL   REDEFINES W-NGD.
000730       03  F            PIC  9(002).
000740       03  W-NGS        PIC  9(004).
000750     02  CHK            PIC  9(001).
000760 01  ERR-STAT           PIC  X(002).
000770 SCREEN SECTION.
000780 SD  C-CRT
000790     END STATUS IS ESTAT.
000800 01  C-CLEAR.
000810     02  LINE   1  CLEAR SCREEN.
000820 01  C-MID.
000830     02  LINE   3  COLUMN  10  PIC  N(026) VALUE
000840        NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000850     02  LINE   4  COLUMN  10  PIC  N(026) VALUE
000860        NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000870     02  LINE   5  COLUMN  10  PIC  N(026) VALUE
000880        NC"＊＊＊　　　　　　　　　　　　　　　　　　　　＊＊＊".
000890     02  LINE   6  COLUMN  10  PIC  N(026) VALUE
000900        NC"＊＊＊　手形・領収書・買掛支払ファイル　更新　＊＊＊".
000910     02  LINE   7  COLUMN  10  PIC  N(026) VALUE
000920        NC"＊＊＊　　　　　　　　　　　　　　　　　　　　＊＊＊".
000930     02  LINE   8  COLUMN  10  PIC  N(026) VALUE
000940        NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000950     02  LINE   9  COLUMN  10  PIC  N(026) VALUE
000960        NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000970 01  C-ERR.
000980     02  LINE  24.
000990       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001000       03  E-ME1   COLUMN  15  PIC  X(026) VALUE
001010            "***  TDTM REWRITE ｴﾗｰ  ***".
001020       03  E-ME2   COLUMN  15  PIC  X(025) VALUE
001030            "***  TDTM DELETE ｴﾗｰ  ***".
001040       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001050       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001060       03  E-KEY   COLUMN  45  PIC  X(006) FROM  TD-KEY.
001070       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001080            "                                                  ".
001090     COPY LIBSCR.
001100 PROCEDURE DIVISION.
001110 M-05.
001120     ACCEPT JS-SIGN.
001130     IF JS-SIGN > 1
001140         GO TO M-05.
001150     DISPLAY C-CLEAR.
001160     DISPLAY C-MID.
001170*
001180     MOVE ZERO TO W-DATA.
001190     COPY LIBCPR.
001200     IF JS-SIGN = 0
001210         MOVE D-NTNG TO W-NGS
001220       ELSE
001230         MOVE D-NBNG TO W-NGS.
001240     IF W-NEN2 >= DATE-NF1 AND <= DATE-NT1
001250         ADD DATE-NC1 TO W-NEND.
001260     IF W-NEN2 >= DATE-NF2 AND <= DATE-NT2
001270         ADD DATE-NC2 TO W-NEND.
001280     MOVE W-NGD TO W-NGN.
001290     SUBTRACT 1 FROM W-GETD.
001300     IF W-GETD = ZERO
001310         MOVE 12 TO W-GET
001320         SUBTRACT 1 FROM W-NEND.
001330     SUBTRACT 1 FROM W-GETD.
001340     IF W-GETD = ZERO
001350         MOVE 12 TO W-GET
001360         SUBTRACT 1 FROM W-NEND.
001370*
001380     OPEN I-O TDT-M.
001390 M-10.
001400     READ TDT-M NEXT RECORD AT END
001410         GO TO M-95.
001420     MOVE TD-SNEN TO W-NEN.
001430     MOVE TD-GET TO W-GET.
001440     IF W-NG NOT < W-NGN
001450         GO TO M-10.
001460     IF W-NG > W-NGD
001470         GO TO M-15.
001480     IF JS-SIGN = 1
001490         GO TO M-10.
001500*
001510     DELETE TDT-M INVALID KEY
001520         DISPLAY E-STAT E-ME2 E-KEY E-ME99.
001530     GO TO M-10.
001540 M-15.
001550     IF JS-SIGN = 0
001560         IF (TD-HCR NOT = 0) AND (TD-HCT NOT = 0)
001570             GO TO M-10.
001580     IF JS-SIGN = 0
001590         IF TD-HCR = 0
001600             MOVE 5 TO TD-HCR.
001610     IF JS-SIGN = 0
001620         IF TD-HCT = 0
001630             MOVE 5 TO TD-HCT.
001640     IF JS-SIGN = 1
001650         IF TD-HCK = 0
001660             MOVE 5 TO TD-HCR
001670           ELSE
001680             GO TO M-10.
001690     REWRITE TDT-R INVALID KEY
001700         DISPLAY E-STAT E-ME1 E-KEY E-ME99.
001710     GO TO M-10.
001720 M-95.
001730     CLOSE TDT-M.
001740     DISPLAY C-CLEAR.
001750     STOP RUN.
