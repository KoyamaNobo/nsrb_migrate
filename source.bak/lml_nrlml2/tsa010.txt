000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSA010.
000030********************************************
000040*****     送　金　案　内　　入　力     *****
000050*****        ( SCREEN : SCTA01)        *****
000060********************************************
000070 AUTHOR. S-NAKAO.
000080 DATE-WRITTEN. '78-03-29.
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT S-M ASSIGN TO T-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE RANDOM
000180         RECORD KEY S-KEY.
000190     SELECT TSA-F ASSIGN TO TSA-MSD.
000200     SELECT SP-F ASSIGN TO P-PRN999.
000210 I-O-CONTROL.
000220     APPLY SHARED-MODE ON S-M
000230     APPLY SHIFT-CODE ON SP-F.
000240 DATA DIVISION.
000250 FILE SECTION.
000260     COPY LISM.
000270     COPY LSPF.
000280 FD  TSA-F
000290     BLOCK  8 RECORDS
000300     LABEL RECORD IS STANDARD
000310     VALUE OF IDENTIFICATION "TSAF".
000320 01  TSA-R.
000330     02  SA-D.
000340       03  SA-DATE    PIC  9(006).                                ﾋｽﾞｹ
000350       03  SA-SCD     PIC  9(004).                                ｼｲﾚｻｷC
000360     02  SA-SC        PIC  9(001).                                ｿｳｷﾝC
000370     02  SA-KIN       PIC  9(009).                                ｷﾝｶﾞｸ
000380     02  F            PIC  X(009).
000390     02  SA-SEQ       PIC  9(003).                                NO
000400 WORKING-STORAGE SECTION.
000410 01  W-15K            PIC  X(005) VALUE ""3FE04F40A0"".
000420 01  HEAD1.
000430     02  W-20K        PIC  X(005) VALUE ""3FE04FE080"".
000440     02  F            PIC  X(004) VALUE SPACE.
000450     02  F            PIC  N(022) VALUE
000460          NC"＊＊＊　　送金案内　プルーフリスト　　＊＊＊".
000470     02  F            PIC  X(005) VALUE SPACE.
000480     02  F            PIC  X(005) VALUE "DATE ".
000490     02  H-DATE       PIC 99B99B99.
000500     02  F            PIC  X(007) VALUE "     P.".
000510     02  H-PAGE       PIC Z9.
000520 01  HEAD2.
000530     02  F            PIC  X(001) VALUE SPACE.
000540     02  F            PIC  N(003) VALUE NC"日　付".
000550     02  F            PIC  X(008) VALUE "   ｺｰﾄﾞ ".
000560     02  F            PIC  N(007) VALUE NC"送　金　先　名".
000570     02  F            PIC  X(021) VALUE SPACE.
000580     02  F            PIC  N(004) VALUE NC"送金区分".
000590     02  F            PIC  X(006) VALUE SPACE.
000600     02  F            PIC  N(003) VALUE NC"金　額".
000610     02  F            PIC  X(003) VALUE SPACE.
000620     02  F            PIC  N(001) VALUE NC"№".
000630 01  W-P.
000640     02  P-15K        PIC  X(005).
000650     02  P-DATE       PIC 99B99B99.
000660     02  F            PIC  X(002).
000670     02  P-SCD        PIC  9(004).
000680     02  F            PIC  X(001).
000690     02  P-NAME       PIC  N(024).
000700     02  F            PIC  X(003).
000710     02  P-SC         PIC  9(001).
000720     02  P-KIN        PIC ZZZZZZZ,ZZZ,ZZ9.
000730     02  F            PIC  9(002).
000740     02  P-SEQ        PIC  9(003).
000750     02  P-20K        PIC  X(005).
000760 01  W-R.
000770     02  W-RD.
000780       03  W-DATE     PIC  9(006).
000790       03  W-DATED REDEFINES W-DATE.
000800         04  W-NEN    PIC  9(002).
000810         04  W-GET    PIC  9(002).
000820         04  W-PEY    PIC  9(002).
000830       03  W-SCD      PIC  9(004).                                ｼｲﾚｻｷC
000840     02  W-SC         PIC  9(001).                                ｿｳｷﾝC
000850     02  W-KIN        PIC S9(009).                                ｷﾝｶﾞｸ
000860     02  F            PIC  X(009).
000870     02  W-SEQ        PIC  9(003).                                NO
000880 01  W-DATA.
000890     02  W-KEY        PIC  9(003).
000900     02  W-NO         PIC  9(003).
000910     02  W-ACT        PIC  9(001).
000920     02  W-DMM        PIC  9(001).
000930     02  CHK          PIC  9(001).
000940     02  W-PAGE       PIC  9(002).
000950     02  W-D          PIC  9(010).
000960     02  W-SCN        PIC  N(003).
000970 01  ERR-STAT         PIC  X(002).
000980     COPY LSTAT.
000990 SCREEN            SECTION.
001000 SD  C-CRT
001010     END STATUS IS ESTAT.
001020 01  C-CLEAR.
001030     02  LINE   1  CLEAR SCREEN.
001040 01  C-MID.
001050     02  LINE   3  COLUMN  10  PIC  N(022) VALUE
001060          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001070     02  LINE   4  COLUMN  10  PIC  N(022) VALUE
001080          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001090     02  LINE   6  COLUMN  10  PIC  N(022) VALUE
001100          NC"＊＊＊　　　　　　　　　　　　　　　　＊＊＊".
001110     02  LINE   7  COLUMN  10  PIC  N(022) VALUE
001120          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001130     02  LINE  10  COLUMN  18  PIC  X(028) VALUE
001140          "[  する=5 しない=1   ﾘﾀｰﾝ  ]".
001150     02  LINE  20  COLUMN  25  PIC  X(022) VALUE
001160          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001170 01  C-MIDC.
001180     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
001190          NC"＊＊＊　　送金案内ファイル　クリア　　＊＊＊".
001200 01  C-MIDP.
001210     02  LINE   5  COLUMN  10  PIC  N(022) VALUE
001220          NC"＊＊＊　送金案内ファイル　入力リスト　＊＊＊".
001230 01  C-ACP.
001240     02  A-CHK   LINE  10  COLUMN  38  PIC  9(001)
001250          USING CHK     CHECK OVERFLOW NO IFC.
001260     02  A-ACT   LINE   3  COLUMN  49  PIC  9(001)
001270          USING W-ACT   CHECK OVERFLOW NO IFC.
001280     02  A-KEY   LINE   5  COLUMN  20  PIC  9(003)
001290          USING W-KEY   CHECK OVERFLOW NO IFC.
001300     02  A-DATE  LINE   7  COLUMN  20  PIC  9(006)
001310          USING W-DATE  CHECK OVERFLOW NO IFC.
001320     02  A-SCD   LINE   9  COLUMN  20  PIC  9(004)
001330          USING W-SCD   CHECK OVERFLOW NO IFC.
001340     02  A-SC    LINE  12  COLUMN  20  PIC  9(001)
001350          USING W-SC    CHECK OVERFLOW NO IFC.
001360     02  A-KIN   LINE  13  COLUMN  20  PIC  9(009)
001370          USING W-KIN   CHECK OVERFLOW NO IFC.
001380     02  A-DMM   LINE  20  COLUMN  42  PIC  9(001)
001390          USING W-DMM   CHECK OVERFLOW NO IFC.
001400 01  C-DSP.
001410     02  D-NAME  LINE  10  COLUMN  20  PIC  N(024) FROM  S-NAME.
001420     02  D-SCN   LINE  12  COLUMN  22  PIC  N(003) FROM  W-SCN.
001430     02  D-KIN   LINE  13  COLUMN  20  PIC ZZZZZZZZ9  FROM  W-KIN.
001440 01  C-ERR.
001450     02  LINE  24.
001460       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001470            "***  ﾄｳﾛｸ ｽﾞﾐ  ***".
001480       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001490            "***  ﾌｧｲﾙ ﾅｼ  ***".
001500       03  E-ME3   COLUMN  15  PIC  X(017) VALUE
001510            "***  ﾏｽﾀｰ ﾅｼ  ***".
001520       03  E-ME4   COLUMN  15  PIC  X(038) VALUE
001530            "***  ﾕｳﾋﾞﾝNO･ｼﾞｭｳｼｮ ｶﾞ ﾄｳﾛｸ ｻﾚﾃﾅｲ  ***".
001540       03  E-ME9   COLUMN  15  PIC  X(021) VALUE
001550            "***  PROGRAM ｴﾗｰ  ***".
001560       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001570       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001580       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001590       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001600            "                                                  ".
001610 PROCEDURE DIVISION.
001620 M-05.
001630     DISPLAY C-CLEAR.
001640     DISPLAY C-MID C-MIDC.
001650     PERFORM S-30 THRU S-40.
001660     IF CHK = 5
001670         OPEN OUTPUT TSA-F
001680         CLOSE TSA-F.
001690     OPEN INPUT TSA-F.
001700     MOVE ZERO TO W-NO.
001710 M-10.
001720     READ TSA-F AT END
001730         GO TO M-15.
001740     IF SA-SEQ > W-NO
001750         MOVE SA-SEQ TO W-NO.
001760     GO TO M-10.
001770 M-15.
001780     CLOSE TSA-F.
001790     OPEN INPUT S-M.
001800     MOVE ZERO TO W-D.
001810 M-20.
001820     CALL "SCTA01".
001830     ACCEPT A-ACT.
001840     IF ESTAT NOT = HTB AND SKP
001850         GO TO M-20.
001860     IF W-ACT = 9
001870         GO TO M-80.
001880     IF W-ACT NOT = 1 AND 2 AND 3
001890         GO TO M-20.
001900 M-25.
001910     CALL "SCTA01".
001920     DISPLAY A-ACT.
001930     IF W-ACT = 1
001940         COMPUTE W-KEY = W-NO + 1
001950         DISPLAY A-KEY
001960         OPEN EXTEND TSA-F
001970         INITIALIZE W-R
001980         MOVE W-KEY TO W-SEQ
001990         MOVE W-D TO W-RD
002000         GO TO M-40.
002010 M-30.
002020     ACCEPT A-KEY.
002030     DISPLAY E-CL.
002040     IF ESTAT = BTB
002050         GO TO M-20.
002060     IF ESTAT NOT = HTB AND SKP
002070         GO TO M-30.
002080     OPEN I-O TSA-F.
002090 M-35.
002100     READ TSA-F AT END
002110         DISPLAY E-ME2 E-ME98
002120         CLOSE TSA-F
002130         GO TO M-30.
002140     IF W-KEY NOT = SA-SEQ
002150         GO TO M-35.
002160     MOVE TSA-R TO W-R.
002170     MOVE W-SCD TO S-KEY.
002180     READ S-M WITH UNLOCK INVALID KEY
002190         MOVE NC"　　＊＊　マスター　なし　＊＊　" TO S-NAME.
002200     MOVE SPACE TO W-SCN.
002210     IF W-SC = 1
002220         MOVE NC"小切手" TO W-SCN.
002230     IF W-SC = 2
002240         MOVE NC"手　形" TO W-SCN.
002250     IF W-SC = 3
002260         MOVE NC"相　殺" TO W-SCN.
002270     DISPLAY A-DATE A-SCD D-NAME A-SC D-SCN D-KIN.
002280     IF W-ACT = 3
002290         GO TO M-65.
002300 M-40.
002310     IF W-ACT = 1
002320         DISPLAY A-DATE.
002330     ACCEPT A-DATE.
002340     IF ESTAT NOT = BTB
002350         GO TO M-45.
002360     CLOSE TSA-F.
002370     IF W-ACT = 2 OR 3
002380         GO TO M-30.
002390     GO TO M-20.
002400 M-45.
002410     IF ESTAT NOT = HTB AND SKP
002420         GO TO M-40.
002430     IF W-GET < 1 OR > 12
002440         GO TO M-40.
002450     IF W-PEY < 1 OR > 31
002460         GO TO M-40.
002470 M-50.
002480     IF W-ACT = 1
002490         DISPLAY A-SCD.
002500     ACCEPT A-SCD.
002510     DISPLAY E-CL.
002520     IF ESTAT = BTB
002530         GO TO M-40.
002540     IF ESTAT NOT = HTB AND SKP
002550         GO TO M-50.
002560     MOVE W-SCD TO S-KEY.
002570     READ S-M WITH UNLOCK INVALID KEY
002580         DISPLAY E-ME3 E-ME98
002590         GO TO M-50.
002600     DISPLAY D-NAME.
002610     IF SPACE = S-JSU OR S-UNO
002620         DISPLAY E-ME4 E-ME98.
002630 M-55.
002640     ACCEPT A-SC.
002650     IF ESTAT = BTB
002660         GO TO M-50.
002670     IF ESTAT NOT = HTB AND SKP
002680         GO TO M-55.
002690     IF W-SC NOT = 1 AND 2 AND 3
002700         GO TO M-55.
002710     MOVE SPACE TO W-SCN.
002720     IF W-SC = 1
002730         MOVE NC"小切手" TO W-SCN.
002740     IF W-SC = 2
002750         MOVE NC"手　形" TO W-SCN.
002760     IF W-SC = 3
002770         MOVE NC"相　殺" TO W-SCN.
002780     DISPLAY D-SCN.
002790 M-60.
002800     ACCEPT A-KIN.
002810     IF ESTAT = BTB
002820         GO TO M-55.
002830     IF ESTAT NOT = HTB AND SKP
002840         GO TO M-60.
002850     DISPLAY D-KIN.
002860     IF W-KIN = ZERO
002870         GO TO M-60.
002880 M-65.
002890     ACCEPT A-DMM.
002900     IF ESTAT NOT = BTB
002910         GO TO M-70.
002920     IF W-ACT = 3
002930         CLOSE TSA-F
002940         GO TO M-25.
002950     GO TO M-60.
002960 M-70.
002970     IF ESTAT = HTB AND SKP
002980         GO TO M-65.
002990     IF W-DMM = 9
003000         CLOSE TSA-F
003010         GO TO M-25.
003020     IF W-DMM NOT = 1
003030         GO TO M-65.
003040     IF W-ACT = 1
003050         INITIALIZE TSA-R
003060         MOVE W-R TO TSA-R
003070         WRITE TSA-R
003080         CALL "CBLTCLS" USING TSA-F                               I.930818
003090         MOVE W-SEQ TO W-NO.
003100     IF W-ACT = 2
003110         INITIALIZE TSA-R
003120         MOVE W-R TO TSA-R
003130         REWRITE TSA-R.
003140     IF W-ACT = 3
003150         MOVE ""FF"" TO TSA-R
003160         REWRITE TSA-R.
003170     CLOSE TSA-F.
003180     MOVE W-RD TO W-D.
003190     GO TO M-25.
003200 M-80.
003210     CLOSE S-M.
003220     DISPLAY C-CLEAR.
003230     DISPLAY C-MID C-MIDP.
003240     PERFORM S-30 THRU S-40.
003250     IF CHK = 1
003260         GO TO M-95.
003270     OPEN INPUT TSA-F.
003280     READ TSA-F AT END
003290         CLOSE TSA-F
003300         GO TO M-95.
003310     ACCEPT H-DATE FROM DATE.
003320     MOVE ZERO TO W-D W-PAGE.
003330     OPEN OUTPUT SP-F.
003340     OPEN INPUT S-M.
003350     PERFORM S-10 THRU S-15.
003360     PERFORM S-20 THRU S-25.
003370     CLOSE TSA-F.
003380     CLOSE S-M.
003390     CLOSE SP-F.
003400 M-95.
003410     DISPLAY C-CLEAR.
003420     STOP RUN.
003430 S-05.
003440     MOVE SPACE TO SP-R.
003450     WRITE SP-R AFTER PAGE.
003460 S-10.
003470     ADD 1 TO W-PAGE.
003480     MOVE W-PAGE TO H-PAGE.
003490     MOVE SPACE TO SP-R.
003500     MOVE HEAD1 TO SP-R.
003510     WRITE SP-R.
003520     MOVE SPACE TO SP-R.
003530     MOVE HEAD2 TO SP-R.
003540     WRITE SP-R AFTER 2.
003550     MOVE SPACE TO SP-R.
003560 S-15.
003570     EXIT.
003580 S-20.
003590     MOVE SA-SCD TO S-KEY.
003600     READ S-M WITH UNLOCK INVALID KEY
003610         MOVE SPACE TO S-NAME
003620         MOVE NC"　　＊＊　マスター　なし　＊＊　" TO S-NAME.
003630     MOVE SPACE TO W-P.
003640     MOVE W-15K TO P-15K.
003650     MOVE W-20K TO P-20K.
003660     MOVE SPACE TO P-NAME.
003670     IF W-D NOT = SA-D
003680         MOVE SA-DATE TO P-DATE
003690         MOVE SA-SCD TO P-SCD
003700         MOVE S-NAME TO P-NAME.
003710     MOVE SA-SC TO P-SC.
003720     MOVE SA-KIN TO P-KIN.
003730     MOVE SA-SEQ TO P-SEQ.
003740     IF LINAGE-COUNTER > 61
003750         PERFORM S-05 THRU S-15.
003760     MOVE SPACE TO SP-R.
003770     MOVE W-P TO SP-R.
003780     WRITE SP-R.
003790     MOVE SPACE TO SP-R.
003800     MOVE SA-D TO W-D.
003810     READ TSA-F AT END
003820         GO TO S-25.
003830     GO TO S-20.
003840 S-25.
003850     EXIT.
003860 S-30.
003870     ACCEPT A-CHK.
003880     IF ESTAT NOT = HTB AND SKP
003890         GO TO S-30.
003900     IF CHK NOT = 1 AND 5
003910         GO TO S-30.
003920 S-35.
003930     ACCEPT A-DMM.
003940     IF ESTAT = BTB
003950         GO TO S-30.
003960     IF ESTAT NOT = HTB AND SKP
003970         GO TO S-35.
003980     IF W-DMM = 9
003990         DISPLAY C-CLEAR
004000         STOP RUN.
004010     IF W-DMM NOT = 1
004020         GO TO S-35.
004030 S-40.
004040     EXIT.
