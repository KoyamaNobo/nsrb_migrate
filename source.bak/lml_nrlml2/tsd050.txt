000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSD050.
000030******************************************************
000040*****     受取・割引・支払手形　落込みリスト     *****
000050******************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE RANDOM
000150         RECORD KEY T-KEY
000160         ALTERNATE RECORD KEY T-KEY2.
000170     SELECT S-M ASSIGN TO S-MSD
000180         ORGANIZATION INDEXED
000190         ACCESS MODE RANDOM
000200         RECORD KEY S-KEY.
000210     SELECT BANK-M ASSIGN TO BANK-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE RANDOM
000240         RECORD KEY B-KEY.
000250     SELECT TGO-F ASSIGN TO TGO-MSD.
000260     SELECT SP-F ASSIGN TO P-PRN999.
000270 I-O-CONTROL.
000280     APPLY SHARED-MODE ON BANK-M
000290     APPLY SHARED-MODE ON S-M
000300     APPLY SHARED-MODE ON T-M
000310     APPLY SHIFT-CODE  ON SP-F.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LISM.
000350     COPY LITM.
000360     COPY LIBANK.
000370     COPY LSPF.
000380 FD  TGO-F
000390     BLOCK  2 RECORDS
000400     LABEL RECORD STANDARD
000410     VALUE OF IDENTIFICATION WK0128ID.
000420 01  TGO-R.
000430     02  TGO-DTC        PIC  9(001).
000440     02  TGO-TSC        PIC  9(002).
000450     02  TGO-OKD        PIC  9(006).
000460     02  TGO-NO         PIC  9(004).
000470     02  TGO-BCD        PIC  9(004).
000480     02  TGO-TCD        PIC  9(004).
000490     02  TGO-KIN        PIC  9(010).
000500     02  TGO-UFD        PIC  9(006).
000510     02  TGO-MKD        PIC  9(006).
000520     02  TGO-SBC        PIC  9(004).
000530     02  TGO-FDM        PIC  N(024).
000540     02  F              PIC  X(025).
000550     02  TGO-SNU        PIC  9(004).
000560     02  TGO-SNM        PIC  9(004).
000570 WORKING-STORAGE SECTION.
000580 77  WK0128ID           PIC  X(009) VALUE SPACE.
000590 01  STN-NO.
000600     02  STN-NO1        PIC  X(003).
000610     02  STN-NO2        PIC  X(003).
000620 01  W-FID.
000630     02  W-FID1         PIC  X(006) VALUE "WK0128".
000640     02  W-FID2         PIC  X(003).
000650 01  HEAD1.
000660     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000670     02  F              PIC  X(035) VALUE SPACE.
000680     02  F              PIC  N(022) VALUE
000690          NC"＊＊＊　　受手・割引・支払手形　落込みリスト".
000700     02  F              PIC  N(005) VALUE NC"　　＊＊＊".
000710     02  F              PIC  X(021) VALUE SPACE.
000720     02  F              PIC  X(005) VALUE "DATE ".
000730     02  H-DATE         PIC 99B99B99.
000740     02  F              PIC  X(007) VALUE "     P.".
000750     02  H-PAGE         PIC Z9.
000760 01  HEAD2.                                                       131
000770     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000780     02  F              PIC  N(004) VALUE NC"　項目　".
000790     02  F              PIC  X(002) VALUE SPACE.
000800     02  F              PIC  N(004) VALUE NC"落込み日".
000810     02  F              PIC  X(004) VALUE SPACE.
000820     02  F              PIC  N(002) VALUE NC"№　".
000830     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
000840     02  F              PIC  N(018) VALUE
000850          NC"取　引　先　名　（　振　出　人　）　".
000860     02  F              PIC  X(020) VALUE SPACE.
000870     02  F              PIC  N(004) VALUE NC"金　　額".
000880     02  F              PIC  X(005) VALUE SPACE.
000890     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
000900     02  F              PIC  N(006) VALUE NC"銀　行　名　".
000910     02  F              PIC  X(004) VALUE SPACE.
000920     02  F              PIC  N(008) VALUE NC"本　支　店　名　".
000930*****02  F              PIC  X(003) VALUE SPACE.
000940     02  F              PIC  N(006) VALUE NC"　受取振出日".
000950     02  F              PIC  X(003) VALUE SPACE.
000960     02  F              PIC  N(004) VALUE NC"満期日　".
000970 01  W-P.                                                         131
000980     02  P-TGN          PIC  N(004).                              受割支
000990     02  F              PIC  X(001).
001000     02  P-OKD          PIC 99/99/99.                             落込み日
001010     02  F              PIC  X(001).
001020     02  P-NO           PIC  9(004).                              NO
001030     02  F              PIC  X(001).
001040     02  P-TCD          PIC  9(004).                              ｺｰﾄﾞ
001050     02  P-F            PIC  X(001).
001060     02  P-NAME         PIC  N(026).                              取引先名
001070     02  P-R            PIC  X(001).
001080     02  P-KIN          PIC Z,ZZZ,ZZZ,ZZZ.
001090     02  P-X            PIC  X(001).
001100     02  P-KBN          PIC  N(002).                              種類
001110     02  F              PIC  X(001).
001120     02  P-SBC          PIC  9(004).                              BK
001130     02  F              PIC  X(001).
001140     02  P-BNA          PIC  N(008).                              BK名前
001150     02  F              PIC  X(001).
001160     02  P-SNA          PIC  N(008).                              BK支店
001170     02  F              PIC  X(001).
001180     02  P-UFD          PIC 99/99/99.                             振出日
001190     02  F              PIC  X(001).
001200     02  P-MAN          PIC 99/99/99.                             満期日
001210 01  W-DATA.
001220     02  W-PAGE         PIC  9(002).
001230     02  W-DTC          PIC  9(001).
001240     02  W-TGN          PIC  N(004).
001250     02  W-OKD          PIC  9(006).
001260     02  CHK.
001270       03  CHK1         PIC  9(001).
001280       03  CHK2         PIC  9(001).
001290     02  CNT            PIC  9(001).
001300     02  W-SKIN         PIC  9(010).
001310     02  W-AKIN         PIC  9(010).
001320 01  ERR-STAT           PIC  X(002).
001330 SCREEN SECTION.
001340 SD  C-CRT
001350     END STATUS IS ESTAT.
001360 01  C-CLEAR.
001370     02  LINE   1  CLEAR SCREEN.
001380 01  C-MID.
001390     02  LINE   3  COLUMN  10  PIC  N(025) VALUE
001400          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001410     02  LINE   4  COLUMN  10  PIC  N(025) VALUE
001420          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001430     02  LINE   5  COLUMN  10  PIC  N(025) VALUE
001440          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001450     02  LINE   6  COLUMN  10  PIC  N(025) VALUE
001460          NC"＊＊＊　受手・割引・支払手形　落込みリスト　＊＊＊".
001470     02  LINE   7  COLUMN  10  PIC  N(025) VALUE
001480          NC"＊＊＊　　　　　　　　　　　　　　　　　　　＊＊＊".
001490     02  LINE   8  COLUMN  10  PIC  N(025) VALUE
001500          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001510     02  LINE   9  COLUMN  10  PIC  N(025) VALUE
001520          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001530 01  C-ERR.
001540     02  LINE  24.
001550       03  E-STAT  COLUMN  10  PIC  X(002) FROM  ERR-STAT.
001560       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001570            "***  DATA ﾅｼ  ***".
001580       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001590       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001600       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001610            "                                                  ".
001620     COPY LIBSCR.
001630 PROCEDURE DIVISION.
001640 M-05.
001650     DISPLAY C-CLEAR.
001660     DISPLAY C-MID.
001670     ACCEPT H-DATE FROM DATE.
001680 M-10.
001690     CALL "CBLSTNNO" USING STN-NO.
001700     MOVE STN-NO2 TO W-FID2.
001710     MOVE W-FID TO WK0128ID.
001720     OPEN INPUT TGO-F.
001730*
001740     READ TGO-F AT END
001750         CLOSE TGO-F
001760         DISPLAY E-ME1 E-ME99
001770         GO TO M-95.
001780*
001790     OPEN INPUT T-M S-M.
001800     OPEN INPUT BANK-M.
001810     OPEN OUTPUT SP-F.
001820     MOVE 0 TO W-PAGE.
001830     PERFORM S-10 THRU S-15.
001840 M-15.
001850     MOVE TGO-DTC TO W-DTC.
001860     MOVE SPACE TO W-TGN.
001870     IF W-DTC = 1
001880         MOVE NC"受取手形" TO W-TGN
001890       ELSE
001900         IF W-DTC = 2
001910             MOVE NC"割引手形" TO W-TGN
001920           ELSE
001930             IF W-DTC = 3
001940                 MOVE NC"支払手形" TO W-TGN.
001950     MOVE ZERO TO CHK W-AKIN W-SKIN.
001960 M-20.
001970     MOVE TGO-OKD TO W-OKD.
001980     MOVE ZERO TO CHK2 W-SKIN CNT.
001990 M-25.
002000     MOVE SPACE TO W-P.
002010     MOVE SPACE TO P-TGN P-NAME P-BNA P-SNA P-KBN.
002020     IF CHK1 = 0
002030         MOVE 1 TO CHK1
002040         MOVE W-TGN TO P-TGN.
002050     IF CHK2 = 0
002060         MOVE 1 TO CHK2
002070         MOVE W-OKD TO P-OKD.
002080     MOVE TGO-NO TO P-NO.
002090     MOVE TGO-TCD TO P-TCD.
002100     MOVE TGO-KIN TO P-KIN.
002110     IF TGO-TSC = 11 OR 21
002120         MOVE NC"約手" TO P-KBN
002130       ELSE
002140         IF TGO-TSC = 12 OR 22
002150             MOVE NC"為手" TO P-KBN.
002160     MOVE TGO-UFD TO P-UFD.
002170     MOVE TGO-MKD TO P-MAN.
002180*
002190     IF TGO-DTC = 3
002200         GO TO M-30.
002210     MOVE TGO-TCD TO T-KEY.
002220     READ T-M WITH UNLOCK INVALID KEY
002230         MOVE NC"　＊＊　　得意先　なし　　＊＊" TO T-NAME.
002240     MOVE T-NAME TO P-NAME
002250     GO TO M-35.
002260 M-30.
002270     MOVE TGO-TCD TO S-KEY.
002280     READ S-M WITH UNLOCK INVALID KEY
002290         MOVE NC"　＊＊　　仕入先　なし　　＊＊" TO S-NAME.
002300     MOVE S-NAME TO P-NAME.
002310 M-35.
002320     IF TGO-DTC = 1 OR 2
002330         IF TGO-SBC = ZERO
002340             GO TO M-40.
002350     IF TGO-DTC = 3
002360         IF TGO-BCD = ZERO
002370             GO TO M-40.
002380     IF TGO-DTC = 1 OR 2
002390         MOVE TGO-SBC TO B-KEY.
002400     IF TGO-DTC = 3
002410         MOVE TGO-BCD TO B-KEY.
002420     READ BANK-M WITH UNLOCK INVALID KEY
002430         MOVE NC"ＢＡＮＫＭ　無し" TO B-BNA
002440         MOVE SPACE TO B-SNA.
002450     MOVE B-KEY TO P-SBC.
002460     MOVE B-BNA TO P-BNA.
002470     MOVE B-SNA TO P-SNA.
002480 M-40.
002490     IF LINAGE-COUNTER > 60
002500         MOVE W-TGN TO P-TGN
002510         MOVE W-OKD TO P-OKD
002520         PERFORM S-05 THRU S-15.
002530     MOVE SPACE TO SP-R.
002540     MOVE W-P TO SP-R.
002550     WRITE SP-R.
002560     MOVE SPACE TO SP-R.
002570     IF TGO-FDM NOT = SPACE
002580         MOVE SPACE TO W-P
002590         MOVE SPACE TO P-TGN P-NAME P-BNA P-SNA P-KBN
002600         MOVE TGO-FDM TO P-NAME
002610         MOVE "(" TO P-F
002620         MOVE ")" TO P-R
002630         MOVE W-P TO SP-R
002640         WRITE SP-R
002650         MOVE SPACE TO SP-R
002660         WRITE SP-R.
002670     ADD TGO-KIN TO W-SKIN.
002680     IF CNT < 2
002690         ADD 1 TO CNT.
002700 M-45.
002710     READ TGO-F AT END
002720         GO TO M-85.
002730     IF TGO-DTC NOT = W-DTC
002740         GO TO M-55.
002750     IF TGO-OKD NOT = W-OKD
002760         GO TO M-50.
002770     GO TO M-25.
002780 M-50.
002790     PERFORM S-20 THRU S-30.
002800     GO TO M-20.
002810 M-55.
002820     PERFORM S-20 THRU S-30.
002830     PERFORM S-35 THRU S-40.
002840     GO TO M-15.
002850 M-85.
002860     PERFORM S-20 THRU S-30.
002870     PERFORM S-35 THRU S-40.
002880 M-90.
002890     CLOSE SP-F.
002900     CLOSE T-M S-M.
002910     CLOSE BANK-M.
002920     CLOSE TGO-F.
002930 M-95.
002940     DISPLAY C-CLEAR.
002950     STOP RUN.
002960 S-05.
002970     MOVE SPACE TO SP-R.
002980     WRITE SP-R AFTER PAGE.
002990 S-10.
003000     ADD 1 TO W-PAGE.
003010     MOVE W-PAGE TO H-PAGE.
003020     MOVE SPACE TO SP-R.
003030     MOVE HEAD1 TO SP-R.
003040     WRITE SP-R.
003050     MOVE SPACE TO SP-R.
003060     MOVE HEAD2 TO SP-R.
003070     WRITE SP-R AFTER 2.
003080     MOVE SPACE TO SP-R.
003090 S-15.
003100     EXIT.
003110 S-20.
003120     IF CNT = 1
003130         MOVE SPACE TO SP-R
003140         GO TO S-25.
003150     MOVE SPACE TO W-P.
003160     MOVE SPACE TO P-TGN P-NAME P-BNA P-SNA P-KBN.
003170     MOVE NC"　　　　　　　　　　　　　　（　小計　）" TO P-NAME.
003180     MOVE W-SKIN TO P-KIN.
003190     MOVE "*" TO P-X.
003200     IF LINAGE-COUNTER > 60
003210         MOVE W-TGN TO P-TGN
003220         MOVE W-OKD TO P-OKD
003230         PERFORM S-05 THRU S-15.
003240     MOVE SPACE TO SP-R.
003250     MOVE W-P TO SP-R.
003260 S-25.
003270     WRITE SP-R.
003280     MOVE SPACE TO SP-R.
003290     ADD W-SKIN TO W-AKIN.
003300 S-30.
003310     EXIT.
003320 S-35.
003330     MOVE SPACE TO W-P.
003340     MOVE SPACE TO P-TGN P-NAME P-BNA P-SNA P-KBN.
003350     MOVE NC"　　　　　　　　［　合　計　］" TO P-NAME.
003360     MOVE W-AKIN TO P-KIN.
003370     MOVE "*" TO P-X.
003380     IF LINAGE-COUNTER > 60
003390         MOVE W-TGN TO P-TGN
003400         MOVE W-OKD TO P-OKD
003410         PERFORM S-05 THRU S-15.
003420     MOVE SPACE TO SP-R.
003430     MOVE W-P TO SP-R.
003440     WRITE SP-R.
003450     MOVE SPACE TO SP-R.
003460     WRITE SP-R.
003470 S-40.
003480     EXIT.
