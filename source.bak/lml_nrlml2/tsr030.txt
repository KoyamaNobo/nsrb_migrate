000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSR030.
000030******************************************************
000040*****     領収書　変換　（ＴＤＴＭ→ＴＮＫＦ）   *****
000050******************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     SELECT TDT-M ASSIGN TO TDT-MSD
000130         ORGANIZATION INDEXED
000140         ACCESS MODE SEQUENTIAL
000150         RECORD KEY TD-KEY
000160         FILE STATUS IS ERR-STAT.
000170     SELECT TNK-F ASSIGN TO TNK-MSD
000180         FILE STATUS IS ERR-STAT.
000190 DATA DIVISION.
000200 FILE SECTION.
000210 FD  TDT-M
000220     BLOCK  3 RECORDS
000230     LABEL RECORD IS STANDARD
000240     VALUE OF IDENTIFICATION "TDTM".
000250 01  TDT-R.
000260     02  TD-KEY.
000270       03  TD-TKC.
000280         04  TD-C1      PIC  9(001).
000290         04  TD-C2      PIC  9(001).
000300       03  TD-TNO       PIC  9(004).
000310     02  TD-TCD         PIC  9(004).
000320     02  TD-DATE        PIC  9(006).
000330     02  TD-MND         PIC  9(006).
000340     02  TD-KIN         PIC S9(010).
000350     02  TD-BKC         PIC  9(004).
000360     02  TD-FRN         PIC  N(024).
000370     02  TD-SAD.
000380       03  TD-S     OCCURS   7  PIC S9(008).
000390     02  TD-ZSHZ        PIC S9(007).
000400     02  TD-SSHZ        PIC S9(007).
000410     02  F              PIC  X(006).
000420     02  TD-SNEN        PIC  9(004).
000430     02  TD-HCR         PIC  9(001).
000440     02  TD-HCT         PIC  9(001).
000450     02  TD-HCK         PIC  9(001).
000460     02  TD-HCZ         PIC  9(001).
000470     02  TD-PC          PIC  9(001).
000480     02  TD-RSC         PIC  9(001).
000490 FD  TNK-F
000500     BLOCK  8 RECORDS
000510     LABEL RECORD IS STANDARD
000520     VALUE OF IDENTIFICATION "TNKF".
000530 01  TNK-R.
000540     02  TN-DATE        PIC  9(006).
000550     02  TN-TCD         PIC  9(004).
000560     02  TN-KIN         PIC S9(009).
000570     02  TN-SOC         PIC  9(001).
000580     02  TN-SHC         PIC  9(001).
000590     02  F              PIC  X(011).
000600 WORKING-STORAGE SECTION.
000610 01  ERR-STAT           PIC  X(002).
000620 01  W-FILE             PIC  X(013).
000630 01  W-DATA.
000640     02  W-DMM          PIC  9(001).
000650     COPY LSTAT.
000660 SCREEN SECTION.
000670 SD  C-CRT
000680     END STATUS IS ESTAT.
000690 01  C-CLEAR.
000700     02  LINE   1  CLEAR SCREEN.
000710 01  C-MID.
000720     02  LINE   3  COLUMN  10  PIC  N(021) VALUE
000730          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000740     02  LINE   4  COLUMN  10  PIC  N(021) VALUE
000750          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000760     02  LINE   5  COLUMN  10  PIC  N(021) VALUE
000770          NC"＊＊＊　　　　　　　　　　　　　　　＊＊＊".
000780     02  LINE   6  COLUMN  10  PIC  N(021) VALUE
000790          NC"＊＊＊　　　　領収書　変換　　　　　＊＊＊".
000800     02  LINE   7  COLUMN  10  PIC  N(021) VALUE
000810          NC"＊＊＊　（ＴＤＴＭ　→　ＴＮＫＦ）　＊＊＊".
000820     02  LINE   8  COLUMN  10  PIC  N(021) VALUE
000830          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000840     02  LINE   9  COLUMN  10  PIC  N(021) VALUE
000850          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000860     02  LINE  20  COLUMN  23  PIC  X(022) VALUE
000870          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000880 01  C-ACP.
000890     02  A-DMM   LINE  20  COLUMN  40  PIC  9(001)
000900          USING W-DMM   CHECK OVERFLOW NO IFC.
000910 01  C-ERR.
000920     02  LINE  24.
000930       03  E-ME1   COLUMN  15  PIC  X(024) VALUE
000940            "***  TNKF WRITE ｴﾗｰ  ***".
000950       03  E-ME2   COLUMN  15  PIC  X(026) VALUE
000960            "***  TDTM REWRITE ｴﾗｰ  ***".
000970       03  E-KEY   COLUMN  50  PIC  X(006) FROM  TD-KEY.
000980     COPY LSSEM.
000990 PROCEDURE DIVISION.
001000 M-05.
001010     DISPLAY C-CLEAR.
001020     DISPLAY C-MID.
001030 M-25.
001040     ACCEPT A-DMM.
001050     IF ESTAT = PF9
001060         GO TO M-95.
001070     IF ESTAT NOT = HTB AND SKP
001080         GO TO M-25.
001090     IF W-DMM = 9
001100         GO TO M-95.
001110     IF W-DMM NOT = 1
001120         GO TO M-25.
001130*
001140     OPEN I-O TDT-M.
001150     OPEN EXTEND TNK-F.
001160 M-30.
001170     READ TDT-M AT END
001180         GO TO M-90.
001190     IF TD-C1 NOT = 0 AND 1                                       ﾘｮｳｼｭｳｼｮ
001200         GO TO M-30.
001210     IF TD-RSC = 9
001220         GO TO M-30.
001230     IF TD-HCR = 1
001240         GO TO M-30.
001250 M-35.
001260     INITIALIZE TNK-R.
001270     MOVE TD-DATE TO TN-DATE.
001280     MOVE TD-TCD TO TN-TCD.
001290     MOVE TD-KIN TO TN-KIN.
001300     IF TD-TKC = 03 OR 04
001310         MOVE 5 TO TN-SOC.
001320     MOVE TD-RSC TO TN-SHC.
001330     WRITE TNK-R.
001340     IF ERR-STAT NOT = "00"
001350         DISPLAY E-STAT E-ME1 E-KEY E-ME99
001360         GO TO M-40.
001370     CALL "CBLTCLS" USING TNK-F.
001380*
001390     MOVE 1 TO TD-HCR.
001400     REWRITE TDT-R INVALID KEY
001410         DISPLAY E-ME78 E-STAT E-ME2 E-KEY E-ME99
001420         GO TO M-90.
001430     GO TO M-30.
001440 M-40.
001450     IF ERR-STAT NOT = "34"
001460         DISPLAY E-ME78 E-ME99
001470         GO TO M-90.
001480     DISPLAY E-CL.
001490     CLOSE TNK-F.
001500     MOVE "TNKF         " TO W-FILE.
001510     DISPLAY E-ME71 E-ME98 STOP " ".
001520     DISPLAY E-CL.
001530     OPEN EXTEND TNK-F.
001540     GO TO M-35.
001550 M-90.
001560     CLOSE TDT-M.
001570     CLOSE TNK-F.
001580 M-95.
001590     DISPLAY C-CLEAR.
001600     STOP RUN.
