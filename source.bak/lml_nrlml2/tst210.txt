000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TST210.
000030********************************************
000040*****     銀行別　割引手形　問合せ     *****
000050*****        ( SCREEN : SCTT21)        *****
000060********************************************
000070 AUTHOR. S-NAKAO.
000080 DATE-WRITTEN. '78-03-29.
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT BANK-M ASSIGN TO BANK-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE  RANDOM
000190         RECORD KEY   B-KEY.
000200     SELECT UKET-M ASSIGN TO UKET-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE  RANDOM
000230         RECORD KEY   UT-KEY.
000240*****SELECT T-M    ASSIGN TO T-MSD                                D.000225
000250     SELECT T-M    ASSIGN TO T1-MSD T2-MSD                        I.000225
000260         ORGANIZATION INDEXED
000270         ACCESS MODE  RANDOM
000280         RECORD KEY   T-KEY                                       I.000225
000290         ALTERNATE RECORD KEY   T-KEY2.                           I.000225
000300*****    RECORD KEY   T-KEY.                                      D.000225
000310     SELECT YRIT-F ASSIGN TO YRIT-MSD.
000320 I-O-CONTROL.
000330     APPLY SHARED-MODE ON M-DATE
000340     APPLY SHARED-MODE ON T-M
000350     APPLY SHARED-MODE ON BANK-M.
000360 DATA DIVISION.
000370 FILE SECTION.
000380     COPY LIBFDD.
000390     COPY LITM.
000400     COPY LIBANK.
000410     COPY LIUKET.
000420 FD  YRIT-F
000430*****BLOCK  6 RECORDS                                             D.960112
000440*****BLOCK  3 RECORDS                                             D.970602
000450     BLOCK  4 RECORDS                                             I.970602
000460     LABEL RECORD IS STANDARD
000470     VALUE OF IDENTIFICATION WK0064ID.                            I.970602
000480*****VALUE OF IDENTIFICATION "TK42".                              D.960112
000490*****VALUE OF IDENTIFICATION WK0085ID.                            D.970602
000500 01  YRIT-R.
000510     02  Y-YBK          PIC  9(004).
000520     02  Y-IDO.
000530       03  Y-IDO1       PIC  9(002).
000540       03  Y-IDO2       PIC  9(002).
000550       03  Y-IDO3       PIC  9(002).
000560     02  Y-MAN          PIC  9(006).
000570     02  Y-TCD          PIC  9(004).
000580     02  Y-KBN          PIC  9(002).
000590     02  Y-NO           PIC  9(004).
000600     02  Y-KIN          PIC  9(010).
000610     02  Y-FUC          PIC  9(001).
000620     02  F              PIC  X(027).                              I.970602
000630*****02  F              PIC  X(005).                              D.960112
000640*****02  F              PIC  X(048).                              D.970602
000650 WORKING-STORAGE SECTION.
000660*77  WK0085ID           PIC  X(009) VALUE SPACE.                  D.970602
000670 77  WK0064ID           PIC  X(009) VALUE SPACE.                  I.970602
000680 01  STN-NO.                                                      I.960112
000690     02  STN-NO1        PIC  X(003).                              I.960112
000700     02  STN-NO2        PIC  X(003).                              I.960112
000710 01  W-FID.                                                       I.960112
000720*****02  W-FID1         PIC  X(006) VALUE "WK0085".               D.970602
000730     02  W-FID1         PIC  X(006) VALUE "WK0064".               I.970602
000740     02  W-FID2         PIC  X(003).                              I.960112
000750 01  W-D.
000760     02  W-YBK          PIC  9(004).
000770     02  W-IDO          PIC  9(006).
000780     02  W-ZAN          PIC S9(010).
000790     02  W-SNG.                                                   I.970917
000800       03  W-SNEN       PIC  9(004).                              I.970917
000810       03  W-SNENL REDEFINES W-SNEN.                              I.970917
000820         04  W-SNEN1    PIC  9(002).                              I.970917
000830         04  W-SNEN2    PIC  9(002).                              I.970917
000840       03  W-SGET       PIC  9(002).                              I.970917
000850     02  W-SNGL  REDEFINES W-SNG.                                 I.970917
000860       03  F            PIC  9(002).                              I.970917
000870       03  W-SNGS       PIC  9(004).                              I.970917
000880     02  W-NGP.
000890       03  W-NG.
000900         04  W-NEN      PIC  9(002).
000910         04  W-GET      PIC  9(002).
000920       03  W-PEY        PIC  9(002).
000930     02  W-PEYD         PIC  9(002).
000940     02  W-TNA.
000950       03  W-TNA1       PIC  N(015).
000960       03  W-TNA2       PIC  N(011).                              I.020424
000970*****  03  W-TNA2       PIC  N(009).                              D.020424
000980     02  W-URA          PIC  X(005).
000990     02  W-FYT          PIC  N(003).
001000     02  W-OC           PIC  X(001).
001010     02  W-MAND         PIC  X(008).
001020     02  W-MAN   REDEFINES W-MAND  PIC 99/99/99.
001030     02  W-MANM  REDEFINES W-MAND  PIC  N(004).
001040     02  W-DMM          PIC  9(001).
001050     02  CNT            PIC  9(001).
001060     02  W-L1           PIC  9(002).
001070     02  W-L2           PIC  9(002).
001080     COPY LSTAT.
001090 SCREEN SECTION.
001100 SD  C-CRT
001110     END STATUS IS ESTAT.
001120 01  C-CLEAR.
001130     02  LINE   1  CLEAR SCREEN.
001140 01  C-ACP.
001150     02  A-YBK   LINE   3  COLUMN  13  PIC  9(004)
001160          USING W-YBK   CHECK OVERFLOW NO IFC.
001170     02  A-DMM   LINE  23  COLUMN  55  PIC  9(001)
001180          USING W-DMM   CHECK OVERFLOW NO IFC.
001190 01  C-DSP.
001200     02  D-DATE  LINE   2.
001210       03  COLUMN  64  PIC  Z(002) FROM  W-NEN.
001220       03  COLUMN  68  PIC  Z(002) FROM  W-GET.
001230     02  D-BK    LINE   3.
001240       03  COLUMN  19  PIC  N(008) FROM  B-BNA.
001250       03  COLUMN  37  PIC  N(008) FROM  B-SNA.
001260     02  LINE W-L1.
001270       03  D-D1.
001280         04  COLUMN   3  PIC  Z(002) FROM  W-PEYD.
001290         04  COLUMN   6  PIC  9(004) FROM  Y-TCD.
001300         04  COLUMN  11  PIC  N(015) FROM  W-TNA1.
001310         04  COLUMN  42  PIC  X(001) FROM  W-OC.
001320         04  COLUMN  44  PIC  X(008) FROM  W-MAND.
001330         04  COLUMN  53  PIC ZZZZ,ZZZ,ZZZ  FROM Y-KIN.
001340       03  D-ZAN   COLUMN  66  PIC ZZZZ,ZZZ,ZZZ FROM  W-ZAN.
001350     02  LINE W-L2.
001360       03  D-D2.
001370*****    04  COLUMN  18  PIC  N(009) FROM  W-TNA2.                D.020424
001380         04  COLUMN  14  PIC  N(011) FROM  W-TNA2.                I.020424
001390         04  COLUMN  36  PIC  X(005) FROM  W-URA.
001400     02  LINE  23.
001410       03  D-NM    COLUMN  21  PIC  X(038) VALUE
001420            "[  NEXT PAGE = ﾘﾀｰﾝ  END = BSKIP     ]".
001430       03  D-EM    COLUMN 42   PIC  X(017) VALUE
001440            "[  END DATA     ]".
001450 01  C-ERR.
001460     02  LINE  24.
001470       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
001480            "***  BANKM ﾅｼ  ***".
001490       03  E-ME2   COLUMN  15  PIC  X(017) VALUE
001500            "***  DATA ﾅｼ  ***".
001510       03  E-ME3   COLUMN  15  PIC  X(018) VALUE
001520            "***  UKETM ﾅｼ  ***".
001530       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
001540       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
001550       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001560            "                                                  ".
001570     COPY LIBSCR.
001580 PROCEDURE DIVISION.
001590 M-05.
001600     COPY LIBCPR.
001610     MOVE ZERO TO W-SNG.                                          I.970917
001620     MOVE D-NTNG TO W-SNGS.                                       I.970917
001630     IF W-SNEN2 >= DATE-NF1 AND <= DATE-NT1                       I.970917
001640         ADD DATE-NC1 TO W-SNEN.                                  I.970917
001650     IF W-SNEN2 >= DATE-NF2 AND <= DATE-NT2                       I.970917
001660         ADD DATE-NC2 TO W-SNEN.                                  I.970917
001670     COMPUTE W-NEN = W-SNEN - DATE-YC1.                           I.970917
001680     MOVE W-SGET TO W-GET.                                        I.970917
001690*****MOVE D-NTNG TO W-NG.                                         D.970917
001700*****SUBTRACT 88 FROM W-NEN.                                      D.970917
001710*
001720     DISPLAY C-CLEAR.
001730     CALL "CBLSTNNO" USING STN-NO.                                I.960112
001740     MOVE STN-NO2 TO W-FID2.                                      I.960112
001750*****MOVE W-FID TO WK0085ID.                                      D.970602
001760     MOVE W-FID TO WK0064ID.                                      I.970602
001770     OPEN INPUT T-M.
001780     OPEN INPUT BANK-M.
001790     OPEN INPUT UKET-M.
001800 M-10.
001810     CALL "SCTT21".
001820     DISPLAY D-DATE.
001830     ACCEPT A-YBK.
001840     IF ESTAT = PF9
001850         GO TO M-95.
001860     IF ESTAT NOT = HTB
001870         GO TO M-10.
001880     MOVE W-YBK TO B-KEY.
001890     READ BANK-M WITH UNLOCK INVALID KEY
001900         DISPLAY E-ME1 E-ME98
001910         GO TO M-10.
001920     DISPLAY D-BK.
001930     IF B-YBC = ZERO
001940         GO TO M-10.
001950     MOVE B-ZYZ TO W-ZAN.
001960     IF W-ZAN = ZERO
001970         MOVE 4 TO W-L1
001980       ELSE
001990         MOVE 5 TO W-L1
002000         DISPLAY D-ZAN.
002010     OPEN INPUT YRIT-F.
002020 M-15.
002030     READ YRIT-F AT END
002040         DISPLAY E-ME2 E-ME99
002050         CLOSE YRIT-F
002060         GO TO M-10.
002070     IF W-YBK NOT = Y-YBK
002080         GO TO M-15.
002090     MOVE ZERO TO W-PEY.
002100 M-20.
002110     MOVE Y-IDO3 TO W-PEY W-PEYD.
002120 M-25.
002130     MOVE SPACE TO W-TNA.
002140     MOVE Y-NO TO UT-KEY.
002150     READ UKET-M WITH UNLOCK INVALID KEY
002160         MOVE NC"　＊＊　　ＵＫＥＴＭ　無し　　＊＊＊" TO W-TNA
002170         GO TO M-30.
002180     IF UT-FDM NOT = SPACE
002190         MOVE UT-FDM TO W-TNA
002200         MOVE "(ｳﾗﾃ)" TO W-URA
002210         GO TO M-30.
002220     MOVE SPACE TO W-URA.
002230     MOVE UT-TCD TO T-KEY.
002240     READ T-M WITH UNLOCK INVALID KEY
002250         MOVE NC"＊＊　　得意先　無し　　＊＊" TO T-NAME.
002260     MOVE T-NAME TO W-TNA.
002270 M-30.
002280     IF Y-KBN = 11
002290         MOVE "ﾔ" TO W-OC.
002300     IF Y-KBN = 12
002310         MOVE "ﾀ" TO W-OC.
002320     IF Y-FUC = 1
002330         MOVE NC"＜戻し＞" TO W-MANM
002340         SUBTRACT Y-KIN FROM W-ZAN
002350         GO TO M-35.
002360     IF Y-FUC = 9
002370         MOVE NC"＜不渡＞" TO W-MANM
002380         SUBTRACT Y-KIN FROM W-ZAN
002390         GO TO M-35.
002400     IF Y-MAN = 999999
002410         MOVE SPACE TO W-MAND
002420         SUBTRACT Y-KIN FROM W-ZAN
002430       ELSE
002440         MOVE Y-MAN TO W-MAN
002450         ADD Y-KIN TO W-ZAN.
002460 M-35.
002470     ADD 2 TO W-L1.
002480     COMPUTE W-L2 = W-L1 + 1.
002490     IF W-L1 < 21
002500         DISPLAY D-D1 D-D2
002510         GO TO M-45.
002520 M-40.
002530     DISPLAY D-NM.
002540     ACCEPT A-DMM.
002550     IF ESTAT = BTB
002560         CLOSE YRIT-F
002570         GO TO M-10.
002580     IF ESTAT NOT = HTB
002590         GO TO M-40.
002600     CALL "SCTT21".
002610     DISPLAY D-DATE D-BK.
002620     MOVE 5 TO W-L1.
002630     COMPUTE W-L2 = W-L1 + 1.
002640     MOVE W-PEY TO W-PEYD.
002650     DISPLAY D-D1 D-D2.
002660 M-45.
002670     READ YRIT-F AT END
002680         GO TO M-50.
002690     IF W-YBK NOT = Y-YBK
002700         GO TO M-50.
002710     IF Y-IDO3 NOT = W-PEY
002720         DISPLAY D-ZAN
002730         GO TO M-20.
002740     MOVE ZERO TO W-PEYD.
002750     GO TO M-25.
002760 M-50.
002770     DISPLAY D-ZAN D-EM.
002780     ACCEPT A-DMM.
002790     CLOSE YRIT-F.
002800     GO TO M-10.
002810 M-95.
002820     CLOSE T-M.
002830     CLOSE BANK-M.
002840     CLOSE UKET-M.
002850     DISPLAY C-CLEAR.
002860     STOP RUN.
