000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. TSG720.
000030*******************************************
000040*****    振替伝票（支払手形決済）     *****
000050*****        ( FDL = FTG710 )         *****
000060*******************************************
000070 AUTHOR. S-NAKAO.
000080 DATE-WRITTEN. '78-03-29.
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT BANK-M ASSIGN TO BANK-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY B-KEY.
000200     SELECT S-M ASSIGN TO S-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE RANDOM
000230         RECORD KEY S-KEY.
000240     SELECT SHIT-F ASSIGN TO SHIT-MSD.
000250     SELECT SP-F ASSIGN TO P-PRN999-FTG710.
000260 I-O-CONTROL.
000270     APPLY SHARED-MODE ON M-DATE
000280     APPLY SHARED-MODE ON S-M
000290     APPLY SHARED-MODE ON BANK-M
000300     APPLY SHIFT-CODE  ON SP-F.
000310 DATA DIVISION.
000320 FILE SECTION.
000330     COPY LIBFDD.
000340     COPY LIBANK.
000350     COPY LSSHIT.
000360     COPY LISM.
000370 FD  SP-F
000380     LABEL RECORD IS OMITTED
000390     LINAGE IS 24 LINES.
000400 01  SP-R               PIC  X(170).
000410 WORKING-STORAGE SECTION.
000420*77  WK0170ID           PIC  X(009) VALUE SPACE.                  D.970602
000430 77  WK0128ID           PIC  X(009) VALUE SPACE.                  I.970602
000440 01  STN-NO.                                                      I.960113
000450     02  STN-NO1        PIC  X(003).                              I.960113
000460     02  STN-NO2        PIC  X(003).                              I.960113
000470 01  W-FID.                                                       I.960113
000480*****02  W-FID1         PIC  X(006) VALUE "WK0170".               D.970602
000490     02  W-FID1         PIC  X(006) VALUE "WK0128".               I.970602
000500     02  W-FID2         PIC  X(003).                              I.960113
000510 01  HEAD1.
000520     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000530     02  F              PIC  X(008) VALUE ""3F504F40677F4F9B"".
000540     02  F              PIC  X(041) VALUE SPACE.
000550     02  F              PIC  N(008) VALUE NC"　振　替　伝　票".
000560     02  F              PIC  X(033) VALUE SPACE.
000570     02  F              PIC  X(008) VALUE ""3F504F40674F40A0"".
000580     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000590 01  HEAD2.
000600     02  F              PIC  X(040) VALUE SPACE.
000610     02  F              PIC  N(002) VALUE NC"平成".
000620     02  F              PIC  X(002) VALUE SPACE.
000630     02  H-NEN          PIC  N(002).
000640     02  F              PIC  N(001) VALUE NC"年".
000650     02  F              PIC  X(001) VALUE SPACE.
000660     02  H-GET          PIC  N(002).
000670     02  F              PIC  N(001) VALUE NC"月".
000680     02  F              PIC  X(001) VALUE SPACE.
000690     02  H-PEY          PIC  N(002).
000700     02  F              PIC  N(001) VALUE NC"日".
000710     02  F              PIC  X(019) VALUE SPACE.
000720     02  F              PIC  N(001) VALUE NC"№".
000730     02  F              PIC  X(007) VALUE SPACE.
000740     02  H-PAGE         PIC Z9.
000750     02  F              PIC  X(002) VALUE SPACE.
000760 01  HEAD3.
000770     02  F              PIC  X(014) VALUE SPACE.
000780     02  F              PIC  N(005) VALUE NC"科　目　名".
000790     02  F              PIC  X(004) VALUE SPACE.
000800     02  F              PIC  N(001) VALUE NC"金".
000810     02  F              PIC  X(003) VALUE SPACE.
000820     02  F              PIC  N(001) VALUE NC"額".
000830     02  F              PIC  X(010) VALUE SPACE.
000840     02  F              PIC  N(001) VALUE NC"摘".
000850     02  F              PIC  X(010) VALUE SPACE.
000860     02  F              PIC  N(001) VALUE NC"要".
000870     02  F              PIC  X(011) VALUE SPACE.
000880     02  F              PIC  N(005) VALUE NC"科　目　名".
000890     02  F              PIC  X(004) VALUE SPACE.
000900     02  F              PIC  N(001) VALUE NC"金".
000910     02  F              PIC  X(003) VALUE SPACE.
000920     02  F              PIC  N(001) VALUE NC"額".
000930     02  F              PIC  X(007) VALUE SPACE.
000940 01  HEAD9.
000950     02  F              PIC  X(005) VALUE ""3FE04F40A0"".
000960     02  F              PIC  X(043) VALUE SPACE.
000970     02  F              PIC  N(016) VALUE
000980          NC"日　進　ゴ　ム　株　式　会　社　".
000990     02  F              PIC  X(031) VALUE SPACE.
001000     02  F              PIC  X(005) VALUE ""3FE04FE080"".
001010 01  W-PD.
001020     02  F              PIC  X(005) VALUE ""3FE04F40A0"".
001030     02  F              PIC  X(092) VALUE SPACE.
001040     02  P-IM           PIC  N(004).
001050     02  F              PIC  X(005) VALUE ""3FE04FE080"".
001060 01  W-P1.
001070     02  P1-15K         PIC  X(005).
001080     02  F              PIC  X(037).
001090     02  P-NA1          PIC  N(020).
001100     02  F              PIC  X(002).
001110     02  P-NA2          PIC  N(008).
001120     02  F              PIC  X(017).
001130     02  P1-20K         PIC  X(005).
001140 01  W-P2.
001150     02  P2-15K         PIC  X(005).
001160     02  F              PIC  X(013).
001170     02  P-KMK1         PIC  N(008).
001180     02  F              PIC  X(001).
001190     02  P-KIN1         PIC ZZZZZZZZZ9.
001200     02  F              PIC  X(001).
001210     02  P-GET          PIC Z9.
001220     02  P-VER          PIC  X(001).
001230     02  P-PEY          PIC Z9.
001240     02  F              PIC  X(001).
001250     02  P-D1           PIC  N(004).
001260     02  F              PIC  X(005).
001270     02  P-D2           PIC  N(008).
001280     02  F              PIC  X(003).
001290     02  P-KMK2         PIC  N(008).
001300     02  F              PIC  X(001).
001310     02  P-KIN2         PIC ZZZZZZZZZ9.
001320     02  F              PIC  X(006).
001330     02  P2-20K         PIC  X(005).
001340 01  W-DATA.
001350*****02  W-SNG          PIC  9(004).                              D.970916
001360     02  W-SNG          PIC  9(006).                              I.970916
001370     02  W-SNGD  REDEFINES W-SNG.
001380*****  03  W-SNEN       PIC  9(002).                              D.970916
001390       03  W-SNEN       PIC  9(004).                              I.970916
001400       03  W-SNENL REDEFINES W-SNEN.                              I.970916
001410         04  W-SNEN1    PIC  9(002).                              I.970916
001420         04  W-SNEN2    PIC  9(002).                              I.970916
001430       03  W-SGET       PIC  9(002).
001440     02  W-SNGL  REDEFINES W-SNG.                                 I.970916
001450       03  F            PIC  9(002).                              I.970916
001460       03  W-SNGS       PIC  9(004).                              I.970916
001470     02  W-WNG          PIC  9(004).
001480     02  W-WNGD  REDEFINES W-WNG.
001490       03  W-WNEN       PIC  9(002).
001500       03  W-WGET       PIC  9(002).
001510     02  W-PEY          PIC  9(002).
001520     02  W-HNGP.
001530       03  W-HNEN       PIC Z9.
001540       03  W-HGET       PIC Z9.
001550       03  W-HPEY       PIC Z9.
001560     02  W-BKC          PIC  9(004).
001570     02  W-KIN          PIC  9(010).
001580     02  W-TCD          PIC  9(004).
001590     02  W-PAGE         PIC  9(002).
001600     02  W-DMM          PIC  9(001).
001610     02  W-TC           PIC  9(001).
001620     02  CHK            PIC  9(001).
001630     02  CNT            PIC  9(001).
001640     COPY LSTAT.
001650 SCREEN SECTION.
001660 SD  C-CRT
001670     END STATUS IS ESTAT.
001680 01  C-CLEAR.
001690     02  LINE   1 CLEAR SCREEN.
001700 01  C-MID.
001710     02  LINE   3 COLUMN  10  PIC  N(023) VALUE
001720          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001730     02  LINE   4 COLUMN  10  PIC  N(023) VALUE
001740          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001750     02  LINE   5 COLUMN  10  PIC  N(023) VALUE
001760          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001770     02  LINE   6 COLUMN  10  PIC  N(023) VALUE
001780          NC"＊＊＊　　　振替伝票　（支手決済）　　　＊＊＊".
001790     02  LINE   7 COLUMN  10  PIC  N(023) VALUE
001800          NC"＊＊＊　　　　　　　　　　　　　　　　　＊＊＊".
001810     02  LINE   8 COLUMN  10  PIC  N(023) VALUE
001820          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001830     02  LINE   9 COLUMN  10  PIC  N(023) VALUE
001840          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001850     02  LINE  12 COLUMN  22  PIC  X(022) VALUE
001860          "【  H.  年   月 分  】".
001870     02  LINE  14 COLUMN  15  PIC  X(036) VALUE
001880          "[   ﾃｽﾄ ﾌﾟﾘﾝﾄ  ｽﾙ=9 ｼﾅｲ=1   ﾘﾀｰﾝ   ]".
001890     02  LINE  20 COLUMN  22  PIC  X(022) VALUE
001900          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001910 01  C-ACP.
001920     02  A-TC    LINE  14 COLUMN  42  PIC  9(001)
001930          USING W-TC    CHECK OVERFLOW NO IFC.
001940     02  A-DMM   LINE  20 COLUMN  39  PIC  9(001)
001950          USING W-DMM   CHECK OVERFLOW NO IFC.
001960 01  C-DSP.
001970     02  D-NG    LINE 12.
001980       03  COLUMN  28  PIC Z9 FROM  W-WNEN.                       I.970916
001990       03  COLUMN  33  PIC Z9 FROM  W-WGET.                       I.970916
002000*****  03  COLUMN  28  PIC Z9 FROM  W-SNEN.                       D.970916
002010*****  03  COLUMN  33  PIC Z9 FROM  W-SGET.                       D.970916
002020 01  C-ERR.
002030     02  LINE 24.
002040       03  E-ME1   COLUMN  15  PIC  X(018) VALUE
002050            "***  BANKM ﾅｼ  ***".
002060       03  E-ME2   COLUMN  15  PIC  X(015) VALUE
002070            "***  SM ﾅｼ  ***".
002080       03  E-BKC   COLUMN  40  PIC  9(004) FROM  ST-BCD.
002090       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
002100       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
002110     COPY LIBSCR.
002120 PROCEDURE DIVISION.
002130 M-05.
002140     DISPLAY C-CLEAR.
002150     DISPLAY C-MID.
002160     COPY LIBCPR.
002170*****MOVE D-NTNG TO W-SNG.                                        D.970916
002180*****SUBTRACT 88 FROM W-SNEN.                                     D.970916
002190     MOVE ZERO TO W-SNG W-WNG.                                    I.970916
002200     MOVE D-NTNG TO W-SNGS.                                       I.970916
002210     IF W-SNEN2 >= DATE-NF1 AND <= DATE-NT1                       I.970916
002220         ADD DATE-NC1 TO W-SNEN.                                  I.970916
002230     IF W-SNEN2 >= DATE-NF2 AND <= DATE-NT2                       I.970916
002240         ADD DATE-NC2 TO W-SNEN.                                  I.970916
002250     COMPUTE W-WNEN = W-SNEN - DATE-YC1.                          I.970916
002260     MOVE W-SGET TO W-WGET.                                       I.970916
002270     DISPLAY D-NG.
002280*****MOVE W-SNG TO W-WNG.                                         D.970916
002290*****ADD 63 TO W-WNEN.                                            D.970916
002300     MOVE SPACE TO W-P2.
002310     MOVE W-15K TO P2-15K.
002320     MOVE W-20K TO P2-20K.
002330     MOVE ALL NC"Ｎ" TO P-KMK1 P-KMK2 P-D1 P-D2.
002340     MOVE 999999999 TO P-KIN1 P-KIN2.
002350     MOVE 99 TO H-NEN H-GET H-PEY H-PAGE P-GET P-PEY.
002360     MOVE "/" TO P-VER.
002370     MOVE ZERO TO CNT W-PAGE.
002380     OPEN OUTPUT SP-F.
002390 M-10.
002400     ACCEPT A-TC.
002410     IF ESTAT NOT = HTB AND SKP
002420         GO TO M-10.
002430     IF W-TC = 1
002440         GO TO M-15.
002450     IF W-TC NOT = 9
002460         GO TO M-10.
002470     IF CNT = ZERO
002480         PERFORM S-10 THRU S-15.
002490     MOVE SPACE TO SP-R.
002500     MOVE W-P2 TO SP-R.
002510     WRITE SP-R AFTER 2.
002520     MOVE SPACE TO SP-R.
002530     ADD 1 TO CNT.
002540     IF CNT = 6
002550         MOVE SPACE TO SP-R
002560         WRITE SP-R AFTER PAGE
002570         MOVE ZERO TO CNT.
002580     GO TO M-10.
002590 M-15.
002600     ACCEPT A-DMM.
002610     IF ESTAT = BTB
002620         GO TO M-10.
002630     IF ESTAT NOT = HTB AND SKP
002640         GO TO M-15.
002650     IF W-DMM = 9
002660         CLOSE SP-F
002670         DISPLAY C-CLEAR
002680         STOP RUN.
002690     IF W-DMM NOT = 1
002700         GO TO M-15.
002710*
002720     IF CNT NOT = ZERO
002730         MOVE SPACE TO SP-R
002740         WRITE SP-R AFTER PAGE
002750         MOVE ZERO TO CNT.
002760     MOVE ZERO TO CHK.
002770     CALL "CBLSTNNO" USING STN-NO.                                I.960113
002780     MOVE STN-NO2 TO W-FID2.                                      I.960113
002790*****MOVE W-FID TO WK0170ID.                                      D.970602
002800     MOVE W-FID TO WK0128ID.                                      I.970602
002810     OPEN INPUT BANK-M S-M.
002820     OPEN INPUT SHIT-F.
002830 M-20.
002840     READ SHIT-F AT END
002850         GO TO M-95.
002860*****IF ST-MNG NOT = W-SNG AND W-WNG                              D.970916
002870     IF (ST-SNM NOT = W-SNEN) OR (ST-MKG NOT = W-SGET)            I.970916
002880         GO TO M-20.
002890     IF ST-SKC NOT = ZERO
002900         GO TO M-20.
002910 M-25.
002920     MOVE ZERO TO W-PAGE.
002930     MOVE ST-MKP TO W-PEY.
002940*****MOVE W-SNEN TO W-HNEN.                                       D.970916
002950*****MOVE W-SGET TO W-HGET.                                       D.970916
002960     MOVE W-WNEN TO W-HNEN.                                       I.970916
002970     MOVE W-WGET TO W-HGET.                                       I.970916
002980     MOVE W-PEY TO W-HPEY.
002990     MOVE ST-BCD TO W-BKC.
003000     MOVE W-BKC TO B-KEY.
003010     READ BANK-M WITH UNLOCK INVALID KEY
003020         DISPLAY E-ME1 E-BKC E-ME99
003030         GO TO M-95.
003040     IF CHK = ZERO
003050         MOVE 5 TO CHK
003060         PERFORM S-10 THRU S-15
003070       ELSE
003080         PERFORM S-05 THRU S-15.
003090     MOVE ZERO TO W-KIN.
003100 M-30.
003110     MOVE ST-TCD TO W-TCD.
003120     MOVE W-TCD TO S-KEY.
003130     READ S-M WITH UNLOCK INVALID KEY
003140         MOVE SPACE TO S-NAME
003150         MOVE W-TCD TO S-NAME.
003160     PERFORM S-20 THRU S-30.
003170 M-45.
003180     MOVE SPACE TO W-P2.
003190     MOVE W-15K TO P2-15K.
003200     MOVE W-20K TO P2-20K.
003210     MOVE SPACE TO P-KMK1 P-KMK2 P-D1 P-D2.
003220     MOVE NC"支　払　手　形　" TO P-KMK1.
003230     MOVE NC"当　座　預　金　" TO P-KMK2.
003240     MOVE ST-KIN TO P-KIN1 P-KIN2.
003250*****MOVE W-SGET TO P-GET.                                        D.970916
003260     MOVE W-WGET TO P-GET.                                        I.970916
003270     MOVE "/" TO P-VER.
003280     MOVE W-PEY TO P-PEY.
003290     MOVE NC"為替手形" TO P-D1.
003300     MOVE NC"支　手　決　済　" TO P-D2.
003310     IF CNT NOT = 6
003320         GO TO M-50.
003330     MOVE SPACE TO SP-R.
003340     MOVE HEAD9 TO SP-R.
003350     WRITE SP-R AFTER 4.
003360     MOVE SPACE TO SP-R.
003370     PERFORM S-05 THRU S-15.
003380     PERFORM S-20 THRU S-30.
003390 M-50.
003400     PERFORM S-45 THRU S-50.
003410     MOVE SPACE TO SP-R.
003420     MOVE W-P2 TO SP-R.
003430     WRITE SP-R.
003440     MOVE SPACE TO SP-R.
003450     ADD ST-KIN TO W-KIN.
003460     ADD 1 TO CNT.
003470 M-55.
003480     READ SHIT-F AT END
003490         GO TO M-90.
003500*****IF ST-MNG NOT = W-SNG AND W-WNG                              D.970916
003510     IF (ST-SNM NOT = W-SNEN) OR (ST-MKG NOT = W-SGET)            I.970916
003520         GO TO M-55.
003530     IF ST-SKC NOT = ZERO
003540         GO TO M-55.
003550     IF ST-MKP NOT = W-PEY
003560         GO TO M-60.
003570     IF ST-BCD NOT = W-BKC
003580         GO TO M-60.
003590     IF ST-TCD = W-TCD
003600         GO TO M-45.
003610     GO TO M-30.
003620 M-60.
003630     PERFORM S-35 THRU S-40.
003640     GO TO M-25.
003650 M-90.
003660     PERFORM S-35 THRU S-40.
003670 M-95.
003680     CLOSE S-M.
003690     CLOSE BANK-M.
003700     CLOSE SHIT-F.
003710     CLOSE SP-F.
003720     DISPLAY C-CLEAR.
003730     STOP RUN.
003740 S-05.
003750     MOVE SPACE TO SP-R.
003760     WRITE SP-R AFTER PAGE.
003770 S-10.
003780     ADD 1 TO W-PAGE.
003790     MOVE W-HNEN TO H-NEN.
003800     MOVE W-HGET TO H-GET.
003810     MOVE W-HPEY TO H-PEY.
003820     MOVE W-PAGE TO H-PAGE.
003830     MOVE SPACE TO SP-R.
003840     MOVE HEAD1 TO SP-R.
003850     WRITE SP-R.
003860     MOVE SPACE TO SP-R.
003870     MOVE HEAD2 TO SP-R.
003880     WRITE SP-R AFTER 2.
003890     MOVE SPACE TO SP-R.
003900     MOVE NC"承認印　" TO P-IM.
003910     MOVE W-PD TO SP-R.
003920     WRITE SP-R AFTER 2.
003930     MOVE SPACE TO SP-R.
003940     MOVE HEAD3 TO SP-R.
003950     WRITE SP-R.
003960     MOVE SPACE TO SP-R.
003970     MOVE ZERO TO CNT.
003980 S-15.
003990     EXIT.
004000 S-20.
004010     MOVE SPACE TO W-P1.
004020     MOVE W-15K TO P1-15K.
004030     MOVE W-20K TO P1-20K.
004040     MOVE S-NAME TO P-NA1.
004050     MOVE B-BNA TO P-NA2.
004060     IF CNT < 5
004070         GO TO S-25.
004080     PERFORM S-45 THRU S-50.
004090     MOVE SPACE TO SP-R.
004100     MOVE HEAD9 TO SP-R.
004110     IF CNT = 6
004120         WRITE SP-R AFTER 3
004130       ELSE
004140         WRITE SP-R AFTER 5.
004150     MOVE SPACE TO SP-R.
004160     PERFORM S-05 THRU S-15.
004170 S-25.
004180     PERFORM S-45 THRU S-50.
004190     MOVE SPACE TO SP-R.
004200     MOVE W-P1 TO SP-R.
004210     WRITE SP-R.
004220     MOVE SPACE TO SP-R.
004230     ADD 1 TO CNT.
004240 S-30.
004250     EXIT.
004260 S-35.
004270     IF CNT = 6
004280         MOVE SPACE TO W-P2
004290         MOVE W-15K TO P2-15K
004300         MOVE W-20K TO P2-20K
004310         MOVE SPACE TO P-KMK1 P-KMK2 P-D1 P-D2
004320         MOVE W-KIN TO P-KIN1 P-KIN2
004330         MOVE SPACE TO SP-R
004340         MOVE W-P2 TO SP-R
004350         WRITE SP-R AFTER 2
004360         MOVE SPACE TO SP-R
004370         MOVE HEAD9 TO SP-R
004380         WRITE SP-R AFTER 2
004390         MOVE SPACE TO SP-R
004400         GO TO S-40.
004410     PERFORM S-45 THRU S-50.
004420     MOVE SPACE TO SP-R.
004430     WRITE SP-R.
004440     ADD 1 TO CNT.
004450     GO TO S-35.
004460 S-40.
004470     EXIT.
004480 S-45.
004490     MOVE SPACE TO P-IM.
004500     IF CNT = 1
004510         MOVE NC"検　印　" TO P-IM.
004520     IF CNT = 3
004530         MOVE NC"記帳印　" TO P-IM.
004540     IF CNT = 5
004550         MOVE NC"入力印　" TO P-IM.
004560     MOVE SPACE TO SP-R.
004570     MOVE W-PD TO SP-R.
004580     WRITE SP-R.
004590     MOVE SPACE TO SP-R.
004600 S-50.
004610     EXIT.
