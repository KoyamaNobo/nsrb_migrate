000010 IDENTIFICATION      DIVISION.
000020 PROGRAM-ID.         YFDEL1.
000030 AUTHOR.             H.KAMASAKA    1996-04-02.
000040 ENVIRONMENT         DIVISION.
000050 CONFIGURATION       SECTION.
000060 SOURCE-COMPUTER.    SYSTEM3100.
000070 OBJECT-COMPUTER.    SYSTEM3100.
000080 INPUT-OUTPUT        SECTION.
000090 FILE-CONTROL.
000100     SELECT  NBK-YR    ASSIGN  TO  NBK-MSD.
000110     SELECT  NYUR-YR   ASSIGN  TO  NYUR-MSD.
000120     SELECT  STRAN-YR  ASSIGN  TO  STRAN-MSD.
000130     SELECT  SU-YR     ASSIGN  TO  SU-MSD.
000140     SELECT  JSSR-YR   ASSIGN  TO  JSSR-MSD.
000150     SELECT  DATE-M    ASSIGN  TO  DATE-MSD
000160         ORGANIZATION  INDEXED
000170         ACCESS  MODE  DYNAMIC
000180         RECORD  KEY   D-KEY
000190         FILE  STATUS  IS  ERR-STAT.
000200     SELECT  WK0128-M  ASSIGN  TO  WK0128-MSD.
000210 I-O-CONTROL.
000220     APPLY  SHARED-MODE  ON  DATE-M.
000230 DATA                DIVISION.
000240 FILE                SECTION.
000250 FD  NBK-YR
000260     BLOCK  4  RECORDS
000270     LABEL  RECORD  IS  STANDARD
000280     VALUE  OF  IDENTIFICATION  "NBKYR".
000290 01  NBK-R.
000300     02  NBK-YM              PIC 9(004).
000310     02  FILLER              PIC X(060).
000320 FD  NYUR-YR
000330     BLOCK  6  RECORDS
000340     LABEL  RECORD  IS  STANDARD
000350     VALUE  OF  IDENTIFICATION  "NYURYR".
000360 01  NYUR-R.
000370     02  NYUR-YM             PIC 9(004).
000380     02  FILLER              PIC X(038).
000390 FD  STRAN-YR
000400     BLOCK  2  RECORDS
000410     LABEL  RECORD  IS  STANDARD
000420     VALUE  OF  IDENTIFICATION  "STRANYR".
000430 01  STRAN-R.
000440     02  STRAN-YM            PIC 9(004).
000450     02  FILLER              PIC X(124).
000460 FD  SU-YR
000470     BLOCK  4  RECORDS
000480     LABEL  RECORD  IS  STANDARD
000490     VALUE  OF  IDENTIFICATION  "SUYR".
000500 01  SU-R.
000510     02  FILLER              PIC X(007).
000520     02  SU-YM               PIC 9(004).
000530     02  FILLER              PIC X(053).
000540 FD  JSSR-YR
000550     BLOCK  5  RECORDS
000560     LABEL  RECORD  IS  STANDARD
000570     VALUE  OF  IDENTIFICATION  "JSSRYR".
000580 01  JSSR-R.
000590     02  FILLER              PIC X(002).
000600     02  JSSR-YM             PIC 9(004).
000610     02  FILLER              PIC X(096).
000620 FD  DATE-M
000630     BLOCK  1  RECORDS
000640     LABEL  RECORD  IS  STANDARD
000650     VALUE  OF  IDENTIFICATION  "DATEM".
000660 01  DATE-R.
000670     02  D-KEY               PIC X(002).
000680     02  FILLER              PIC X(178).
000690     02  D-NFDD.
000700         03  D-Y             PIC 9(002).
000710         03  D-M             PIC 9(002).
000720     02  FILLER              PIC X(072).
000730 FD  WK0128-M
000740     BLOCK  2  RECORDS
000750     LABEL  RECORD  IS  STANDARD
000760     VALUE  OF  IDENTIFICATION  "WK0128".
000770 01  WK0128-R                PIC X(128).
000780 WORKING-STORAGE     SECTION.
000790 77  JS-SIGN                 PIC 9.
000800 01  W-DATA.
000810     02  W-YM.
000820         03  W-Y             PIC 9(002).
000830         03  W-M             PIC 9(002).
000840     02  W-DMM               PIC 9.
000850 01  W-STAT.
000860     02  HTB                 PIC X(002)    VALUE  "01".
000870     02  SKP                 PIC X(002)    VALUE  "06".
000880     02  BTB                 PIC X(002)    VALUE  "09".
000890     02  PF9                 PIC X(002)    VALUE  "P9".
000900     02  ERR-STAT            PIC X(002).
000910 SCREEN              SECTION.
000920 SD  C-CRT
000930     END  STATUS  IS  ESTAT.
000940 01  C-CLEAR.
000950     02  LINE   1    CLEAR  SCREEN.
000960 01  C-MID1.
000970     02  LINE   1    COLUMN  19    PIC N(018)    VALUE
000980           NC"＊＊＊　　ファイル　クリア　　＊＊＊".
000990     02  LINE  10    COLUMN  27    PIC X(025)    VALUE
001000             "  年   月までを削除します".
001010 01  C-MID2.
001020     02  LINE  22    COLUMN  29    PIC X(022)    VALUE
001030             "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001040 01  C-ACP.
001050     02  A-Y      LINE  10    COLUMN  27    PIC 9(002)
001060           USING  W-Y      CHECK  OVERFLOW  NO  IFC.
001070     02  A-M      LINE  10    COLUMN  32    PIC 9(002)
001080           USING  W-M      CHECK  OVERFLOW  NO  IFC.
001090     02  A-DMM    LINE  22    COLUMN  46    PIC 9
001100           USING  W-DMM    CHECK  OVERFLOW  NO  IFC.
001110 01  C-DSP.
001120     02  D-YY   LINE 10    COLUMN 27    PIC 9(002)    FROM  D-Y.
001130     02  D-MM   LINE 10    COLUMN 32    PIC 9(002)    FROM  D-M.
001140 01  C-ERR.
001150     02  LINE  24.
001160         03  E-STAT   COLUMN 10   PIC X(002)   FROM  ERR-STAT.
001170         03  E-ME98   COLUMN 75   PIC X(005)   VALUE ""27"J"05"".
001180         03  E-ME99   COLUMN 75   PIC X(005)   VALUE ""27"B"05"".
001190         03  E-CL.
001200             04  COLUMN   1    PIC X(040)    VALUE
001210                   "                                       ".
001220             04  COLUMN  41    PIC X(040)    VALUE
001230                   "                                       ".
001240 PROCEDURE           DIVISION.
001250 M-05.
001260     ACCEPT JS-SIGN.
001270     IF  JS-SIGN NOT = 1 AND 2 AND 3 AND 4 AND 5
001280         GO  TO  M-05.
001290     DISPLAY  C-CLEAR.
001300     DISPLAY  C-MID1.
001310     IF JS-SIGN NOT = 1
001320         GO  TO  M-25.
001330 M-10.
001340     DISPLAY  C-MID2.
001350     ACCEPT  A-Y.
001360     IF  ESTAT = PF9
001370         MOVE  255  TO  COMPLETION-CODE
001380         GO  TO  M-99.
001390     IF  ESTAT NOT = HTB AND SKP
001400         GO  TO  M-10.
001410 M-15.
001420     ACCEPT  A-M.
001430     IF  ESTAT = BTB
001440         GO  TO  M-10.
001450     IF  ESTAT NOT = HTB AND SKP
001460         GO  TO  M-15.
001470     IF  W-M > 12
001480         GO  TO  M-15.
001490 M-20.
001500     ACCEPT  A-DMM.
001510     IF  ESTAT = BTB
001520         GO  TO  M-15.
001530     IF  ESTAT NOT = HTB AND SKP
001540         GO  TO  M-20.
001550     IF  W-DMM = 9
001560         MOVE  255  TO  COMPLETION-CODE
001570         GO  TO  M-99.
001580     IF  W-DMM NOT = 1
001590         GO  TO  M-20.
001600     OPEN  I-O  DATE-M.
001610     MOVE  "01"  TO  D-KEY.
001620     READ  DATE-M   INVALID  KEY
001630         DISPLAY  E-ME98.
001640     MOVE  W-YM  TO  D-NFDD.
001650     REWRITE  DATE-R  INVALID  KEY
001660         DISPLAY  E-ME98.
001670     CLOSE  DATE-M.
001680     GO  TO  M-30.
001690 M-25.
001700     OPEN  INPUT  DATE-M.
001710     MOVE  "01"  TO  D-KEY.
001720     READ  DATE-M  WITH  UNLOCK  INVALID  KEY
001730         DISPLAY  E-ME98.
001740     CLOSE  DATE-M.
001750     DISPLAY  D-YY  D-MM.
001760     IF  JS-SIGN = 2
001770         GO  TO  M-40.
001780     IF  JS-SIGN = 3
001790         GO  TO  M-50.
001800     IF  JS-SIGN = 4
001810         GO  TO  M-60.
001820     IF  JS-SIGN = 5
001830         GO  TO  M-70.
001840 M-30.
001850     OPEN  INPUT   NBK-YR.
001860     OPEN  OUTPUT  WK0128-M.
001870 M-35.
001880     READ  NBK-YR  AT  END
001890         CLOSE  NBK-YR  WK0128-M
001900         GO  TO  M-99.
001910     IF  NBK-YM <= W-YM
001920         GO  TO  M-35.
001930     MOVE  NBK-R  TO  WK0128-R.
001940     WRITE  WK0128-R.
001950     GO  TO  M-35.
001960 M-40.
001970     OPEN  INPUT   NYUR-YR.
001980     OPEN  OUTPUT  WK0128-M.
001990 M-45.
002000     READ  NYUR-YR  AT  END
002010         CLOSE  NYUR-YR  WK0128-M
002020         GO  TO  M-99.
002030     IF  NYUR-YM <= D-NFDD
002040         GO  TO  M-45.
002050     MOVE  NYUR-R  TO  WK0128-R.
002060     WRITE  WK0128-R.
002070     GO  TO  M-45.
002080 M-50.
002090     OPEN  INPUT   STRAN-YR.
002100     OPEN  OUTPUT  WK0128-M.
002110 M-55.
002120     READ  STRAN-YR  AT  END
002130         CLOSE  STRAN-YR  WK0128-M
002140         GO  TO  M-99.
002150     IF  STRAN-YM <= D-NFDD
002160         GO  TO  M-55.
002170     MOVE  STRAN-R  TO  WK0128-R.
002180     WRITE  WK0128-R.
002190     GO  TO  M-55.
002200 M-60.
002210     OPEN  INPUT   SU-YR.
002220     OPEN  OUTPUT  WK0128-M.
002230 M-65.
002240     READ  SU-YR  AT  END
002250         CLOSE  SU-YR  WK0128-M
002260         GO  TO  M-99.
002270     IF  SU-YM <= D-NFDD
002280         GO  TO  M-65.
002290     MOVE  SU-R  TO  WK0128-R.
002300     WRITE  WK0128-R.
002310     GO  TO  M-65.
002320 M-70.
002330     OPEN  INPUT   JSSR-YR.
002340     OPEN  OUTPUT  WK0128-M.
002350 M-75.
002360     READ  JSSR-YR  AT  END
002370         CLOSE  JSSR-YR  WK0128-M
002380         GO  TO  M-99.
002390     IF  JSSR-YM <= D-NFDD
002400         GO  TO  M-75.
002410     MOVE  JSSR-R  TO  WK0128-R.
002420     WRITE  WK0128-R.
002430     GO  TO  M-75.
002440 M-99.
002450     DISPLAY  C-CLEAR
002460     STOP  RUN.
