000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KBT650.
000030*********************************************************
000040*    PROGRAM         :  工品材料仕入明細問合せ          *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  ******                          *
000070*        変更　　　  :  62/06/10                        *
000080*    COMPILE TYPE    :  COBOL                           *
000090*    JS-SIGN         :  全件=0,工品=1                   *
000100*********************************************************
000110 ENVIRONMENT DIVISION.
000120 CONFIGURATION SECTION.
000130 SOURCE-COMPUTER. SYSTEM3100.
000140 OBJECT-COMPUTER. SYSTEM3100.
000150 INPUT-OUTPUT SECTION.
000160 FILE-CONTROL.
000170     COPY LIBCSE.
000180     SELECT JT-M ASSIGN TO JT-MSD
000190         ORGANIZATION INDEXED
000200         ACCESS MODE DYNAMIC
000210         RECORD KEY JT-KEY
000220         FILE STATUS IS ERR-STAT.
000230     SELECT J-M ASSIGN TO J-MSD
000240         ORGANIZATION INDEXED
000250         ACCESS MODE DYNAMIC
000260         RECORD KEY J-KEY
000270         FILE STATUS IS ERR-STAT.
000280 I-O-CONTROL.
000290     APPLY SHARED-MODE ON M-DATE
000300     APPLY SHARED-MODE ON J-M
000310     APPLY SHARED-MODE ON JT-M.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIBFDD.
000350     COPY LIJM.
000360     COPY LIJTM.
000370 WORKING-STORAGE SECTION.
000380 77  JS-SIGN          PIC  9(001).
000390 01  W-DATA.
000400     02  W-SIGN       PIC  N(004).
000410     02  W-NG.
000420       03  W-NEN      PIC  9(002).
000430       03  W-GET      PIC  9(002).
000440     02  W-JCD        PIC  9(006).
000450     02  W-DMM        PIC  9(001).
000460     02  W-END        PIC  9(001).
000470     02  W-T          PIC S9(006)V9(02).
000480     02  W-L1         PIC  9(002).
000490     02  W-L2         PIC  9(002).
000500 01  ERR-STAT         PIC  X(002).
000510     COPY LSTAT.
000520 SCREEN SECTION.
000530 SD  C-CRT
000540     END STATUS IS ESTAT.
000550 01  C-CLEAR.
000560     02  C-CL    LINE   1  CLEAR SCREEN.
000570 01  C-MID.
000580     02  LINE   1.
000590       03  COLUMN   1  PIC  N(004) FROM  W-SIGN.
000600       03  COLUMN  21  PIC  N(020) VALUE
000610            NC"＊＊＊　　材料仕入明細　問合せ　　＊＊＊".
000620       03  COLUMN  72  PIC  9(002) FROM  W-NEN.
000630       03  COLUMN  74  PIC  N(001) VALUE NC"年".
000640       03  COLUMN  76  PIC Z9      FROM  W-GET.
000650       03  COLUMN  78  PIC  N(001) VALUE NC"月".
000660     02  LINE   2  COLUMN   3  PIC  X(020) VALUE
000670          "ｺｰﾄﾞ  材　　料　　名".
000680     02  LINE   3  COLUMN  51  PIC  X(029) VALUE
000690          "数　量     単　価      金　額".
000700     02  LINE  23  COLUMN  31  PIC  X(035) VALUE
000710          "NEXT=ﾘﾀｰﾝ , 入力=F10 , 終了=F9     ".
000720 01  C-ACP.
000730     02  A-JCD   LINE   4  COLUMN   2  PIC  9(006)
000740           USING W-JCD   CHECK OVERFLOW NO IFC.
000750     02  A-DMM   LINE  23  COLUMN  65  PIC  9(001)
000760           USING W-DMM   CHECK OVERFLOW NO IFC.
000770 01  C-DSP.
000780     02  D-MEI.
000790       03  LINE W-L1.
000800         04  COLUMN   2  PIC  9(006) FROM  J-JCD.
000810         04  COLUMN   9  PIC  N(024) FROM  J-NAME.
000820       03  LINE W-L2.
000830         04  COLUMN  44  PIC --,---,--9.99  FROM  JT-SSU.
000840         04  COLUMN  57  PIC ----,--9.99    FROM  W-T.
000850         04  COLUMN  68  PIC ----,---,--9   FROM  JT-SIK.
000860 01  C-ERR.
000870     02  LINE  24.
000880       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
000890            "***  DATA ﾅｼ  ***".
000900       03  E-ME2   COLUMN  15  PIC  X(015) VALUE
000910            "***  JM ﾅｼ  ***".
000920       03  E-JCD   COLUMN  40  PIC  9(006) FROM  JT-KEY.
000930       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
000940       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
000950     COPY LIBSCR.
000960 PROCEDURE DIVISION.
000970 M-05.
000980     ACCEPT JS-SIGN.
000990     IF JS-SIGN > 1
001000         STOP RUN.
001010     IF JS-SIGN = 0
001020         MOVE SPACE TO W-SIGN
001030       ELSE
001040         MOVE NC"【工品】" TO W-SIGN.
001050     COPY LIBCPR.
001060     MOVE D-NKNG TO W-NG.
001070     OPEN INPUT J-M.
001080 M-06.
001090     DISPLAY C-CLEAR.
001100     DISPLAY C-MID.
001110     MOVE 2 TO W-L1.
001120     MOVE 3 TO W-L2.
001130 M-08.
001140     ACCEPT A-JCD.
001150     IF ESTAT = PF9
001160         GO TO M-90.
001170     IF ESTAT NOT = HTB AND SKP
001180         GO TO M-08.
001190*
001200     OPEN INPUT JT-M.
001210     MOVE SPACE TO JT-KEY.
001220     MOVE W-JCD TO JT-KEY.
001230     START JT-M KEY NOT < JT-KEY INVALID KEY
001240         DISPLAY E-ME1 E-ME99
001250         CLOSE JT-M
001260         GO TO M-08.
001270     MOVE 0 TO W-END.
001280 M-10.
001290     READ JT-M NEXT RECORD WITH UNLOCK AT END
001300         DISPLAY E-ME1 E-ME99
001310         CLOSE JT-M
001320         GO TO M-08.
001330     IF JS-SIGN = 1
001340         IF JT-BC NOT = 4
001350             GO TO M-10.
001360     IF ZERO = JT-SSU AND JT-SIK
001370         GO TO M-10.
001380 M-15.
001390     MOVE JT-KEY TO J-KEY.
001400     READ J-M WITH UNLOCK INVALID KEY
001410         MOVE SPACE TO J-NAME
001420         MOVE NC"＊＊　材料マスタなし　＊＊" TO J-NAME.
001430     MOVE ZERO TO W-T.
001440     IF ZERO NOT = JT-SSU AND JT-SIK
001450         COMPUTE W-T = (JT-SIK / JT-SSU) + 0.009.
001460 M-17.
001470     ADD 2 TO W-L1 W-L2.
001480     IF W-L1 > 21
001490         GO TO M-25.
001500     DISPLAY D-MEI.
001510 M-20.
001520     READ JT-M NEXT RECORD AT END
001530         MOVE 1 TO W-END
001540         GO TO M-25.
001550     IF JS-SIGN = 1
001560         IF JT-BC > 4
001570             GO TO M-20.
001580     IF ZERO = JT-SSU AND JT-SIK
001590         GO TO M-20.
001600     GO TO M-15.
001610 M-25.
001620     ACCEPT A-DMM.
001630     IF ESTAT = PF9
001640         CLOSE JT-M
001650         GO TO M-90.
001660     IF (ESTAT = ADV) OR (W-END = 1)
001670         CLOSE JT-M
001680         GO TO M-06.
001690     IF ESTAT NOT = HTB
001700         GO TO M-25.
001710*
001720     DISPLAY C-CLEAR.
001730     DISPLAY C-MID.
001740     MOVE 2 TO W-L1.
001750     MOVE 3 TO W-L2.
001760     GO TO M-17.
001770 M-90.
001780     CLOSE J-M.
001790 M-95.
001800     DISPLAY C-CLEAR.
001810     STOP RUN.
