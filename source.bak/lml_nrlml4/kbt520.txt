000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KBT520.
000030**************************************************************
000040*    PROGRAM         :  óöï®êªïiédì¸Å@édì¸êÊï î≠íçì¸å…écñ‚çáÇπ *
000050*    PRINTER TYPE    :  JIPS                                 *
000060*    SCREEN          :  SCBT52                               *
000070*    COMPILE TYPE    :  COBOL                                *
000080**************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT S-M ASSIGN TO S-MSD
000160         ORGANIZATION INDEXED
000170         ACCESS MODE RANDOM
000180         RECORD KEY S-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE RANDOM
000230         RECORD KEY HI-KEY
000240         ALTERNATE RECORD KEY HI-KEY2
000250         FILE STATUS IS ERR-STAT.
000260     SELECT HSHF ASSIGN TO HSH1-MSD HSH2-MSD HSH3-MSD
000270         ORGANIZATION INDEXED
000280         ACCESS MODE DYNAMIC
000290         RECORD KEY HSH-KEY
000300         ALTERNATE RECORD KEY HSH-KEY2
000310         ALTERNATE RECORD KEY HSH-KEY3
000320         FILE STATUS IS ERR-STAT.
000330 I-O-CONTROL.
000340     APPLY SHARED-MODE ON S-M
000350     APPLY SHARED-MODE ON HI-M
000360     APPLY SHARED-MODE ON HSHF.
000370 DATA DIVISION.
000380 FILE SECTION.
000390     COPY LISM.
000400     COPY LIHIM.
000410     COPY LIHSHF.
000420 WORKING-STORAGE SECTION.
000430 01  W-DATA.
000440     02  W-SCD          PIC  9(004).
000450     02  W-NO           PIC  9(002).
000460     02  W-DMM          PIC  9(001).
000470     02  W-L            PIC  9(002).
000480     02  W-C            PIC  9(002).
000490     02  W-G            PIC  9(002).
000500     02  W-S            PIC  9(001).
000510     02  CNT            PIC  9(002).
000520     02  W-ASUD.
000530       03  W-GYO   OCCURS  11.
000540         04  W-ASU   OCCURS   4.
000550           05  W-SUD   OCCURS  10.
000560             06  W-SU   PIC S9(005).
000570         04  W-SUT      PIC S9(006).
000580     02  W-KIN          PIC S9(008).
000590     02  W-KEY3         PIC  X(018).
000600     02  W-AGSD.
000610       03  W-AGSU  OCCURS   4.
000620         04  W-GSUD  OCCURS  10.
000630           05  W-GSU    PIC S9(005).
000640     02  W-TSU          PIC S9(006).
000650     02  W-ANSD.
000660       03  W-ANSU  OCCURS   4.
000670         04  W-NSUD  OCCURS  10.
000680           05  W-NSU    PIC S9(005).
000690       03  W-NSUT       PIC S9(006).
000700     02  W-ZC           PIC  9(001).
000710 01  W-EM               PIC  X(030) VALUE SPACE.
000720 01  W-FILE             PIC  X(013) VALUE SPACE.
000730 01  ERR-STAT           PIC  X(002).
000740     COPY LSTAT.
000750 SCREEN SECTION.
000760 SD  C-CRT
000770     END STATUS IS ESTAT.
000780 01  C-CLEAR.
000790     02  C-CL    LINE   1  CLEAR SCREEN.
000800 01  C-ACP.
000810     02  A-SCD   LINE   2  COLUMN   8   PIC  9(004)
000820          USING W-SCD    CHECK OVERFLOW NO IFC.
000830     02  A-NO    LINE  19  COLUMN   1   PIC  9(002)
000840          USING W-NO     CHECK OVERFLOW NO IFC.
000850     02  A-DMM   LINE  23  COLUMN  76   PIC  9(001)
000860          USING W-DMM      CHECK OVERFLOW NO IFC.
000870 01  C-DSP.
000880     02  D-SNA   LINE   2  COLUMN  13  PIC  N(024) FROM  S-NAME.
000890     02  D-MEI   LINE W-L.
000900       03  COLUMN   1  PIC  9(002)   FROM  W-G.
000910       03  COLUMN   4  PIC  9(006)   FROM  HSH-HCD.
000920       03  COLUMN  11  PIC  N(014)   FROM  HI-NAME.
000930       03  COLUMN  40  PIC ------9   FROM  W-SUT(W-G).
000940       03  COLUMN  48  PIC ZZZZ9     FROM  HSH-T.
000950       03  COLUMN  54  PIC --------9 FROM  W-KIN.
000960       03  COLUMN  64  PIC  9(006)   FROM  HSH-NNGPS.
000970       03  COLUMN  71  PIC  9(002)   FROM  HSH-RSN.
000980       03  COLUMN  73  PIC  X(001)   VALUE "-".
000990       03  COLUMN  74  PIC  9(004)   FROM  HSH-RNG.
001000       03  COLUMN  78  PIC  X(001)   VALUE "-".
001010       03  COLUMN  79  PIC  9(002)   FROM  HSH-RND.
001020     02  D-SSD.
001030       03  LINE  19  COLUMN W-C  PIC  -(006) FROM
001040                                             W-SU(W-G,1,CNT).
001050       03  LINE  20  COLUMN W-C  PIC  -(006) FROM
001060                                             W-SU(W-G,2,CNT).
001070       03  LINE  21  COLUMN W-C  PIC  -(006) FROM
001080                                             W-SU(W-G,3,CNT).
001090       03  LINE  22  COLUMN W-C  PIC  -(006) FROM
001100                                             W-SU(W-G,4,CNT).
001110       03  LINE  22  COLUMN  71  PIC ------9 FROM  W-SUT(W-G).
001120     02  D-GSD.
001130       03  LINE  19  COLUMN W-C  PIC  -(006) FROM  W-GSU(1,CNT).
001140       03  LINE  20  COLUMN W-C  PIC  -(006) FROM  W-GSU(2,CNT).
001150       03  LINE  21  COLUMN W-C  PIC  -(006) FROM  W-GSU(3,CNT).
001160       03  LINE  22  COLUMN W-C  PIC  -(006) FROM  W-GSU(4,CNT).
001170       03  LINE  22  COLUMN  71  PIC ------9 FROM  W-TSU.
001180 01  C-ERR.
001190     02  LINE  24.
001200       03  E-ME    COLUMN  15   PIC  X(030) FROM  W-EM.
001210     COPY LSSEM.
001220 PROCEDURE DIVISION.
001230 M-05.
001240     CALL "SCBT52".
001250     MOVE ZERO TO W-DATA.
001260     OPEN INPUT S-M HI-M HSHF.
001270 M-10.
001280     ACCEPT A-SCD.
001290     DISPLAY E-CL.
001300     IF ESTAT = PF9
001310         GO TO M-90.
001320     IF ESTAT NOT = HTB AND SKP
001330         GO TO M-10.
001340*
001350     MOVE W-SCD TO S-KEY.
001360     READ S-M WITH UNLOCK INVALID KEY
001370         MOVE SPACE TO S-NAME
001380         MOVE "***  édì¸êÊÅ@Ç»Çµ  ***        " TO W-EM
001390         DISPLAY E-ME E-ME98
001400         GO TO M-10.
001410     DISPLAY D-SNA.
001420*
001430     MOVE SPACE TO HSH-KEY3.
001440     MOVE W-SCD TO HSH-SCD.
001450     START HSHF KEY NOT < HSH-KEY3 INVALID KEY
001460         MOVE "***  ÉfÅ[É^Å@Ç»Çµ  ***        " TO W-EM
001470         DISPLAY E-ME E-ME98
001480         GO TO M-10.
001490 M-15.
001500     READ HSHF NEXT RECORD WITH UNLOCK AT END
001510         MOVE "***  ÉfÅ[É^Å@Ç»Çµ  ***        " TO W-EM
001520         DISPLAY E-ME E-ME98
001530         GO TO M-10.
001540     IF HSH-SCD NOT = W-SCD
001550         MOVE "***  ÉfÅ[É^Å@Ç»Çµ  ***        " TO W-EM
001560         DISPLAY E-ME E-ME98
001570         GO TO M-10.
001580     IF HSH-ENGP NOT = ZERO
001590         GO TO M-15.
001600     PERFORM SET-RTN THRU SET-EX.
001610     IF W-ZC = 0
001620         GO TO M-15.
001630 M-20.
001640     MOVE ZERO TO W-ASUD W-G.
001650     MOVE 3 TO W-L.
001660 M-25.
001670     ADD 1 TO W-G.
001680     IF W-G = 12
001690         MOVE HSH-KEY3 TO W-KEY3
001700         GO TO M-35.
001710     MOVE W-ANSD TO W-GYO(W-G).
001720     ADD 1 TO W-L.
001730     COMPUTE W-KIN = W-SUT(W-G) * HSH-T.
001740     MOVE HSH-HCD TO HI-KEY.
001750     READ HI-M WITH UNLOCK INVALID KEY
001760         MOVE SPACE TO HI-NAME
001770         MOVE NC"Å@ÅñÅñÅñÅ@ïiñºÅ@Ç»ÇµÅ@ÅñÅñÅñ" TO HI-NAME.
001780     DISPLAY D-MEI.
001790 M-30.
001800     READ HSHF NEXT RECORD WITH UNLOCK AT END
001810         MOVE SPACE TO W-KEY3
001820         MOVE "ÇdÇmÇcÅ@ÇcÇ`ÇsÇ`              " TO W-EM
001830         DISPLAY E-ME E-ME98
001840         GO TO M-35.
001850     IF HSH-SCD NOT = W-SCD
001860         MOVE SPACE TO W-KEY3
001870         MOVE "ÇdÇmÇcÅ@ÇcÇ`ÇsÇ`              " TO W-EM
001880         GO TO M-35.
001890     IF HSH-ENGP NOT = ZERO
001900         GO TO M-30.
001910     PERFORM SET-RTN THRU SET-EX.
001920     IF W-ZC = 0
001930         GO TO M-30.
001940     GO TO M-25.
001950 M-35.
001960     ACCEPT A-DMM.
001970     IF ESTAT = PF9
001980         GO TO M-90.
001990     IF ESTAT = BTB
002000         GO TO M-40.
002010     IF ESTAT NOT = HTB AND SKP
002020         GO TO M-35.
002030     IF W-DMM = 9
002040         CALL "SCBT52"
002050         GO TO M-10.
002060     IF W-DMM NOT = 1
002070         GO TO M-35.
002080     CALL "SCBT52".
002090     IF W-KEY3 = SPACE
002100         GO TO M-10.
002110     MOVE W-KEY3 TO HSH-KEY3.
002120     READ HSHF WITH UNLOCK INVALID KEY
002130         MOVE SPACE TO W-KEY3
002140         MOVE "ÇcÇ`ÇsÇ`Å@ÉGÉâÅ[              " TO W-EM
002150         GO TO M-10.
002160     DISPLAY A-SCD D-SNA
002170     GO TO M-20.
002180 M-40.
002190     ACCEPT A-NO.
002200     IF ESTAT = PF9
002210         GO TO M-90.
002220     IF ESTAT = BTB
002230         GO TO M-35.
002240     IF ESTAT NOT = HTB AND SKP
002250         GO TO M-40.
002260     IF W-NO = 99
002270         GO TO M-50.
002280     IF W-NO < 1 OR > 11
002290         GO TO M-40.
002300*
002310     MOVE W-NO TO W-G.
002320     MOVE 4 TO W-C.
002330     MOVE ZERO TO CNT.
002340 M-45.
002350     ADD 1 TO CNT.
002360     IF CNT NOT = 11
002370         ADD 6 TO W-C
002380         DISPLAY D-SSD
002390         GO TO M-45.
002400     GO TO M-40.
002410 M-50.
002420     PERFORM KEI-RTN THRU KEI-EX.
002430     GO TO M-40.
002440 M-90.
002450     CLOSE S-M.
002460     CLOSE HI-M.
002470     CLOSE HSHF.
002480 M-95.
002490     DISPLAY C-CLEAR.
002500     STOP RUN.
002510 SET-RTN.
002520     MOVE ZERO TO W-ANSD W-ZC W-S.
002530 SET-020.
002540     ADD 1 TO W-S.
002550     IF W-S = 5
002560         GO TO SET-EX.
002570     MOVE ZERO TO CNT.
002580 SET-040.
002590     ADD 1 TO CNT.
002600     IF CNT = 11
002610         GO TO SET-020.
002620     COMPUTE W-NSU(W-S,CNT) =
002630          HSH-HSU(W-S,CNT) - HSH-NSU(W-S,CNT) - HSH-ISU(W-S,CNT).
002640     ADD W-NSU(W-S,CNT) TO W-NSUT.
002650     IF W-ZC = 0
002660         IF W-NSU(W-S,CNT) NOT = ZERO
002670             MOVE 1 TO W-ZC.
002680     GO TO SET-040.
002690 SET-EX.
002700     EXIT.
002710 KEI-RTN.
002720     MOVE ZERO TO W-AGSD.
002730     MOVE SPACE TO HSH-KEY3.
002740     MOVE W-SCD TO HSH-SCD.
002750     START HSHF KEY NOT < HSH-KEY3 INVALID KEY
002760         GO TO KEI-080.
002770 KEI-020.
002780     READ HSHF NEXT RECORD WITH UNLOCK AT END
002790         GO TO KEI-080.
002800     IF HSH-SCD NOT = W-SCD
002810         GO TO KEI-080.
002820     IF HSH-ENGP NOT = ZERO
002830         GO TO KEI-020.
002840*
002850     MOVE ZERO TO W-S.
002860 KEI-040.
002870     ADD 1 TO W-S.
002880     IF W-S = 5
002890         GO TO KEI-020.
002900     MOVE ZERO TO CNT.
002910 KEI-060.
002920     ADD 1 TO CNT.
002930     IF CNT NOT = 11
002940         COMPUTE W-GSU(W-S,CNT) = W-GSU(W-S,CNT) +
002950           HSH-HSU(W-S,CNT) - HSH-NSU(W-S,CNT) - HSH-ISU(W-S,CNT)
002960         GO TO KEI-060.
002970     GO TO KEI-040.
002980 KEI-080.
002990     MOVE ZERO TO W-S W-TSU.
003000 KEI-100.
003010     ADD 1 TO W-S.
003020     IF W-S = 5
003030         GO TO KEI-140.
003040     MOVE ZERO TO CNT.
003050 KEI-120.
003060     ADD 1 TO CNT.
003070     IF CNT NOT = 11
003080         ADD W-GSU(W-S,CNT) TO W-TSU
003090         GO TO KEI-120.
003100     GO TO KEI-100.
003110 KEI-140.
003120     MOVE 4 TO W-C.
003130     MOVE ZERO TO CNT.
003140 KEI-160.
003150     ADD 1 TO CNT.
003160     IF CNT NOT = 11
003170         ADD 6 TO W-C
003180         DISPLAY D-GSD
003190         GO TO KEI-160.
003200 KEI-EX.
003210     EXIT.
