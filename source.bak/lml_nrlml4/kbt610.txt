000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KBT610.
000030**************************************************************
000040*    PROGRAM         :  履物製品仕入　納期別発注入庫残問合せ *
000050*    PRINTER TYPE    :  JIPS                                 *
000060*    SCREEN          :  SCBT61                               *
000070*    COMPILE TYPE    :  COBOL                                *
000080**************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT S-M ASSIGN TO S-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY S-KEY
000200         FILE STATUS IS ERR-STAT.
000210     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000220         ORGANIZATION INDEXED
000230         ACCESS MODE RANDOM
000240         RECORD KEY HI-KEY
000250         ALTERNATE RECORD KEY HI-KEY2
000260         FILE STATUS IS ERR-STAT.
000270     SELECT HSHWF ASSIGN TO HSHW-MSD.
000280 I-O-CONTROL.
000290     APPLY SHARED-MODE ON S-M
000300     APPLY SHARED-MODE ON HI-M
000310     APPLY SHARED-MODE ON M-DATE.
000320 DATA DIVISION.
000330 FILE SECTION.
000340     COPY LIBFDD.
000350     COPY LISM.
000360     COPY LIHIM.
000370 FD  HSHWF
000380     BLOCK  1 RECORDS
000390     LABEL RECORD IS STANDARD
000400     VALUE OF IDENTIFICATION WK0768ID.
000410 01  HSHW-R.
000420     02  HSHW-KEY3.
000430       03  HSHW-SCD     PIC  9(004).
000440       03  HSHW-KEY2.
000450         04  HSHW-HCD   PIC  9(006).
000460         04  HSHW-RNO.
000470           05  HSHW-RSN PIC  9(002).
000480           05  HSHW-RNG PIC  9(004).
000490           05  HSHW-RND PIC  9(002).
000500     02  HSHW-HDD       PIC  9(008).
000510     02  HSHW-HDDL  REDEFINES HSHW-HDD.
000520       03  F            PIC  9(002).
000530       03  HSHW-HNGPS   PIC  9(006).
000540     02  HSHW-AHSUD.
000550       03  HSHW-HSUD  OCCURS   4.                                  ｻｲｽﾞ
000560         04  HSHW-AHSU  OCCURS  10.
000570           05  HSHW-HSU PIC S9(004).                               数量
000580     02  HSHW-ANSUD.
000590       03  HSHW-NSUD  OCCURS   4.                                  ｻｲｽﾞ
000600         04  HSHW-ANSU  OCCURS  10.
000610           05  HSHW-NSU PIC S9(004).                               数量
000620     02  HSHW-AISUD.
000630       03  HSHW-ISUD  OCCURS   4.                                  ｻｲｽﾞ
000640         04  HSHW-AISU  OCCURS  10.
000650           05  HSHW-ISU PIC S9(004).                               数量
000660     02  HSHW-T         PIC  9(005).
000670     02  HSHW-NDD       PIC  9(008).
000680     02  HSHW-NDDL  REDEFINES HSHW-NDD.
000690       03  F            PIC  9(002).
000700       03  HSHW-NNGPS   PIC  9(006).
000710       03  HSHW-NDS   REDEFINES HSHW-NNGPS.
000720         04  HSHW-NNEN  PIC  9(002).
000730         04  HSHW-NGET  PIC  9(002).
000740         04  HSHW-NPEY  PIC  9(002).
000750     02  HSHW-ENGP      PIC  9(006).
000760     02  F              PIC  X(243).
000770 WORKING-STORAGE SECTION.
000780 77  WK0768ID           PIC  X(009) VALUE SPACE.
000790 01  STN-NO.
000800     02  STN-NO1        PIC  X(003).
000810     02  STN-NO2        PIC  X(003).
000820 01  W-FID.
000830     02  W-FID1         PIC  X(006) VALUE "WK0768".
000840     02  W-FID2         PIC  X(003).
000850 01  W-DATA.
000860     02  W-ND.
000870       03  W-NNEN       PIC  9(004).
000880       03  W-NNENL REDEFINES W-NNEN.
000890         04  W-NNEN1    PIC  9(002).
000900         04  W-NNEN2    PIC  9(002).
000910       03  W-NGET       PIC  9(002).
000920       03  W-NPEY       PIC  9(002).
000930     02  W-NDL   REDEFINES W-ND.
000940       03  F            PIC  9(002).
000950       03  W-NDS        PIC  9(006).
000960     02  W-HCD          PIC  9(006).
000970     02  W-NO           PIC  9(001).
000980     02  W-DMM          PIC  9(001).
000990     02  W-L1           PIC  9(002).
001000     02  W-L2           PIC  9(002).
001010     02  W-C            PIC  9(002).
001020     02  W-G            PIC  9(001).
001030     02  W-S            PIC  9(001).
001040     02  CNT            PIC  9(002).
001050     02  W-ASUD.
001060       03  W-GYO   OCCURS   6.
001070         04  W-ASU   OCCURS   4.
001080           05  W-SUD   OCCURS  10.
001090             06  W-SU   PIC S9(005).
001100         04  W-SUT      PIC S9(006).
001110         04  W-HD       PIC  9(006).
001120     02  W-RNO          PIC  9(008).
001130     02  W-AGSD.
001140       03  W-AGSU  OCCURS   4.
001150         04  W-GSUD  OCCURS  10.
001160           05  W-GSU    PIC S9(005).
001170     02  W-TSU          PIC S9(006).
001180 01  W-EM               PIC  X(030) VALUE SPACE.
001190 01  W-FILE             PIC  X(013) VALUE SPACE.
001200 01  ERR-STAT           PIC  X(002).
001210     COPY LSTAT.
001220 SCREEN SECTION.
001230 SD  C-CRT
001240     END STATUS IS ESTAT.
001250 01  C-CLEAR.
001260     02  C-CL    LINE   1  CLEAR SCREEN.
001270 01  C-ACP.
001280     02  LINE   3.
001290       03  A-NNEN  COLUMN   3   PIC  9(002)
001300            USING W-NNEN2                 NO IFC.
001310       03  A-NGET  COLUMN   6   PIC  9(002)
001320            USING W-NGET                  NO IFC.
001330       03  A-NPEY  COLUMN   9   PIC  9(002)
001340            USING W-NPEY   CHECK OVERFLOW NO IFC.
001350     02  A-NO    LINE  18  COLUMN   1   PIC  9(001)
001360          USING W-NO     CHECK OVERFLOW NO IFC.
001370     02  A-NDS   LINE  20  COLUMN   1   PIC  9(006)
001380          USING W-NDS    CHECK OVERFLOW NO IFC.
001390     02  A-HCD   LINE  22  COLUMN   1   PIC  9(006)
001400          USING W-HCD    CHECK OVERFLOW NO IFC.
001410     02  A-DMM   LINE  23  COLUMN  76   PIC  9(001)
001420          USING W-DMM      CHECK OVERFLOW NO IFC.
001430 01  C-DSP.
001440     02  D-MEI.
001450       03  LINE W-L1.
001460         04  COLUMN   1  PIC  9(001)   FROM  W-G.
001470         04  COLUMN   3  PIC  9(002)   FROM  HSHW-NNEN.
001480         04  COLUMN   5  PIC  X(001)   VALUE "/".
001490         04  COLUMN   6  PIC  9(002)   FROM  HSHW-NGET.
001500         04  COLUMN   8  PIC  X(001)   VALUE "/".
001510         04  COLUMN   9  PIC  9(002)   FROM  HSHW-NPEY.
001520         04  COLUMN  12  PIC  9(004)   FROM  HSHW-SCD.
001530         04  COLUMN  17  PIC  N(024)   FROM  S-NAME.
001540         04  COLUMN  66  PIC  9(002)   FROM  HSHW-RSN.
001550         04  COLUMN  68  PIC  X(001)   VALUE "-".
001560         04  COLUMN  69  PIC  9(004)   FROM  HSHW-RNG.
001570         04  COLUMN  73  PIC  X(001)   VALUE "-".
001580         04  COLUMN  74  PIC  9(002)   FROM  HSHW-RND.
001590       03  LINE W-L2.
001600         04  COLUMN  17  PIC  9(006)   FROM  HSHW-HCD.
001610         04  COLUMN  24  PIC  N(024)   FROM  HI-NAME.
001620         04  COLUMN  73  PIC ----,--9  FROM  W-SUT(W-G).
001630     02  D-SSD.
001640       03  LINE  19  COLUMN W-C  PIC  -(006) FROM
001650                                             W-SU(W-G,1,CNT).
001660       03  LINE  20  COLUMN W-C  PIC  -(006) FROM
001670                                             W-SU(W-G,2,CNT).
001680       03  LINE  21  COLUMN W-C  PIC  -(006) FROM
001690                                             W-SU(W-G,3,CNT).
001700       03  LINE  22  COLUMN W-C  PIC  -(006) FROM
001710                                             W-SU(W-G,4,CNT).
001720       03  LINE  22  COLUMN  70  PIC ------9 FROM  W-SUT(W-G).
001730       03  LINE  20  COLUMN  71  PIC  9(006) FROM  W-HD(W-G).
001740     02  D-GSM.
001750       03  LINE  19  COLUMN   2  PIC  N(002) VALUE NC"納期".
001760       03  LINE  21  COLUMN   1  PIC  X(006) VALUE "品ｺｰﾄﾞ".
001770       03  LINE  20  COLUMN  71  PIC  X(006) VALUE "      ".
001780     02  D-GSC.
001790       03  LINE  19  COLUMN   2  PIC  X(004) VALUE "    ".
001800       03  LINE  20  COLUMN   1  PIC  X(006) VALUE "      ".
001810       03  LINE  21  COLUMN   1  PIC  X(006) VALUE "      ".
001820       03  LINE  22  COLUMN   1  PIC  X(006) VALUE "      ".
001830     02  D-GSD.
001840       03  LINE  19  COLUMN W-C  PIC  -(006) FROM  W-GSU(1,CNT).
001850       03  LINE  20  COLUMN W-C  PIC  -(006) FROM  W-GSU(2,CNT).
001860       03  LINE  21  COLUMN W-C  PIC  -(006) FROM  W-GSU(3,CNT).
001870       03  LINE  22  COLUMN W-C  PIC  -(006) FROM  W-GSU(4,CNT).
001880       03  LINE  22  COLUMN  70  PIC ------9 FROM  W-TSU.
001890 01  C-ERR.
001900     02  LINE  24.
001910       03  E-ME    COLUMN  15   PIC  X(030) FROM  W-EM.
001920     COPY LSSEM.
001930     COPY LIBSCR.
001940 PROCEDURE DIVISION.
001950 M-05.
001960     COPY LIBCPR.
001970     CALL "SCBT61".
001980     MOVE ZERO TO W-DATA.
001990     OPEN INPUT S-M HI-M.
002000     CALL "CBLSTNNO" USING STN-NO.
002010     MOVE STN-NO2 TO W-FID2.
002020     MOVE W-FID TO WK0768ID.
002030 M-10.
002040     ACCEPT A-NNEN.
002050     DISPLAY E-CL.
002060     IF ESTAT = PF9
002070         GO TO M-90.
002080     IF ESTAT NOT = NOC AND HTB AND SKP
002090         GO TO M-10.
002100     MOVE ZERO TO W-NNEN1.
002110     IF W-NNEN2 >= DATE-NF1 AND <= DATE-NT1
002120         ADD DATE-NC1 TO W-NNEN.
002130     IF W-NNEN2 >= DATE-NF2 AND <= DATE-NT2
002140         ADD DATE-NC2 TO W-NNEN.
002150 M-15.
002160     ACCEPT A-NGET.
002170     DISPLAY E-CL.
002180     IF ESTAT = BTB
002190         GO TO M-10.
002200     IF ESTAT NOT = NOC AND HTB AND SKP
002210         GO TO M-15.
002220     IF W-NGET = ZERO
002230         IF W-NNEN2 = ZERO
002240             MOVE ZERO TO W-NNEN.
002250 M-20.
002260     ACCEPT A-NPEY.
002270     DISPLAY E-CL.
002280     IF ESTAT = BTB
002290         GO TO M-15.
002300     IF ESTAT NOT = HTB AND SKP
002310         GO TO M-20.
002320*
002330     OPEN INPUT HSHWF.
002340 M-25.
002350     READ HSHWF AT END
002360         CLOSE HSHWF
002370         MOVE "***  データ　なし  ***        " TO W-EM
002380         DISPLAY E-ME E-ME98
002390         GO TO M-10.
002400     IF HSHW-ENGP NOT = ZERO
002410         GO TO M-25.
002420     IF HSHW-NDD < W-ND
002430         GO TO M-25.
002440 M-30.
002450     MOVE ZERO TO W-ASUD W-G.
002460     MOVE 1 TO W-L1.
002470     MOVE 2 TO W-L2.
002480 M-35.
002490     ADD 1 TO W-G.
002500     IF W-G = 7
002510         MOVE HSHW-RNO TO W-RNO
002520         GO TO M-45.
002530     PERFORM SET-RTN THRU SET-EX.
002540     ADD 2 TO W-L1 W-L2.
002550     MOVE HSHW-SCD TO S-KEY.
002560     READ S-M WITH UNLOCK INVALID KEY
002570         MOVE SPACE TO S-NAME
002580         MOVE NC"　＊＊＊　仕入先　なし　＊＊＊" TO S-NAME.
002590     MOVE HSHW-HCD TO HI-KEY.
002600     READ HI-M WITH UNLOCK INVALID KEY
002610         MOVE SPACE TO HI-NAME
002620         MOVE NC"　＊＊＊　品名　なし　＊＊＊　" TO HI-NAME.
002630     DISPLAY D-MEI.
002640 M-40.
002650     READ HSHWF AT END
002660         MOVE ZERO TO W-RNO
002670         MOVE "ＥＮＤ　ＤＡＴＡ              " TO W-EM
002680         DISPLAY E-ME E-ME98
002690         GO TO M-45.
002700     IF HSHW-ENGP NOT = ZERO
002710         GO TO M-40.
002720     GO TO M-35.
002730 M-45.
002740     ACCEPT A-DMM.
002750     IF ESTAT = PF9
002760         CLOSE HSHWF
002770         GO TO M-90.
002780     IF ESTAT = BTB
002790         GO TO M-55.
002800     IF ESTAT NOT = HTB AND SKP
002810         GO TO M-45.
002820     IF W-DMM = 9
002830         CALL "SCBT61"
002840         CLOSE HSHWF
002850         GO TO M-10.
002860     IF W-DMM NOT = 1
002870         GO TO M-45.
002880     CALL "SCBT61".
002890     IF W-RNO = ZERO
002900         CLOSE HSHWF
002910         GO TO M-10.
002920     CLOSE HSHWF.
002930     OPEN INPUT HSHWF.
002940 M-50.
002950     READ HSHWF AT END
002960         CLOSE HSHWF
002970         MOVE ZERO TO W-RNO
002980         MOVE "ＤＡＴＡ　エラー              " TO W-EM
002990         DISPLAY E-ME E-ME98
003000         GO TO M-10.
003010     IF W-RNO NOT = HSHW-RNO
003020         GO TO M-50.
003030     GO TO M-30.
003040 M-55.
003050     ACCEPT A-NO.
003060     IF ESTAT = PF9
003070         CLOSE HSHWF
003080         GO TO M-90.
003090     IF ESTAT = BTB
003100         GO TO M-45.
003110     IF ESTAT NOT = HTB AND SKP
003120         GO TO M-55.
003130     IF W-NO = 9
003140         DISPLAY D-GSM
003150         GO TO M-65.
003160     IF W-NO < 1 OR > 6
003170         GO TO M-55.
003180*
003190     DISPLAY D-GSC.
003200     MOVE W-NO TO W-G.
003210     MOVE 4 TO W-C.
003220     MOVE ZERO TO CNT.
003230 M-60.
003240     ADD 1 TO CNT.
003250     IF CNT NOT = 11
003260         ADD 6 TO W-C
003270         DISPLAY D-SSD
003280         GO TO M-60.
003290     GO TO M-55.
003300 M-65.
003310     ACCEPT A-NDS.
003320     IF ESTAT = PF9
003330         CLOSE HSHWF
003340         GO TO M-90.
003350     IF ESTAT = BTB
003360         GO TO M-55.
003370     IF ESTAT NOT = HTB AND SKP
003380         GO TO M-65.
003390 M-70.
003400     ACCEPT A-HCD.
003410     DISPLAY E-CL.
003420     IF ESTAT = PF9
003430         CLOSE HSHWF
003440         GO TO M-90.
003450     IF ESTAT = BTB
003460         GO TO M-65.
003470     IF ESTAT NOT = HTB AND SKP
003480         GO TO M-70.
003490     IF W-HCD = ZERO
003500         GO TO M-75.
003510     MOVE W-HCD TO HI-KEY.
003520     READ HI-M WITH UNLOCK INVALID KEY
003530         MOVE "　＊＊　品名　なし　＊＊      " TO W-EM
003540         DISPLAY E-ME E-ME98
003550         GO TO M-70.
003560 M-75.
003570     PERFORM KEI-RTN THRU KEI-EX.
003580     GO TO M-55.
003590 M-90.
003600     CLOSE S-M.
003610     CLOSE HI-M.
003620 M-95.
003630     DISPLAY C-CLEAR.
003640     STOP RUN.
003650 SET-RTN.
003660     MOVE HSHW-HNGPS TO W-HD(W-G).
003670     MOVE ZERO TO W-S.
003680 SET-020.
003690     ADD 1 TO W-S.
003700     IF W-S = 5
003710         GO TO SET-EX.
003720     MOVE ZERO TO CNT.
003730 SET-040.
003740     ADD 1 TO CNT.
003750     IF CNT = 11
003760         GO TO SET-020.
003770     COMPUTE W-SU(W-G,W-S,CNT) = HSHW-HSU(W-S,CNT) -
003780                           HSHW-NSU(W-S,CNT) - HSHW-ISU(W-S,CNT).
003790     ADD W-SU(W-G,W-S,CNT) TO W-SUT(W-G).
003800     MOVE HSHW-HNGPS TO W-HD(W-G).
003810     GO TO SET-040.
003820 SET-EX.
003830     EXIT.
003840 KEI-RTN.
003850     CLOSE HSHWF.
003860     OPEN INPUT HSHWF.
003870     MOVE ZERO TO W-AGSD.
003880 KEI-020.
003890     READ HSHWF AT END
003900         GO TO KEI-080.
003910     IF W-NDS NOT = ZERO
003920         IF HSHW-NNGPS < W-NDS
003930             GO TO KEI-020.
003940     IF W-NDS NOT = ZERO
003950         IF HSHW-NNGPS > W-NDS
003960             GO TO KEI-080.
003970     IF W-HCD NOT = ZERO
003980         IF HSHW-HCD NOT = W-HCD
003990             GO TO KEI-020.
004000     IF HSHW-ENGP NOT = ZERO
004010         GO TO KEI-020.
004020*
004030     MOVE ZERO TO W-S.
004040 KEI-040.
004050     ADD 1 TO W-S.
004060     IF W-S = 5
004070         GO TO KEI-020.
004080     MOVE ZERO TO CNT.
004090 KEI-060.
004100     ADD 1 TO CNT.
004110     IF CNT NOT = 11
004120         COMPUTE W-GSU(W-S,CNT) = W-GSU(W-S,CNT)
004130                       + HSHW-HSU(W-S,CNT) - HSHW-NSU(W-S,CNT)
004140                                           - HSHW-ISU(W-S,CNT)
004150         GO TO KEI-060.
004160     GO TO KEI-040.
004170 KEI-080.
004180     MOVE ZERO TO W-S W-TSU.
004190 KEI-100.
004200     ADD 1 TO W-S.
004210     IF W-S = 5
004220         GO TO KEI-140.
004230     MOVE ZERO TO CNT.
004240 KEI-120.
004250     ADD 1 TO CNT.
004260     IF CNT NOT = 11
004270         ADD W-GSU(W-S,CNT) TO W-TSU
004280         GO TO KEI-120.
004290     GO TO KEI-100.
004300 KEI-140.
004310     MOVE 4 TO W-C.
004320     MOVE ZERO TO CNT.
004330 KEI-160.
004340     ADD 1 TO CNT.
004350     IF CNT NOT = 11
004360         ADD 6 TO W-C
004370         DISPLAY D-GSD
004380         GO TO KEI-160.
004390 KEI-EX.
004400     EXIT.
