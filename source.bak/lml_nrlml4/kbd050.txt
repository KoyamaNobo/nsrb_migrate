000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KBD050.
000030*********************************************************
000040*    PROGRAM         :  工品製品仕入　変換可能リスト    *
000050*********************************************************
000060 ENVIRONMENT DIVISION.
000070 CONFIGURATION SECTION.
000080 SOURCE-COMPUTER. SYSTEM3100.
000090 OBJECT-COMPUTER. SYSTEM3100.
000100 INPUT-OUTPUT SECTION.
000110 FILE-CONTROL.
000120     COPY LIBCSE.
000130     SELECT S-M ASSIGN TO S-MSD
000140         ORGANIZATION INDEXED
000150         ACCESS MODE RANDOM
000160         RECORD KEY S-KEY
000170         FILE STATUS IS ERR-STAT.
000180     SELECT J-M ASSIGN TO J-MSD
000190         ORGANIZATION INDEXED
000200         ACCESS MODE RANDOM
000210         RECORD KEY J-KEY
000220         FILE STATUS IS ERR-STAT.
000230     SELECT KH-M ASSIGN TO KH-MSD
000240         ORGANIZATION INDEXED
000250         ACCESS MODE RANDOM
000260         RECORD KEY KH-KEY
000270         FILE STATUS IS ERR-STAT.
000280     SELECT JSS-F ASSIGN TO JSS-MSD
000290         ORGANIZATION INDEXED
000300         ACCESS MODE DYNAMIC
000310         RECORD KEY JS-KEY
000320         FILE STATUS IS ERR-STAT.
000330     SELECT SP-F ASSIGN TO P-PRN999.
000340 I-O-CONTROL.
000350     APPLY SHARED-MODE ON M-DATE
000360     APPLY SHARED-MODE ON S-M
000370     APPLY SHARED-MODE ON J-M
000380     APPLY SHARED-MODE ON KH-M
000390     APPLY SHARED-MODE ON JSS-F
000400     APPLY SHIFT-CODE  ON SP-F.
000410 DATA DIVISION.
000420 FILE SECTION.
000430     COPY LIBFDD.
000440     COPY LISM.
000450     COPY LIJM.
000460     COPY LIKHM.
000470     COPY LSPF.
000480 FD  JSS-F
000490     BLOCK  5 RECORDS
000500     LABEL RECORD IS STANDARD
000510     VALUE OF IDENTIFICATION "JSSF".
000520 01  JSS-R.
000530     02  JS-DC          PIC  9(002).
000540     02  JS-DATE        PIC  9(008).
000550     02  JS-SCD         PIC  9(004).
000560     02  JS-JCD         PIC  9(006).
000570     02  JS-SU          PIC S9(007)V9(02).
000580     02  JS-T           PIC S9(006)V9(02).
000590     02  JS-KIN         PIC S9(008).
000600     02  JS-SHZ         PIC S9(007).
000610     02  JS-CD          PIC  9(006).
000620     02  JS-SJCD        PIC  9(006).
000630     02  JS-NNO         PIC  9(006).
000640     02  JS-FC          PIC  9(001).
000650     02  JS-YC          PIC  9(001).
000660     02  JS-TC          PIC  9(001).
000670     02  JS-SEC         PIC  9(001).
000680     02  JS-SC          PIC  9(001).
000690     02  JS-BSC         PIC  9(001).
000700     02  JS-BKC         PIC  9(002).
000710     02  JS-KCO         PIC  X(005).
000720     02  JS-KHC         PIC  9(001).
000730     02  F              PIC  X(010).
000740     02  JS-KEY.
000750       03  JS-DNO       PIC  X(006).
000760       03  JS-GNO       PIC  9(001).
000770     02  JS-PCNT        PIC  9(001).
000780 WORKING-STORAGE SECTION.
000790 01  HEAD1.
000800     02  W-20K          PIC  X(005) VALUE ""3FE04FE080"".
000810     02  F              PIC  X(039) VALUE SPACE.
000820     02  F              PIC  N(024) VALUE
000830          NC"＊＊＊　　工品製品仕入　変換可能リスト　　＊＊＊".
000840     02  F              PIC  X(027) VALUE SPACE.
000850     02  F              PIC  X(005) VALUE "DATE ".
000860     02  H-DATE         PIC 99B99B99.
000870     02  F              PIC  X(007) VALUE "     P.".
000880     02  H-PAGE         PIC Z9.
000890 01  HEAD2.
000900     02  W-15K          PIC  X(005) VALUE ""3FE04F40A0"".
000910     02  F              PIC  X(001) VALUE SPACE.
000920     02  F              PIC  N(004) VALUE NC"　日　付".
000930     02  F              PIC  X(004) VALUE SPACE.
000940     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
000950     02  F              PIC  N(006) VALUE NC"品　　　名　".
000960     02  F              PIC  X(018) VALUE SPACE.
000970     02  F              PIC  N(004) VALUE NC"　数　量".
000980     02  F              PIC  X(002) VALUE SPACE.
000990     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
001000     02  F              PIC  N(010) VALUE
001010          NC"仕　　入　　先　　名".
001020     02  F              PIC  X(021) VALUE SPACE.
001030     02  F              PIC  N(002) VALUE NC"材料".
001040     02  F              PIC  X(005) VALUE "ｺｰﾄﾞ ".
001050     02  F              PIC  N(008) VALUE NC"材　　料　　名　".
001060     02  F              PIC  X(024) VALUE SPACE.
001070 01  W-P.
001080     02  P-DATE         PIC 99/99/99.
001090     02  F              PIC  X(002).
001100     02  P-KCO          PIC  X(005).
001110     02  F              PIC  X(001).
001120     02  P-KNA          PIC  X(020).
001130     02  P-SU           PIC --,---,--9.99.
001140     02  F              PIC  X(002).
001150     02  P-SCD          PIC  9(004).
001160     02  F              PIC  X(001).
001170     02  P-SNA          PIC  N(024).
001180     02  F              PIC  X(001).
001190     02  P-JCD          PIC  9(006).
001200     02  F              PIC  X(001).
001210     02  P-JNA          PIC  N(024).
001220 01  W-DATA.
001230     02  W-DMM          PIC  9(001).
001240     02  W-DATE         PIC  9(008).
001250     02  W-NGPL  REDEFINES W-DATE.
001260       03  F            PIC  9(002).
001270       03  W-NGPS       PIC  9(006).
001280     02  CHK            PIC  9(001).
001290     02  W-PAGE         PIC  9(002) VALUE ZERO.
001300 01  ERR-STAT           PIC  X(002).
001310     COPY LSTAT.
001320 SCREEN SECTION.
001330 SD  C-CRT
001340     END STATUS IS ESTAT.
001350 01  C-CLEAR.
001360     02  C-CL    LINE   1  CLEAR SCREEN.
001370 01  C-MID.
001380     02  LINE   3  COLUMN  10   PIC  N(024) VALUE
001390          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001400     02  LINE   4  COLUMN  10   PIC  N(024) VALUE
001410          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001420     02  LINE   5  COLUMN  10   PIC  N(024) VALUE
001430          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
001440     02  LINE   6  COLUMN  10   PIC  N(024) VALUE
001450          NC"＊＊＊　　工品製品仕入　変換可能リスト　　＊＊＊".
001460     02  LINE   7  COLUMN  10   PIC  N(024) VALUE
001470          NC"＊＊＊　　　　　　　　　　　　　　　　　　＊＊＊".
001480     02  LINE   8  COLUMN  10   PIC  N(024) VALUE
001490          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001500     02  LINE   9  COLUMN  10   PIC  N(024) VALUE
001510          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001520     02  LINE  22  COLUMN  30   PIC  X(022) VALUE
001530          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
001540 01  C-ACP.
001550     02  A-DMM   LINE  22  COLUMN  47   PIC  9(001)
001560          USING W-DMM    CHECK OVERFLOW NO IFC.
001570 01  C-ERR.
001580     02  LINE  24.
001590       03  E-STAT  COLUMN  10   PIC  X(002) FROM  ERR-STAT.
001600       03  E-ME1   COLUMN  15   PIC  X(017) VALUE
001610            "***  DATA ﾅｼ  ***".
001620       03  E-ME2   COLUMN  15   PIC  X(026) VALUE
001630            "***  JSSF REWRITE ｴﾗｰ  ***".
001640       03  E-ME98  COLUMN  75   PIC  X(005) VALUE ""27"J"05"".
001650       03  E-ME99  COLUMN  75   PIC  X(005) VALUE ""27"B"05"".
001660       03  E-CL.
001670         04  COLUMN   1   PIC  X(040) VALUE
001680              "                                        ".
001690         04  COLUMN  41   PIC  X(040) VALUE
001700              "                                        ".
001710     COPY LIBSCR.
001720 PROCEDURE DIVISION.
001730 M-05.
001740     DISPLAY C-CLEAR.
001750     DISPLAY C-MID.
001760 M-10.
001770     ACCEPT A-DMM.
001780     IF ESTAT = PF9
001790         GO TO M-95.
001800     IF ESTAT NOT = HTB AND SKP
001810         GO TO M-10.
001820     IF W-DMM = 9
001830         GO TO M-95.
001840     IF W-DMM NOT = 1
001850         GO TO M-10.
001860*
001870     OPEN I-O JSS-F.
001880 M-15.
001890     READ JSS-F NEXT RECORD AT END
001900         CLOSE JSS-F
001910         DISPLAY E-ME1 E-ME99
001920         GO TO M-95.
001930     IF JS-KHC NOT = 0
001940         GO TO M-15.
001950     IF JS-KCO = ZERO OR SPACE
001960         GO TO M-15.
001970     IF JS-JCD < 490000 OR > 498999
001980         GO TO M-15.
001990*
002000     OPEN INPUT S-M.
002010     OPEN INPUT J-M.
002020     OPEN INPUT KH-M.
002030     OPEN OUTPUT SP-F.
002040     COPY LIBCPR.
002050     MOVE DATE-05R TO H-DATE.
002060     PERFORM S-10 THRU S-15.
002070 M-20.
002080     MOVE JS-DATE TO W-DATE.
002090     MOVE 0 TO CHK.
002100 M-25.
002110     MOVE JS-KCO TO KH-KEY.
002120     READ KH-M WITH UNLOCK INVALID KEY
002130         MOVE " ***  KHM ﾅｼ  ***   " TO KH-NAME.
002140     MOVE JS-SCD TO S-KEY.
002150     READ S-M WITH UNLOCK INVALID KEY
002160         MOVE SPACE TO S-NAME
002170         MOVE NC"　＊＊　仕入先マスター　なし　＊＊" TO S-NAME.
002180     MOVE JS-JCD TO J-KEY.
002190     READ J-M WITH UNLOCK INVALID KEY
002200         MOVE SPACE TO J-NAME
002210         MOVE NC"　＊＊　材料マスター　なし　＊＊　　" TO J-NAME.
002220*
002230     MOVE SPACE TO W-P.
002240     MOVE SPACE TO P-SNA P-JNA.
002250     IF CHK = 0
002260         MOVE 1 TO CHK
002270         MOVE W-NGPS TO P-DATE.
002280     MOVE JS-KCO TO P-KCO.
002290     MOVE KH-NAME TO P-KNA.
002300     MOVE JS-SU TO P-SU.
002310     MOVE JS-SCD TO P-SCD.
002320     MOVE S-NAME TO P-SNA.
002330     MOVE JS-JCD TO P-JCD.
002340     MOVE J-NAME TO P-JNA.
002350     IF LINAGE-COUNTER > 60
002360         MOVE W-NGPS TO P-DATE
002370         PERFORM S-05 THRU S-15.
002380     MOVE SPACE TO SP-R.
002390     MOVE W-P TO SP-R.
002400     WRITE SP-R.
002410     MOVE SPACE TO SP-R.
002420*
002430     MOVE 1 TO JS-KHC.
002440     REWRITE JSS-R INVALID KEY
002450         DISPLAY E-ME2 E-STAT E-ME99
002460         GO TO M-90.
002470 M-30.
002480     READ JSS-F NEXT RECORD AT END
002490         GO TO M-90.
002500     IF JS-KHC NOT = 0
002510         GO TO M-30.
002520     IF JS-KCO = ZERO OR SPACE
002530         GO TO M-30.
002540     IF JS-JCD < 490000 OR > 498999
002550         GO TO M-30.
002560     IF JS-DATE = W-DATE
002570        GO TO M-25.
002580     GO TO M-20.
002590 M-90.
002600     CLOSE S-M.
002610     CLOSE J-M.
002620     CLOSE KH-M.                                                  I.020325
002630     CLOSE JSS-F.
002640     CLOSE SP-F.
002650 M-95.
002660     DISPLAY C-CLEAR.
002670     STOP RUN.
002680 S-05.
002690     MOVE SPACE TO SP-R.
002700     WRITE SP-R AFTER PAGE.
002710 S-10.
002720     ADD 1 TO W-PAGE.
002730     MOVE W-PAGE TO H-PAGE.
002740     MOVE SPACE TO SP-R.
002750     MOVE HEAD1 TO SP-R.
002760     WRITE SP-R.
002770     MOVE SPACE TO SP-R.
002780     MOVE HEAD2 TO SP-R.
002790     WRITE SP-R AFTER 2.
002800     MOVE SPACE TO SP-R.
002810 S-15.
002820     EXIT.
