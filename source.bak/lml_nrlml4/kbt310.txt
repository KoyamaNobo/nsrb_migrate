000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. KBT310.
000030*********************************************************
000040*    PROGRAM         :  仕入先日付別仕入明細問合せ　    *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :  SCBT31                          *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT S-M ASSIGN TO S-MSD
000160         ORGANIZATION INDEXED
000170         RECORD KEY S-KEY
000180         ACCESS MODE DYNAMIC
000190         FILE STATUS IS ERR-STAT.
000200     SELECT J-M ASSIGN TO J-MSD
000210         ORGANIZATION INDEXED
000220         RECORD KEY J-KEY
000230         ACCESS MODE RANDOM
000240         FILE STATUS IS ERR-STAT.
000250     SELECT JSSR-F ASSIGN TO JSSR-MSD.
000260 I-O-CONTROL.
000270     APPLY SHARED-MODE ON S-M
000280     APPLY SHARED-MODE ON J-M.
000290 DATA DIVISION.
000300 FILE SECTION.
000310     COPY LISM.
000320     COPY LIJM.
000330     COPY LSJSSW.
000340 WORKING-STORAGE SECTION.
000350 77  WK0128ID           PIC  X(009) VALUE SPACE.
000360 01  STN-NO.
000370     02  STN-NO1        PIC  X(003).
000380     02  STN-NO2        PIC  X(003).
000390 01  W-FID.
000400     02  W-FID1         PIC  X(006) VALUE "WK0128".
000410     02  W-FID2         PIC  X(003).
000420 01  W-D.
000430     02  W-SCD          PIC  9(004).
000440     02  W-SJCD         PIC  9(006).
000450     02  W-EJCD         PIC  9(006).
000460     02  W-NGP.
000470       03  W-NEN        PIC  9(004).
000480       03  W-NENL  REDEFINES W-NEN.
000490         04  W-NEN1     PIC  9(002).
000500         04  W-NEN2     PIC  9(002).
000510       03  W-GP.
000520         04  W-GET      PIC  9(002).
000530         04  W-PEY      PIC  9(002).
000540     02  W-NGPD  REDEFINES W-NGP.
000550       03  F            PIC  9(002).
000560       03  W-NGPS       PIC  9(006).
000570     02  W-DMM          PIC  9(001).
000580     02  W-DCN          PIC  N(004).
000590     02  W-KIN          PIC S9(008).
000600     02  W-L1           PIC  9(002).
000610     02  W-L2           PIC  9(002).                                   A 6
000620     02  W-END          PIC  9(001).
000630 01  ERR-STAT           PIC  X(002).
000640     COPY LSTAT.
000650 SCREEN SECTION.
000660 SD  C-CRT
000670     END STATUS IS ESTAT.
000680 01  C-CLEAR.
000690     02  C-CL    LINE  1  CLEAR SCREEN.
000700 01  C-ACP.
000710     02  LINE   4.
000720       03  A-SCD   COLUMN   1  PIC  9(004)
000730            USING W-SCD   CHECK OVERFLOW NO IFC.
000740       03  A-SJCD  COLUMN  55  PIC  9(006)
000750          USING W-SJCD  CHECK OVERFLOW NO IFC.
000760       03  A-EJCD  COLUMN  63  PIC  9(006)
000770          USING W-EJCD  CHECK OVERFLOW NO IFC.
000780     02  A-NGPS  LINE   8  COLUMN   1  PIC  9(006)
000790          USING W-NGPS  CHECK OVERFLOW NO IFC.
000800     02  A-DMM   LINE  23  COLUMN  72  PIC  9(001)
000810          USING W-DMM   CHECK OVERFLOW NO IFC.
000820 01  C-DSP.
000830     02  D-SNA   LINE   4  COLUMN   6  PIC  N(024) FROM  S-NAME.
000840     02  D-MEI.
000850       03  LINE W-L1.
000860         04  COLUMN   1  PIC  9(006)        FROM  JR-NGPS.
000870         04  COLUMN   8  PIC  9(006)        FROM  JR-DNO.
000880         04  COLUMN  14  PIC  X(001)        VALUE "-".
000890         04  COLUMN  15  PIC  9(001)        FROM  JR-GNO.
000900         04  COLUMN  17  PIC  9(006)        FROM  JR-JCD.
000910         04  COLUMN  24  PIC  N(024)        FROM  J-NAME.
000920       03  LINE W-L2.
000930         04  COLUMN  26  PIC  N(004)        FROM  W-DCN.
000940         04  COLUMN  35  PIC ZZ/ZZ/ZZ       FROM  JR-SDAT.
000950         04  COLUMN  44  PIC --,---,---.--  FROM  JR-SU.
000960         04  COLUMN  58  PIC ----,---.--    FROM  JR-T.
000970         04  COLUMN  70  PIC ---,---,---    FROM  W-KIN.
000980     02  LINE  23.
000990       03  D-NM    COLUMN  20  PIC  X(053) VALUE
001000         "NEXT=ﾘﾀｰﾝ , ｺｰﾄﾞ=F10 , 材料=F8 , 日付=F5 , 終了=F9   ".
001010       03  D-EM    COLUMN   1  PIC  X(012) VALUE "[ END DATA ]".
001020 01  C-ERR.
001030     02  LINE  24.
001040       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
001050            "***  DATA ﾅｼ  ***".
001060       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
001070            "***  ｼｲﾚｻｷ ﾅｼ  ***".
001080       03  E-ME98  COLUMN  75  PIC  X(075) VALUE ""27"J"05"".
001090       03  E-ME99  COLUMN  75  PIC  X(075) VALUE ""27"B"05"".
001100       03  E-CL    COLUMN  10  PIC  X(050) VALUE
001110            "                                                  ".
001120 PROCEDURE DIVISION.
001130 M-05.
001140     DISPLAY C-CLEAR.
001150     CALL "SCBT31".
001160     CALL "CBLSTNNO" USING STN-NO.
001170     MOVE STN-NO2 TO W-FID2.
001180     MOVE W-FID TO WK0128ID.
001190     OPEN INPUT S-M.
001200     OPEN INPUT J-M.
001210 M-10.
001220     ACCEPT A-SCD.
001230     DISPLAY E-CL.
001240     IF ESTAT = C2 OR PF9
001250         GO TO M-95.
001260     IF ESTAT NOT = HTB AND SKP
001270         GO TO M-10.
001280     MOVE W-SCD TO S-KEY.
001290     READ S-M WITH UNLOCK INVALID KEY
001300         DISPLAY E-ME1 E-ME99
001310         GO TO M-10.
001320     DISPLAY D-SNA.
001330 M-15.
001340     ACCEPT A-SJCD.
001350     DISPLAY E-CL.
001360     IF ESTAT = BTB
001370         GO TO M-10.
001380     IF ESTAT = C2 OR PF9
001390         GO TO M-95.
001400     IF ESTAT NOT = HTB AND SKP
001410         GO TO M-15.
001420 M-20.
001430     ACCEPT A-EJCD.
001440     DISPLAY E-CL.
001450     IF ESTAT = BTB
001460         GO TO M-15.
001470     IF ESTAT NOT = HTB AND SKP
001480         GO TO M-20.
001490     IF W-SJCD > W-EJCD
001500         GO TO M-20.
001510 M-25.
001520     ACCEPT A-NGPS.
001530     DISPLAY E-CL.
001540     IF ESTAT = BTB
001550         GO TO M-20.
001560     IF ESTAT = C2 OR PF9
001570         GO TO M-95.
001580     IF ESTAT NOT = HTB AND SKP
001590         GO TO M-25.
001600     MOVE 20 TO W-NEN1.
001610*
001620     OPEN INPUT JSSR-F.
001630 M-30.
001640     READ JSSR-F AT END
001650         CLOSE JSSR-F
001660         DISPLAY E-ME1 E-ME99
001670         GO TO M-10.
001680     IF JR-SCD < W-SCD
001690         GO TO M-30.
001700     IF JR-SCD > W-SCD
001710         CLOSE JSSR-F
001720         DISPLAY E-ME1 E-ME99
001730         GO TO M-10.
001740     IF JR-JCD < W-SJCD OR > W-EJCD
001750         GO TO M-30.
001760     IF JR-DATE < W-NGP
001770         GO TO M-30.
001780*
001790     MOVE 0 TO W-END.
001800     MOVE 6 TO W-L1.
001810     MOVE 7 TO W-L2.
001820 M-35.
001830     ADD 2 TO W-L1 W-L2.
001840     IF W-L1 > 21
001850         DISPLAY D-NM
001860         GO TO M-45.
001870     MOVE JR-JCD TO J-KEY.
001880     READ J-M WITH UNLOCK INVALID KEY
001890         MOVE SPACE TO J-NAME
001900         MOVE NC"　　材料マスタなし　" TO J-NAME.
001910     MOVE SPACE TO W-DCN.
001920     IF JR-DC = 11
001930         MOVE NC"数量訂正" TO W-DCN
001940       ELSE
001950         IF JR-DC = 12
001960             MOVE NC"単価訂正" TO W-DCN
001970           ELSE
001980             IF JR-DC = 13
001990                 MOVE NC"輸入振替" TO W-DCN
002000               ELSE
002010                 IF JR-DC = 14
002020                     MOVE NC"無償他　" TO W-DCN.
002030     MOVE JR-KIN TO W-KIN.
002040     IF JR-SHZ NOT = ZERO
002050         MOVE JR-SHZ TO W-KIN.
002060     DISPLAY D-MEI.
002070 M-40.
002080     READ JSSR-F AT END
002090         MOVE 1 TO W-END
002100         DISPLAY D-EM
002110         GO TO M-45.
002120     IF JR-SCD > W-SCD
002130         MOVE 1 TO W-END
002140         DISPLAY D-EM
002150         GO TO M-45.
002160     IF JR-JCD < W-SJCD OR > W-EJCD
002170         GO TO M-40.
002180     IF JR-DATE < W-NGP
002190         GO TO M-40.
002200     GO TO M-35.
002210 M-45.
002220     ACCEPT A-DMM.
002230     IF ESTAT = PF9
002240         GO TO M-90.
002250     IF W-END = 1
002260         CLOSE JSSR-F
002270         DISPLAY C-CLEAR
002280         CALL "SCBT31"
002290         DISPLAY A-SCD D-SNA A-SJCD A-EJCD
002300         GO TO M-10.
002310     IF ESTAT NOT = HTB AND ADV AND PF8 AND PF5
002320         GO TO M-45.
002330     DISPLAY C-CLEAR.
002340     CALL "SCBT31".
002350     DISPLAY A-SCD D-SNA A-SJCD A-EJCD.
002360     IF ESTAT = HTB
002370         MOVE 6 TO W-L1
002380         MOVE 7 TO W-L2
002390         GO TO M-35.
002400     CLOSE JSSR-F.
002410     IF ESTAT = PF8
002420         GO TO M-15.
002430     IF ESTAT = PF5
002440         GO TO M-25.
002450     GO TO M-10.
002460 M-90.
002470     CLOSE JSSR-F.
002480     CLOSE S-M.
002490     CLOSE J-M.
002500 M-95.
002510     DISPLAY C-CLEAR.
002520     STOP RUN.
