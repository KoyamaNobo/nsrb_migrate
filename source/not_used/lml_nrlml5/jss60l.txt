000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JSS60L.
000030*********************************************************
000040*    PROGRAM         :  生協荷札入日記表                *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SNFWK ASSIGN TO SNFWK-MSD
000160         ORGANIZATION SEQUENTIAL
000170         ACCESS MODE  SEQUENTIAL
000180         FILE STATUS IS ERR-STAT.
000190     SELECT TC-M ASSIGN TO TC-MSD
000200         ORGANIZATION INDEXED
000210         ACCESS MODE  RANDOM
000220         RECORD KEY   TC-KEY
000230         FILE STATUS IS ERR-STAT.
000240     SELECT HI2-M ASSIGN TO HI2-MSD
000250         ORGANIZATION INDEXED
000260         ACCESS MODE  RANDOM
000270         RECORD KEY   HI-KEY2
000280         FILE STATUS IS ERR-STAT.
000290     SELECT JCON ASSIGN TO JCON-MSD
000300         ORGANIZATION INDEXED
000310         ACCESS MODE  DYNAMIC
000320         RECORD KEY   JCON1-KEY
000330         FILE STATUS IS ERR-STAT.
000340     SELECT SP-F ASSIGN TO P-PRN999.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON TC-M  HI2-M  JCON
000370     APPLY SHIFT-CODE  ON SP-F.
000380*
000390 DATA DIVISION.
000400 FILE SECTION.
000410     COPY    LSNFWK.
000420     COPY    LITCM.
000430     COPY    LIHIM2.
000440     COPY    L-JCON.
000450     COPY    LSPF.
000460*
000470 WORKING-STORAGE SECTION.
000480 77  W-FILE             PIC  X(13).
000490 01  ERR-STAT           PIC  X(02).
000500 01  HEAD1.
000510     02  F              PIC  X(05)  VALUE  ""3FE04FE080"".
000520     02  F              PIC  X(29)  VALUE  SPACE.
000530     02  F              PIC  N(25)  VALUE
000540       NC"＊＊＊　　生　協　荷　札　入　日　記　表　　＊＊＊".
000550     02  F              PIC  X(30)  VALUE  SPACE.
000560     02  H-SYSY         PIC  9(02).
000570     02  F              PIC  X(01)  VALUE    "-".
000580     02  H-SYSM         PIC  9(02).
000590     02  F              PIC  X(01)  VALUE    "-".
000600     02  H-SYSD         PIC  9(02).
000610     02  F              PIC  X(10)  VALUE  SPACE.
000620     02  F              PIC  X(05)  VALUE    "PAGE.".
000630     02  H-PAGE         PIC  ZZZ9.
000640 01  HEAD2.
000650     02  F              PIC  N(05)  VALUE  NC"送り状№　".
000660     02  F              PIC  X(10)  VALUE    " 発 送 日 ".
000670     02  F              PIC  X(11)  VALUE    "直送先ｺｰﾄﾞ ".
000680     02  F              PIC  N(09)  VALUE  NC"得意先名／直送先名".
000690     02  F              PIC  X(37)  VALUE  SPACE.
000700     02  F              PIC  N(05)  VALUE  NC"運送／倉庫".
000710     02  F              PIC  X(11)  VALUE  SPACE.
000720     02  F              PIC  N(02)  VALUE  NC"個数".
000730 01  HEAD3.
000740     02  F              PIC  X(01)  VALUE  SPACE.
000750     02  F              PIC  N(02)  VALUE  NC"品名".
000760     02  F              PIC  X(05)  VALUE    "ｺｰﾄﾞ ".
000770     02  F              PIC  N(02)  VALUE  NC"品名".
000780 01  HEAD4.
000790     02  F              PIC  X(12)  VALUE    "  ３号 ２号 ".
000800     02  F              PIC  X(11)  VALUE    "ＳＳ  Ｓ   ".
000810     02  F              PIC  X(12)  VALUE    "Ｍ   Ｌ ＬＬ".
000820     02  F              PIC  X(87)  VALUE  SPACE.
000830     02  F              PIC  X(10)  VALUE    "ＸＬ XXL  ".
000840     02  F              PIC  N(02)  VALUE  NC"合計".
000850 01  HEAD5.
000860     02  F              PIC  X(47)  VALUE
000870         "  12.5 13.0 13.5 14.0 15.0 16.0 17.0 18.0 19.0 ".
000880     02  F              PIC  X(45)  VALUE
000890         "20.0 21.0 21.5 22.0 22.5 23.0 23.5 24.0 24.5 ".
000900     02  F              PIC  X(44)  VALUE
000910         "25.0 25.5 26.0 26.5 27.0 27.5 28.0 29.0 30.0".
000920 01  HEAD6.
000930     02  F              PIC  N(04)  VALUE  NC"　配達日".
000940     02  F              PIC  X(16)  VALUE  SPACE.
000950     02  F              PIC  N(03)  VALUE  NC"摘　要".
000960 01  MEI1.
000970     02  F              PIC  X(01)  VALUE  SPACE.
000980     02  M-OKNO         PIC  9(06).
000990     02  F              PIC  X(04)  VALUE  SPACE.
001000     02  M-HATY         PIC  9(02).
001010     02  M-A            PIC  X(01).
001020     02  M-HATM         PIC  9(02).
001030     02  M-B            PIC  X(01).
001040     02  M-HATD         PIC  9(02).
001050     02  F              PIC  X(02)  VALUE  SPACE.
001060     02  M-TOKCD        PIC  9(04).
001070     02  M-C            PIC  X(01).
001080     02  M-TYNO         PIC  9(03).
001090     02  F              PIC  X(02)  VALUE  SPACE.
001100     02  M-TCM          PIC  N(26).
001110     02  F              PIC  X(03)  VALUE  SPACE.
001120     02  M-JCON         PIC  N(06).
001130     02  F              PIC  X(08)  VALUE  SPACE.
001140     02  M-EDA          PIC  ZZ9.
001150     02  M-D            PIC  X(01).
001160     02  M-KOSU         PIC  ZZ9.
001170 01  MEI2.
001180     02  F              PIC  X(02)  VALUE  SPACE.
001190     02  M-HINCD        PIC  9(06).
001200     02  F              PIC  X(01)  VALUE  SPACE.
001210     02  M-HINNA        PIC  N(24).
001220     02  F              PIC  X(75)  VALUE  SPACE.
001230     02  M-SUM          PIC  ZZZZ.
001240 01  MEI3.
001250     02  F              PIC  X(01)  VALUE  SPACE.
001260     02  M-SIZE         OCCURS  27.
001270       03  F            PIC  X(02)  VALUE  SPACE.
001280       03  M-SZKB       PIC  ZZZ.
001290 01  MEI4.
001300     02  F              PIC  X(02)  VALUE  SPACE.
001310     02  M-HAI          PIC  N(09).
001320     02  F              PIC  X(04)  VALUE  SPACE.
001330     02  M-TEKI         PIC  N(23).
001340     02  F              PIC  X(62)  VALUE  SPACE.
001350     02  M-HASU         PIC  N(02).
001360 01  W-NONYMD.
001370     02  W-NONY         PIC  9(02).
001380     02  W-NONM         PIC  9(02).
001390     02  W-NOND         PIC  9(02).
001400 01  W-SYSDATE.
001410     02  W-SYSYMD       PIC  9(06).
001420     02  F              REDEFINES    W-SYSYMD.
001430       03  W-SYSY       PIC  9(02).
001440       03  W-SYSM       PIC  9(02).
001450       03  W-SYSD       PIC  9(02).
001460 01  W-DATA.
001470     02  W-FLG          PIC  9(01).
001480     02  PNO            PIC  9(04).
001490     02  LNO            PIC  9(02).
001500     02  CNT            PIC  9(02).
001510     02  W-SUM          PIC  9(04).
001520     02  W-UNNA         OCCURS  09  PIC  N(06).
001530     02  W-SOKNA        OCCURS  09  PIC  N(06).
001540     02  W-ISU          PIC  9(03).
001550     02  W-GSU          PIC  9(05).
001560*
001570     COPY    LSTAT.
001580     COPY    LWMSG.
001590*
001600 SCREEN SECTION.
001610 SD  C-CRT
001620     END STATUS ESTAT.
001630 01  C-CLEAR.
001640     02  LINE   1  CLEAR SCREEN.
001650 01  DSP-AREA.
001660     02  D-TITLE     LINE  01  COLUMN  16    PIC  N(19)  VALUE
001670         NC"＊＊＊　　生協　荷札入日記表　　＊＊＊".
001680     02  LINE  07.
001690       03  D-NONY      COLUMN  33    PIC  9(02)  FROM  W-NONY.
001700       03  D-NONM      COLUMN  37    PIC  9(02)  FROM  W-NONM.
001710       03  D-NOND      COLUMN  41    PIC  9(02)  FROM  W-NOND.
001720       03  D-NONYMD    COLUMN  24    PIC  X(21)  VALUE
001730             "納  期：   年  月  日".
001740 01  MSG-AREA.
001750     02  LINE  24.
001760       03  MSG-01     COLUMN  15  PIC  N(13)  VALUE
001770         NC"生協荷札データ未作成です。".
001780     COPY    LSSEM.
001790     COPY    LSMSG.
001800*
001810 PROCEDURE DIVISION.
001820 MAIN-01.
001830     PERFORM    INIT-RTN  THRU  INIT-EX.
001840     IF  W-FLG = 9
001850         MOVE     255  TO  COMPLETION-CODE
001860         GO TO    MAIN-05.
001870 MAIN-04.
001880     PERFORM    LST-RTN  THRU  LST-EX.
001890 MAIN-05.
001900     PERFORM    END-RTN  THRU  END-EX.
001910     STOP RUN.
001920*
001930*-----初期処理-----*
001940 INIT-RTN.
001950     DISPLAY    C-CLEAR.
001960     ACCEPT     W-SYSYMD  FROM  DATE.
001970     DISPLAY    DSP-AREA.
001980     INITIALIZE    W-DATA.
001990     OPEN INPUT    JCON.
002000     MOVE    "7 "  TO  JCON7-KEY.
002010     READ    JCON  WITH UNLOCK
002020         INVALID KEY    MOVE    ERR-STAT   TO  ERR-FLG
002030                        MOVE    "G"        TO  ERR-M
002040                        MOVE    "JCON"     TO  ERR-F
002050                        MOVE    JCON7-KEY  TO  ERR-K
002060                        MOVE    9          TO  W-FLG
002070                        DISPLAY    ERR-DIS  DISP-BUZ-B
002080                        GO TO    INIT-99.
002090     IF  JCON7-11 = ZERO
002100         MOVE    9  TO  W-FLG
002110         DISPLAY    DISP-BUZ-B
002120         GO TO    INIT-99
002130     ELSE
002140         MOVE    JCON7-11  TO  W-NONYMD
002150         DISPLAY    D-NONY  D-NONM  D-NOND.
002160     MOVE    2  TO  JCON2-01.
002170     MOVE    1  TO  JCON2-02.
002180     START    JCON    KEY NOT < JCON2-KEY
002190         INVALID KEY    GO TO    INIT-02.
002200 INIT-01.
002210     READ     JCON    NEXT RECORD  WITH UNLOCK
002220         AT END    GO TO    INIT-02.
002230     IF  JCON2-01 = 2
002240         MOVE     JCON2-03  TO  W-UNNA(JCON2-02)
002250         GO TO    INIT-01.
002260 INIT-02.
002270     MOVE    3  TO  JCON3-01.
002280     MOVE    1  TO  JCON3-02.
002290     START    JCON    KEY NOT < JCON3-KEY
002300         INVALID KEY    GO TO    INIT-99.
002310 INIT-03.
002320     READ     JCON    NEXT RECORD  WITH UNLOCK
002330         AT END    GO TO    INIT-99.
002340     IF  JCON3-01 = 3
002350         MOVE    JCON3-03  TO  W-SOKNA(JCON3-02)
002360         GO TO    INIT-03.
002370 INIT-99.
002380     CLOSE    JCON.
002390 INIT-EX.
002400     EXIT.
002410*
002420*-----終了処理-----*
002430 END-RTN.
002440     IF  W-FLG NOT = 9
002450         CLOSE    SNFWK  TC-M  HI2-M  SP-F.
002460 END-EX.
002470     EXIT.
002480*
002490*----出力処理-----*
002500 LST-RTN.
002510     OPEN INPUT     SNFWK  TC-M  HI2-M.
002520     OPEN OUTPUT    SP-F.
002530     MOVE    W-SYSY  TO  H-SYSY.
002540     MOVE    W-SYSM  TO  H-SYSM.
002550     MOVE    W-SYSD  TO  H-SYSD.
002560     MOVE    90  TO  LNO.
002570 LST-01.
002580     READ    SNFWK    NEXT RECORD  WITH UNLOCK
002590         AT END    GO TO    LST-EX.
002600     IF  SNF1-03 = 7
002610         MOVE     SNF2-04  TO  M-HAI
002620         MOVE     SNF2-05  TO  M-TEKI
002630         IF  W-ISU NOT = W-GSU
002640             MOVE  NC"端数"     TO  M-HASU
002650         ELSE
002660             MOVE  SPACE        TO  M-HASU
002670         END-IF
002680         MOVE     SPACE    TO  SP-R
002690         MOVE     MEI4     TO  SP-R
002700         WRITE    SP-R
002710         ADD    1  TO  LNO
002720         GO TO     LST-01.
002730     IF  SNF1-03 NOT = 1
002740         GO TO    LST-02.
002750     ADD    3  TO  LNO.
002760     IF  LNO > 63
002770         PERFORM    HEAD-RTN  THRU  HEAD-EX
002780         ADD     3  TO  LNO.
002790     MOVE     SNF1-061  TO  TC-TCD.
002800     MOVE     1  TO  TC-CCD.
002810     READ     TC-M    WITH UNLOCK
002820         INVALID KEY    INITIALIZE    TC-R.
002830     MOVE     SNF1-01   TO  M-OKNO.
002840     MOVE     SNF1-051  TO  M-HATY.
002850     MOVE     SNF1-052  TO  M-HATM.
002860     MOVE     SNF1-053  TO  M-HATD.
002870     MOVE     SNF1-061  TO  M-TOKCD.
002880     MOVE     SNF1-062  TO  M-TYNO.
002890     MOVE     TC-NAME   TO  M-TCM.
002900     IF  SNF1-07 = 0
002910         INITIALIZE    M-JCON
002920     ELSE
002930         MOVE     W-UNNA(SNF1-07)  TO  M-JCON.
002940     MOVE     SNF1-02   TO  M-EDA.
002950     MOVE     SNF1-09   TO  M-KOSU.
002960     MOVE     "-"  TO  M-A  M-B  M-C.
002970     MOVE     "/"  TO  M-D.
002980 LST-01A.
002990     MOVE     SNF1-04  TO  HI-HCD  HI-MHCD.
003000     READ     HI2-M    WITH UNLOCK
003010         INVALID KEY    INITIALIZE    HI-R.
003020     MOVE     HI-ISU    TO  W-ISU.
003030     MOVE     ZERO      TO  W-GSU.
003040 LST-01B.
003050     MOVE     SPACE     TO  SP-R.
003060     MOVE     MEI1      TO  SP-R.
003070     WRITE    SP-R    AFTER  2.
003080     MOVE     SPACE     TO  MEI1  SP-R.
003090     MOVE     SNF1-06   TO  TC-KEY.
003100     READ     TC-M    WITH UNLOCK
003110         INVALID KEY    INITIALIZE    TC-R.
003120     MOVE     TC-NAME   TO  M-TCM.
003130     IF  SNF1-08 = 0
003140         INITIALIZE    M-JCON
003150     ELSE
003160         MOVE     W-SOKNA(SNF1-08)  TO  M-JCON.
003170     MOVE     MEI1      TO  SP-R.
003180     WRITE    SP-R.
003190 LST-02.
003200     ADD    2  TO  LNO.
003210     IF  LNO > 63
003220         PERFORM    HEAD-RTN  THRU  HEAD-EX
003230         MOVE     SPACE  TO  SP-R
003240         WRITE    SP-R
003250         ADD    3  TO  LNO.
003260     MOVE     SNF1-04  TO  HI-HCD  HI-MHCD  M-HINCD.
003270     READ     HI2-M    WITH UNLOCK
003280         INVALID KEY    INITIALIZE    HI-R.
003290     MOVE     HI-NAME  TO  M-HINNA.
003300     MOVE     0  TO  W-SUM.
003310     MOVE     1  TO  CNT.
003320 LST-03.
003330     MOVE     SNF1-101(CNT)  TO  M-SZKB(CNT).
003340     ADD      SNF1-101(CNT)  TO  W-SUM.
003350     IF  CNT < 27
003360         ADD    1  TO  CNT
003370         GO TO     LST-03.
003380     MOVE     W-SUM  TO  M-SUM.
003390     ADD      W-SUM  TO  W-GSU.
003400     MOVE     SPACE  TO  SP-R.
003410     MOVE     MEI2   TO  SP-R.
003420     WRITE    SP-R.
003430     MOVE     SPACE  TO  SP-R.
003440     MOVE     MEI3   TO  SP-R.
003450     WRITE    SP-R.
003460     GO TO    LST-01.
003470 LST-EX.
003480     EXIT.
003490*
003500*-----ヘッダー印字処理-----*
003510 HEAD-RTN.
003520     IF  LNO < 90
003530         MOVE     SPACE  TO  SP-R
003540         WRITE    SP-R   AFTER  PAGE.
003550     ADD    1  TO  PNO.
003560     MOVE     PNO    TO  H-PAGE.
003570     MOVE     SPACE  TO  SP-R.
003580     MOVE     HEAD1  TO  SP-R.
003590     WRITE    SP-R.
003600     MOVE     SPACE  TO  SP-R.
003610     MOVE     HEAD2  TO  SP-R.
003620     WRITE    SP-R   AFTER  2.
003630     MOVE     SPACE  TO  SP-R.
003640     MOVE     HEAD3  TO  SP-R.
003650     WRITE    SP-R.
003660     MOVE     SPACE  TO  SP-R.
003670     MOVE     HEAD4  TO  SP-R.
003680     WRITE    SP-R.
003690     MOVE     SPACE  TO  SP-R.
003700     MOVE     HEAD5  TO  SP-R.
003710     WRITE    SP-R.
003720     MOVE     SPACE  TO  SP-R.
003730     MOVE     HEAD6  TO  SP-R.
003740     WRITE    SP-R.
003750     MOVE     SPACE  TO  SP-R.
003760     MOVE     7  TO  LNO.
003770 HEAD-EX.
003780     EXIT.
003790*
003800***
003810     COPY    LPMSG.
