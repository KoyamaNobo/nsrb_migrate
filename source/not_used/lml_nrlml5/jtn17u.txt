000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JTN17U.
000030*********************************************************
000040*    PROGRAM         :  生協出荷予定変換　              *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SSYF ASSIGN TO SSY-MSD.
000160     SELECT HI2-M ASSIGN TO HI-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY HI-KEY2
000200         FILE STATUS IS ERR-STAT.
000210     SELECT GSYF ASSIGN TO GSY-RDB
000220         ORGANIZATION INDEXED
000230         ACCESS MODE DYNAMIC
000240         RECORD KEY GSY-KEY
000250         FILE STATUS IS ERR-STAT.
000260 I-O-CONTROL.
000270     APPLY SHARED-MODE ON HI2-M
000280     APPLY SHARED-MODE ON GSYF.
000290 DATA DIVISION.
000300 FILE SECTION.
000310     COPY LIHIM2.
000320     COPY LIGSYF.
000330 FD  SSYF
000340     BLOCK  3 RECORDS
000350     LABEL RECORD IS STANDARD
000360     VALUE OF IDENTIFICATION "SSYF".
000370 01  SSY-R.
000380     02  SSY-KEY.
000390       03  SSY-HCD      PIC  9(006).
000400       03  SSY-TCD      PIC  9(004).
000410       03  SSY-ND       PIC  9(008).
000420       03  SSY-SIZ      PIC  9(001).
000430     02  SSY-ASU.
000440       03  SSY-SUD   OCCURS  10.
000450         04  SSY-SU     PIC S9(006).
000460 WORKING-STORAGE SECTION.
000470 77  ERR-STAT           PIC  X(002).
000480 77  W-FILE             PIC  X(013).
000490 01  W-DATA.
000500     02  W-HCD          PIC  9(006).
000510     02  W-SYSD         PIC  9(006).
000520     02  W-DMM          PIC  9(001).
000530     COPY LSTAT.
000540 SCREEN SECTION.
000550 SD  C-CRT
000560     END STATUS IS ESTAT.
000570 01  C-CLEAR.
000580     02  LINE  1  CLEAR SCREEN.
000590 01  C-MID.
000600     02  LINE   3  COLUMN  20  PIC  N(020) VALUE
000610          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000620     02  LINE   4  COLUMN  20  PIC  N(020) VALUE
000630          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000640     02  LINE   5  COLUMN  20  PIC  N(020) VALUE
000650          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
000660     02  LINE   6  COLUMN  20  PIC  N(020) VALUE
000670          NC"＊＊＊　　生協　出荷予定　変換　　＊＊＊".
000680     02  LINE   7  COLUMN  20  PIC  N(020) VALUE
000690          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
000700     02  LINE   8  COLUMN  20  PIC  N(020) VALUE
000710          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000720     02  LINE   9  COLUMN  20  PIC  N(020) VALUE
000730          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
000740     02  LINE  23  COLUMN  42  PIC  X(022) VALUE
000750          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
000760 01  C-ACP.
000770     02  A-DMM   LINE  23  COLUMN  59  PIC  9(001)
000780          USING W-DMM   CHECK OVERFLOW NO IFC.
000790 01  C-ERR.
000800     02  LINE  24.
000810       03  E-ME1   COLUMN  15  PIC  X(025) VALUE
000820            "***  DATA ﾅｼ  ***        ".
000830       03  E-ME2   COLUMN  15  PIC  X(025) VALUE
000840            "***  ﾋﾝﾒｲ ﾅｼ  ***        ".
000850       03  E-ME3   COLUMN  15  PIC  X(025) VALUE
000860            "***  WRITE ｴﾗｰ  ***      ".
000870       03  E-ME4   COLUMN  15  PIC  X(025) VALUE
000880            "***  REWRITE ｴﾗｰ  ***    ".
000890       03  E-KEY.
000900         04  COLUMN  41  PIC  9(006) FROM  W-HCD.
000910         04  COLUMN  48  PIC  9(004) FROM  SSY-TCD.
000920         04  COLUMN  53  PIC  9(008) FROM  SSY-ND.
000930         04  COLUMN  62  PIC  9(001) FROM  SSY-SIZ.
000940     COPY LIBSCR.
000950     COPY LSSEM.
000960 PROCEDURE DIVISION.
000970 M-05.
000980     DISPLAY C-CLEAR.
000990     DISPLAY C-MID.
001000     MOVE ZERO TO W-DATA.
001010 M-10.
001020     ACCEPT A-DMM.
001030     IF ESTAT = PF9
001040         MOVE 255 TO COMPLETION-CODE
001050         GO TO M-95.
001060     IF ESTAT NOT = HTB AND SKP
001070         GO TO M-10.
001080     IF W-DMM = 9
001090         MOVE 255 TO COMPLETION-CODE
001100         GO TO M-95.
001110     IF W-DMM NOT = 1
001120         GO TO M-10.
001130*
001140     ACCEPT W-SYSD FROM DATE.
001150     OPEN INPUT SSYF.
001160     OPEN INPUT HI2-M.
001170     OPEN I-O GSYF.
001180 M-15.
001190     READ SSYF AT END
001200         DISPLAY E-ME1 E-ME99
001210         GO TO M-90.
001220 M-20.
001230     MOVE SSY-HCD TO W-HCD.
001240     MOVE W-HCD TO HI-MHCD HI-HCD.
001250     READ HI2-M WITH UNLOCK INVALID KEY
001260         DISPLAY E-ME2 E-KEY E-ME99
001270         GO TO M-90.
001280 M-25.
001290     INITIALIZE GSY-R.
001300     MOVE SSY-KEY TO GSY-KEY.
001310     READ GSYF INVALID KEY
001320         GO TO M-30.
001330     MOVE SSY-ASU TO GSY-ASU.
001340     MOVE HI-BCD1 TO GSY-BCD1.
001350     MOVE 1 TO GSY-DC.
001360     MOVE W-SYSD TO GSY-ID.
001370     REWRITE GSY-R INVALID KEY
001380         DISPLAY E-STAT E-ME4 E-KEY E-ME99
001390         GO TO M-90.
001400     GO TO M-45.
001410 M-30.
001420     MOVE SSY-ASU TO GSY-ASU.
001430     MOVE HI-BCD1 TO GSY-BCD1.
001440     MOVE 1 TO GSY-DC.
001450     MOVE W-SYSD TO GSY-ID.
001460 M-35.
001470     WRITE GSY-R INVALID KEY
001480         DISPLAY E-STAT E-ME3 E-KEY E-ME99
001490         GO TO M-40.
001500     GO TO M-45.
001510 M-40.
001520     IF ERR-STAT NOT = "24"
001530         DISPLAY E-ME78 E-ME99
001540         GO TO M-90.
001550     DISPLAY E-CL.
001560     CLOSE GSYF.
001570     DISPLAY E-ME71 E-ME98 STOP " ".
001580     DISPLAY E-CL.
001590     OPEN I-O GSYF.
001600     DISPLAY E-CL.
001610     GO TO M-35.
001620 M-45.
001630     READ SSYF AT END
001640         GO TO M-90.
001650     IF SSY-HCD = W-HCD
001660         GO TO M-25.
001670     GO TO M-20.
001680 M-90.
001690     CLOSE HI2-M.
001700     CLOSE GSYF.
001710     CLOSE SSYF.
001720 M-95.
001730     DISPLAY C-CLEAR.
001740     STOP RUN.
