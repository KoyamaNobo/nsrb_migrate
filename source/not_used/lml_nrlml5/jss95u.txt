000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. JSS95U.
000030*********************************************************
000040*    PROGRAM         :  出荷指図トラン変換　生協→通常  *
000050*    PRINTER TYPE    :  JIPS                            *
000060*    SCREEN          :                                  *
000070*    COMPILE TYPE    :  COBOL                           *
000080*********************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM3100.
000120 OBJECT-COMPUTER. SYSTEM3100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     SELECT SSTR ASSIGN TO SSTR-RDB
000160         ORGANIZATION INDEXED
000170         ACCESS MODE  DYNAMIC
000180         RECORD KEY   SSTR-KEY
000190         FILE STATUS IS ERR-STAT.
000200     SELECT JSTR ASSIGN TO JSTR-MSD
000210         ORGANIZATION INDEXED
000220         ACCESS MODE  DYNAMIC
000230         RECORD KEY   JSTR-KEY
000240         FILE STATUS IS ERR-STAT.
000250 I-O-CONTROL.
000260     APPLY SHARED-MODE ON    SSTR  JSTR.
000270*
000280 DATA DIVISION.
000290 FILE SECTION.
000300     COPY    L-SSTR.
000310     COPY    L-JSTR.
000320*
000330 WORKING-STORAGE SECTION.
000340 77  W-FILE             PIC  X(13).
000350 01  ERR-STAT           PIC  X(02).
000360 01  W-DATA.
000370     02  W-FLG          PIC  9(01).
000380     COPY    LWMSG.
000390*
000400 SCREEN SECTION.
000410 SD  C-CRT
000420     END STATUS ESTAT.
000430 01  C-CLEAR.
000440     02  LINE   1  CLEAR SCREEN.
000450 01  DSP-AREA.
000460     02  D-TITLE    LINE  01    COLUMN  16  PIC  N(22)  VALUE
000470       NC"＊＊＊　　生協出荷指図トラン　変換　　＊＊＊".
000480 01  MSG-AREA.
000490     02  LINE  24.
000500       03  MSG-01      COLUMN  15  PIC  N(13)    VALUE
000510         NC"生協荷札データ未作成です。".
000520     COPY    LSSEM.
000530     COPY    LSMSG.
000540*
000550 PROCEDURE DIVISION.
000560 MAIN-01.
000570     PERFORM    INIT-RTN  THRU  INIT-EX.
000580     IF  W-FLG = 9
000590         MOVE     255  TO  COMPLETION-CODE
000600         GO TO    MAIN-03.
000610 MAIN-02.
000620     PERFORM    UPDT-RTN  THRU  UPDT-EX.
000630 MAIN-03.
000640     PERFORM    END-RTN  THRU  END-EX.
000650     STOP RUN.
000660*
000670*-----初期処理-----*
000680 INIT-RTN.
000690     INITIALIZE    W-DATA.
000700     DISPLAY    C-CLEAR  DSP-AREA.
000710 INIT-EX.
000720     EXIT.
000730*
000740*-----終了処理-----*
000750 END-RTN.
000760     DISPLAY    C-CLEAR.
000770 END-EX.
000780     EXIT.
000790*
000800*-----更新処理-----*
000810 UPDT-RTN.
000820     OPEN I-O      SSTR   JSTR.
000830     SELECT    SSTR
000840         WHERE    SSTR-158 = 1.
000850 UPDT-03.
000860     READ    SSTR      NEXT RECORD
000870         AT END    SCRATCH    SSTR
000880                   GO TO    UPDT-EX.
000890     PERFORM    WJSTR-RTN THRU  WJSTR-EX.
000900     PERFORM    RSSTR-RTN THRU  RSSTR-EX.
000910     GO TO    UPDT-03.
000920 UPDT-EX.
000930     EXIT.
000940*
000950*-----出荷指図トラン　追加処理-----*
000960 WJSTR-RTN.
000970     INITIALIZE  JSTR-R.
000980     MOVE    SSTR-R  TO  JSTR-R.
000990     WRITE   JSTR-R
001000         INVALID KEY    MOVE    "W"       TO  ERR-M
001010                        MOVE    "JSTR"    TO  ERR-F
001020                        MOVE    JSTR-KEY  TO  ERR-K
001030                        PERFORM    ERR-RTN  THRU  ERR-EX.
001040 WJSTR-EX.
001050     EXIT.
001060*
001070*-----生協出荷指図トラン　更新処理-----*
001080 RSSTR-RTN.
001090     MOVE    2        TO  SSTR-158.
001100     REWRITE    SSTR-R
001110         INVALID KEY    MOVE    "R"       TO  ERR-M
001120                        MOVE    "SSTR"    TO  ERR-F
001130                        MOVE    SSTR-KEY  TO  ERR-K
001140                        PERFORM    ERR-RTN  THRU  ERR-EX.
001150 RSSTR-EX.
001160     EXIT.
001170*****
001180     COPY    LPMSG.
