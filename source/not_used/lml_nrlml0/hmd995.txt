000010 IDENTIFICATION DIVISION.
000020 PROGRAM-ID. HMD990.
000030*************************************************************
000040*    PROGRAM         :  生協売上値引データ抽出（エクセル用）*
000050*    PRINTER TYPE    :  *****                               *
000060*    SCREEN          :  ******                              *
000070*    COMPILE TYPE    :  COBOL                               *
000080*************************************************************
000090 ENVIRONMENT DIVISION.
000100 CONFIGURATION SECTION.
000110 SOURCE-COMPUTER. SYSTEM100.
000120 OBJECT-COMPUTER. SYSTEM100.
000130 INPUT-OUTPUT SECTION.
000140 FILE-CONTROL.
000150     COPY LIBCSE.
000160     SELECT T-M ASSIGN TO T1-MSD T2-MSD
000170         ORGANIZATION INDEXED
000180         ACCESS MODE RANDOM
000190         RECORD KEY T-KEY
000200         ALTERNATE RECORD KEY T-KEY2
000210         FILE STATUS ERR-STAT.
000220     SELECT TC-M ASSIGN TO TC-MSD
000230         ORGANIZATION INDEXED
000240         ACCESS MODE RANDOM
000250         RECORD KEY TC-KEY
000260         FILE STATUS ERR-STAT.
000270     SELECT HI-M ASSIGN TO HI1-MSD HI2-MSD
000280         ORGANIZATION INDEXED
000290         ACCESS MODE RANDOM
000300         RECORD KEY HI-KEY
000310         ALTERNATE RECORD KEY HI-KEY2
000320         FILE STATUS ERR-STAT.
000330     SELECT SIKF ASSIGN TO SIK-FDU.
000340     SELECT SNTR-F ASSIGN TO SNTR-MSD.
000350 I-O-CONTROL.
000360     APPLY SHARED-MODE ON M-DATE
000370     APPLY SHARED-MODE ON T-M
000380     APPLY SHARED-MODE ON TC-M
000390     APPLY SHARED-MODE ON HI-M
000400     APPLY SHARED-MODE ON SNTR-F.
000410 DATA DIVISION.
000420 FILE SECTION.
000430     COPY LIBFDD.
000440     COPY LITM.
000450     COPY LITCM.
000460     COPY LIHIM.
000470 FD  SIKF
000480     BLOCK  1 RECORDS
000490     LABEL RECORD STANDARD
000500     VALUE OF IDENTIFICATION "SURIF".
000510 01  SIK-R1.
000520     02  F              PIC  X(006).
000530     02  F              PIC  X(001).
000540     02  SIK-TCD        PIC  9(008).
000550     02  SIK-TNA        PIC  N(026).
000560     02  F              PIC  X(006).
000570     02  F              PIC  X(048).
000580     02  F              PIC  X(004).
000590     02  F              PIC  X(006).
000600     02  F              PIC  X(004).
000610     02  F              PIC  X(005).
000620     02  F              PIC  X(008).
000630     02  F              PIC  X(048).
000640     02  SIK-1          PIC  9(001).
000650 01  SIK-R2.
000660     02  SIK-DNO        PIC  9(006).
000670     02  SIK-GNO        PIC  9(001).
000680     02  SIK-DATE       PIC  9(008).
000690     02  SIK-CNA        PIC  N(026).
000700     02  SIK-HCD        PIC  9(006).
000710     02  SIK-HNA        PIC  N(024).
000720     02  SIK-SIZ        PIC  X(004).
000730     02  SIK-KBN        PIC  N(003).
000740     02  SIK-SU         PIC S9(004).
000750     02  SIK-T          PIC S9(005).
000760     02  SIK-KIN        PIC S9(008).
000770     02  SIK-BI         PIC  N(024).
000780     02  SIK-2          PIC  9(001).
000790 FD  SNTR-F
000800     BLOCK  2 RECORDS
000810     LABEL RECORD STANDARD
000820     VALUE OF IDENTIFICATION "STRANYR".
000830 01  SNTR-R.
000840     02  SNTR-DNO       PIC  9(006).
000850     02  SNTR-GNO       PIC  9(001).
000860     02  SNTR-DATE.
000870       03  SNTR-NEN     PIC  9(004).
000880       03  SNTR-GET     PIC  9(002).
000890       03  SNTR-PEY     PIC  9(002).
000900     02  SNTR-TCD       PIC  9(004).
000910     02  SNTR-D1.
000920       03  SNTR-HCD     PIC  9(006).
000930       03  SNTR-SIZ     PIC  9(001).
000940       03  SNTR-ASU.
000950         04 SNTR-SUD   OCCURS  10.
000960           05  SNTR-SU  PIC S9(004)  COMP-3.
000970       03  SNTR-SUT     PIC S9(005).
000980       03  SNTR-T       PIC S9(005).
000990       03  SNTR-KIN     PIC S9(008).
001000       03  SNTR-CSC     PIC  9(001).
001010       03  SNTR-DC      PIC  9(001).
001020       03  F            PIC  X(005).
001030       03  SNTR-CCD     PIC  9(003).
001040       03  SNTR-BC1     PIC  9(002).
001050       03  F            PIC  X(041).
001060     02  SNTR-D2    REDEFINES SNTR-D1.
001070       03  SNTR-BI      PIC  N(024).
001080       03  F            PIC  X(036).
001090       03  SNTR-SHZ     PIC S9(007).
001100       03  F            PIC  X(017).
001110     02  SNTR-SNC       PIC  9(001).
001120 WORKING-STORAGE SECTION.
001130 01  W-DATA.
001140     02  W-D.
001150       03  W-STA        PIC  9(001).
001160       03  W-DMM        PIC  9(001).
001170       03  CHK          PIC  9(001).
001180       03  W-DNO        PIC  9(006).
001190       03  W-DC         PIC  9(001).
001200       03  CNT          PIC  9(002).
001210       03  W-C          PIC  9(002).
001220       03  W-SC         PIC  9(002).
001230       03  W-SNGP       PIC  9(008).
001240       03  W-SNGPD  REDEFINES W-SNGP.
001250         04  W-SNEN     PIC  9(004).
001260         04  W-SNENL  REDEFINES W-SNEN.
001270           05  W-SNEN1  PIC  9(002).
001280           05  W-SNEN2  PIC  9(002).
001290         04  W-SGET     PIC  9(002).
001300         04  W-SPEY     PIC  9(002).
001310       03  W-SNGPL  REDEFINES W-SNGP.
001320         04  F          PIC  9(002).
001330         04  W-SNGS     PIC  9(004).
001340         04  F          PIC  9(002).
001350       03  W-ENGP       PIC  9(008).
001360       03  W-ENGPD  REDEFINES W-ENGP.
001370         04  W-ENEN     PIC  9(004).
001380         04  W-EGET     PIC  9(002).
001390         04  W-EPEY     PIC  9(002).
001400     02  W-ASMD.
001410       03  F            PIC  X(040) VALUE
001420            "          SS   S   M   L  LL  XL XXL    ".
001430       03  F            PIC  X(040) VALUE
001440            "12.513.013.514.015.016.017.018.019.020.0".
001450       03  F            PIC  X(040) VALUE
001460            "21.021.522.022.523.023.524.024.525.0    ".
001470       03  F            PIC  X(040) VALUE
001480            "24.024.525.025.526.026.527.027.5        ".
001490     02  W-ASD.
001500       03  W-SD    OCCURS  40.
001510         04  W-S        PIC  X(004).
001520 01  W-AR.
001530     02  W-ARD   OCCURS  6.
001540       03  W-R.
001550         04  WR-DNO     PIC  9(006).
001560         04  WR-GNO     PIC  9(001).
001570         04  WR-DATE    PIC  9(008).
001580         04  WR-TCD     PIC  9(004).
001590         04  WR-HCD     PIC  9(006).
001600         04  WR-SIZ     PIC  9(001).
001610         04  WR-SUD   OCCURS  10.
001620           05  WR-SU    PIC S9(004)  COMP-3.
001630         04  WR-SUT     PIC S9(005).
001640         04  WR-T       PIC S9(005).
001650         04  WR-KIN     PIC S9(008).
001660         04  WR-CSC     PIC  9(001).
001670         04  WR-DC      PIC  9(001).
001680         04  F          PIC  X(005).
001690         04  WR-CCD     PIC  9(003).
001700         04  WR-BC1     PIC  9(002).
001710         04  F          PIC  X(041).
001720         04  WR-SNC     PIC  9(001).
001730 01  ERR-STAT           PIC  X(002).
001740     COPY LSTAT.
001750 SCREEN SECTION.
001760 SD  C-CRT
001770     END STATUS IS ESTAT.
001780 01  C-CLEAR.
001790     02  C-CL    LINE   1  CLEAR SCREEN.
001800 01  C-MID.
001810     02  LINE   3  COLUMN  10  PIC  N(020) VALUE
001820          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001830     02  LINE   4  COLUMN  10  PIC  N(020) VALUE
001840          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001850     02  LINE   5  COLUMN  10  PIC  N(020) VALUE
001860          NC"＊＊＊　　　　　　　　　　　　　　＊＊＊".
001870     02  LINE   6  COLUMN  10  PIC  N(020) VALUE
001880          NC"＊＊＊　　売上値引データ　抽出　　＊＊＊".
001890     02  LINE   7  COLUMN  10  PIC  N(020) VALUE
001900          NC"＊＊＊　　　（　コープ九州　）　　＊＊＊".
001910     02  LINE   8  COLUMN  10  PIC  N(020) VALUE
001920          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001930     02  LINE   9  COLUMN  10  PIC  N(020) VALUE
001940          NC"＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊".
001950     02  LINE  12  COLUMN  16  PIC  N(014) VALUE
001960          NC"フロッピーをセットして下さい" BLINK.
001970     02  LINE  16  COLUMN  11  PIC  X(038) VALUE
001980          "    年   月   日  〜      年   月   日".
001990     02  LINE  20  COLUMN  19  PIC  X(022) VALUE
002000          "確認  OK=1 NO=9   ﾘﾀｰﾝ".
002010 01  C-ACP.
002020     02  LINE  16.
002030       03  A-SNEN  COLUMN  11  PIC  9(004)
002040            USING W-SNEN  CHECK OVERFLOW NO IFC.
002050       03  A-SGET  COLUMN  18  PIC  9(002)
002060            USING W-SGET  CHECK OVERFLOW NO IFC.
002070       03  A-SPEY  COLUMN  23  PIC  9(002)
002080            USING W-SPEY  CHECK OVERFLOW NO IFC.
002090       03  A-ENEN  COLUMN  33  PIC  9(004)
002100            USING W-ENEN  CHECK OVERFLOW NO IFC.
002110       03  A-EGET  COLUMN  40  PIC  9(002)
002120            USING W-EGET  CHECK OVERFLOW NO IFC.
002130       03  A-EPEY  COLUMN  45  PIC  9(002)
002140            USING W-EPEY  CHECK OVERFLOW NO IFC.
002150     02  A-DMM   LINE  20  COLUMN  36  PIC  9(001)
002160          USING W-DMM   CHECK OVERFLOW NO IFC.
002170 01  C-ERR.
002180     02  LINE  24.
002190       03  E-ME1   COLUMN  15  PIC  X(017) VALUE
002200            "***  DATA ﾅｼ  ***".
002210       03  E-ME2   COLUMN  15  PIC  X(018) VALUE
002220            "***  DATA ｴﾗｰ  ***".
002230       03  E-ME98  COLUMN  75  PIC  X(005) VALUE ""27"J"05"".
002240       03  E-ME99  COLUMN  75  PIC  X(005) VALUE ""27"B"05"".
002250     COPY LIBSCR.
002260 PROCEDURE DIVISION.
002270 M-05.
002280     DISPLAY C-CLEAR.
002290     DISPLAY C-MID.
002300     MOVE ZERO TO W-D.
002310     COPY LIBCPR.
002320     MOVE D-NHNG TO W-SNGS.
002330     IF W-SNEN2 >= DATE-NF1 AND <= DATE-NT1
002340         ADD DATE-NC1 TO W-SNEN.
002350     IF W-SNEN2 >= DATE-NF2 AND <= DATE-NT2
002360         ADD DATE-NC2 TO W-SNEN.
002370     MOVE 1 TO W-SPEY.
002380     MOVE W-SNEN TO W-ENEN.
002390     MOVE W-SGET TO W-EGET.
002400     MOVE 99 TO W-EPEY.
002410     DISPLAY A-SNEN A-SGET A-SPEY A-ENEN A-EGET A-EPEY.
002420 M-10.
002430     ACCEPT A-SNEN.
002440     IF ESTAT = PF9
002450         GO TO M-95.
002460     IF ESTAT NOT = HTB AND SKP
002470         GO TO M-10.
002480     IF W-SNEN < 1998
002490         GO TO M-10.
002500 M-15.
002510     ACCEPT A-SGET.
002520     IF ESTAT = PF9
002530         GO TO M-10.
002540     IF ESTAT = BTB
002550         GO TO M-10.
002560     IF ESTAT NOT = HTB AND SKP
002570         GO TO M-10.
002580     IF W-SGET < 1 OR > 12
002590         GO TO M-15.
002600 M-20.
002610     ACCEPT A-SPEY.
002620     IF ESTAT = PF9
002630         GO TO M-95.
002640     IF ESTAT = BTB
002650         GO TO M-15.
002660     IF ESTAT NOT = HTB AND SKP
002670         GO TO M-20.
002680     IF W-SPEY > 31
002690         GO TO M-20.
002700 M-25.
002710     ACCEPT A-ENEN.
002720     IF ESTAT = BTB
002730         GO TO M-20.
002740     IF ESTAT NOT = HTB AND SKP
002750         GO TO M-25.
002760     IF W-SNEN > W-ENEN
002770         GO TO M-25.
002780 M-30.
002790     ACCEPT A-EGET.
002800     IF ESTAT = BTB
002810         GO TO M-25.
002820     IF ESTAT NOT = HTB AND SKP
002830         GO TO M-30.
002840     IF W-EGET < 1 OR > 12
002850         GO TO M-30.
002860 M-35.
002870     ACCEPT A-EPEY.
002880     IF ESTAT = BTB
002890         GO TO M-30.
002900     IF ESTAT NOT = HTB AND SKP
002910         GO TO M-35.
002920     IF W-EPEY NOT = 99
002930         IF W-EPEY > 31
002940             GO TO M-35.
002950     IF W-SNGP > W-ENGP
002960         GO TO M-35.
002970 M-40.
002980     ACCEPT A-DMM.
002990     IF ESTAT = BTB
003000         GO TO M-35.
003010     IF ESTAT NOT = HTB AND SKP
003020         GO TO M-40.
003030     IF W-DMM = 9
003040         GO TO M-10.
003050     IF W-DMM NOT = 1
003060         GO TO M-40.
003070*
003080     OPEN INPUT TC-M HI-M.
003090     OPEN INPUT SNTR-F.
003100     OPEN OUTPUT SIKF.
003110 M-45.
003120     READ SNTR-F AT END
003130         GO TO M-90.
003140     IF SNTR-DATE < W-SNGP OR > W-ENGP
003150         GO TO M-45.
003160     IF SNTR-TCD NOT = 3240
003170         GO TO M-45.
003180     IF SNTR-DC = 4
003190         GO TO M-45.
003200     IF SNTR-GNO = 9
003210         DISPLAY E-ME2 E-ME99
003220         GO TO M-90.
003230     IF W-STA NOT = 0
003240         GO TO M-50.
003250     MOVE 1 TO W-STA.
003260*
003270     OPEN INPUT T-M.
003280     MOVE SNTR-TCD TO T-KEY.
003290     READ T-M WITH UNLOCK INVALID KEY
003300         MOVE SPACE TO T-NAME.
003310*
003320     MOVE SPACE TO SIK-R1.
003330     MOVE SNTR-TCD TO SIK-TCD.
003340     MOVE T-NAME TO SIK-TNA.
003350     MOVE 1 TO SIK-1.
003360     WRITE SIK-R1.
003370     CLOSE T-M.
003380*
003390     MOVE W-ASMD TO W-ASD.
003400 M-50.
003410     MOVE SNTR-DNO TO W-DNO.
003420     INITIALIZE W-AR.
003430     MOVE 0 TO W-DC.
003440 M-55.
003450     ADD 1 TO W-DC.
003460     IF W-DC > 6
003470         DISPLAY E-ME2 E-ME99
003480         GO TO M-90.
003490     INITIALIZE W-R(W-DC).
003500     MOVE SNTR-R TO W-R(W-DC).
003510 M-60.
003520     READ SNTR-F AT END
003530         GO TO M-85.
003540     IF SNTR-DATE < W-SNGP OR > W-ENGP
003550         GO TO M-60.
003560     IF SNTR-TCD NOT = 3240
003570         GO TO M-60.
003580     IF SNTR-DC = 4
003590         GO TO M-60.
003600     IF SNTR-DNO NOT = W-DNO
003610         DISPLAY E-ME2 E-ME99
003620         GO TO M-90.
003630     IF SNTR-GNO NOT = 9
003640         GO TO M-55.
003650*
003660     PERFORM S-05 THRU S-20.
003670     GO TO M-45.
003680 M-85.
003690     PERFORM S-05 THRU S-20.
003700 M-90.
003710     CLOSE TC-M HI-M.
003720     CLOSE SNTR-F.
003730     CLOSE SIKF.
003740 M-95.
003750     DISPLAY C-CLEAR.
003760     STOP RUN.
003770 S-05.
003780     MOVE WR-TCD(1) TO TC-TCD.
003790     IF WR-CCD(1) = ZERO
003800         MOVE 001 TO TC-CCD
003810       ELSE
003820         MOVE WR-CCD(1) TO TC-CCD.
003830     READ TC-M WITH UNLOCK INVALID KEY
003840         MOVE SPACE TO TC-NAME.
003850     MOVE 0 TO W-DC.
003860 S-10.
003870     ADD 1 TO W-DC.
003880     IF W-DC > 6
003890         GO TO S-20.
003900     IF WR-GNO(W-DC) = 0
003910         GO TO S-20.
003920*
003930     MOVE WR-HCD(W-DC) TO HI-KEY.                                 I.030117
003940     READ HI-M WITH UNLOCK INVALID KEY                            I.030117
003950         MOVE SPACE TO HI-NAME.                                   I.030117
003960     IF WR-SNC(W-DC) = 1                                          I.030117
003970         GO TO S-17.                                              I.030117
003980*
003990     MOVE ZERO TO CNT W-C.
004000     IF WR-SIZ(W-DC) = 2
004010         ADD 10 TO W-C.
004020     IF WR-SIZ(W-DC) = 3
004030         ADD 20 TO W-C.
004040     IF WR-SIZ(W-DC) = 4
004050         ADD 30 TO W-C.
004060 S-15.
004070     ADD 1 TO CNT.
004080     IF CNT > 10
004090         GO TO S-10.
004100     IF WR-SU(W-DC,CNT) = ZERO
004110         GO TO S-15.
004120     COMPUTE W-SC = W-C + CNT.
004130*
004140*****MOVE WR-HCD(W-DC) TO HI-KEY.                                 D.030117
004150*****READ HI-M WITH UNLOCK INVALID KEY                            D.030117
004160*****    MOVE SPACE TO HI-NAME.                                   D.030117
004170 S-17.                                                            I.030117
004180     MOVE SPACE TO SIK-R2.
004190     MOVE WR-DNO(W-DC) TO SIK-DNO.
004200     MOVE WR-GNO(W-DC) TO SIK-GNO.
004210     MOVE WR-DATE(W-DC) TO SIK-DATE.
004220     MOVE TC-NAME TO SIK-CNA.
004230     MOVE WR-HCD(W-DC) TO SIK-HCD.
004240     MOVE HI-NAME TO SIK-HNA.
004250     IF WR-SNC(W-DC) = 0                                          I.030117
004260         MOVE W-S(W-SC) TO SIK-SIZ.
004270     IF WR-DC(W-DC) = 0
004280         MOVE NC"売　上" TO SIK-KBN.
004290     IF WR-DC(W-DC) = 1
004300         MOVE NC"返　品" TO SIK-KBN.
004310     IF WR-DC(W-DC) = 2
004320         MOVE NC"不良返" TO SIK-KBN.
004330     IF WR-DC(W-DC) = 3
004340         MOVE NC"預　り" TO SIK-KBN.
004350     IF WR-DC(W-DC) = 5
004360         MOVE NC"振　替" TO SIK-KBN.
004370     IF WR-SNC(W-DC) = 1
004380         MOVE NC"値　引" TO SIK-KBN.
004390     IF WR-DC(W-DC) = 8
004400         MOVE NC"調　整" TO SIK-KBN.
004410     IF WR-SNC(W-DC) = 1 OR 3
004420*****    MOVE WR-SU(W-DC,CNT) TO SIK-SU                           D.030117
004430         MOVE WR-SUT(W-DC) TO SIK-SU                              I.030117
004440         COMPUTE SIK-T = WR-T(W-DC) * -1
004450         COMPUTE SIK-KIN = SIK-SU * SIK-T                         I.030115
004460*****    COMPUTE SIK-KIN = WR-KIN(W-DC) * -1                      D.030115
004470       ELSE
004480         IF WR-DC(W-DC) = 1 OR 2 OR 5
004490             COMPUTE SIK-SU = WR-SU(W-DC,CNT) * -1
004500             MOVE WR-T(W-DC) TO SIK-T
004510             COMPUTE SIK-KIN = SIK-SU * SIK-T                     I.030115
004520*****        COMPUTE SIK-KIN = WR-KIN(W-DC) * -1                  D.030115
004530           ELSE
004540             MOVE WR-SU(W-DC,CNT) TO SIK-SU
004550             MOVE WR-T(W-DC) TO SIK-T
004560             COMPUTE SIK-KIN = SIK-SU * SIK-T.                    I.030115
004570*****        MOVE WR-KIN(W-DC) TO SIK-KIN.                        D.030115
004580     IF SNTR-DNO = W-DNO
004590         IF SNTR-GNO = 9
004600             MOVE SNTR-BI TO SIK-BI.
004610     MOVE 2 TO SIK-2.
004620     WRITE SIK-R2.
004630     IF WR-SNC(W-DC) = 1                                          I.030117
004640         GO TO S-10.                                              I.030117
004650     GO TO S-15.
004660 S-20.
004670     EXIT.
